var requirejs,require,define;(function(global){function isFunction(a){return ostring.call(a)==="[object Function]"}function isArray(a){return ostring.call(a)==="[object Array]"}function each(a,b){if(a){var c;for(c=0;c<a.length;c+=1)if(a[c]&&b(a[c],c,a))break}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1;c-=1)if(a[c]&&b(a[c],c,a))break}}function hasProp(a,b){return hasOwn.call(a,b)}function eachProp(a,b){var c;for(c in a)if(a.hasOwnProperty(c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){if(c||!hasProp(a,e))d&&typeof b!="string"?(a[e]||(a[e]={}),mixin(a[e],b,c,d)):a[e]=b}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeContextModuleFunc(a,b,c){return function(){var d=aps.call(arguments,0),e;return c&&isFunction(e=d[d.length-1])&&(e.__requireJsBuild=!0),d.push(b),a.apply(null,d)}}function addRequireMethods(a,b,c){each([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(d){var e=d[1]||d[0];a[d[0]]=b?makeContextModuleFunc(b[e],c):function(){var a=contexts[defContextName];return a[e].apply(a,arguments)}})}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function p(a){var b,c;for(b=0;a[b];b+=1){c=a[b];if(c===".")a.splice(b,1),b-=1;else if(c===".."){if(b===1&&(a[2]===".."||a[0]===".."))break;b>0&&(a.splice(b-1,2),b-=2)}}}function q(a,b,c){var d,e,f,h,i,j,k,l,m,n,o,q=b&&b.split("/"),r=q,s=g.map,t=s&&s["*"];a&&a.charAt(0)==="."&&(b?(g.pkgs[b]?r=q=[b]:r=q.slice(0,q.length-1),a=r.concat(a.split("/")),p(a),e=g.pkgs[d=a[0]],a=a.join("/"),e&&a===d+"/"+e.main&&(a=d)):a.indexOf("./")===0&&(a=a.substring(2)));if(c&&(q||t)&&s){h=a.split("/");for(i=h.length;i>0;i-=1){k=h.slice(0,i).join("/");if(q)for(j=q.length;j>0;j-=1){f=s[q.slice(0,j).join("/")];if(f){f=f[k];if(f){l=f,m=i;break}}}if(l)break;!n&&t&&t[k]&&(n=t[k],o=i)}!l&&n&&(l=n,m=o),l&&(h.splice(0,m,l),a=h.join("/"))}return a}function r(a){isBrowser&&each(scripts(),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===d.contextName)return b.parentNode.removeChild(b),!0})}function s(a){var b=g.paths[a];if(b&&isArray(b)&&b.length>1)return r(a),b.shift(),d.undef(a),d.require([a]),!0}function t(a,b,c,e){var f,g,h,i=a?a.indexOf("!"):-1,j=null,l=b?b.name:null,o=a,p=!0,r="";return a||(p=!1,a="_@r"+(m+=1)),i!==-1&&(j=a.substring(0,i),a=a.substring(i+1,a.length)),j&&(j=q(j,l,e),g=k[j]),a&&(j?g&&g.normalize?r=g.normalize(a,function(a){return q(a,l,e)}):r=q(a,l,e):(r=q(a,l,e),f=d.nameToUrl(r))),h=j&&!g&&!c?"_unnormalized"+(n+=1):"",{prefix:j,name:r,parentMap:b,unnormalized:!!h,url:f,originalName:o,isDefine:p,id:(j?j+"!"+r:r)+h}}function u(a){var b=a.id,c=h[b];return c||(c=h[b]=new d.Module(a)),c}function v(a,b,c){var d=a.id,e=h[d];hasProp(k,d)&&(!e||e.defineEmitComplete)?b==="defined"&&c(k[d]):u(a).on(b,c)}function w(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=h[b];c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function x(){globalDefQueue.length&&(apsp.apply(j,[j.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function y(a,b,c){var e=a&&a.map,f=makeContextModuleFunc(c||d.require,e,b);return addRequireMethods(f,d,e),f.isBrowser=isBrowser,f}function z(a){delete h[a],each(o,function(b,c){if(b.map.id===a)return o.splice(c,1),b.defined||(d.waitCount-=1),!0})}function A(a,b){var c=a.map.id,d=a.depMaps,e;if(!a.inited)return;return b[c]?a:(b[c]=!0,each(d,function(a){var d=a.id,f=h[d];if(!f)return;return!f.inited||!f.enabled?(e=null,delete b[c],!0):e=A(f,mixin({},b))}),e)}function B(a,b,c){var d=a.map.id,f=a.depMaps;if(!a.inited||!a.map.isDefine)return;return b[d]?k[d]:(b[d]=a,each(f,function(f){var g=f.id,i=h[g],j;if(e[g])return;if(i){if(!i.inited||!i.enabled){c[d]=!0;return}j=B(i,b,c),c[g]||a.defineDepById(g,j)}}),a.check(!0),k[d])}function C(a){a.check()}function D(){var a,c,e,i,j=g.waitSeconds*1e3,k=j&&d.startTime+j<(new Date).getTime(),l=[],m=!1,n=!0;if(b)return;b=!0,eachProp(h,function(b){a=b.map,c=a.id;if(!b.enabled)return;if(!b.error)if(!b.inited&&k)s(c)?(i=!0,m=!0):(l.push(c),r(c));else if(!b.inited&&b.fetched&&a.isDefine){m=!0;if(!a.prefix)return n=!1}});if(k&&l.length)return e=makeError("timeout","Load timeout for modules: "+l,null,l),e.contextName=d.contextName,w(e);n&&(each(o,function(a){if(a.defined)return;var b=A(a,{}),c={};b&&(B(b,c,{}),eachProp(c,C))}),eachProp(h,C)),(!k||i)&&m&&(isBrowser||isWebWorker)&&!f&&(f=setTimeout(function(){f=0,D()},50)),b=!1}function E(a){u(t(a[0],null,!0)).init(a[1],a[2])}function F(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function G(a){var b=a.currentTarget||a.srcElement;return F(b,d.onScriptLoad,"load","onreadystatechange"),F(b,d.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}var b,c,d,e,f,g={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},h={},i={},j=[],k={},l={},m=1,n=1,o=[];return e={require:function(a){return y(a)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports=k[a.map.id]={}},module:function(a){return a.module={id:a.map.id,uri:a.map.url,config:function(){return g.config&&g.config[a.map.id]||{}},exports:k[a.map.id]}}},c=function(a){this.events=i[a.id]||{},this.map=a,this.shim=g.shim[a.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},c.prototype={init:function(a,b,c,d){d=d||{};if(this.inited)return;this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.depMaps.rjsSkipMap=a.rjsSkipMap,this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check()},defineDepById:function(a,b){var c;return each(this.depMaps,function(b,d){if(b.id===a)return c=d,!0}),this.defineDep(c,b)},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(this.fetched)return;this.fetched=!0,d.startTime=(new Date).getTime();var a=this.map;if(!this.shim)return a.prefix?this.callPlugin():this.load();y(this,!0)(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()}))},load:function(){var a=this.map.url;l[a]||(l[a]=!0,d.load(this.map.id,a))},check:function(a){if(!this.enabled||this.enabling)return;var b,c,e=this.map.id,f=this.depExports,g=this.exports,i=this.factory;if(!this.inited)this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(isFunction(i)){if(this.events.error)try{g=d.execCb(e,i,f,g)}catch(j){b=j}else g=d.execCb(e,i,f,g);this.map.isDefine&&(c=this.module,c&&c.exports!==undefined&&c.exports!==this.exports?g=c.exports:g===undefined&&this.usingExports&&(g=this.exports));if(b)return b.requireMap=this.map,b.requireModules=[this.map.id],b.requireType="define",w(this.error=b)}else g=i;this.exports=g,this.map.isDefine&&!this.ignore&&(k[e]=g,req.onResourceLoad&&req.onResourceLoad(d,this.map,this.depMaps)),delete h[e],this.defined=!0,d.waitCount-=1,d.waitCount===0&&(o=[])}this.defining=!1,a||this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}},callPlugin:function(){var a=this.map,b=a.id,c=t(a.prefix,null,!1,!0);v(c,"defined",bind(this,function(c){var e,f,i,j=this.map.name,k=this.map.parentMap?this.map.parentMap.name:null;if(this.map.unnormalized){c.normalize&&(j=c.normalize(j,function(a){return q(a,k,!0)})||""),f=t(a.prefix+"!"+j,this.map.parentMap,!1,!0),v(f,"defined",bind(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),i=h[f.id],i&&(this.events.error&&i.on("error",bind(this,function(a){this.emit("error",a)})),i.enable());return}e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(h,function(a){a.map.id.indexOf(b+"_unnormalized")===0&&z(a.map.id)}),w(a)}),e.fromText=function(a,b){var c=useInteractive;c&&(useInteractive=!1),u(t(a)),req.exec(b),c&&(useInteractive=!0),d.completeLoad(a)},c.load(a.name,y(a.parentMap,!0,function(a,b,c){return a.rjsSkipMap=!0,d.require(a,b,c)}),e,g)})),d.enable(c,this),this.pluginMaps[c.id]=c},enable:function(){this.enabled=!0,this.waitPushed||(o.push(this),d.waitCount+=1,this.waitPushed=!0),this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,f,g;if(typeof a=="string"){a=t(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.depMaps.rjsSkipMap),this.depMaps[b]=a,g=e[a.id];if(g){this.depExports[b]=g(this);return}this.depCount+=1,v(a,"defined",bind(this,function(a){this.defineDep(b,a),this.check()})),this.errback&&v(a,"error",this.errback)}c=a.id,f=h[c],!e[c]&&f&&!f.enabled&&d.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=h[a.id];b&&!b.enabled&&d.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),a==="error"&&delete this.events[a]}},d={config:g,contextName:a,registry:h,defined:k,urlFetched:l,waitCount:0,defQueue:j,Module:c,makeModuleMap:t,configure:function(a){a.baseUrl&&a.baseUrl.charAt(a.baseUrl.length-1)!=="/"&&(a.baseUrl+="/");var b=g.pkgs,c=g.shim,e=g.paths,f=g.map;mixin(g,a,!0),g.paths=mixin(e,a.paths,!0),a.map&&(g.map=mixin(f||{},a.map,!0,!0)),a.shim&&(eachProp(a.shim,function(a,b){isArray(a)&&(a={deps:a}),a.exports&&!a.exports.__buildReady&&(a.exports=d.makeShimExports(a.exports)),c[b]=a}),g.shim=c),a.packages&&(each(a.packages,function(a){var c;a=typeof a=="string"?{name:a}:a,c=a.location,b[a.name]={name:a.name,location:c||a.name,main:(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),g.pkgs=b),eachProp(h,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=t(b))}),(a.deps||a.callback)&&d.require(a.deps||[],a.callback)},makeShimExports:function(a){var b;return typeof a=="string"?(b=function(){return getGlobal(a)},b.exports=a,b):function(){return a.apply(global,arguments)}},requireDefined:function(a,b){return hasProp(k,t(a,b,!1,!0).id)},requireSpecified:function(a,b){return a=t(a,b,!1,!0).id,hasProp(k,a)||hasProp(h,a)},require:function(b,c,e,f){var g,h,i,l,m;if(typeof b=="string")return isFunction(c)?w(makeError("requireargs","Invalid require call"),e):req.get?req.get(d,b,c):(g=b,f=c,i=t(g,f,!1,!0),h=i.id,hasProp(k,h)?k[h]:w(makeError("notloaded",'Module name "'+h+'" has not been loaded yet for context: '+a)));e&&!isFunction(e)&&(f=e,e=undefined),c&&!isFunction(c)&&(f=c,c=undefined),x();while(j.length){m=j.shift();if(m[0]===null)return w(makeError("mismatch","Mismatched anonymous define() module: "+m[m.length-1]));E(m)}return l=u(t(null,f)),l.init(b,c,e,{enabled:!0}),D(),d.require},undef:function(a){x();var b=t(a,null,!0),c=h[a];delete k[a],delete l[b.url],delete i[a],c&&(c.events.defined&&(i[a]=c.events),z(a))},enable:function(a,b){var c=h[a.id];c&&u(a).enable()},completeLoad:function(a){var b,c,d,e=g.shim[a]||{},f=e.exports&&e.exports.exports;x();while(j.length){c=j.shift();if(c[0]===null){c[0]=a;if(b)break;b=!0}else c[0]===a&&(b=!0);E(c)}d=h[a];if(!b&&!k[a]&&d&&!d.inited){if(g.enforceDefine&&(!f||!getGlobal(f))){if(s(a))return;return w(makeError("nodefine","No define call for "+a,null,[a]))}E([a,e.deps||[],e.exports])}D()},toUrl:function(a,b){var c=a.lastIndexOf("."),e=null;return c!==-1&&(e=a.substring(c,a.length),a=a.substring(0,c)),d.nameToUrl(q(a,b&&b.id,!0),e)},nameToUrl:function(a,b){var c,d,e,f,h,i,j,k,l;if(req.jsExtRegExp.test(a))k=a+(b||"");else{c=g.paths,d=g.pkgs,h=a.split("/");for(i=h.length;i>0;i-=1){j=h.slice(0,i).join("/"),e=d[j],l=c[j];if(l){isArray(l)&&(l=l[0]),h.splice(0,i,l);break}if(e){a===e.name?f=e.location+"/"+e.main:f=e.location,h.splice(0,i,f);break}}k=h.join("/"),k+=b||(/\?/.test(k)?"":".js"),k=(k.charAt(0)==="/"||k.match(/^[\w\+\.\-]+:/)?"":g.baseUrl)+k}return g.urlArgs?k+((k.indexOf("?")===-1?"?":"&")+g.urlArgs):k},load:function(a,b){req.load(d,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if(a.type==="load"||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=G(a);d.completeLoad(b.id)}},onScriptError:function(a){var b=G(a);if(!s(b.id))return w(makeError("scripterror","Script error",a,[b.id]))}}}function getInteractiveScript(){return interactiveScript&&interactiveScript.readyState==="interactive"?interactiveScript:(eachReverse(scripts(),function(a){if(a.readyState==="interactive")return interactiveScript=a}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.0.5",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,aps=ap.slice,apsp=ap.splice,isBrowser=typeof window!="undefined"&&!!navigator&&!!document,isWebWorker=!isBrowser&&typeof importScripts!="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(typeof define!="undefined")return;if(typeof requirejs!="undefined"){if(isFunction(requirejs))return;cfg=requirejs,requirejs=undefined}typeof require!="undefined"&&!isFunction(require)&&(cfg=require,require=undefined),req=requirejs=function(a,b,c,d){var e,f,g=defContextName;return!isArray(a)&&typeof a!="string"&&(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=contexts[g],e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),addRequireMethods(req),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=function(a){throw a},req.load=function(a,b,c){var d=a&&a.config||{},e;if(isBrowser)return e=d.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),e.type=d.scriptType||"text/javascript",e.charset="utf-8",e.async=!0,e.setAttribute("data-requirecontext",a.contextName),e.setAttribute("data-requiremodule",b),e.attachEvent&&!(e.attachEvent.toString&&e.attachEvent.toString().indexOf("[native code")<0)&&!isOpera?(useInteractive=!0,e.attachEvent("onreadystatechange",a.onScriptLoad)):(e.addEventListener("load",a.onScriptLoad,!1),e.addEventListener("error",a.onScriptError,!1)),e.src=c,currentlyAddingScript=e,baseElement?head.insertBefore(e,baseElement):head.appendChild(e),currentlyAddingScript=null,e;isWebWorker&&(importScripts(c),a.completeLoad(b))},isBrowser&&eachReverse(scripts(),function(a){head||(head=a.parentNode),dataMain=a.getAttribute("data-main");if(dataMain)return cfg.baseUrl||(src=dataMain.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath,dataMain=mainScript),dataMain=dataMain.replace(jsSuffixRegExp,""),cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain],!0}),define=function(a,b,c){var d,e;typeof a!="string"&&(c=b,b=a,a=null),isArray(b)||(c=b,b=[]),!b.length&&isFunction(c)&&c.length&&(c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)}),b=(c.length===1?["require"]:["require","exports","module"]).concat(b)),useInteractive&&(d=currentlyAddingScript||getInteractiveScript(),d&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")])),(e?e.defQueue:globalDefQueue).push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)})(this),function(){(function(a,b){function c(a){var b=ob[a]={};return $.each(a.split(bb),function(a,c){b[c]=!0}),b}function d(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(qb,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:+d+""===d?+d:pb.test(d)?$.parseJSON(d):d}catch(f){}$.data(a,c,d)}else d=b}return d}function e(a){var b;for(b in a){if(b==="data"&&$.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function f(){return!1}function g(){return!0}function h(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function i(a,b){do a=a[b];while(a&&a.nodeType!==1);return a}function j(a,b,c){b=b||0;if($.isFunction(b))return $.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return $.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=$.grep(a,function(a){return a.nodeType===1});if(Kb.test(b))return $.filter(b,d,!c);b=$.filter(b,d)}return $.grep(a,function(a,d){return $.inArray(a,b)>=0===c})}function k(a){var b=Nb.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function l(a,b){return a.getElementsByTagName(b)[0]||a.appendChild(a.ownerDocument.createElement(b))}function m(a,b){if(b.nodeType!==1||!$.hasData(a))return;var c,d,e,f=$._data(a),g=$._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;d<e;d++)$.event.add(b,c,h[c][d])}g.data&&(g.data=$.extend({},g.data))}function n(a,b){var c;if(b.nodeType!==1)return;b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),c==="object"?(b.parentNode&&(b.outerHTML=a.outerHTML),$.support.html5Clone&&a.innerHTML&&!$.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):c==="input"&&Xb.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):c==="option"?b.selected=a.defaultSelected:c==="input"||c==="textarea"?b.defaultValue=a.defaultValue:c==="script"&&b.text!==a.text&&(b.text=a.text),b.removeAttribute($.expando)}function o(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function p(a){Xb.test(a.type)&&(a.defaultChecked=a.checked)}function q(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=qc.length;while(e--){b=qc[e]+c;if(b in a)return b}return d}function r(a,b){return a=b||a,$.css(a,"display")==="none"||!$.contains(a.ownerDocument,a)}function s(a,b){var c,d,e=[],f=0,g=a.length;for(;f<g;f++){c=a[f];if(!c.style)continue;e[f]=$._data(c,"olddisplay"),b?(!e[f]&&c.style.display==="none"&&(c.style.display=""),c.style.display===""&&r(c)&&(e[f]=$._data(c,"olddisplay",w(c.nodeName)))):(d=cc(c,"display"),!e[f]&&d!=="none"&&$._data(c,"olddisplay",d))}for(f=0;f<g;f++){c=a[f];if(!c.style)continue;if(!b||c.style.display==="none"||c.style.display==="")c.style.display=b?e[f]||"":"none"}return a}function t(a,b,c){var d=jc.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function u(a,b,c,d){var e=c===(d?"border":"content")?4:b==="width"?1:0,f=0;for(;e<4;e+=2)c==="margin"&&(f+=$.css(a,c+pc[e],!0)),d?(c==="content"&&(f-=parseFloat(cc(a,"padding"+pc[e]))||0),c!=="margin"&&(f-=parseFloat(cc(a,"border"+pc[e]+"Width"))||0)):(f+=parseFloat(cc(a,"padding"+pc[e]))||0,c!=="padding"&&(f+=parseFloat(cc(a,"border"+pc[e]+"Width"))||0));return f}function v(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=!0,f=$.support.boxSizing&&$.css(a,"boxSizing")==="border-box";if(d<=0){d=cc(a,b);if(d<0||d==null)d=a.style[b];if(kc.test(d))return d;e=f&&($.support.boxSizingReliable||d===a.style[b]),d=parseFloat(d)||0}return d+u(a,b,c||(f?"border":"content"),e)+"px"}function w(a){if(mc[a])return mc[a];var b=$("<"+a+">").appendTo(P.body),c=b.css("display");b.remove();if(c==="none"||c===""){dc=P.body.appendChild(dc||$.extend(P.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!ec||!dc.createElement)ec=(dc.contentWindow||dc.contentDocument).document,ec.write("<!doctype html><html><body>"),ec.close();b=ec.body.appendChild(ec.createElement(a)),c=cc(b,"display"),P.body.removeChild(dc)}return mc[a]=c,c}function x(a,b,c,d){var e;if($.isArray(b))$.each(b,function(b,e){c||tc.test(a)?d(a,e):x(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)});else if(!c&&$.type(b)==="object")for(e in b)x(a+"["+e+"]",b[e],c,d);else d(a,b)}function y(a){return function(b,c){typeof b!="string"&&(c=b,b="*");var d,e,f,g=b.toLowerCase().split(bb),h=0,i=g.length;if($.isFunction(c))for(;h<i;h++)d=g[h],f=/^\+/.test(d),f&&(d=d.substr(1)||"*"),e=a[d]=a[d]||[],e[f?"unshift":"push"](c)}}function z(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h,i=a[f],j=0,k=i?i.length:0,l=a===Jc;for(;j<k&&(l||!h);j++)h=i[j](c,d,e),typeof h=="string"&&(!l||g[h]?h=b:(c.dataTypes.unshift(h),h=z(a,c,d,e,h,g)));return(l||!h)&&!g["*"]&&(h=z(a,c,d,e,"*",g)),h}function A(a,c){var d,e,f=$.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&$.extend(!0,a,e)}function B(a,c,d){var e,f,g,h,i=a.contents,j=a.dataTypes,k=a.responseFields;for(f in k)f in d&&(c[k[f]]=d[f]);while(j[0]==="*")j.shift(),e===b&&(e=a.mimeType||c.getResponseHeader("content-type"));if(e)for(f in i)if(i[f]&&i[f].test(e)){j.unshift(f);break}if(j[0]in d)g=j[0];else{for(f in d){if(!j[0]||a.converters[f+" "+j[0]]){g=f;break}h||(h=f)}g=g||h}if(g)return g!==j[0]&&j.unshift(g),d[g]}function C(a,b){var c,d,e,f,g=a.dataTypes.slice(),h=g[0],i={},j=0;a.dataFilter&&(b=a.dataFilter(b,a.dataType));if(g[1])for(c in a.converters)i[c.toLowerCase()]=a.converters[c];for(;e=g[++j];)if(e!=="*"){if(h!=="*"&&h!==e){c=i[h+" "+e]||i["* "+e];if(!c)for(d in i){f=d.split(" ");if(f[1]===e){c=i[h+" "+f[0]]||i["* "+f[0]];if(c){c===!0?c=i[d]:i[d]!==!0&&(e=f[0],g.splice(j--,0,e));break}}}if(c!==!0)if(c&&a["throws"])b=c(b);else try{b=c(b)}catch(k){return{state:"parsererror",error:c?k:"No conversion from "+h+" to "+e}}}h=e}return{state:"success",data:b}}function D(){try{return new a.XMLHttpRequest}catch(b){}}function E(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function F(){return setTimeout(function(){Uc=b},0),Uc=$.now()}function G(a,b){$.each(b,function(b,c){var d=($c[b]||[]).concat($c["*"]),e=0,f=d.length;for(;e<f;e++)if(d[e].call(a,b,c))return})}function H(a,b,c){var d,e=0,f=0,g=Zc.length,h=$.Deferred().always(function(){delete i.elem}),i=function(){var b=Uc||F(),c=Math.max(0,j.startTime+j.duration-b),d=1-(c/j.duration||0),e=0,f=j.tweens.length;for(;e<f;e++)j.tweens[e].run(d);return h.notifyWith(a,[j,d,c]),d<1&&f?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:$.extend({},b),opts:$.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Uc||F(),duration:c.duration,tweens:[],createTween:function(b,c,d){var e=$.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(e),e},stop:function(b){var c=0,d=b?j.tweens.length:0;for(;c<d;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;I(k,j.opts.specialEasing);for(;e<g;e++){d=Zc[e].call(j,a,k,j.opts);if(d)return d}return G(j,k),$.isFunction(j.opts.start)&&j.opts.start.call(a,j),$.fx.timer($.extend(i,{anim:j,queue:j.opts.queue,elem:a})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function I(a,b){var c,d,e,f,g;for(c in a){d=$.camelCase(c),e=b[d],f=a[c],$.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=$.cssHooks[d];if(g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}}function J(a,b,c){var d,e,f,g,h,i,j,k,l=this,m=a.style,n={},o=[],p=a.nodeType&&r(a);c.queue||(j=$._queueHooks(a,"fx"),j.unqueued==null&&(j.unqueued=0,k=j.empty.fire,j.empty.fire=function(){j.unqueued||k()}),j.unqueued++,l.always(function(){l.always(function(){j.unqueued--,$.queue(a,"fx").length||j.empty.fire()})})),a.nodeType===1&&("height"in b||"width"in b)&&(c.overflow=[m.overflow,m.overflowX,m.overflowY],$.css(a,"display")==="inline"&&$.css(a,"float")==="none"&&(!$.support.inlineBlockNeedsLayout||w(a.nodeName)==="inline"?m.display="inline-block":m.zoom=1)),c.overflow&&(m.overflow="hidden",$.support.shrinkWrapBlocks||l.done(function(){m.overflow=c.overflow[0],m.overflowX=c.overflow[1],m.overflowY=c.overflow[2]}));for(d in b){f=b[d];if(Wc.exec(f)){delete b[d];if(f===(p?"hide":"show"))continue;o.push(d)}}g=o.length;if(g){h=$._data(a,"fxshow")||$._data(a,"fxshow",{}),p?$(a).show():l.done(function(){$(a).hide()}),l.done(function(){var b;$.removeData(a,"fxshow",!0);for(b in n)$.style(a,b,n[b])});for(d=0;d<g;d++)e=o[d],i=l.createTween(e,p?h[e]:0),n[e]=h[e]||$.style(a,e),e in h||(h[e]=i.start,p&&(i.end=i.start,i.start=e==="width"||e==="height"?1:0))}}function K(a,b,c,d,e){return new K.prototype.init(a,b,c,d,e)}function L(a,b){var c,d={height:a},e=0;for(;e<4;e+=2-b)c=pc[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function M(a){return $.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}var N,O,P=a.document,Q=a.location,R=a.navigator,S=a.jQuery,T=a.$,U=Array.prototype.push,V=Array.prototype.slice,W=Array.prototype.indexOf,X=Object.prototype.toString,Y=Object.prototype.hasOwnProperty,Z=String.prototype.trim,$=function(a,b){return new $.fn.init(a,b,N)},_=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,ab=/\S/,bb=/\s+/,cb=ab.test("Â ")?/^[\s\xA0]+|[\s\xA0]+$/g:/^\s+|\s+$/g,db=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,eb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,fb=/^[\],:{}\s]*$/,gb=/(?:^|:|,)(?:\s*\[)+/g,hb=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,ib=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,jb=/^-ms-/,kb=/-([\da-z])/gi,lb=function(a,b){return(b+"").toUpperCase()},mb=function(){P.addEventListener?(P.removeEventListener("DOMContentLoaded",mb,!1),$.ready()):P.readyState==="complete"&&(P.detachEvent("onreadystatechange",mb),$.ready())},nb={};$.fn=$.prototype={constructor:$,init:function(a,c,d){var e,f,g,h;if(!a)return this;if(a.nodeType)return this.context=this[0]=a,this.length=1,this;if(typeof a=="string"){a.charAt(0)==="<"&&a.charAt(a.length-1)===">"&&a.length>=3?e=[null,a,null]:e=db.exec(a);if(e&&(e[1]||!c)){if(e[1])return c=c instanceof $?c[0]:c,h=c&&c.nodeType?c.ownerDocument||c:P,a=$.parseHTML(e[1],h,!0),eb.test(e[1])&&$.isPlainObject(c)&&this.attr.call(a,c,!0),$.merge(this,a);f=P.getElementById(e[2]);if(f&&f.parentNode){if(f.id!==e[2])return d.find(a);this.length=1,this[0]=f}return this.context=P,this.selector=a,this}return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a)}return $.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),$.makeArray(a,this))},selector:"",jquery:"1.8.0",length:0,size:function(){return this.length},toArray:function(){return V.call(this)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=$.merge(this.constructor(),a);return d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")"),d},each:function(a,b){return $.each(this,a,b)},ready:function(a){return $.ready.promise().done(a),this},eq:function(a){return a=+a,a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(V.apply(this,arguments),"slice",V.call(arguments).join(","))},map:function(a){return this.pushStack($.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:U,sort:[].sort,splice:[].splice},$.fn.init.prototype=$.fn,$.extend=$.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;typeof h=="boolean"&&(k=h,h=arguments[1]||{},i=2),typeof h!="object"&&!$.isFunction(h)&&(h={}),j===i&&(h=this,--i);for(;i<j;i++)if((a=arguments[i])!=null)for(c in a){d=h[c],e=a[c];if(h===e)continue;k&&e&&($.isPlainObject(e)||(f=$.isArray(e)))?(f?(f=!1,g=d&&$.isArray(d)?d:[]):g=d&&$.isPlainObject(d)?d:{},h[c]=$.extend(k,g,e)):e!==b&&(h[c]=e)}return h},$.extend({noConflict:function(b){return a.$===$&&(a.$=T),b&&a.jQuery===$&&(a.jQuery=S),$},isReady:!1,readyWait:1,holdReady:function(a){a?$.readyWait++:$.ready(!0)},ready:function(a){if(a===!0?--$.readyWait:$.isReady)return;if(!P.body)return setTimeout($.ready,1);$.isReady=!0;if(a!==!0&&--$.readyWait>0)return;O.resolveWith(P,[$]),$.fn.trigger&&$(P).trigger("ready").off("ready")},isFunction:function(a){return $.type(a)==="function"},isArray:Array.isArray||function(a){return $.type(a)==="array"},isWindow:function(a){return a!=null&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):nb[X.call(a)]||"object"},isPlainObject:function(a){if(!a||$.type(a)!=="object"||a.nodeType||$.isWindow(a))return!1;try{if(a.constructor&&!Y.call(a,"constructor")&&!Y.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||Y.call(a,d)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){var d;return!a||typeof a!="string"?null:(typeof b=="boolean"&&(c=b,b=0),b=b||P,(d=eb.exec(a))?[b.createElement(d[1])]:(d=$.buildFragment([a],b,c?null:[]),$.merge([],(d.cacheable?$.clone(d.fragment):d.fragment).childNodes)))},parseJSON:function(b){if(!b||typeof b!="string")return null;b=$.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(fb.test(b.replace(hb,"@").replace(ib,"]").replace(gb,"")))return(new Function("return "+b))();$.error("Invalid JSON: "+b)},parseXML:function(c){var d,e;if(!c||typeof c!="string")return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&$.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&ab.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(jb,"ms-").replace(kb,lb)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var e,f=0,g=a.length,h=g===b||$.isFunction(a);if(d){if(h){for(e in a)if(c.apply(a[e],d)===!1)break}else for(;f<g;)if(c.apply(a[f++],d)===!1)break}else if(h){for(e in a)if(c.call(a[e],e,a[e])===!1)break}else for(;f<g;)if(c.call(a[f],f,a[f++])===!1)break;return a},trim:Z?function(a){return a==null?"":Z.call(a)}:function(a){return a==null?"":a.toString().replace(cb,"")},makeArray:function(a,b){var c,d=b||[];return a!=null&&(c=$.type(a),a.length==null||c==="string"||c==="function"||c==="regexp"||$.isWindow(a)?U.call(d,a):$.merge(d,a)),d},inArray:function(a,b,c){var d;if(b){if(W)return W.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if(typeof d=="number")for(;f<d;f++)a[e++]=c[f];else while(c[f]!==b)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;c=!!c;for(;f<g;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,c,d){var e,f,g=[],h=0,i=a.length,j=a instanceof $||i!==b&&typeof i=="number"&&(i>0&&a[0]&&a[i-1]||i===0||$.isArray(a));if(j)for(;h<i;h++)e=c(a[h],h,d),e!=null&&(g[g.length]=e);else for(f in a)e=c(a[f],f,d),e!=null&&(g[g.length]=e);return g.concat.apply([],g)},guid:1,proxy:function(a,c){var d,e,f;return typeof c=="string"&&(d=a[c],c=a,a=d),$.isFunction(a)?(e=V.call(arguments,2),f=function(){return a.apply(c,e.concat(V.call(arguments)))},f.guid=a.guid=a.guid||f.guid||$.guid++,f):b},access:function(a,c,d,e,f,g,h){var i,j=d==null,k=0,l=a.length;if(d&&typeof d=="object"){for(k in d)$.access(a,c,k,d[k],1,g,e);f=1}else if(e!==b){i=h===b&&$.isFunction(e),j&&(i?(i=c,c=function(a,b,c){return i.call($(a),c)}):(c.call(a,e),c=null));if(c)for(;k<l;k++)c(a[k],d,i?e.call(a[k],k,c(a[k],d)):e,h);f=1}return f?a:j?c.call(a):l?c(a[0],d):g},now:function(){return(new Date).getTime()}}),$.ready.promise=function(b){if(!O){O=$.Deferred();if(P.readyState==="complete"||P.readyState!=="loading"&&P.addEventListener)setTimeout($.ready,1);else if(P.addEventListener)P.addEventListener("DOMContentLoaded",mb,!1),a.addEventListener("load",$.ready,!1);else{P.attachEvent("onreadystatechange",mb),a.attachEvent("onload",$.ready);var c=!1;try{c=a.frameElement==null&&P.documentElement}catch(d){}c&&c.doScroll&&function e(){if(!$.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}$.ready()}}()}}return O.promise(b)},$.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){nb["[object "+b+"]"]=b.toLowerCase()}),N=$(P);var ob={};$.Callbacks=function(a){a=typeof a=="string"?ob[a]||c(a):$.extend({},a);var d,e,f,g,h,i,j=[],k=!a.once&&[],l=function(b){d=a.memory&&b,e=!0,i=g||0,g=0,h=j.length,f=!0;for(;j&&i<h;i++)if(j[i].apply(b[0],b[1])===!1&&a.stopOnFalse){d=!1;break}f=!1,j&&(k?k.length&&l(k.shift()):d?j=[]:m.disable())},m={add:function(){if(j){var b=j.length;(function c(b){$.each(b,function(b,d){$.isFunction(d)&&(!a.unique||!m.has(d))?j.push(d):d&&d.length&&c(d)})})(arguments),f?h=j.length:d&&(g=b,l(d))}return this},remove:function(){return j&&$.each(arguments,function(a,b){var c;while((c=$.inArray(b,j,c))>-1)j.splice(c,1),f&&(c<=h&&h--,c<=i&&i--)}),this},has:function(a){return $.inArray(a,j)>-1},empty:function(){return j=[],this},disable:function(){return j=k=d=b,this},disabled:function(){return!j},lock:function(){return k=b,d||m.disable(),this},locked:function(){return!k},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],j&&(!e||k)&&(f?k.push(b):l(b)),this},fire:function(){return m.fireWith(this,arguments),this},fired:function(){return!!e}};return m},$.extend({Deferred:function(a){var b=[["resolve","done",$.Callbacks("once memory"),"resolved"],["reject","fail",$.Callbacks("once memory"),"rejected"],["notify","progress",$.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return $.Deferred(function(c){$.each(b,function(b,d){var f=d[0],g=a[b];e[d[1]]($.isFunction(g)?function(){var a=g.apply(this,arguments);a&&$.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f+"With"](this===e?c:this,[a])}:c[f])}),a=null}).promise()},promise:function(a){return typeof a=="object"?$.extend(a,d):d}},e={};return d.pipe=d.then,$.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[a^1][2].disable,b[2][2].lock),e[f[0]]=g.fire,e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=V.call(arguments),d=c.length,e=d!==1||a&&$.isFunction(a.promise)?d:0,f=e===1?a:$.Deferred(),g=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?V.call(arguments):d,c===h?f.notifyWith(b,c):--e||f.resolveWith(b,c)}},h,i,j;if(d>1){h=new Array(d),i=new Array(d),j=new Array(d);for(;b<d;b++)c[b]&&$.isFunction(c[b].promise)?c[b].promise().done(g(b,j,c)).fail(f.reject).progress(g(b,i,h)):--e}return e||f.resolveWith(j,c),f.promise()}}),$.support=function(){var b,c,d,e,f,g,h,i,j,k,l,m=P.createElement("div");m.setAttribute("className","t"),m.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=m.getElementsByTagName("*"),d=m.getElementsByTagName("a")[0],d.style.cssText="top:1px;float:left;opacity:.5";if(!c||!c.length||!d)return{};e=P.createElement("select"),f=e.appendChild(P.createElement("option")),g=m.getElementsByTagName("input")[0],b={leadingWhitespace:m.firstChild.nodeType===3,tbody:!m.getElementsByTagName("tbody").length,htmlSerialize:!!m.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),hrefNormalized:d.getAttribute("href")==="/a",opacity:/^0.5/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:g.value==="on",optSelected:f.selected,getSetAttribute:m.className!=="t",enctype:!!P.createElement("form").enctype,html5Clone:P.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:P.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},g.checked=!0,b.noCloneChecked=g.cloneNode(!0).checked,e.disabled=!0,b.optDisabled=!f.disabled;try{delete m.test}catch(n){b.deleteExpando=!1}!m.addEventListener&&m.attachEvent&&m.fireEvent&&(m.attachEvent("onclick",l=function(){b.noCloneEvent=!1}),m.cloneNode(!0).fireEvent("onclick"),m.detachEvent("onclick",l)),g=P.createElement("input"),g.value="t",g.setAttribute("type","radio"),b.radioValue=g.value==="t",g.setAttribute("checked","checked"),g.setAttribute("name","t"),m.appendChild(g),h=P.createDocumentFragment(),h.appendChild(m.lastChild),b.checkClone=h.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=g.checked,h.removeChild(g),h.appendChild(m);if(m.attachEvent)for(j in{submit:!0,change:!0,focusin:!0})i="on"+j,k=i in m,k||(m.setAttribute(i,"return;"),k=typeof m[i]=="function"),b[j+"Bubbles"]=k;return $(function(){var c,d,e,f,g="padding:0;margin:0;border:0;display:block;overflow:hidden;",h=P.getElementsByTagName("body")[0];if(!h)return;c=P.createElement("div"),c.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",h.insertBefore(c,h.firstChild),d=P.createElement("div"),c.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",e=d.getElementsByTagName("td"),e[0].style.cssText="padding:0;margin:0;border:0;display:none",k=e[0].offsetHeight===0,e[0].style.display="",e[1].style.display="none",b.reliableHiddenOffsets=k&&e[0].offsetHeight===0,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",b.boxSizing=d.offsetWidth===4,b.doesNotIncludeMarginInBodyOffset=h.offsetTop!==1,a.getComputedStyle&&(b.pixelPosition=(a.getComputedStyle(d,null)||{}).top!=="1%",b.boxSizingReliable=(a.getComputedStyle(d,null)||{width:"4px"}).width==="4px",f=P.createElement("div"),f.style.cssText=d.style.cssText=g,f.style.marginRight=f.style.width="0",d.style.width="1px",d.appendChild(f),b.reliableMarginRight=!parseFloat((a.getComputedStyle(f,null)||{}).marginRight)),typeof d.style.zoom!="undefined"&&(d.innerHTML="",d.style.cssText=g+"width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=d.offsetWidth===3,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",b.shrinkWrapBlocks=d.offsetWidth!==3,c.style.zoom=1),h.removeChild(c),c=d=e=f=null}),h.removeChild(m),c=d=e=f=g=h=m=null,b}();var pb=/^(?:\{.*\}|\[.*\])$/,qb=/([A-Z])/g;$.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+($.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?$.cache[a[$.expando]]:a[$.expando],!!a&&!e(a)},data:function(a,c,d,e){if(!$.acceptData(a))return;var f,g,h=$.expando,i=typeof c=="string",j=a.nodeType,k=j?$.cache:a,l=j?a[h]:a[h]&&h;if((!l||!k[l]||!e&&!k[l].data)&&i&&d===b)return;l||(j?a[h]=l=$.deletedIds.pop()||++$.uuid:l=h),k[l]||(k[l]={},j||(k[l].toJSON=$.noop));if(typeof c=="object"||typeof c=="function")e?k[l]=$.extend(k[l],c):k[l].data=$.extend(k[l].data,c);return f=k[l],e||(f.data||(f.data={}),f=f.data),d!==b&&(f[$.camelCase(c)]=d),i?(g=f[c],g==null&&(g=f[$.camelCase(c)])):g=f,g},removeData:function(a,b,c){if(!$.acceptData(a))return;var d,f,g,h=a.nodeType,i=h?$.cache:a,j=h?a[$.expando]:$.expando;if(!i[j])return;if(b){d=c?i[j]:i[j].data;if(d){$.isArray(b)||(b in d?b=[b]:(b=$.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(f=0,g=b.length;f<g;f++)delete d[b[f]];if(!(c?e:$.isEmptyObject)(d))return}}if(!c){delete i[j].data;if(!e(i[j]))return}h?$.cleanData([a],!0):$.support.deleteExpando||i!=i.window?delete i[j]:i[j]=null},_data:function(a,b,c){return $.data(a,b,c,!0)},acceptData:function(a){var b=a.nodeName&&$.noData[a.nodeName.toLowerCase()];return!b||b!==!0&&a.getAttribute("classid")===b}}),$.fn.extend({data:function(a,c){var e,f,g,h,i,j=this[0],k=0,l=null;if(a===b){if(this.length){l=$.data(j);if(j.nodeType===1&&!$._data(j,"parsedAttrs")){g=j.attributes;for(i=g.length;k<i;k++)h=g[k].name,h.indexOf("data-")===0&&(h=$.camelCase(h.substring(5)),d(j,h,l[h]));$._data(j,"parsedAttrs",!0)}}return l}return typeof a=="object"?this.each(function(){$.data(this,a)}):(e=a.split(".",2),e[1]=e[1]?"."+e[1]:"",f=e[1]+"!",$.access(this,function(c){if(c===b)return l=this.triggerHandler("getData"+f,[e[0]]),l===b&&j&&(l=$.data(j,a),l=d(j,a,l)),l===b&&e[1]?this.data(e[0]):l;e[1]=c,this.each(function(){var b=$(this);b.triggerHandler("setData"+f,e),$.data(this,a,c),b.triggerHandler("changeData"+f,e)})},null,c,arguments.length>1,null,!1))},removeData:function(a){return this.each(function(){$.removeData(this,a)})}}),$.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=$._data(a,b),c&&(!d||$.isArray(c)?d=$._data(a,b,$.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=$.queue(a,b),d=c.shift(),e=$._queueHooks(a,b),f=function(){$.dequeue(a,b)};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),delete e.stop,d.call(a,f,e)),!c.length&&e&&e.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return $._data(a,c)||$._data(a,c,{empty:$.Callbacks("once memory").add(function(){$.removeData(a,b+"queue",!0),$.removeData(a,c,!0)})})}}),$.fn.extend({queue:function(a,c){var d=2;return typeof a!="string"&&(c=a,a="fx",d--),arguments.length<d?$.queue(this[0],a):c===b?this:this.each(function(){var b=$.queue(this,a,c);$._queueHooks(this,a),a==="fx"&&b[0]!=="inprogress"&&$.dequeue(this,a)})},dequeue:function(a){return this.each(function(){$.dequeue(this,a)})},delay:function(a,b){return a=$.fx?$.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=$.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};typeof a!="string"&&(c=a,a=b),a=a||"fx";while(h--)(d=$._data(g[h],a+"queueHooks"))&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var rb,sb,tb,ub=/[\t\r\n]/g,vb=/\r/g,wb=/^(?:button|input)$/i,xb=/^(?:button|input|object|select|textarea)$/i,yb=/^a(?:rea|)$/i,zb=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Ab=$.support.getSetAttribute;$.fn.extend({attr:function(a,b){return $.access(this,$.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){$.removeAttr(this,a)})},prop:function(a,b){return $.access(this,$.prop,a,b,arguments.length>1)},removeProp:function(a){return a=$.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g,h;if($.isFunction(a))return this.each(function(b){$(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(bb);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{f=" "+e.className+" ";for(g=0,h=b.length;g<h;g++)~f.indexOf(" "+b[g]+" ")||(f+=b[g]+" ");e.className=$.trim(f)}}}return this},removeClass:function(a){var c,d,e,f,g,h,i;if($.isFunction(a))return this.each(function(b){$(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(bb);for(h=0,i=this.length;h<i;h++){e=this[h];if(e.nodeType===1&&e.className){d=(" "+e.className+" ").replace(ub," ");for(f=0,g=c.length;f<g;f++)while(d.indexOf(" "+c[f]+" ")>-1)d=d.replace(" "+c[f]+" "," ");e.className=a?$.trim(d):""}}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";return $.isFunction(a)?this.each(function(c){$(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if(c==="string"){var e,f=0,g=$(this),h=b,i=a.split(bb);while(e=i[f++])h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&$._data(this,"__className__",this.className),this.className=this.className||a===!1?"":$._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(ub," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,f=this[0];if(!arguments.length){if(f)return c=$.valHooks[f.type]||$.valHooks[f.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,typeof d=="string"?d.replace(vb,""):d==null?"":d);return}return e=$.isFunction(a),this.each(function(d){var f,g=$(this);if(this.nodeType!==1)return;e?f=a.call(this,d,g.val()):f=a,f==null?f="":typeof f=="number"?f+="":$.isArray(f)&&(f=$.map(f,function(a){return a==null?"":a+""})),c=$.valHooks[this.type]||$.valHooks[this.nodeName.toLowerCase()];if(!c||!("set"in c)||c.set(this,f,"value")===b)this.value=f})}}),$.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,f=a.selectedIndex,g=[],h=a.options,i=a.type==="select-one";if(f<0)return null;c=i?f:0,d=i?f+1:h.length;for(;c<d;c++){e=h[c];if(e.selected&&($.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!$.nodeName(e.parentNode,"optgroup"))){b=$(e).val();if(i)return b;g.push(b)}}return i&&!g.length&&h.length?$(h[f]).val():g},set:function(a,b){var c=$.makeArray(b);return $(a).find("option").each(function(){this.selected=$.inArray($(this).val(),c)>=0}),c.length||(a.selectedIndex=-1),c}}},attrFn:{},attr:function(a,c,d,e){var f,g,h,i=a.nodeType;if(!a||i===3||i===8||i===2)return;if(e&&$.isFunction($.fn[c]))return $(a)[c](d);if(typeof a.getAttribute=="undefined")return $.prop(a,c,d);h=i!==1||!$.isXMLDoc(a),h&&(c=c.toLowerCase(),g=$.attrHooks[c]||(zb.test(c)?sb:rb));if(d!==b){if(d===null){$.removeAttr(a,c);return}return g&&"set"in g&&h&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,""+d),d)}return g&&"get"in g&&h&&(f=g.get(a,c))!==null?f:(f=a.getAttribute(c),f===null?b:f)},removeAttr:function(a,b){var c,d,e,f,g=0;if(b&&a.nodeType===1){d=b.split(bb);for(;g<d.length;g++)e=d[g],e&&(c=$.propFix[e]||e,f=zb.test(e),f||$.attr(a,e,""),a.removeAttribute(Ab?e:c),f&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(wb.test(a.nodeName)&&a.parentNode)$.error("type property can't be changed");else if(!$.support.radioValue&&b==="radio"&&$.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},value:{get:function(a,b){return rb&&$.nodeName(a,"button")?rb.get(a,b):b in a?a.value:null},set:function(a,b,c){if(rb&&$.nodeName(a,"button"))return rb.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(!a||h===3||h===8||h===2)return;return g=h!==1||!$.isXMLDoc(a),g&&(c=$.propFix[c]||c,f=$.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&(e=f.get(a,c))!==null?e:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):xb.test(a.nodeName)||yb.test(a.nodeName)&&a.href?0:b}}}}),sb={get:function(a,c){var d,e=$.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;return b===!1?$.removeAttr(a,c):(d=$.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}},Ab||(tb={name:!0,id:!0,coords:!0},rb=$.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&(tb[c]?d.value!=="":d.specified)?d.value:b},set:function(a,b,c){var d=a.getAttributeNode(c);return d||(d=P.createAttribute(c),a.setAttributeNode(d)),d.value=b+""}},$.each(["width","height"],function(a,b){$.attrHooks[b]=$.extend($.attrHooks[b],{set:function(a,c){if(c==="")return a.setAttribute(b,"auto"),c}})}),$.attrHooks.contenteditable={get:rb.get,set:function(a,b,c){b===""&&(b="false"),rb.set(a,b,c)}}),$.support.hrefNormalized||$.each(["href","src","width","height"],function(a,c){$.attrHooks[c]=$.extend($.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),$.support.style||($.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),$.support.optSelected||($.propHooks.selected=$.extend($.propHooks.selected,{get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}})),$.support.enctype||($.propFix.enctype="encoding"),$.support.checkOn||$.each(["radio","checkbox"],function(){$.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),$.each(["radio","checkbox"],function(){$.valHooks[this]=$.extend($.valHooks[this],{set:function(a,b){if($.isArray(b))return a.checked=$.inArray($(a).val(),b)>=0}})});var Bb=/^(?:textarea|input|select)$/i,Cb=/^([^\.]*|)(?:\.(.+)|)$/,Db=/(?:^|\s)hover(\.\S+|)\b/,Eb=/^key/,Fb=/^(?:mouse|contextmenu)|click/,Gb=/^(?:focusinfocus|focusoutblur)$/,Hb=function(a){return $.event.special.hover?a:a.replace(Db,"mouseenter$1 mouseleave$1")};$.event={add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q;if(a.nodeType===3||a.nodeType===8||!c||!d||!(g=$._data(a)))return;d.handler&&(o=d,d=o.handler,f=o.selector),d.guid||(d.guid=$.guid++),i=g.events,i||(g.events=i={}),h=g.handle,h||(g.handle=h=function(a){return typeof $=="undefined"||!!a&&$.event.triggered===a.type?b:$.event.dispatch.apply(h.elem,arguments)},h.elem=a),c=$.trim(Hb(c)).split(" ");for(j=0;j<c.length;j++){k=Cb.exec(c[j])||[],l=k[1],m=(k[2]||"").split(".").sort(),q=$.event.special[l]||{},l=(f?q.delegateType:q.bindType)||l,q=$.event.special[l]||{},n=$.extend({type:l,origType:k[1],data:e,handler:d,guid:d.guid,selector:f,namespace:m.join(".")},o),p=i[l];if(!p){p=i[l]=[],p.delegateCount=0;if(!q.setup||q.setup.call(a,e,m,h)===!1)a.addEventListener?a.addEventListener(l,h,!1):a.attachEvent&&a.attachEvent("on"+l,h)}q.add&&(q.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),f?p.splice(p.delegateCount++,0,n):p.push(n),$.event.global[l]=!0}a=null},global:{},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=$.hasData(a)&&$._data(a);if(!q||!(m=q.events))return;b=$.trim(Hb(b||"")).split(" ");for(f=0;f<b.length;f++){g=Cb.exec(b[f])||[],h=i=g[1],j=g[2];if(!h){for(h in m)$.event.remove(a,h+b[f],c,d,!0);continue}n=$.event.special[h]||{},h=(d?n.delegateType:n.bindType)||h,o=m[h]||[],k=o.length,j=j?new RegExp("(^|\\.)"+j.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(l=0;l<o.length;l++)p=o[l],(e||i===p.origType)&&(!c||c.guid===p.guid)&&(!j||j.test(p.namespace))&&(!d||d===p.selector||d==="**"&&p.selector)&&(o.splice(l--,1),p.selector&&o.delegateCount--,n.remove&&n.remove.call(a,p));o.length===0&&k!==o.length&&((!n.teardown||n.teardown.call(a,j,q.handle)===!1)&&$.removeEvent(a,h,q.handle),delete m[h])}$.isEmptyObject(m)&&(delete q.handle,$.removeData(a,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,f){if(!e||e.nodeType!==3&&e.nodeType!==8){var g,h,i,j,k,l,m,n,o,p,q=c.type||c,r=[];if(Gb.test(q+$.event.triggered))return;q.indexOf("!")>=0&&(q=q.slice(0,-1),h=!0),q.indexOf(".")>=0&&(r=q.split("."),q=r.shift(),r.sort());if((!e||$.event.customEvent[q])&&!$.event.global[q])return;c=typeof c=="object"?c[$.expando]?c:new $.Event(q,c):new $.Event(q),c.type=q,c.isTrigger=!0,c.exclusive=h,c.namespace=r.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,l=q.indexOf(":")<0?"on"+q:"";if(!e){g=$.cache;for(i in g)g[i].events&&g[i].events[q]&&$.event.trigger(c,d,g[i].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?$.makeArray(d):[],d.unshift(c),m=$.event.special[q]||{};if(m.trigger&&m.trigger.apply(e,d)===!1)return;o=[[e,m.bindType||q]];if(!f&&!m.noBubble&&!$.isWindow(e)){p=m.delegateType||q,j=Gb.test(p+q)?e:e.parentNode;for(k=e;j;j=j.parentNode)o.push([j,p]),k=j;k===(e.ownerDocument||P)&&o.push([k.defaultView||k.parentWindow||a,p])}for(i=0;i<o.length&&!c.isPropagationStopped();i++)j=o[i][0],c.type=o[i][1],n=($._data(j,"events")||{})[c.type]&&$._data(j,"handle"),n&&n.apply(j,d),n=l&&j[l],n&&$.acceptData(j)&&n.apply(j,d)===!1&&c.preventDefault();return c.type=q,!f&&!c.isDefaultPrevented()&&(!m._default||m._default.apply(e.ownerDocument,d)===!1)&&(q!=="click"||!$.nodeName(e,"a"))&&$.acceptData(e)&&l&&e[q]&&(q!=="focus"&&q!=="blur"||c.target.offsetWidth!==0)&&!$.isWindow(e)&&(k=e[l],k&&(e[l]=null),$.event.triggered=q,e[q](),$.event.triggered=b,k&&(e[l]=k)),c.result}return},dispatch:function(c){c=$.event.fix(c||a.event);var d,e,f,g,h,i,j,k,l,m,n,o=($._data(this,"events")||{})[c.type]||[],p=o.delegateCount,q=[].slice.call(arguments),r=!c.exclusive&&!c.namespace,s=$.event.special[c.type]||{},t=[];q[0]=c,c.delegateTarget=this;if(s.preDispatch&&s.preDispatch.call(this,c)===!1)return;if(p&&(!c.button||c.type!=="click")){g=$(this),g.context=this;for(f=c.target;f!=this;f=f.parentNode||this)if(f.disabled!==!0||c.type!=="click"){i={},k=[],g[0]=f;for(d=0;d<p;d++)l=o[d],m=l.selector,i[m]===b&&(i[m]=g.is(m)),i[m]&&k.push(l);k.length&&t.push({elem:f,matches:k})}}o.length>p&&t.push({elem:this,matches:o.slice(p)});for(d=0;d<t.length&&!c.isPropagationStopped();d++){j=t[d],c.currentTarget=j.elem;for(e=0;e<j.matches.length&&!c.isImmediatePropagationStopped();e++){l=j.matches[e];if(r||!c.namespace&&!l.namespace||c.namespace_re&&c.namespace_re.test(l.namespace))c.data=l.data,c.handleObj=l,h=(($.event.special[l.origType]||{}).handle||l.handler).apply(j.elem,q),h!==b&&(c.result=h,h===!1&&(c.preventDefault(),c.stopPropagation()))}}return s.postDispatch&&s.postDispatch.call(this,c),c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,g=c.button,h=c.fromElement;return a.pageX==null&&c.clientX!=null&&(d=a.target.ownerDocument||P,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h),!a.which&&g!==b&&(a.which=g&1?1:g&2?3:g&4?2:0),a}},fix:function(a){if(a[$.expando])return a;var b,c,d=a,e=$.event.fixHooks[a.type]||{},f=e.props?this.props.concat(e.props):this.props;a=$.Event(d);for(b=f.length;b;)c=f[--b],a[c]=d[c];return a.target||(a.target=d.srcElement||P),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,e.filter?e.filter(a,d):a},special:{ready:{setup:$.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){$.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=$.extend(new $.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?$.event.trigger(e,null,b):$.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},$.event.handle=$.event.dispatch,$.removeEvent=P.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]=="undefined"&&(a[d]=null),a.detachEvent(d,c))},$.Event=function(a,b){if(!(this instanceof $.Event))return new $.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?g:f):this.type=a,b&&$.extend(this,b),this.timeStamp=a&&a.timeStamp||$.now(),this[$.expando]=!0},$.Event.prototype={preventDefault:function(){this.isDefaultPrevented=g;var a=this.originalEvent;if(!a)return;a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=g;var a=this.originalEvent;if(!a)return;a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g,this.stopPropagation()},isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f},$.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){$.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj,g=f.selector;if(!e||e!==d&&!$.contains(d,e))a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b;return c}}}),$.support.submitBubbles||($.event.special.submit={setup:function(){if($.nodeName(this,"form"))return!1;$.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=$.nodeName(c,"input")||$.nodeName(c,"button")?c.form:b;d&&!$._data(d,"_submit_attached")&&($.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),$._data(d,"_submit_attached",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&$.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if($.nodeName(this,"form"))return!1;$.event.remove(this,"._submit")}}),$.support.changeBubbles||($.event.special.change={setup:function(){if(Bb.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")$.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),$.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),$.event.simulate("change",this,a,!0)});return!1}$.event.add(this,"beforeactivate._change",function(a){var b=a.target;Bb.test(b.nodeName)&&!$._data(b,"_change_attached")&&($.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&$.event.simulate("change",this.parentNode,a,!0)}),$._data(b,"_change_attached",!0))})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){return $.event.remove(this,"._change"),Bb.test(this.nodeName)}}),$.support.focusinBubbles||$.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){$.event.simulate(b,a.target,$.event.fix(a),!0)};$.event.special[b]={setup:function(){c++===0&&P.addEventListener(a,d,!0)},teardown:function(){--c===0&&P.removeEventListener(a,d,!0)}}}),$.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=d||c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=f;else if(!e)return this;return g===1&&(h=e,e=function(a){return $().off(a),h.apply(this,arguments)},e.guid=h.guid||(h.guid=$.guid++)),this.each(function(){$.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,g;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,$(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if(typeof a=="object"){for(g in a)this.off(g,c,a[g]);return this}if(c===!1||typeof c=="function")d=c,c=b;return d===!1&&(d=f),this.each(function(){$.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){return $(this.context).on(a,this.selector,b,c),this},die:function(a,b){return $(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a||"**",c)},trigger:function(a,b){return this.each(function(){$.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return $.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||$.guid++,d=0,e=function(c){var e=($._data(this,"lastToggle"+a.guid)||0)%d;return $._data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),$.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){$.fn[b]=function(a,c){return c==null&&(c=a,a=null),arguments.length>0?this.on(b,null,a,c):this.trigger(b)},Eb.test(b)&&($.event.fixHooks[b]=$.event.keyHooks),Fb.test(b)&&($.event.fixHooks[b]=$.event.mouseHooks)}),function(a,b){function c(a,b,c,d){var e=0,f=b.length;for(;e<f;e++)fb(a,b[e],c,d)}function d(a,b,d,e,f,g){var h,i=gb.setFilters[b.toLowerCase()];return i||fb.error(b),(a||!(h=f))&&c(a||"*",e,h=[],f),h.length>0?i(h,d,g):[]}function e(a,e,f,g,h){var i,j,k,l,m,n,o,p,q=0,r=h.length,s=S.POS,t=new RegExp("^"+s.source+"(?!"+y+")","i"),u=function(){var a=1,c=arguments.length-2;for(;a<c;a++)arguments[a]===b&&(i[a]=b)};for(;q<r;q++){s.exec(""),a=h[q],l=[],k=0,m=g;while(i=s.exec(a)){p=s.lastIndex=i.index+i[0].length;if(p>k){o=a.slice(k,i.index),k=p,n=[e],I.test(o)&&(m&&(n=m),m=g);if(j=O.test(o))o=o.slice(0,-5).replace(I,"$&*");i.length>1&&i[0].replace(t,u),m=d(o,i[1],i[2],n,m,j)}}m?(l=l.concat(m),(o=a.slice(k))&&o!==")"?I.test(o)?c(o,l,f,g):fb(o,e,f,g?g.concat(m):m):w.apply(f,l)):fb(a,e,f,g)}return r===1?f:fb.uniqueSort(f)}function f(a,b,c){var d,e,f,g=[],h=0,i=K.exec(a),j=!i.pop()&&!i.pop(),k=j&&a.match(J)||[""],l=gb.preFilter,m=gb.filter,n=!c&&b!==p;for(;(e=k[h])!=null&&j;h++){g.push(d=[]),n&&(e=" "+e);while(e){j=!1;if(i=I.exec(e))e=e.slice(i[0].length),j=d.push({part:i.pop().replace(H," "),captures:i});for(f in m)(i=S[f].exec(e))&&(!l[f]||(i=l[f](i,b,c)))&&(e=e.slice(i.shift().length),j=d.push({part:f,captures:i}));if(!j)break}}return j||fb.error(a),g}function g(a,b,c){var d=b.dir,e=u++;return a||(a=function(a){return a===c}),b.first?function(b,c){while(b=b[d])if(b.nodeType===1)return a(b,c)&&b}:function(b,c){var f,g=e+"."+l,h=g+"."+k;while(b=b[d])if(b.nodeType===1){if((f=b[x])===h)return b.sizset;if(typeof f=="string"&&f.indexOf(g)===0){if(b.sizset)return b}else{b[x]=h;if(a(b,c))return b.sizset=!0,b;b.sizset=!1}}}}function h(a,b){return a?function(c,d){var e=b(c,d);return e&&a(e===!0?c:e,d)}:b}function i(a,b,c){var d,e,f=0;for(;d=a[f];f++)gb.relative[d.part]?e=g(e,gb.relative[d.part],b):(d.captures.push(b,c),e=h(e,gb.filter[d.part].apply(null,d.captures)));return e}function j(a){return function(b,c){var d,e=0;for(;d=a[e];e++)if(d(b,c))return!0;return!1}}var k,l,m,n,o,p=a.document,q=p.documentElement,r="undefined",s=!1,t=!0,u=0,v=[].slice,w=[].push,x=("sizcache"+Math.random()).replace(".",""),y="[\\x20\\t\\r\\n\\f]",z="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",A=z.replace("w","w#"),B="([*^$|!~]?=)",C="\\["+y+"*("+z+")"+y+"*(?:"+B+y+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+A+")|)|)"+y+"*\\]",D=":("+z+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)",E=":(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)",F=y+"*([\\x20\\t\\r\\n\\f>+~])"+y+"*",G="(?=[^\\x20\\t\\r\\n\\f])(?:\\\\.|"+C+"|"+D.replace(2,7)+"|[^\\\\(),])+",H=new RegExp("^"+y+"+|((?:^|[^\\\\])(?:\\\\.)*)"+y+"+$","g"),I=new RegExp("^"+F),J=new RegExp(G+"?(?="+y+"*,|$)","g"),K=new RegExp("^(?:(?!,)(?:(?:^|,)"+y+"*"+G+")*?|"+y+"*(.*?))(\\)|$)"),L=new RegExp(G.slice(19,-6)+"\\x20\\t\\r\\n\\f>+~])+|"+F,"g"),M=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,N=/[\x20\t\r\n\f]*[+~]/,O=/:not\($/,P=/h\d/i,Q=/input|select|textarea|button/i,R=/\\(?!\\)/g,S={ID:new RegExp("^#("+z+")"),CLASS:new RegExp("^\\.("+z+")"),NAME:new RegExp("^\\[name=['\"]?("+z+")['\"]?\\]"),TAG:new RegExp("^("+z.replace("[-","[-\\*")+")"),ATTR:new RegExp("^"+C),PSEUDO:new RegExp("^"+D),CHILD:new RegExp("^:(only|nth|last|first)-child(?:\\("+y+"*(even|odd|(([+-]|)(\\d*)n|)"+y+"*(?:([+-]|)"+y+"*(\\d+)|))"+y+"*\\)|)","i"),POS:new RegExp(E,"ig"),needsContext:new RegExp("^"+y+"*[>+~]|"+E,"i")},T={},U=[],V={},W=[],X=function(a){return a.sizzleFilter=!0,a},Y=function(a){return function(b){return b.nodeName.toLowerCase()==="input"&&b.type===a}},Z=function(a){return function(b){var c=b.nodeName.toLowerCase();return(c==="input"||c==="button")&&b.type===a}},_=function(a){var b=!1,c=p.createElement("div");try{b=a(c)}catch(d){}return c=null,b},ab=_(function(a){a.innerHTML="<select></select>";var b=typeof a.lastChild.getAttribute("multiple");return b!=="boolean"&&b!=="string"}),bb=_(function(a){a.id=x+0,a.innerHTML="<a name='"+x+"'></a><div name='"+x+"'></div>",q.insertBefore(a,q.firstChild);var b=p.getElementsByName&&p.getElementsByName(x).length===2+p.getElementsByName(x+0).length;return o=!p.getElementById(x),q.removeChild(a),b}),cb=_(function(a){return a.appendChild(p.createComment("")),a.getElementsByTagName("*").length===0}),db=_(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!==r&&a.firstChild.getAttribute("href")==="#"}),eb=_(function(a){return a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!a.getElementsByClassName||a.getElementsByClassName("e").length===0?!1:(a.lastChild.className="e",a.getElementsByClassName("e").length!==1)}),fb=function(a,b,c,d){c=c||[],b=b||p;var e,f,g,h,i=b.nodeType;if(i!==1&&i!==9)return[];if(!a||typeof a!="string")return c;g=ib(b);if(!g&&!d)if(e=M.exec(a))if(h=e[1]){if(i===9){f=b.getElementById(h);if(!f||!f.parentNode)return c;if(f.id===h)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(h))&&jb(b,f)&&f.id===h)return c.push(f),c}else{if(e[2])return w.apply(c,v.call(b.getElementsByTagName(a),0)),c;if((h=e[3])&&eb&&b.getElementsByClassName)return w.apply(c,v.call(b.getElementsByClassName(h),0)),c}return mb(a,b,c,d,g)},gb=fb.selectors={cacheLength:50,match:S,order:["ID","TAG"],attrHandle:{},createPseudo:X,find:{ID:o?function(a,b,c){if(typeof b.getElementById!==r&&!c){var d=b.getElementById(a);return d&&d.parentNode?[d]:[]}}:function(a,c,d){if(typeof c.getElementById!==r&&!d){var e=c.getElementById(a);return e?e.id===a||typeof e.getAttributeNode!==r&&e.getAttributeNode("id").value===a?[e]:b:[]}},TAG:cb?function(a,b){if(typeof b.getElementsByTagName!==r)return b.getElementsByTagName(a)}:function(a,b){var c=b.getElementsByTagName(a);if(a==="*"){var d,e=[],f=0;for(;d=c[f];f++)d.nodeType===1&&e.push(d);return e}return c}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(R,""),a[3]=(a[4]||a[5]||"").replace(R,""),a[2]==="~="&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),a[1]==="nth"?(a[2]||fb.error(a[0]),a[3]=+(a[3]?a[4]+(a[5]||1):2*(a[2]==="even"||a[2]==="odd")),a[4]=+(a[6]+a[7]||a[2]==="odd")):a[2]&&fb.error(a[0]),a},PSEUDO:function(a){var b,c=a[4];return S.CHILD.test(a[0])?null:(c&&(b=K.exec(c))&&b.pop()&&(a[0]=a[0].slice(0,b[0].length-c.length-1),c=b[0].slice(0,-1)),a.splice(2,3,c||a[3]),a)}},filter:{ID:o?function(a){return a=a.replace(R,""),function(b){return b.getAttribute("id")===a}}:function(a){return a=a.replace(R,""),function(b){var c=typeof b.getAttributeNode!==r&&b.getAttributeNode("id");return c&&c.value===a}},TAG:function(a){return a==="*"?function(){return!0}:(a=a.replace(R,"").toLowerCase(),function(b){return b.nodeName&&b.nodeName.toLowerCase()===a})},CLASS:function(a){var b=T[a];return b||(b=T[a]=new RegExp("(^|"+y+")"+a+"("+y+"|$)"),U.push(a),U.length>gb.cacheLength&&delete T[U.shift()]),function(a){return b.test(a.className||typeof a.getAttribute!==r&&a.getAttribute("class")||"")}},ATTR:function(a,b,c){return b?function(d){var e=fb.attr(d,a),f=e+"";if(e==null)return b==="!=";switch(b){case"=":return f===c;case"!=":return f!==c;case"^=":return c&&f.indexOf(c)===0;case"*=":return c&&f.indexOf(c)>-1;case"$=":return c&&f.substr(f.length-c.length)===c;case"~=":return(" "+f+" ").indexOf(c)>-1;case"|=":return f===c||f.substr(0,c.length+1)===c+"-"}}:function(b){return fb.attr(b,a)!=null}},CHILD:function(a,b,c,d){if(a==="nth"){var e=u++;return function(a){var b,f,g=0,h=a;if(c===1&&d===0)return!0;b=a.parentNode;if(b&&(b[x]!==e||!a.sizset)){for(h=b.firstChild;h;h=h.nextSibling)if(h.nodeType===1){h.sizset=++g;if(h===a)break}b[x]=e}return f=a.sizset-d,c===0?f===0:f%c===0&&f/c>=0}}return function(b){var c=b;switch(a){case"only":case"first":while(c=c.previousSibling)if(c.nodeType===1)return!1;if(a==="first")return!0;c=b;case"last":while(c=c.nextSibling)if(c.nodeType===1)return!1;return!0}}},PSEUDO:function(a,b,c,d){var e=gb.pseudos[a]||gb.pseudos[a.toLowerCase()];return e||fb.error("unsupported pseudo: "+a),e.sizzleFilter?e(b,c,d):e}},pseudos:{not:X(function(a,b,c){var d=lb(a.replace(H,"$1"),b,c);return function(a){return!d(a)}}),enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&!!a.checked||b==="option"&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return!gb.pseudos.empty(a)},empty:function(a){var b;a=a.firstChild;while(a){if(a.nodeName>"@"||(b=a.nodeType)===3||b===4)return!1;a=a.nextSibling}return!0},contains:X(function(a){return function(b){return(b.textContent||b.innerText||kb(b)).indexOf(a)>-1}}),has:X(function(a){return function(b){return fb(a,b).length>0}}),header:function(a){return P.test(a.nodeName)},text:function(a){var b,c;return a.nodeName.toLowerCase()==="input"&&(b=a.type)==="text"&&((c=a.getAttribute("type"))==null||c.toLowerCase()===b)},radio:Y("radio"),checkbox:Y("checkbox"),file:Y("file"),password:Y("password"),image:Y("image"),submit:Z("submit"),reset:Z("reset"),button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&a.type==="button"||b==="button"},input:function(a){return Q.test(a.nodeName)},focus:function(a){var b=a.ownerDocument;return a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&(!!a.type||!!a.href)},active:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b,c){return c?a.slice(1):[a[0]]},last:function(a,b,c){var d=a.pop();return c?a:[d]},even:function(a,b,c){var d=[],e=c?1:0,f=a.length;for(;e<f;e+=2)d.push(a[e]);return d},odd:function(a,b,c){var d=[],e=c?0:1,f=a.length;for(;e<f;e+=2)d.push(a[e]);return d},lt:function(a,b,c){return c?a.slice(+b):a.slice(0,+b)},gt:function(a,b,c){return c?a.slice(0,+b+1):a.slice(+b+1)},eq:function(a,b,c){var d=a.splice(+b,1);return c?a:d}}};gb.setFilters.nth=gb.setFilters.eq,gb.filters=gb.pseudos,db||(gb.attrHandle={href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}}),bb&&(gb.order.push("NAME"),gb.find.NAME=function(a,b){if(typeof b.getElementsByName!==r)return b.getElementsByName(a)}),eb&&(gb.order.splice(1,0,"CLASS"),gb.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!==r&&!c)return b.getElementsByClassName(a)});try{v.call(q.childNodes,0)[0].nodeType}catch(hb){v=function(a){var b,c=[];for(;b=this[a];a++)c.push(b);return c}}var ib=fb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?b.nodeName!=="HTML":!1},jb=fb.contains=q.compareDocumentPosition?function(a,b){return!!(a.compareDocumentPosition(b)&16)}:q.contains?function(a,b){var c=a.nodeType===9?a.documentElement:a,d=b.parentNode;return a===d||!!(d&&d.nodeType===1&&c.contains&&c.contains(d))}:function(a,b){while(b=b.parentNode)if(b===a)return!0;return!1},kb=fb.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(e===1||e===9||e===11){if(typeof a.textContent=="string")return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=kb(a)}else if(e===3||e===4)return a.nodeValue}else for(;b=a[d];d++)c+=kb(b);return c};fb.attr=function(a,b){var c,d=ib(a);return d||(b=b.toLowerCase()),gb.attrHandle[b]?gb.attrHandle[b](a):ab||d?a.getAttribute(b):(c=a.getAttributeNode(b),c?typeof a[b]=="boolean"?a[b]?b:null:c.specified?c.value:null:null)},fb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},[0,0].sort(function(){return t=0}),q.compareDocumentPosition?m=function(a,b){return a===b?(s=!0,0):(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1}:(m=function(a,b){if(a===b)return s=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,h=b.parentNode,i=g;if(g===h)return n(a,b);if(!g)return-1;if(!h)return 1;while(i)e.unshift(i),i=i.parentNode;i=h;while(i)f.unshift(i),i=i.parentNode;c=e.length,d=f.length;for(var j=0;j<c&&j<d;j++)if(e[j]!==f[j])return n(e[j],f[j]);return j===c?n(a,f[j],-1):n(e[j],b,1)},n=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),fb.uniqueSort=function(a){var b,c=1;if(m){s=t,a.sort(m);if(s)for(;b=a[c];c++)b===a[c-1]&&a.splice(c--,1)}return a};var lb=fb.compile=function(a,b,c){var d,e,g,h=V[a];if(h&&h.context===b)return h;e=f(a,b,c);for(g=0;d=e[g];g++)e[g]=i(d,b,c);return h=V[a]=j(e),h.context=b,h.runs=h.dirruns=0,W.push(a),W.length>gb.cacheLength&&delete V[W.shift()],h};fb.matches=function(a,b){return fb(a,null,null,b)},fb.matchesSelector=function(a,b){return fb(b,null,null,[a]).length>0};var mb=function(a,b,c,d,f){a=a.replace(H,"$1");var g,h,i,j,m,n,o,p,q,r=a.match(J),s=a.match(L),t=b.nodeType;if(S.POS.test(a))return e(a,b,c,d,r);if(d)g=v.call(d,0);else if(r&&r.length===1){if(s.length>1&&t===9&&!f&&(r=S.ID.exec(s[0]))){b=gb.find.ID(r[1],b,f)[0];if(!b)return c;a=a.slice(s.shift().length)}p=(r=N.exec(s[0]))&&!r.index&&b.parentNode||b,q=s.pop(),n=q.split(":not")[0];for(i=0,j=gb.order.length;i<j;i++){o=gb.order[i];if(r=S[o].exec(n)){g=gb.find[o]((r[1]||"").replace(R,""),p,f);if(g==null)continue;n===q&&(a=a.slice(0,a.length-q.length)+n.replace(S[o],""),a||w.apply(c,v.call(g,0)));break}}}if(a){h=lb(a,b,f),l=h.dirruns++,g==null&&(g=gb.find.TAG("*",N.test(a)&&b.parentNode||b));for(i=0;m=g[i];i++)k=h.runs++,h(m,b)&&c.push(m)}return c};p.querySelectorAll&&function(){var a,b=mb,c=/'|\\/g,d=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,e=[],f=[":active"],g=q.matchesSelector||q.mozMatchesSelector||q.webkitMatchesSelector||q.oMatchesSelector||q.msMatchesSelector;_(function(a){a.innerHTML="<select><option selected></option></select>",a.querySelectorAll("[selected]").length||e.push("\\["+y+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),a.querySelectorAll(":checked").length||e.push(":checked")}),_(function(a){a.innerHTML="<p test=''></p>",a.querySelectorAll("[test^='']").length&&e.push("[*^$]="+y+"*(?:\"\"|'')"),a.innerHTML="<input type='hidden'>",a.querySelectorAll(":enabled").length||e.push(":enabled",":disabled")}),e=e.length&&new RegExp(e.join("|")),mb=function(a,d,f,g,h){if(!g&&!h&&(!e||!e.test(a)))if(d.nodeType===9)try{return w.apply(f,v.call(d.querySelectorAll(a),0)),f}catch(i){}else if(d.nodeType===1&&d.nodeName.toLowerCase()!=="object"){var j=d.getAttribute("id"),k=j||x,l=N.test(a)&&d.parentNode||d;j?k=k.replace(c,"\\$&"):d.setAttribute("id",k);try{return w.apply(f,v.call(l.querySelectorAll(a.replace(J,"[id='"+k+"'] $&")),0)),f}catch(i){}finally{j||d.removeAttribute("id")}}return b(a,d,f,g,h)},g&&(_(function(b){a=g.call(b,"div");try{g.call(b,"[test!='']:sizzle"),f.push(gb.match.PSEUDO)}catch(c){}}),f=new RegExp(f.join("|")),fb.matchesSelector=function(b,c){c=c.replace(d,"='$1']");if(!ib(b)&&!f.test(c)&&(!e||!e.test(c)))try{var h=g.call(b,c);if(h||a||b.document&&b.document.nodeType!==11)return h}catch(i){}return fb(c,null,null,[b]).length>0})}(),fb.attr=$.attr,$.find=fb,$.expr=fb.selectors,$.expr[":"]=$.expr.pseudos,$.unique=fb.uniqueSort,$.text=fb.getText,$.isXMLDoc=fb.isXML,$.contains=fb.contains}(a);var Ib=/Until$/,Jb=/^(?:parents|prev(?:Until|All))/,Kb=/^.[^:#\[\.,]*$/,Lb=$.expr.match.needsContext,Mb={children:!0,contents:!0,next:!0,prev:!0};$.fn.extend({find:function(a){var b,c,d,e,f,g,h=this;if(typeof a!="string")return $(a).filter(function(){for(b=0,c=h.length;b<c;b++)if($.contains(h[b],this))return!0});g=this.pushStack("","find",a);for(b=0,c=this.length;b<c;b++){d=g.length,$.find(a,this[b],g);if(b>0)for(e=d;e<g.length;e++)for(f=0;f<d;f++)if(g[f]===g[e]){g.splice(e--,1);break}}return g},has:function(a){var b,c=$(a,this),d=c.length;return this.filter(function(){for(b=0;b<d;b++)if($.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(j(this,a,!1),"not",a)},filter:function(a){return this.pushStack(j(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?Lb.test(a)?$(a,this.context).index(this[0])>=0:$.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c,d=0,e=this.length,f=[],g=Lb.test(a)||typeof a!="string"?$(a,b||this.context):0;for(;d<e;d++){c=this[d];while(c&&c.ownerDocument&&c!==b&&c.nodeType!==11){if(g?g.index(c)>-1:$.find.matchesSelector(c,a)){f.push(c);break}c=c.parentNode}}return f=f.length>1?$.unique(f):f,this.pushStack(f,"closest",a)},index:function(a){return a?typeof a=="string"?$.inArray(this[0],$(a)):$.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c=typeof a=="string"?$(a,b):$.makeArray(a&&a.nodeType?[a]:a),d=$.merge(this.get(),c);return this.pushStack(h(c[0])||h(d[0])?d:$.unique(d))},addBack:function(a){return this.add(a==null?this.prevObject:this.prevObject.filter(a))}}),$.fn.andSelf=$.fn.addBack,$.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return $.dir(a,"parentNode")},parentsUntil:function(a,b,c){return $.dir(a,"parentNode",c)},next:function(a){return i(a,"nextSibling")},prev:function(a){return i(a,"previousSibling")},nextAll:function(a){return $.dir(a,"nextSibling")},prevAll:function(a){return $.dir(a,"previousSibling")},nextUntil:function(a,b,c){return $.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return $.dir(a,"previousSibling",c)},siblings:function(a){return $.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return $.sibling(a.firstChild)},contents:function(a){return $.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:$.merge([],a.childNodes)}},function(a,b){$.fn[a]=function(c,d){var e=$.map(this,b,c);return Ib.test(a)||(d=c),d&&typeof d=="string"&&(e=$.filter(d,e)),e=this.length>1&&!Mb[a]?$.unique(e):e,this.length>1&&Jb.test(a)&&(e=e.reverse()),this.pushStack(e,a,V.call(arguments).join(","))}}),$.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),b.length===1?$.find.matchesSelector(b[0],a)?[b[0]]:[]:$.find.matches(a,b)},dir:function(a,c,d){var e=[],f=a[c];while(f&&f.nodeType!==9&&(d===b||f.nodeType!==1||!$(f).is(d)))f.nodeType===1&&e.push(f),f=f[c];return e},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var Nb="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Ob=/ jQuery\d+="(?:null|\d+)"/g,Pb=/^\s+/,Qb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Rb=/<([\w:]+)/,Sb=/<tbody/i,Tb=/<|&#?\w+;/,Ub=/<(?:script|style|link)/i,Vb=/<(?:script|object|embed|option|style)/i,Wb=new RegExp("<(?:"+Nb+")[\\s/>]","i"),Xb=/^(?:checkbox|radio)$/,Yb=/checked\s*(?:[^=]|=\s*.checked.)/i,Zb=/\/(java|ecma)script/i,$b=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,_b={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},ac=k(P),bc=ac.appendChild(P.createElement("div"));_b.optgroup=_b.option,_b.tbody=_b.tfoot=_b.colgroup=_b.caption=_b.thead,_b.th=_b.td,$.support.htmlSerialize||(_b._default=[1,"X<div>","</div>"]),$.fn.extend({text:function(a){return $.access(this,function(a){return a===b?$.text(this):this.empty().append((this[0]&&this[0].ownerDocument||P).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if($.isFunction(a))return this.each(function(b){$(this).wrapAll(a.call(this,b))});if(this[0]){var b=$(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return $.isFunction(a)?this.each(function(b){$(this).wrapInner(a.call(this,b))}):this.each(function(){var b=$(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=$.isFunction(a);return this.each(function(c){$(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){$.nodeName(this,"body")||$(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){(this.nodeType===1||this.nodeType===11)&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(a,this.firstChild)})},before:function(){if(!h(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=$.clean(arguments);return this.pushStack($.merge(a,this),"before",this.selector)}},after:function(){if(!h(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=$.clean(arguments);return this.pushStack($.merge(this,a),"after",this.selector)}},remove:function(a,b){var c,d=0;for(;(c=this[d])!=null;d++)if(!a||$.filter(a,[c]).length)!b&&c.nodeType===1&&($.cleanData(c.getElementsByTagName("*")),$.cleanData([c])),c.parentNode&&c.parentNode.removeChild(c);return this},empty:function(){var a,b=0;for(;(a=this[b])!=null;b++){a.nodeType===1&&$.cleanData(a.getElementsByTagName("*"));while(a.firstChild)a.removeChild(a.firstChild)}return this},clone:function(a,b){return a=a==null?!1:a,b=b==null?a:b,this.map(function(){return $.clone(this,a,b)})},html:function(a){return $.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return c.nodeType===1?c.innerHTML.replace(Ob,""):b;if(typeof a=="string"&&!Ub.test(a)&&($.support.htmlSerialize||!Wb.test(a))&&($.support.leadingWhitespace||!Pb.test(a))&&!_b[(Rb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Qb,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},c.nodeType===1&&($.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){return h(this[0])?this.length?this.pushStack($($.isFunction(a)?a():a),"replaceWith",a):this:$.isFunction(a)?this.each(function(b){var c=$(this),d=c.html();c.replaceWith(a.call(this,b,d))}):(typeof a!="string"&&(a=$(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;$(this).remove(),b?$(b).before(a):$(c).append(a)}))},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){a=[].concat.apply([],a);var e,f,g,h,i=0,j=a[0],k=[],m=this.length;if(!$.support.checkClone&&m>1&&typeof j=="string"&&Yb.test(j))return this.each(function(){$(this).domManip(a,c,d)});if($.isFunction(j))return this.each(function(e){var f=$(this);a[0]=j.call(this,e,c?f.html():b),f.domManip(a,c,d)});if(this[0]){e=$.buildFragment(a,this,k),g=e.fragment,f=g.firstChild,g.childNodes.length===1&&(g=f);if(f){c=c&&$.nodeName(f,"tr");for(h=e.cacheable||m-1;i<m;i++)d.call(c&&$.nodeName(this[i],"table")?l(this[i],"tbody"):this[i],i===h?g:$.clone(g,!0,!0))}g=f=null,k.length&&$.each(k,function(a,b){b.src?$.ajax?$.ajax({url:b.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):$.error("no ajax"):$.globalEval((b.text||b.textContent||b.innerHTML||"").replace($b,"")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),$.buildFragment=function(a,c,d){var e,f,g,h=a[0];return c=c||P,c=(c[0]||c).ownerDocument||c[0]||c,typeof c.createDocumentFragment=="undefined"&&(c=P),a.length===1&&typeof h=="string"&&h.length<512&&c===P&&h.charAt(0)==="<"&&!Vb.test(h)&&($.support.checkClone||!Yb.test(h))&&($.support.html5Clone||!Wb.test(h))&&(f=!0,e=$.fragments[h],g=e!==b),e||(e=c.createDocumentFragment(),$.clean(a,c,e,d),f&&($.fragments[h]=g&&e)),{fragment:e,cacheable:f}},$.fragments={},$.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){$.fn[a]=function(c){var d,e=0,f=[],g=$(c),h=g.length,i=this.length===1&&this[0].parentNode;if((i==null||i&&i.nodeType===11&&i.childNodes.length===1)&&h===1)return g[b](this[0]),this;for(;e<h;e++)d=(e>0?this.clone(!0):this).get(),$(g[e])[b](d),f=f.concat(d);return this.pushStack(f,a,g.selector)}}),$.extend({clone:function(a,b,c){var d,e,f,g;$.support.html5Clone||$.isXMLDoc(a)||!Wb.test("<"+a.nodeName+">")?g=a.cloneNode(!0):(bc.innerHTML=a.outerHTML,bc.removeChild(g=bc.firstChild));if((!$.support.noCloneEvent||!$.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!$.isXMLDoc(a)){n(a,g),d=o(a),e=o(g);for(f=0;d[f];++f)e[f]&&n(d[f],e[f])}if(b){m(a,g);if(c){d=o(a),e=o(g);for(f=0;d[f];++f)m(d[f],e[f])}}return d=e=null,g},clean:function(a,b,c,d){var e,f,g,h,i,j,l,m,n,o,q,r,s=0,t=[];if(!b||typeof b.createDocumentFragment=="undefined")b=P;for(f=b===P&&ac;(g=a[s])!=null;s++){typeof g=="number"&&(g+="");if(!g)continue;if(typeof g=="string")if(!Tb.test(g))g=b.createTextNode(g);else{f=f||k(b),l=l||f.appendChild(b.createElement("div")),g=g.replace(Qb,"<$1></$2>"),h=(Rb.exec(g)||["",""])[1].toLowerCase(),i=_b[h]||_b._default,j=i[0],l.innerHTML=i[1]+g+i[2];while(j--)l=l.lastChild;if(!$.support.tbody){m=Sb.test(g),n=h==="table"&&!m?l.firstChild&&l.firstChild.childNodes:i[1]==="<table>"&&!m?l.childNodes:[];for(e=n.length-1;e>=0;--e)$.nodeName(n[e],"tbody")&&!n[e].childNodes.length&&n[e].parentNode.removeChild(n[e])}!$.support.leadingWhitespace&&Pb.test(g)&&l.insertBefore(b.createTextNode(Pb.exec(g)[0]),l.firstChild),g=l.childNodes,l=f.lastChild}g.nodeType?t.push(g):t=$.merge(t,g)}l&&(f.removeChild(l),g=l=f=null);if(!$.support.appendChecked)for(s=0;(g=t[s])!=null;s++)$.nodeName(g,"input")?p(g):typeof g.getElementsByTagName!="undefined"&&$.grep(g.getElementsByTagName("input"),p);if(c){q=function(a){if(!a.type||Zb.test(a.type))return d?d.push(a.parentNode?a.parentNode.removeChild(a):a):c.appendChild(a)};for(s=0;(g=t[s])!=null;s++)if(!$.nodeName(g,"script")||!q(g))c.appendChild(g),typeof g.getElementsByTagName!="undefined"&&(r=$.grep($.merge([],g.getElementsByTagName("script")),q),t.splice.apply(t,[s+1,0].concat(r)),s+=r.length)}return t},cleanData:function(a,b){var c,d,e,f,g=0,h=$.expando,i=$.cache,j=$.support.deleteExpando,k=$.event.special;for(;(e=a[g])!=null;g++)if(b||$.acceptData(e)){d=e[h],c=d&&i[d];if(c){if(c.events)for(f in c.events)k[f]?$.event.remove(e,f):$.removeEvent(e,f,c.handle);i[d]&&(delete i[d],j?delete e[h]:e.removeAttribute?e.removeAttribute(h):e[h]=null,$.deletedIds.push(d))}}}}),function(){var a,b;$.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},a=$.uaMatch(R.userAgent),b={},a.browser&&(b[a.browser]=!0,b.version=a.version),b.webkit&&(b.safari=!0),$.browser=b,$.sub=function(){function a(b,c){return new a.fn.init(b,c)}$.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function c(c,d){return d&&d instanceof $&&!(d instanceof a)&&(d=a(d)),$.fn.init.call(this,c,d,b)},a.fn.init.prototype=a.fn;var b=a(P);return a}}();var cc,dc,ec,fc=/alpha\([^)]*\)/i,gc=/opacity=([^)]*)/,hc=/^(top|right|bottom|left)$/,ic=/^margin/,jc=new RegExp("^("+_+")(.*)$","i"),kc=new RegExp("^("+_+")(?!px)[a-z%]+$","i"),lc=new RegExp("^([-+])=("+_+")","i"),mc={},nc={position:"absolute",visibility:"hidden",display:"block"},oc={letterSpacing:0,fontWeight:400,lineHeight:1},pc=["Top","Right","Bottom","Left"],qc=["Webkit","O","Moz","ms"],rc=$.fn.toggle;$.fn.extend({css:function(a,c){return $.access(this,function(a,c,d){return d!==b?$.style(a,c,d):$.css(a,c)},a,c,arguments.length>1)},show:function(){return s(this,!0)},hide:function(){return s(this)},toggle:function(a,b){var c=typeof a=="boolean";return $.isFunction(a)&&$.isFunction(b)?rc.apply(this,arguments):this.each(function(){(c?a:r(this))?$(this).show():$(this).hide()})}}),$.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=cc(a,"opacity");return c===""?"1":c}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":$.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!a||a.nodeType===3||a.nodeType===8||!a.style)return;var f,g,h,i=$.camelCase(c),j=a.style;c=$.cssProps[i]||($.cssProps[i]=q(j,i)),h=$.cssHooks[c]||$.cssHooks[i];if(d===b)return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c];g=typeof d,g==="string"&&(f=lc.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat($.css(a,c)),g="number");if(d==null||g==="number"&&isNaN(d))return;g==="number"&&!$.cssNumber[i]&&(d+="px");if(!h||!("set"in h)||(d=h.set(a,d,e))!==b)try{j[c]=d}catch(k){}},css:function(a,c,d,e){var f,g,h,i=$.camelCase(c);return c=$.cssProps[i]||($.cssProps[i]=q(a.style,i)),h=$.cssHooks[c]||$.cssHooks[i],h&&"get"in h&&(f=h.get(a,!0,e)),f===b&&(f=cc(a,c)),f==="normal"&&c in oc&&(f=oc[c]),d||e!==b?(g=parseFloat(f),d||$.isNumeric(g)?g||0:f):f},swap:function(a,b,c){var d,e,f={};for(e in b)f[e]=a.style[e],a.style[e]=b[e];d=c.call(a);for(e in b)a.style[e]=f[e];return d}}),a.getComputedStyle?cc=function(a,b){var c,d,e,f,g=getComputedStyle(a,null),h=a.style;return g&&(c=g[b],c===""&&!$.contains(a.ownerDocument.documentElement,a)&&(c=$.style(a,b)),kc.test(c)&&ic.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=c,c=g.width,h.width=d,h.minWidth=e,h.maxWidth=f)),c}:P.documentElement.currentStyle&&(cc=function(a,b){var c,d,e=a.currentStyle&&a.currentStyle[b],f=a.style;return e==null&&f&&f[b]&&(e=f[b]),kc.test(e)&&!hc.test(b)&&(c=f.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),f.left=b==="fontSize"?"1em":e,e=f.pixelLeft+"px",f.left=c,d&&(a.runtimeStyle.left=d)),e===""?"auto":e}),$.each(["height","width"],function(a,b){$.cssHooks[b]={get:function(a,c,d){if(c)return a.offsetWidth!==0||cc(a,"display")!=="none"?v(a,b,d):$.swap(a,nc,function(){return v(a,b,d)})},set:function(a,c,d){return t(a,c,d?u(a,b,d,$.support.boxSizing&&$.css(a,"boxSizing")==="border-box"):0)}}}),$.support.opacity||($.cssHooks.opacity={get:function(a,b){return gc.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=$.isNumeric(b)?"alpha(opacity="+b*100+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&$.trim(f.replace(fc,""))===""&&c.removeAttribute){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=fc.test(f)?f.replace(fc,e):f+" "+e}}),$(function(){$.support.reliableMarginRight||($.cssHooks.marginRight={get:function(a,b){return $.swap(a,{display:"inline-block"},function(){if(b)return cc(a,"marginRight")})}}),!$.support.pixelPosition&&$.fn.position&&$.each(["top","left"],function(a,b){$.cssHooks[b]={get:function(a,c){if(c){var d=cc(a,b);return kc.test(d)?$(a).position()[b]+"px":d}}}})}),$.expr&&$.expr.filters&&($.expr.filters.hidden=function(a){return a.offsetWidth===0&&a.offsetHeight===0||!$.support.reliableHiddenOffsets&&(a.style&&a.style.display||cc(a,"display"))==="none"},$.expr.filters.visible=function(a){return!$.expr.filters.hidden(a)}),$.each({margin:"",padding:"",border:"Width"},function(a,b){$.cssHooks[a+b]={expand:function(c){var d,e=typeof c=="string"?c.split(" "):[c],f={};for(d=0;d<4;d++)f[a+pc[d]+b]=e[d]||e[d-2]||e[0];return f}},ic.test(a)||($.cssHooks[a+b].set=t)});var sc=/%20/g,tc=/\[\]$/,uc=/\r?\n/g,vc=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,wc=/^(?:select|textarea)/i;$.fn.extend({serialize:function(){return $.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?$.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||wc.test(this.nodeName)||vc.test(this.type))}).map(function(a,b){var c=$(this).val();return c==null?null:$.isArray(c)?$.map(c,function(a,c){return{name:b.name,value:a.replace(uc,"\r\n")}}):{name:b.name,value:c.replace(uc,"\r\n")}}).get()}}),$.param=function(a,c){var d,e=[],f=function(a,b){b=$.isFunction(b)?b():b==null?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=$.ajaxSettings&&$.ajaxSettings.traditional);if($.isArray(a)||a.jquery&&!$.isPlainObject(a))$.each(a,function(){f(this.name,this.value)});else for(d in a)x(d,a[d],c,f);return e.join("&").replace(sc,"+")};var xc,yc,zc=/#.*$/,Ac=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Bc=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Cc=/^(?:GET|HEAD)$/,Dc=/^\/\//,Ec=/\?/,Fc=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Gc=/([?&])_=[^&]*/,Hc=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Ic=$.fn.load,Jc={},Kc={},Lc=["*/"]+["*"];try{xc=Q.href}catch(Mc){xc=P.createElement("a"),xc.href="",xc=xc.href}yc=Hc.exec(xc.toLowerCase())||[],$.fn.load=function(a,c,d){if(typeof a!="string"&&Ic)return Ic.apply(this,arguments);if(!this.length)return this;var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),$.isFunction(c)?(d=c,c=b):typeof c=="object"&&(f="POST"),$.ajax({url:a,type:f,dataType:"html",data:c,complete:function(a,b){d&&h.each(d,g||[a.responseText,b,a])}}).done(function(a){g=arguments,h.html(e?$("<div>").append(a.replace(Fc,"")).find(e):a)}),this},$.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){$.fn[b]=function(a){return this.on(b,a)}}),$.each(["get","post"],function(a,c){$[c]=function(a,d,e,f){return $.isFunction(d)&&(f=f||e,e=d,d=b),$.ajax({type:c,url:a,data:d,success:e,dataType:f})}}),$.extend({getScript:function(a,c){return $.get(a,b,c,"script")},getJSON:function(a,b,c){return $.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?A(a,$.ajaxSettings):(b=a,a=$.ajaxSettings),A(a,b),a},ajaxSettings:{url:xc,isLocal:Bc.test(yc[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Lc},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":$.parseJSON,"text xml":$.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:y(Jc),ajaxTransport:y(Kc),ajax:function(a,c){function d(a,c,d,g){var j,l,s,t,v,x=c;if(u===2)return;u=2,i&&clearTimeout(i),h=b,f=g||"",w.readyState=a>0?4:0,d&&(t=B(m,w,d));if(a>=200&&a<300||a===304)m.ifModified&&(v=w.getResponseHeader("Last-Modified"),v&&($.lastModified[e]=v),v=w.getResponseHeader("Etag"),v&&($.etag[e]=v)),a===304?(x="notmodified",j=!0):(j=C(m,t),x=j.state,l=j.data,s=j.error,j=!s);else{s=x;if(!x||a)x="error",a<0&&(a=0)}w.status=a,w.statusText=""+(c||x),j?p.resolveWith(n,[l,x,w]):p.rejectWith(n,[w,x,s]),w.statusCode(r),r=b,k&&o.trigger("ajax"+(j?"Success":"Error"),[w,m,j?l:s]),q.fireWith(n,[w,x]),k&&(o.trigger("ajaxComplete",[w,m]),--$.active||$.event.trigger("ajaxStop"))}typeof a=="object"&&(c=a,a=b),c=c||{};var e,f,g,h,i,j,k,l,m=$.ajaxSetup({},c),n=m.context||m,o=n!==m&&(n.nodeType||n instanceof $)?$(n):$.event,p=$.Deferred(),q=$.Callbacks("once memory"),r=m.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,setRequestHeader:function(a,b){if(!u){var c=a.toLowerCase();a=t[c]=t[c]||a,s[a]=b}return this},getAllResponseHeaders:function(){return u===2?f:null},getResponseHeader:function(a){var c;if(u===2){if(!g){g={};while(c=Ac.exec(f))g[c[1].toLowerCase()]=c[2]}c=g[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return u||(m.mimeType=a),this},abort:function(a){return a=a||v,h&&h.abort(a),d(0,a),this}};p.promise(w),w.success=w.done,w.error=w.fail,w.complete=q.add,w.statusCode=function(a){if(a){var b;if(u<2)for(b in a)r[b]=[r[b],a[b]];else b=a[w.status],w.always(b)}return this},m.url=((a||m.url)+"").replace(zc,"").replace(Dc,yc[1]+"//"),m.dataTypes=$.trim(m.dataType||"*").toLowerCase().split(bb),m.crossDomain==null&&(j=Hc.exec(m.url.toLowerCase()),m.crossDomain=!(!j||j[1]==yc[1]&&j[2]==yc[2]&&(j[3]||(j[1]==="http:"?80:443))==(yc[3]||(yc[1]==="http:"?80:443)))),m.data&&m.processData&&typeof m.data!="string"&&(m.data=$.param(m.data,m.traditional)),z(Jc,m,c,w);if(u===2)return w;k=m.global,m.type=m.type.toUpperCase(),m.hasContent=!Cc.test(m.type),k&&$.active++===0&&$.event.trigger("ajaxStart");if(!m.hasContent){m.data&&(m.url+=(Ec.test(m.url)?"&":"?")+m.data,delete m.data),e=m.url;if(m.cache===!1){var x=$.now(),y=m.url.replace(Gc,"$1_="+x);m.url=y+(y===m.url?(Ec.test(m.url)?"&":"?")+"_="+x:"")}}(m.data&&m.hasContent&&m.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",m.contentType),m.ifModified&&(e=e||m.url,$.lastModified[e]&&w.setRequestHeader("If-Modified-Since",$.lastModified[e]),$.etag[e]&&w.setRequestHeader("If-None-Match",$.etag[e])),w.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+(m.dataTypes[0]!=="*"?", "+Lc+"; q=0.01":""):m.accepts["*"]);for(l in m.headers)w.setRequestHeader(l,m.headers[l]);if(!m.beforeSend||m.beforeSend.call(n,w,m)!==!1&&u!==2){v="abort";for(l in{success:1,error:1,complete:1})w[l](m[l]);h=z(Kc,m,c,w);if(!h)d(-1,"No Transport");else{w.readyState=1,k&&o.trigger("ajaxSend",[w,m]),m.async&&m.timeout>0&&(i=setTimeout(function(){w.abort("timeout")},m.timeout));try{u=1,h.send(s,d)}catch(A){if(!(u<2))throw A;d(-1,A)}}return w}return w.abort()},active:0,lastModified:{},etag:{}});var Nc=[],Oc=/\?/,Pc=/(=)\?(?=&|$)|\?\?/,Qc=$.now();$.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Nc.pop()||$.expando+"_"+Qc++;return this[a]=!0,a}}),$.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.data,j=c.url,k=c.jsonp!==!1,l=k&&Pc.test(j),m=k&&!l&&typeof i=="string"&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&Pc.test(i);if(c.dataTypes[0]==="jsonp"||l||m)return f=c.jsonpCallback=$.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,g=a[f],l?c.url=j.replace(Pc,"$1"+f):m?c.data=i.replace(Pc,"$1"+f):k&&(c.url+=(Oc.test(j)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||$.error(f+" was not called"),h[0]},c.dataTypes[0]="json",a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,Nc.push(f)),h&&$.isFunction(g)&&g(h[0]),h=g=b}),"script"}),$.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return $.globalEval(a),a}}}),$.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),$.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=P.head||P.getElementsByTagName("head")[0]||P.documentElement;return{send:function(e,f){c=P.createElement("script"),c.async="async",a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,e){if(e||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||f(200,"success")},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var Rc,Sc=a.ActiveXObject?function(){for(var a in Rc)Rc[a](0,1)}:!1,Tc=0;$.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&D()||E()}:D,function(a){$.extend($.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}($.ajaxSettings.xhr()),$.support.ajax&&$.ajaxTransport(function(c){if(!c.crossDomain||$.support.cors){var d;return{send:function(e,f){var g,h,i=c.xhr();c.username?i.open(c.type,c.url,c.async,c.username,c.password):i.open(c.type,c.url,c.async);if(c.xhrFields)for(h in c.xhrFields)i[h]=c.xhrFields[h];c.mimeType&&i.overrideMimeType&&i.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e)i.setRequestHeader(h,e[h])}catch(j){}i.send(c.hasContent&&c.data||null),d=function(a,e){var h,j,k,l,m;try{if(d&&(e||i.readyState===4)){d=b,g&&(i.onreadystatechange=$.noop,Sc&&delete Rc[g]);if(e)i.readyState!==4&&i.abort();else{h=i.status,k=i.getAllResponseHeaders(),l={},m=i.responseXML,m&&m.documentElement&&(l.xml=m);try{l.text=i.responseText}catch(a){}try{j=i.statusText}catch(n){j=""}!h&&c.isLocal&&!c.crossDomain?h=l.text?200:404:h===1223&&(h=204)}}}catch(o){e||f(-1,o)}l&&f(h,j,l,k)},c.async?i.readyState===4?setTimeout(d,0):(g=++Tc,Sc&&(Rc||(Rc={},$(a).unload(Sc)),Rc[g]=d),i.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var Uc,Vc,Wc=/^(?:toggle|show|hide)$/,Xc=new RegExp("^(?:([-+])=|)("+_+")([a-z%]*)$","i"),Yc=/queueHooks$/,Zc=[J],$c={"*":[function(a,b){var c,d,e,f=this.createTween(a,b),g=Xc.exec(b),h=f.cur(),i=+h||0,j=1;if(g){c=+g[2],d=g[3]||($.cssNumber[a]?"":"px");if(d!=="px"&&i){i=$.css(f.elem,a,!0)||c||1;do e=j=j||".5",i/=j,$.style(f.elem,a,i+d),j=f.cur()/h;while(j!==1&&j!==e)}f.unit=d,f.start=i,f.end=g[1]?i+(g[1]+1)*c:c}return f}]};$.Animation=$.extend(H,{tweener:function(a,b){$.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");var c,d=0,e=a.length;for(;d<e;d++)c=a[d],$c[c]=$c[c]||[],$c[c].unshift(b)},prefilter:function(a,b){b?Zc.unshift(a):Zc.push(a)}}),$.Tween=K,K.prototype={constructor:K,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||($.cssNumber[c]?"":"px")},cur:function(){var a=K.propHooks[this.prop];return a&&a.get?a.get(this):K.propHooks._default.get(this)},run:function(a){var b,c=K.propHooks[this.prop];return this.pos=b=$.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration),this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):K.propHooks._default.set(this),this}},K.prototype.init.prototype=K.prototype,K.propHooks={_default:{get:function(a){var b;return a.elem[a.prop]==null||!!a.elem.style&&a.elem.style[a.prop]!=null?(b=$.css(a.elem,a.prop,!1,""),!b||b==="auto"?0:b):a.elem[a.prop]},set:function(a){$.fx.step[a.prop]?$.fx.step[a.prop](a):a.elem.style&&(a.elem.style[$.cssProps[a.prop]]!=null||$.cssHooks[a.prop])?$.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},K.propHooks.scrollTop=K.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},$.each(["toggle","show","hide"],function(a,b){var c=$.fn[b];$.fn[b]=function(d,e,f){return d==null||typeof d=="boolean"||!a&&$.isFunction(d)&&$.isFunction(e)?c.apply(this,arguments):this.animate(L(b,!0),d,e,f)}}),$.fn.extend({fadeTo:function(a,b,c,d){return this.filter(r).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=$.isEmptyObject(a),f=$.speed(b,c,d),g=function(){var b=H(this,$.extend({},a),f);e&&b.stop(!0)};return e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=a!=null&&a+"queueHooks",f=$.timers,g=$._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&Yc.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem===this&&(a==null||f[c].queue===a)&&(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&$.dequeue(this,a)})}}),$.each({slideDown:L("show"),slideUp:L("hide"),slideToggle:L("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){$.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),$.speed=function(a,b,c){var d=a&&typeof a=="object"?$.extend({},a):{complete:c||!c&&b||$.isFunction(a)&&a,duration:a,easing:c&&b||b&&!$.isFunction(b)&&b};d.duration=$.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in $.fx.speeds?$.fx.speeds[d.duration]:$.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";return d.old=d.complete,d.complete=function(){$.isFunction(d.old)&&d.old.call(this),d.queue&&$.dequeue(this,d.queue)},d},$.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},$.timers=[],$.fx=K.prototype.init,$.fx.tick=function(){var a,b=$.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||$.fx.stop()},$.fx.timer=function(a){a()&&$.timers.push(a)&&!Vc&&(Vc=setInterval($.fx.tick,$.fx.interval))},$.fx.interval=13,$.fx.stop=function(){clearInterval(Vc),Vc=null},$.fx.speeds={slow:600,fast:200,_default:400},$.fx.step={},$.expr&&$.expr.filters&&($.expr.filters.animated=function(a){return $.grep($.timers,function(b){return a===b.elem}).length});var _c=/^(?:body|html)$/i;$.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){$.offset.setOffset(this,a,b)});var c,d,e,f,g,h,i,j,k,l,m=this[0],n=m&&m.ownerDocument;if(!n)return;return(e=n.body)===m?$.offset.bodyOffset(m):(d=n.documentElement,$.contains(d,m)?(c=m.getBoundingClientRect(),f=M(n),g=d.clientTop||e.clientTop||0,h=d.clientLeft||e.clientLeft||0,i=f.pageYOffset||d.scrollTop,j=f.pageXOffset||d.scrollLeft,k=c.top+i-g,l=c.left+j-h,{top:k,left:l}):{top:0,left:0})},$.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return $.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat($.css(a,"marginTop"))||0,c+=parseFloat($.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=$.css(a,"position");d==="static"&&(a.style.position="relative");var e=$(a),f=e.offset(),g=$.css(a,"top"),h=$.css(a,"left"),i=(d==="absolute"||d==="fixed")&&$.inArray("auto",[g,h])>-1,j={},k={},l,m;i?(k=e.position(),l=k.top,m=k.left):(l=parseFloat(g)||0,m=parseFloat(h)||0),$.isFunction(b)&&(b=b.call(a,c,f)),b.top!=null&&(j.top=b.top-f.top+l),b.left!=null&&(j.left=b.left-f.left+m),"using"in b?b.using.call(a,j):e.css(j)}},$.fn.extend({position:function(){if(!this[0])return;var a=this[0],b=this.offsetParent(),c=this.offset(),d=_c.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat($.css(a,"marginTop"))||0,c.left-=parseFloat($.css(a,"marginLeft"))||0,d.top+=parseFloat($.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat($.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||P.body;while(a&&!_c.test(a.nodeName)&&$.css(a,"position")==="static")a=a.offsetParent;return a||P.body})}}),$.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);$.fn[a]=function(e){return $.access(this,function(a,e,f){var g=M(a);if(f===b)return g?c in g?g[c]:g.document.documentElement[e]:a[e];g?g.scrollTo(d?$(g).scrollLeft():f,d?f:$(g).scrollTop()):a[e]=f},a,e,arguments.length,null)}}),$.each({Height:"height",Width:"width"},function(a,c){$.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){$.fn[e]=function(e,f){var g=arguments.length&&(d||typeof e!="boolean"),h=d||(e===!0||f===!0?"margin":"border");return $.access(this,function(c,d,e){var f;return $.isWindow(c)?c.document.documentElement["client"+a]:c.nodeType===9?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?$.css(c,d,e,h):$.style(c,d,e,h)},c,g?e:b,g)}})}),a.jQuery=a.$=$,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return $})})(window),function(){var a;a=function(a,b){var c,d,e,f,g,h,i;e=typeof exports!="undefined"&&exports!==null?exports:window;if(a.length>0){i=a.split(".");for(g=0,h=i.length;g<h;g++)d=i[g],e=e[d]||(e[d]={})}for(c in b)f=b[c],e[c]=f;return e},a("",{namespace:a})}.call(this),define("vendor/namespace",function(){});var a=a||{REVISION:"53"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,String.prototype.startsWith=String.prototype.startsWith||function(a){return this.slice(0,a.length)===a},String.prototype.endsWith=String.prototype.endsWith||function(a){var b=String(a),c=this.lastIndexOf(b);return(-1<c&&c)===this.length-b.length},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},function(){var a=0,b=["ms","moz","webkit","o"];for(var c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame===undefined&&(window.requestAnimationFrame=function(b,c){var d=Date.now(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame=window.cancelAnimationFrame||function(a){window.clearTimeout(a)}}(),a.FrontSide=0,a.BackSide=1,a.DoubleSide=2,a.NoShading=0,a.FlatShading=1,a.SmoothShading=2,a.NoColors=0,a.FaceColors=1,a.VertexColors=2,a.NoBlending=0,a.NormalBlending=1,a.AdditiveBlending=2,a.SubtractiveBlending=3,a.MultiplyBlending=4,a.CustomBlending=5,a.AddEquation=100,a.SubtractEquation=101,a.ReverseSubtractEquation=102,a.ZeroFactor=200,a.OneFactor=201,a.SrcColorFactor=202,a.OneMinusSrcColorFactor=203,a.SrcAlphaFactor=204,a.OneMinusSrcAlphaFactor=205,a.DstAlphaFactor=206,a.OneMinusDstAlphaFactor=207,a.DstColorFactor=208,a.OneMinusDstColorFactor=209,a.SrcAlphaSaturateFactor=210,a.MultiplyOperation=0,a.MixOperation=1,a.AddOperation=2,a.UVMapping=function(){},a.CubeReflectionMapping=function(){},a.CubeRefractionMapping=function(){},a.SphericalReflectionMapping=function(){},a.SphericalRefractionMapping=function(){},a.RepeatWrapping=1e3,a.ClampToEdgeWrapping=1001,a.MirroredRepeatWrapping=1002,a.NearestFilter=1003,a.NearestMipMapNearestFilter=1004,a.NearestMipMapLinearFilter=1005,a.LinearFilter=1006,a.LinearMipMapNearestFilter=1007,a.LinearMipMapLinearFilter=1008,a.UnsignedByteType=1009,a.ByteType=1010,a.ShortType=1011,a.UnsignedShortType=1012,a.IntType=1013,a.UnsignedIntType=1014,a.FloatType=1015,a.UnsignedShort4444Type=1016,a.UnsignedShort5551Type=1017,a.UnsignedShort565Type=1018,a.AlphaFormat=1019,a.RGBFormat=1020,a.RGBAFormat=1021,a.LuminanceFormat=1022,a.LuminanceAlphaFormat=1023,a.RGB_S3TC_DXT1_Format=2001,a.RGBA_S3TC_DXT1_Format=2002,a.RGBA_S3TC_DXT3_Format=2003,a.RGBA_S3TC_DXT5_Format=2004,a.Clock=function(a){this.autoStart=a!==undefined?a:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},a.Clock.prototype.start=function(){this.startTime=Date.now(),this.oldTime=this.startTime,this.running=!0},a.Clock.prototype.stop=function(){this.getElapsedTime(),this.running=!1},a.Clock.prototype.getElapsedTime=function(){return this.elapsedTime+=this.getDelta(),this.elapsedTime},a.Clock.prototype.getDelta=function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=Date.now();a=.001*(b-this.oldTime),this.oldTime=b,this.elapsedTime+=a}return a},a.Color=function(a){return a!==undefined&&this.setHex(a),this},a.Color.prototype={constructor:a.Color,r:1,g:1,b:1,copy:function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this},copyGammaToLinear:function(a){return this.r=a.r*a.r,this.g=a.g*a.g,this.b=a.b*a.b,this},copyLinearToGamma:function(a){return this.r=Math.sqrt(a.r),this.g=Math.sqrt(a.g),this.b=Math.sqrt(a.b),this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;return this.r=a*a,this.g=b*b,this.b=c*c,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},setRGB:function(a,b,c){return this.r=a,this.g=b,this.b=c,this},setHSV:function(a,b,c){var d,e,f,g,h;return c===0?this.r=this.g=this.b=0:(d=Math.floor(a*6),e=a*6-d,f=c*(1-b),g=c*(1-b*e),h=c*(1-b*(1-e)),d===0?(this.r=c,this.g=h,this.b=f):d===1?(this.r=g,this.g=c,this.b=f):d===2?(this.r=f,this.g=c,this.b=h):d===3?(this.r=f,this.g=g,this.b=c):d===4?(this.r=h,this.g=f,this.b=c):d===5&&(this.r=c,this.g=f,this.b=g)),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},setHex:function(a){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(a&255)/255,this},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getContextStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},setContextStyle:function(a){var b=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/i.exec(a);return this.r=parseInt(b[1],10)/255,this.g=parseInt(b[2],10)/255,this.b=parseInt(b[3],10)/255,this},getHSV:function(a){var b=this.r,c=this.g,d=this.b,e=Math.max(Math.max(b,c),d),f=Math.min(Math.min(b,c),d),g,h,i=e;if(f===e)g=0,h=0;else{var j=e-f;h=j/e,b===e?g=(c-d)/j:c===e?g=2+(d-b)/j:g=4+(b-c)/j,g/=6,g<0&&(g+=1),g>1&&(g-=1)}return a===undefined&&(a={h:0,s:0,v:0}),a.h=g,a.s=h,a.v=i,a},lerpSelf:function(a,b){return this.r+=(a.r-this.r)*b,this.g+=(a.g-this.g)*b,this.b+=(a.b-this.b)*b,this},clone:function(){return(new a.Color).setRGB(this.r,this.g,this.b)}},a.Vector2=function(a,b){this.x=a||0,this.y=b||0},a.Vector2.prototype={constructor:a.Vector2,set:function(a,b){return this.x=a,this.y=b,this},copy:function(a){return this.x=a.x,this.y=a.y,this},add:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addSelf:function(a){return this.x+=a.x,this.y+=a.y,this},sub:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},subSelf:function(a){return this.x-=a.x,this.y-=a.y,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this},divideScalar:function(a){return a?(this.x/=a,this.y/=a):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this},equals:function(a){return a.x===this.x&&a.y===this.y},clone:function(){return new a.Vector2(this.x,this.y)}},a.Vector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},a.Vector3.prototype={constructor:a.Vector3,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},addSelf:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},sub:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},subSelf:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},multiply:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},multiplySelf:function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},divideSelf:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){return a?(this.x/=a,this.y/=a,this.z/=a):(this.x=0,this.y=0,this.z=0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},cross:function(a,b){return this.x=a.y*b.z-a.z*b.y,this.y=a.z*b.x-a.x*b.z,this.z=a.x*b.y-a.y*b.x,this},crossSelf:function(a){var b=this.x,c=this.y,d=this.z;return this.x=c*a.z-d*a.y,this.y=d*a.x-b*a.z,this.z=b*a.y-c*a.x,this},angleTo:function(a){return Math.acos(this.dot(a)/this.length()/a.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(b){return(new a.Vector3).sub(this,b).lengthSq()},getPositionFromMatrix:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},setEulerFromRotationMatrix:function(a,b){function c(a){return Math.min(Math.max(a,-1),1)}var d=a.elements,e=d[0],f=d[4],g=d[8],h=d[1],i=d[5],j=d[9],k=d[2],l=d[6],m=d[10];return b===undefined||b==="XYZ"?(this.y=Math.asin(c(g)),Math.abs(g)<.99999?(this.x=Math.atan2(-j,m),this.z=Math.atan2(-f,e)):(this.x=Math.atan2(l,i),this.z=0)):b==="YXZ"?(this.x=Math.asin(-c(j)),Math.abs(j)<.99999?(this.y=Math.atan2(g,m),this.z=Math.atan2(h,i)):(this.y=Math.atan2(-k,e),this.z=0)):b==="ZXY"?(this.x=Math.asin(c(l)),Math.abs(l)<.99999?(this.y=Math.atan2(-k,m),this.z=Math.atan2(-f,i)):(this.y=0,this.z=Math.atan2(h,e))):b==="ZYX"?(this.y=Math.asin(-c(k)),Math.abs(k)<.99999?(this.x=Math.atan2(l,m),this.z=Math.atan2(h,e)):(this.x=0,this.z=Math.atan2(-f,i))):b==="YZX"?(this.z=Math.asin(c(h)),Math.abs(h)<.99999?(this.x=Math.atan2(-j,i),this.y=Math.atan2(-k,e)):(this.x=0,this.y=Math.atan2(g,m))):b==="XZY"&&(this.z=Math.asin(-c(f)),Math.abs(f)<.99999?(this.x=Math.atan2(l,i),this.y=Math.atan2(g,e)):(this.x=Math.atan2(-j,m),this.y=0)),this},setEulerFromQuaternion:function(a,b){function c(a){return Math.min(Math.max(a,-1),1)}var d=a.x*a.x,e=a.y*a.y,f=a.z*a.z,g=a.w*a.w;return b===undefined||b==="XYZ"?(this.x=Math.atan2(2*(a.x*a.w-a.y*a.z),g-d-e+f),this.y=Math.asin(c(2*(a.x*a.z+a.y*a.w))),this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),g+d-e-f)):b==="YXZ"?(this.x=Math.asin(c(2*(a.x*a.w-a.y*a.z))),this.y=Math.atan2(2*(a.x*a.z+a.y*a.w),g-d-e+f),this.z=Math.atan2(2*(a.x*a.y+a.z*a.w),g-d+e-f)):b==="ZXY"?(this.x=Math.asin(c(2*(a.x*a.w+a.y*a.z))),this.y=Math.atan2(2*(a.y*a.w-a.z*a.x),g-d-e+f),this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),g-d+e-f)):b==="ZYX"?(this.x=Math.atan2(2*(a.x*a.w+a.z*a.y),g-d-e+f),this.y=Math.asin(c(2*(a.y*a.w-a.x*a.z))),this.z=Math.atan2(2*(a.x*a.y+a.z*a.w),g+d-e-f)):b==="YZX"?(this.x=Math.atan2(2*(a.x*a.w-a.z*a.y),g-d+e-f),this.y=Math.atan2(2*(a.y*a.w-a.x*a.z),g+d-e-f),this.z=Math.asin(c(2*(a.x*a.y+a.z*a.w)))):b==="XZY"&&(this.x=Math.atan2(2*(a.x*a.w+a.y*a.z),g-d+e-f),this.y=Math.atan2(2*(a.x*a.z+a.y*a.w),g+d-e-f),this.z=Math.asin(c(2*(a.z*a.w-a.x*a.y)))),this},getScaleFromMatrix:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();return this.x=b,this.y=c,this.z=d,this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},clone:function(){return new a.Vector3(this.x,this.y,this.z)}},a.Vector4=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d!==undefined?d:1},a.Vector4.prototype={constructor:a.Vector4,set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w!==undefined?a.w:1,this},add:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},addSelf:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this},sub:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},subSelf:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this},divideScalar:function(a){return a?(this.x/=a,this.y/=a,this.z/=a,this.w/=a):(this.x=0,this.y=0,this.z=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this.w+=(a.w-this.w)*b,this},clone:function(){return new a.Vector4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);return b<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b),this},setAxisAngleFromRotationMatrix:function(a){var b,c,d,e,f=.01,g=.1,h=a.elements,i=h[0],j=h[4],k=h[8],l=h[1],m=h[5],n=h[9],o=h[2],p=h[6],q=h[10];if(Math.abs(j-l)<f&&Math.abs(k-o)<f&&Math.abs(n-p)<f){if(Math.abs(j+l)<g&&Math.abs(k+o)<g&&Math.abs(n+p)<g&&Math.abs(i+m+q-3)<g)return this.set(1,0,0,0),this;b=Math.PI;var r=(i+1)/2,s=(m+1)/2,t=(q+1)/2,u=(j+l)/4,v=(k+o)/4,w=(n+p)/4;return r>s&&r>t?r<f?(c=0,d=.707106781,e=.707106781):(c=Math.sqrt(r),d=u/c,e=v/c):s>t?s<f?(c=.707106781,d=0,e=.707106781):(d=Math.sqrt(s),c=u/d,e=w/d):t<f?(c=.707106781,d=.707106781,e=0):(e=Math.sqrt(t),c=v/e,d=w/e),this.set(c,d,e,b),this}var x=Math.sqrt((p-n)*(p-n)+(k-o)*(k-o)+(l-j)*(l-j));return Math.abs(x)<.001&&(x=1),this.x=(p-n)/x,this.y=(k-o)/x,this.z=(l-j)/x,this.w=Math.acos((i+m+q-1)/2),this}},a.Matrix3=function(){this.elements=new Float32Array(9)},a.Matrix3.prototype={constructor:a.Matrix3,multiplyVector3:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return a.x=b[0]*c+b[3]*d+b[6]*e,a.y=b[1]*c+b[4]*d+b[7]*e,a.z=b[2]*c+b[5]*d+b[8]*e,a},multiplyVector3Array:function(b){var c=a.Matrix3.__v1;for(var d=0,e=b.length;d<e;d+=3)c.x=b[d],c.y=b[d+1],c.z=b[d+2],this.multiplyVector3(c),b[d]=c.x,b[d+1]=c.y,b[d+2]=c.z;return b},getInverse:function(a){var b=a.elements,c=b[10]*b[5]-b[6]*b[9],d=-b[10]*b[1]+b[2]*b[9],e=b[6]*b[1]-b[2]*b[5],f=-b[10]*b[4]+b[6]*b[8],g=b[10]*b[0]-b[2]*b[8],h=-b[6]*b[0]+b[2]*b[4],i=b[9]*b[4]-b[5]*b[8],j=-b[9]*b[0]+b[1]*b[8],k=b[5]*b[0]-b[1]*b[4],l=b[0]*c+b[1]*f+b[2]*i;l===0&&console.warn("Matrix3.getInverse(): determinant == 0");var m=1/l,n=this.elements;return n[0]=m*c,n[1]=m*d,n[2]=m*e,n[3]=m*f,n[4]=m*g,n[5]=m*h,n[6]=m*i,n[7]=m*j,n[8]=m*k,this},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this},transposeIntoArray:function(a){var b=this.m;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this}},a.Matrix3.__v1=new a.Vector3,a.Matrix4=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.elements=new Float32Array(16),this.set(a!==undefined?a:1,b||0,c||0,d||0,e||0,f!==undefined?f:1,g||0,h||0,i||0,j||0,k!==undefined?k:1,l||0,m||0,n||0,o||0,p!==undefined?p:1)},a.Matrix4.prototype={constructor:a.Matrix4,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(a){var b=a.elements;return this.set(b[0],b[4],b[8],b[12],b[1],b[5],b[9],b[13],b[2],b[6],b[10],b[14],b[3],b[7],b[11],b[15]),this},lookAt:function(b,c,d){var e=this.elements,f=a.Matrix4.__v1,g=a.Matrix4.__v2,h=a.Matrix4.__v3;return h.sub(b,c).normalize(),h.length()===0&&(h.z=1),f.cross(d,h).normalize(),f.length()===0&&(h.x+=1e-4,f.cross(d,h).normalize()),g.cross(h,f),e[0]=f.x,e[4]=g.x,e[8]=h.x,e[1]=f.y,e[5]=g.y,e[9]=h.y,e[2]=f.z,e[6]=g.z,e[10]=h.z,this},multiply:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},multiplySelf:function(a){return this.multiply(this,a)},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiply(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},multiplyVector3:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=1/(b[3]*c+b[7]*d+b[11]*e+b[15]);return a.x=(b[0]*c+b[4]*d+b[8]*e+b[12])*f,a.y=(b[1]*c+b[5]*d+b[9]*e+b[13])*f,a.z=(b[2]*c+b[6]*d+b[10]*e+b[14])*f,a},multiplyVector4:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w;return a.x=b[0]*c+b[4]*d+b[8]*e+b[12]*f,a.y=b[1]*c+b[5]*d+b[9]*e+b[13]*f,a.z=b[2]*c+b[6]*d+b[10]*e+b[14]*f,a.w=b[3]*c+b[7]*d+b[11]*e+b[15]*f,a},multiplyVector3Array:function(b){var c=a.Matrix4.__v1;for(var d=0,e=b.length;d<e;d+=3)c.x=b[d],c.y=b[d+1],c.z=b[d+2],this.multiplyVector3(c),b[d]=c.x,b[d+1]=c.y,b[d+2]=c.z;return b},rotateAxis:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return a.x=c*b[0]+d*b[4]+e*b[8],a.y=c*b[1]+d*b[5]+e*b[9],a.z=c*b[2]+d*b[6]+e*b[10],a.normalize(),a},crossVector:function(b){var c=this.elements,d=new a.Vector4;return d.x=c[0]*b.x+c[4]*b.y+c[8]*b.z+c[12]*b.w,d.y=c[1]*b.x+c[5]*b.y+c[9]*b.z+c[13]*b.w,d.z=c[2]*b.x+c[6]*b.y+c[10]*b.z+c[14]*b.w,d.w=b.w?c[3]*b.x+c[7]*b.y+c[11]*b.z+c[15]*b.w:1,d},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14],n=a[3],o=a[7],p=a[11],q=a[15];return e*h*k*n-d*i*k*n-e*g*l*n+c*i*l*n+d*g*m*n-c*h*m*n-e*h*j*o+d*i*j*o+e*f*l*o-b*i*l*o-d*f*m*o+b*h*m*o+e*g*j*p-c*i*j*p-e*f*k*p+b*i*k*p+c*f*m*p-b*g*m*p-d*g*j*q+c*h*j*q+d*f*k*q-b*h*k*q-c*f*l*q+b*g*l*q},transpose:function(){var a=this.elements,b;return b=a[1],a[1]=a[4],a[4]=b,b=a[2],a[2]=a[8],a[8]=b,b=a[6],a[6]=a[9],a[9]=b,b=a[3],a[3]=a[12],a[12]=b,b=a[7],a[7]=a[13],a[13]=b,b=a[11],a[11]=a[14],a[14]=b,this},flattenToArray:function(a){var b=this.elements;return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a},getPosition:function(){var b=this.elements;return a.Matrix4.__v1.set(b[12],b[13],b[14])},setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getColumnX:function(){var b=this.elements;return a.Matrix4.__v1.set(b[0],b[1],b[2])},getColumnY:function(){var b=this.elements;return a.Matrix4.__v1.set(b[4],b[5],b[6])},getColumnZ:function(){var b=this.elements;return a.Matrix4.__v1.set(b[8],b[9],b[10])},getInverse:function(a){var b=this.elements,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[12],h=c[1],i=c[5],j=c[9],k=c[13],l=c[2],m=c[6],n=c[10],o=c[14],p=c[3],q=c[7],r=c[11],s=c[15];return b[0]=j*o*q-k*n*q+k*m*r-i*o*r-j*m*s+i*n*s,b[4]=g*n*q-f*o*q-g*m*r+e*o*r+f*m*s-e*n*s,b[8]=f*k*q-g*j*q+g*i*r-e*k*r-f*i*s+e*j*s,b[12]=g*j*m-f*k*m-g*i*n+e*k*n+f*i*o-e*j*o,b[1]=k*n*p-j*o*p-k*l*r+h*o*r+j*l*s-h*n*s,b[5]=f*o*p-g*n*p+g*l*r-d*o*r-f*l*s+d*n*s,b[9]=g*j*p-f*k*p-g*h*r+d*k*r+f*h*s-d*j*s,b[13]=f*k*l-g*j*l+g*h*n-d*k*n-f*h*o+d*j*o,b[2]=i*o*p-k*m*p+k*l*q-h*o*q-i*l*s+h*m*s,b[6]=g*m*p-e*o*p-g*l*q+d*o*q+e*l*s-d*m*s,b[10]=e*k*p-g*i*p+g*h*q-d*k*q-e*h*s+d*i*s,b[14]=g*i*l-e*k*l-g*h*m+d*k*m+e*h*o-d*i*o,b[3]=j*m*p-i*n*p-j*l*q+h*n*q+i*l*r-h*m*r,b[7]=e*n*p-f*m*p+f*l*q-d*n*q-e*l*r+d*m*r,b[11]=f*i*p-e*j*p-f*h*q+d*j*q+e*h*r-d*i*r,b[15]=e*j*l-f*i*l+f*h*m-d*j*m-e*h*n+d*i*n,this.multiplyScalar(1/a.determinant()),this},setRotationFromEuler:function(a,b){var c=this.elements,d=a.x,e=a.y,f=a.z,g=Math.cos(d),h=Math.sin(d),i=Math.cos(e),j=Math.sin(e),k=Math.cos(f),l=Math.sin(f);if(b===undefined||b==="XYZ"){var m=g*k,n=g*l,o=h*k,p=h*l;c[0]=i*k,c[4]=-i*l,c[8]=j,c[1]=n+o*j,c[5]=m-p*j,c[9]=-h*i,c[2]=p-m*j,c[6]=o+n*j,c[10]=g*i}else if(b==="YXZ"){var q=i*k,r=i*l,s=j*k,t=j*l;c[0]=q+t*h,c[4]=s*h-r,c[8]=g*j,c[1]=g*l,c[5]=g*k,c[9]=-h,c[2]=r*h-s,c[6]=t+q*h,c[10]=g*i}else if(b==="ZXY"){var q=i*k,r=i*l,s=j*k,t=j*l;c[0]=q-t*h,c[4]=-g*l,c[8]=s+r*h,c[1]=r+s*h,c[5]=g*k,c[9]=t-q*h,c[2]=-g*j,c[6]=h,c[10]=g*i}else if(b==="ZYX"){var m=g*k,n=g*l,o=h*k,p=h*l;c[0]=i*k,c[4]=o*j-n,c[8]=m*j+p,c[1]=i*l,c[5]=p*j+m,c[9]=n*j-o,c[2]=-j,c[6]=h*i,c[10]=g*i}else if(b==="YZX"){var u=g*i,v=g*j,w=h*i,x=h*j;c[0]=i*k,c[4]=x-u*l,c[8]=w*l+v,c[1]=l,c[5]=g*k,c[9]=-h*k,c[2]=-j*k,c[6]=v*l+w,c[10]=u-x*l}else if(b==="XZY"){var u=g*i,v=g*j,w=h*i,x=h*j;c[0]=i*k,c[4]=-l,c[8]=j*k,c[1]=u*l+x,c[5]=g*k,c[9]=v*l-w,c[2]=w*l-v,c[6]=h*k,c[10]=x*l+u}return this},setRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),this},compose:function(b,c,d){var e=this.elements,f=a.Matrix4.__m1,g=a.Matrix4.__m2;return f.identity(),f.setRotationFromQuaternion(c),g.makeScale(d.x,d.y,d.z),this.multiply(f,g),e[12]=b.x,e[13]=b.y,e[14]=b.z,this},decompose:function(b,c,d){var e=this.elements,f=a.Matrix4.__v1,g=a.Matrix4.__v2,h=a.Matrix4.__v3;f.set(e[0],e[1],e[2]),g.set(e[4],e[5],e[6]),h.set(e[8],e[9],e[10]),b=b instanceof a.Vector3?b:new a.Vector3,c=c instanceof a.Quaternion?c:new a.Quaternion,d=d instanceof a.Vector3?d:new a.Vector3,d.x=f.length(),d.y=g.length(),d.z=h.length(),b.x=e[12],b.y=e[13],b.z=e[14];var i=a.Matrix4.__m1;return i.copy(this),i.elements[0]/=d.x,i.elements[1]/=d.x,i.elements[2]/=d.x,i.elements[4]/=d.y,i.elements[5]/=d.y,i.elements[6]/=d.y,i.elements[8]/=d.z,i.elements[9]/=d.z,i.elements[10]/=d.z,c.setFromRotationMatrix(i),[b,c,d]},extractPosition:function(a){var b=this.elements,c=a.elements;return b[12]=c[12],b[13]=c[13],b[14]=c[14],this},extractRotation:function(b){var c=this.elements,d=b.elements,e=a.Matrix4.__v1,f=1/e.set(d[0],d[1],d[2]).length(),g=1/e.set(d[4],d[5],d[6]).length(),h=1/e.set(d[8],d[9],d[10]).length();return c[0]=d[0]*f,c[1]=d[1]*f,c[2]=d[2]*f,c[4]=d[4]*g,c[5]=d[5]*g,c[6]=d[6]*g,c[8]=d[8]*h,c[9]=d[9]*h,c[10]=d[10]*h,this},translate:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[12]=b[0]*c+b[4]*d+b[8]*e+b[12],b[13]=b[1]*c+b[5]*d+b[9]*e+b[13],b[14]=b[2]*c+b[6]*d+b[10]*e+b[14],b[15]=b[3]*c+b[7]*d+b[11]*e+b[15],this},rotateX:function(a){var b=this.elements,c=b[4],d=b[5],e=b[6],f=b[7],g=b[8],h=b[9],i=b[10],j=b[11],k=Math.cos(a),l=Math.sin(a);return b[4]=k*c+l*g,b[5]=k*d+l*h,b[6]=k*e+l*i,b[7]=k*f+l*j,b[8]=k*g-l*c,b[9]=k*h-l*d,b[10]=k*i-l*e,b[11]=k*j-l*f,this},rotateY:function(a){var b=this.elements,c=b[0],d=b[1],e=b[2],f=b[3],g=b[8],h=b[9],i=b[10],j=b[11],k=Math.cos(a),l=Math.sin(a);return b[0]=k*c-l*g,b[1]=k*d-l*h,b[2]=k*e-l*i,b[3]=k*f-l*j,b[8]=k*g+l*c,b[9]=k*h+l*d,b[10]=k*i+l*e,b[11]=k*j+l*f,this},rotateZ:function(a){var b=this.elements,c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=Math.cos(a),l=Math.sin(a);return b[0]=k*c+l*g,b[1]=k*d+l*h,b[2]=k*e+l*i,b[3]=k*f+l*j,b[4]=k*g-l*c,b[5]=k*h-l*d,b[6]=k*i-l*e,b[7]=k*j-l*f,this},rotateByAxis:function(a,b){var c=this.elements;if(a.x===1&&a.y===0&&a.z===0)return this.rotateX(b);if(a.x===0&&a.y===1&&a.z===0)return this.rotateY(b);if(a.x===0&&a.y===0&&a.z===1)return this.rotateZ(b);var d=a.x,e=a.y,f=a.z,g=Math.sqrt(d*d+e*e+f*f);d/=g,e/=g,f/=g;var h=d*d,i=e*e,j=f*f,k=Math.cos(b),l=Math.sin(b),m=1-k,n=d*e*m,o=d*f*m,p=e*f*m,q=d*l,r=e*l,s=f*l,t=h+(1-h)*k,u=n+s,v=o-r,w=n-s,x=i+(1-i)*k,y=p+q,z=o+r,A=p-q,B=j+(1-j)*k,C=c[0],D=c[1],E=c[2],F=c[3],G=c[4],H=c[5],I=c[6],J=c[7],K=c[8],L=c[9],M=c[10],N=c[11],O=c[12],P=c[13],Q=c[14],R=c[15];return c[0]=t*C+u*G+v*K,c[1]=t*D+u*H+v*L,c[2]=t*E+u*I+v*M,c[3]=t*F+u*J+v*N,c[4]=w*C+x*G+y*K,c[5]=w*D+x*H+y*L,c[6]=w*E+x*I+y*M,c[7]=w*F+x*J+y*N,c[8]=z*C+A*G+B*K,c[9]=z*D+A*H+B*L,c[10]=z*E+A*I+B*M,c[11]=z*F+A*J+B*N,this},scale:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},getMaxScaleOnAxis:function(){var a=this.elements,b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],c=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],d=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(b,Math.max(c,d)))},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},makeFrustum:function(a,b,c,d,e,f){var g=this.elements,h=2*e/(b-a),i=2*e/(d-c),j=(b+a)/(b-a),k=(d+c)/(d-c),l=-(f+e)/(f-e),m=-2*f*e/(f-e);return g[0]=h,g[4]=0,g[8]=j,g[12]=0,g[1]=0,g[5]=i,g[9]=k,g[13]=0,g[2]=0,g[6]=0,g[10]=l,g[14]=m,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this},makePerspective:function(a,b,c,d){var e=c*Math.tan(a*Math.PI/360),f=-e,g=f*b,h=e*b;return this.makeFrustum(g,h,f,e,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=b-a,i=c-d,j=f-e,k=(b+a)/h,l=(c+d)/i,m=(f+e)/j;return g[0]=2/h,g[4]=0,g[8]=0,g[12]=-k,g[1]=0,g[5]=2/i,g[9]=0,g[13]=-l,g[2]=0,g[6]=0,g[10]=-2/j,g[14]=-m,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this},clone:function(){var b=this.elements;return new a.Matrix4(b[0],b[4],b[8],b[12],b[1],b[5],b[9],b[13],b[2],b[6],b[10],b[14],b[3],b[7],b[11],b[15])}},a.Matrix4.__v1=new a.Vector3,a.Matrix4.__v2=new a.Vector3,a.Matrix4.__v3=new a.Vector3,a.Matrix4.__m1=new a.Matrix4,a.Matrix4.__m2=new a.Matrix4,a.EventTarget=function(){var a={};this.addEventListener=function(b,c){a[b]===undefined&&(a[b]=[]),a[b].indexOf(c)===-1&&a[b].push(c)},this.dispatchEvent=function(b){for(var c in a[b.type])a[b.type][c](b)},this.removeEventListener=function(b,c){var d=a[b].indexOf(c);d!==-1&&a[b].splice(d,1)}},a.Frustum=function(){this.planes=[new a.Vector4,new a.Vector4,new a.Vector4,new a.Vector4,new a.Vector4,new a.Vector4]},a.Frustum.prototype.setFromMatrix=function(a){var b,c=this.planes,d=a.elements,e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=d[5],k=d[6],l=d[7],m=d[8],n=d[9],o=d[10],p=d[11],q=d[12],r=d[13],s=d[14],t=d[15];c[0].set(h-e,l-i,p-m,t-q),c[1].set(h+e,l+i,p+m,t+q),c[2].set(h+f,l+j,p+n,t+r),c[3].set(h-f,l-j,p-n,t-r),c[4].set(h-g,l-k,p-o,t-s),c[5].set(h+g,l+k,p+o,t+s);for(var u=0;u<6;u++)b=c[u],b.divideScalar(Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z))},a.Frustum.prototype.contains=function(a){var b=0,c=this.planes,d=a.matrixWorld,e=d.elements,f=-a.geometry.boundingSphere.radius*d.getMaxScaleOnAxis();for(var g=0;g<6;g++){b=c[g].x*e[12]+c[g].y*e[13]+c[g].z*e[14]+c[g].w;if(b<=f)return!1}return!0},a.Frustum.__v1=new a.Vector3,function(a){a.Ray=function(b,c,d,e){this.origin=b||new a.Vector3,this.direction=c||new a.Vector3,this.near=d||0,this.far=e||Infinity};var b=new a.Vector3,c=new a.Vector3,d=new a.Vector3,e=new a.Vector3,f=new a.Vector3,g=new a.Vector3,h=new a.Matrix4,i=function(a,b){return a.distance-b.distance},j=new a.Vector3,k=new a.Vector3,l=new a.Vector3,m=function(a,b,c){j.sub(c,a);var d=j.dot(b),e=k.add(a,l.copy(b).multiplyScalar(d)),f=c.distanceTo(e);return f},n=function(a,b,c,d){j.sub(d,b),k.sub(c,b),l.sub(a,b);var e=j.dot(j),f=j.dot(k),g=j.dot(l),h=k.dot(k),i=k.dot(l),m=1/(e*h-f*f),n=(h*g-f*i)*m,o=(e*i-f*g)*m;return n>=0&&o>=0&&n+o<1},o=function(f,i,j){if(f instanceof a.Particle){var k=m(i.origin,i.direction,f.matrixWorld.getPosition());if(k>f.scale.x)return j;j.push({distance:k,point:f.position,face:null,object:f})}else if(f instanceof a.Mesh){var l=f.geometry.boundingSphere.radius*f.matrixWorld.getMaxScaleOnAxis(),k=m(i.origin,i.direction,f.matrixWorld.getPosition());if(k>l)return j;var o=f.geometry,p=o.vertices,q=f.material instanceof a.MeshFaceMaterial,r=q===!0?f.material.materials:null,s=f.material.side,t,u,v,w,x=i.precision;f.matrixRotationWorld.extractRotation(f.matrixWorld),b.copy(i.origin),h.getInverse(f.matrixWorld),c.copy(b),h.multiplyVector3(c),d.copy(i.direction),h.rotateAxis(d).normalize();for(var y=0,z=o.faces.length;y<z;y++){var A=o.faces[y],B=q===!0?r[A.materialIndex]:f.material;if(B===undefined)continue;s=B.side,e.sub(A.centroid,c);var C=A.normal,D=d.dot(C);if(Math.abs(D)<x)continue;var E=C.dot(e)/D;if(E<0)continue;if(s===a.DoubleSide||(s===a.FrontSide?D<0:D>0)){g.add(c,d.multiplyScalar(E));if(A instanceof a.Face3){t=p[A.a],u=p[A.b],v=p[A.c];if(n(g,t,u,v)){var F=f.matrixWorld.multiplyVector3(g.clone());k=b.distanceTo(F);if(k<i.near||k>i.far)continue;j.push({distance:k,point:F,face:A,faceIndex:y,object:f})}}else if(A instanceof a.Face4){t=p[A.a],u=p[A.b],v=p[A.c],w=p[A.d];if(n(g,t,u,w)||n(g,u,v,w)){var F=f.matrixWorld.multiplyVector3(g.clone());k=b.distanceTo(F);if(k<i.near||k>i.far)continue;j.push({distance:k,point:F,face:A,faceIndex:y,object:f})}}}}}},p=function(a,b,c){var d=a.getDescendants();for(var e=0,f=d.length;e<f;e++)o(d[e],b,c)};a.Ray.prototype.precision=1e-4,a.Ray.prototype.set=function(a,b){this.origin=a,this.direction=b},a.Ray.prototype.intersectObject=function(a,b){var c=[];return b===!0&&p(a,this,c),o(a,this,c),c.sort(i),c},a.Ray.prototype.intersectObjects=function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++)o(a[d],this,c),b===!0&&p(a[d],this,c);return c.sort(i),c}}(a),a.Rectangle=function(){function h(){e=c-a,f=d-b}var a=0,b=0,c=0,d=0,e=0,f=0,g=!0;this.getX=function(){return a},this.getY=function(){return b},this.getWidth=function(){return e},this.getHeight=function(){return f},this.getLeft=function(){return a},this.getTop=function(){return b},this.getRight=function(){return c},this.getBottom=function(){return d},this.set=function(e,f,i,j){g=!1,a=e,b=f,c=i,d=j,h()},this.addPoint=function(e,f){g===!0?(g=!1,a=e,b=f,c=e,d=f,h()):(a=a<e?a:e,b=b<f?b:f,c=c>e?c:e,d=d>f?d:f,h())},this.add3Points=function(e,f,i,j,k,l){g===!0?(g=!1,a=e<i?e<k?e:k:i<k?i:k,b=f<j?f<l?f:l:j<l?j:l,c=e>i?e>k?e:k:i>k?i:k,d=f>j?f>l?f:l:j>l?j:l,h()):(a=e<i?e<k?e<a?e:a:k<a?k:a:i<k?i<a?i:a:k<a?k:a,b=f<j?f<l?f<b?f:b:l<b?l:b:j<l?j<b?j:b:l<b?l:b,c=e>i?e>k?e>c?e:c:k>c?k:c:i>k?i>c?i:c:k>c?k:c,d=f>j?f>l?f>d?f:d:l>d?l:d:j>l?j>d?j:d:l>d?l:d,h())},this.addRectangle=function(e){g===!0?(g=!1,a=e.getLeft(),b=e.getTop(),c=e.getRight(),d=e.getBottom(),h()):(a=a<e.getLeft()?a:e.getLeft(),b=b<e.getTop()?b:e.getTop(),c=c>e.getRight()?c:e.getRight(),d=d>e.getBottom()?d:e.getBottom(),h())},this.inflate=function(e){a-=e,b-=e,c+=e,d+=e,h()},this.minSelf=function(e){a=a>e.getLeft()?a:e.getLeft(),b=b>e.getTop()?b:e.getTop(),c=c<e.getRight()?c:e.getRight(),d=d<e.getBottom()?d:e.getBottom(),h()},this.intersects=function(e){return c<e.getLeft()?!1:a>e.getRight()?!1:d<e.getTop()?!1:b>e.getBottom()?!1:!0},this.empty=function(){g=!0,a=0,b=0,c=0,d=0,h()},this.isEmpty=function(){return g}},a.Math={clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},sign:function(a){return a<0?-1:a>0?1:0}},a.Object3D=function(){a.Object3DLibrary.push(this),this.id=a.Object3DIdCount++,this.name="",this.properties={},this.parent=undefined,this.children=[],this.up=new a.Vector3(0,1,0),this.position=new a.Vector3,this.rotation=new a.Vector3,this.eulerOrder=a.Object3D.defaultEulerOrder,this.scale=new a.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new a.Matrix4,this.matrixWorld=new a.Matrix4,this.matrixRotationWorld=new a.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.quaternion=new a.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this._vector=new a.Vector3},a.Object3D.prototype={constructor:a.Object3D,applyMatrix:function(b){this.matrix.multiply(b,this.matrix),this.scale.getScaleFromMatrix(this.matrix);var c=(new a.Matrix4).extractRotation(this.matrix);this.rotation.setEulerFromRotationMatrix(c,this.eulerOrder),this.position.getPositionFromMatrix(this.matrix)},translate:function(a,b){this.matrix.rotateAxis(b),this.position.addSelf(b.multiplyScalar(a))},translateX:function(a){this.translate(a,this._vector.set(1,0,0))},translateY:function(a){this.translate(a,this._vector.set(0,1,0))},translateZ:function(a){this.translate(a,this._vector.set(0,0,1))},localToWorld:function(a){return this.matrixWorld.multiplyVector3(a)},worldToLocal:function(b){return a.Object3D.__m1.getInverse(this.matrixWorld).multiplyVector3(b)},lookAt:function(a){this.matrix.lookAt(a,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},add:function(b){if(b===this){console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");return}if(b instanceof a.Object3D){b.parent!==undefined&&b.parent.remove(b),b.parent=this,this.children.push(b);var c=this;while(c.parent!==undefined)c=c.parent;c!==undefined&&c instanceof a.Scene&&c.__addObject(b)}},remove:function(b){var c=this.children.indexOf(b);if(c!==-1){b.parent=undefined,this.children.splice(c,1);var d=this;while(d.parent!==undefined)d=d.parent;d!==undefined&&d instanceof a.Scene&&d.__removeObject(b)}},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)},getChildByName:function(a,b){for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c];if(e.name===a)return e;if(b===!0){e=e.getChildByName(a,b);if(e!==undefined)return e}}return undefined},getDescendants:function(a){a===undefined&&(a=[]),Array.prototype.push.apply(a,this.children);for(var b=0,c=this.children.length;b<c;b++)this.children[b].getDescendants(a);return a},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z));this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){this.matrixAutoUpdate===!0&&this.updateMatrix();if(this.matrixWorldNeedsUpdate===!0||a===!0)this.parent===undefined?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},clone:function(b){b===undefined&&(b=new a.Object3D),b.name=this.name,b.up.copy(this.up),b.position.copy(this.position),b.rotation instanceof a.Vector3&&b.rotation.copy(this.rotation),b.eulerOrder=this.eulerOrder,b.scale.copy(this.scale),b.renderDepth=this.renderDepth,b.rotationAutoUpdate=this.rotationAutoUpdate,b.matrix.copy(this.matrix),b.matrixWorld.copy(this.matrixWorld),b.matrixRotationWorld.copy(this.matrixRotationWorld),b.matrixAutoUpdate=this.matrixAutoUpdate,b.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,b.quaternion.copy(this.quaternion),b.useQuaternion=this.useQuaternion,b.boundRadius=this.boundRadius,b.boundRadiusScale=this.boundRadiusScale,b.visible=this.visible,b.castShadow=this.castShadow,b.receiveShadow=this.receiveShadow,b.frustumCulled=this.frustumCulled;for(var c=0;c<this.children.length;c++){var d=this.children[c];b.add(d.clone())}return b},deallocate:function(){var b=a.Object3DLibrary.indexOf(this);b!==-1&&a.Object3DLibrary.splice(b,1)}},a.Object3D.__m1=new a.Matrix4,a.Object3D.defaultEulerOrder="XYZ",a.Object3DIdCount=0,a.Object3DLibrary=[],a.Projector=function(){function J(){if(c===e){var b=new a.RenderableObject;return d.push(b),e++,c++,b}return d[c++]}function K(){if(g===i){var b=new a.RenderableVertex;return h.push(b),i++,g++,b}return h[g++]}function L(){if(k===m){var b=new a.RenderableFace3;return l.push(b),m++,k++,b}return l[k++]}function M(){if(n===p){var b=new a.RenderableFace4;return o.push(b),p++,n++,b}return o[n++]}function N(){if(r===t){var b=new a.RenderableLine;return s.push(b),t++,r++,b}return s[r++]}function O(){if(v===x){var b=new a.RenderableParticle;return w.push(b),x++,v++,b}return w[v++]}function P(a,b){return b.z-a.z}function Q(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;return e>=0&&f>=0&&g>=0&&h>=0?!0:e<0&&f<0||g<0&&h<0?!1:(e<0?c=Math.max(c,e/(e-f)):f<0&&(d=Math.min(d,e/(e-f))),g<0?c=Math.max(c,g/(g-h)):h<0&&(d=Math.min(d,g/(g-h))),d<c?!1:(a.lerpSelf(b,c),b.lerpSelf(a,1-d),!0))}var b,c,d=[],e=0,f,g,h=[],i=0,j,k,l=[],m=0,n,o=[],p=0,q,r,s=[],t=0,u,v,w=[],x=0,y={objects:[],sprites:[],lights:[],elements:[]},z=new a.Vector3,A=new a.Vector4,B=new a.Matrix4,C=new a.Matrix4,D=new a.Matrix3,E=new a.Frustum,F=new a.Vector4,G=new a.Vector4,H;this.projectVector=function(a,b){return b.matrixWorldInverse.getInverse(b.matrixWorld),B.multiply(b.projectionMatrix,b.matrixWorldInverse),B.multiplyVector3(a),a},this.unprojectVector=function(a,b){return b.projectionMatrixInverse.getInverse(b.projectionMatrix),B.multiply(b.matrixWorld,b.projectionMatrixInverse),B.multiplyVector3(a),a},this.pickingRay=function(b,c){var d,e,f;return b.z=-1,d=new a.Vector3(b.x,b.y,1),this.unprojectVector(b,c),this.unprojectVector(d,c),d.subSelf(b).normalize(),new a.Ray(b,d)};var I=function(d,e){c=0,y.objects.length=0,y.sprites.length=0,y.lights.length=0;var f=function(c){for(var d=0,e=c.children.length;d<e;d++){var g=c.children[d];if(g.visible===!1)continue;if(g instanceof a.Light)y.lights.push(g);else if(g instanceof a.Mesh||g instanceof a.Line){if(g.frustumCulled===!1||E.contains(g)===!0)b=J(),b.object=g,g.renderDepth!==null?b.z=g.renderDepth:(z.copy(g.matrixWorld.getPosition()),B.multiplyVector3(z),b.z=z.z),y.objects.push(b)}else g instanceof a.Sprite||g instanceof a.Particle?(b=J(),b.object=g,g.renderDepth!==null?b.z=g.renderDepth:(z.copy(g.matrixWorld.getPosition()),B.multiplyVector3(z),b.z=z.z),y.sprites.push(b)):(b=J(),b.object=g,g.renderDepth!==null?b.z=g.renderDepth:(z.copy(g.matrixWorld.getPosition()),B.multiplyVector3(z),b.z=z.z),y.objects.push(b));f(g)}};return f(d),e===!0&&y.objects.sort(P),y};this.projectScene=function(b,c,d,e){var i=c.near,l=c.far,m=!1,o,p,s,t,w,x,z,H,J,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb;k=0,n=0,r=0,v=0,y.elements.length=0,b.updateMatrixWorld(),c.parent===undefined&&c.updateMatrixWorld(),c.matrixWorldInverse.getInverse(c.matrixWorld),B.multiply(c.projectionMatrix,c.matrixWorldInverse),E.setFromMatrix(B),y=I(b,d);for(o=0,p=y.objects.length;o<p;o++){U=y.objects[o].object,V=U.matrixWorld,g=0;if(U instanceof a.Mesh){W=U.geometry,X=W.vertices,$=W.faces,cb=W.faceVertexUvs,D.getInverse(V),D.transpose(),ib=U.material instanceof a.MeshFaceMaterial,jb=ib===!0?U.material:null,lb=U.material.side;for(s=0,t=X.length;s<t;s++)f=K(),f.positionWorld.copy(X[s]),V.multiplyVector3(f.positionWorld),f.positionScreen.copy(f.positionWorld),B.multiplyVector4(f.positionScreen),f.positionScreen.x/=f.positionScreen.w,f.positionScreen.y/=f.positionScreen.w,f.visible=f.positionScreen.z>i&&f.positionScreen.z<l;for(w=0,x=$.length;w<x;w++){_=$[w],kb=ib===!0?jb.materials[_.materialIndex]:U.material;if(kb===undefined)continue;lb=kb.side;if(_ instanceof a.Face3){eb=h[_.a],fb=h[_.b],gb=h[_.c];if(eb.visible!==!0||fb.visible!==!0||gb.visible!==!0)continue;m=(gb.positionScreen.x-eb.positionScreen.x)*(fb.positionScreen.y-eb.positionScreen.y)-(gb.positionScreen.y-eb.positionScreen.y)*(fb.positionScreen.x-eb.positionScreen.x)<0;if(lb!==a.DoubleSide&&m!==(lb===a.FrontSide))continue;j=L(),j.v1.copy(eb),j.v2.copy(fb),j.v3.copy(gb)}else if(_ instanceof a.Face4){eb=h[_.a],fb=h[_.b],gb=h[_.c],hb=h[_.d];if(eb.visible!==!0||fb.visible!==!0||gb.visible!==!0||hb.visible!==!0)continue;m=(hb.positionScreen.x-eb.positionScreen.x)*(fb.positionScreen.y-eb.positionScreen.y)-(hb.positionScreen.y-eb.positionScreen.y)*(fb.positionScreen.x-eb.positionScreen.x)<0||(fb.positionScreen.x-gb.positionScreen.x)*(hb.positionScreen.y-gb.positionScreen.y)-(fb.positionScreen.y-gb.positionScreen.y)*(hb.positionScreen.x-gb.positionScreen.x)<0;if(lb!==a.DoubleSide&&m!==(lb===a.FrontSide))continue;j=M(),j.v1.copy(eb),j.v2.copy(fb),j.v3.copy(gb),j.v4.copy(hb)}j.normalWorld.copy(_.normal),m===!1&&(lb===a.BackSide||lb===a.DoubleSide)&&j.normalWorld.negate(),D.multiplyVector3(j.normalWorld).normalize(),j.centroidWorld.copy(_.centroid),V.multiplyVector3(j.centroidWorld),j.centroidScreen.copy(j.centroidWorld),B.multiplyVector3(j.centroidScreen),ab=_.vertexNormals;for(z=0,H=ab.length;z<H;z++)bb=j.vertexNormalsWorld[z],bb.copy(ab[z]),m===!1&&(lb===a.BackSide||lb===a.DoubleSide)&&bb.negate(),D.multiplyVector3(bb).normalize();j.vertexNormalsLength=ab.length;for(J=0,R=cb.length;J<R;J++){db=cb[J][w];if(db===undefined)continue;for(S=0,T=db.length;S<T;S++)j.uvs[J][S]=db[S]}j.color=_.color,j.material=kb,j.z=j.centroidScreen.z,y.elements.push(j)}}else if(U instanceof a.Line){C.multiply(B,V),X=U.geometry.vertices,eb=K(),eb.positionScreen.copy(X[0]),C.multiplyVector4(eb.positionScreen);var mb=U.type===a.LinePieces?2:1;for(s=1,t=X.length;s<t;s++){eb=K(),eb.positionScreen.copy(X[s]),C.multiplyVector4(eb.positionScreen);if((s+1)%mb>0)continue;fb=h[g-2],F.copy(eb.positionScreen),G.copy(fb.positionScreen),Q(F,G)===!0&&(F.multiplyScalar(1/F.w),G.multiplyScalar(1/G.w),q=N(),q.v1.positionScreen.copy(F),q.v2.positionScreen.copy(G),q.z=Math.max(F.z,G.z),q.material=U.material,y.elements.push(q))}}}for(o=0,p=y.sprites.length;o<p;o++)U=y.sprites[o].object,V=U.matrixWorld,U instanceof a.Particle&&(A.set(V.elements[12],V.elements[13],V.elements[14],1),B.multiplyVector4(A),A.z/=A.w,A.z>0&&A.z<1&&(u=O(),u.object=U,u.x=A.x/A.w,u.y=A.y/A.w,u.z=A.z,u.rotation=U.rotation.z,u.scale.x=U.scale.x*Math.abs(u.x-(A.x+c.projectionMatrix.elements[0])/(A.w+c.projectionMatrix.elements[12])),u.scale.y=U.scale.y*Math.abs(u.y-(A.y+c.projectionMatrix.elements[5])/(A.w+c.projectionMatrix.elements[13])),u.material=U.material,y.elements.push(u)));return e===!0&&y.elements.sort(P),y}},a.Quaternion=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d!==undefined?d:1},a.Quaternion.prototype={constructor:a.Quaternion,set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this},setFromEuler:function(a,b){var c=Math.cos(a.x/2),d=Math.cos(a.y/2),e=Math.cos(a.z/2),f=Math.sin(a.x/2),g=Math.sin(a.y/2),h=Math.sin(a.z/2);return b===undefined||b==="XYZ"?(this.x=f*d*e+c*g*h,this.y=c*g*e-f*d*h,this.z=c*d*h+f*g*e,this.w=c*d*e-f*g*h):b==="YXZ"?(this.x=f*d*e+c*g*h,this.y=c*g*e-f*d*h,this.z=c*d*h-f*g*e,this.w=c*d*e+f*g*h):b==="ZXY"?(this.x=f*d*e-c*g*h,this.y=c*g*e+f*d*h,this.z=c*d*h+f*g*e,this.w=c*d*e-f*g*h):b==="ZYX"?(this.x=f*d*e-c*g*h,this.y=c*g*e+f*d*h,this.z=c*d*h-f*g*e,this.w=c*d*e+f*g*h):b==="YZX"?(this.x=f*d*e+c*g*h,this.y=c*g*e+f*d*h,this.z=c*d*h-f*g*e,this.w=c*d*e-f*g*h):b==="XZY"&&(this.x=f*d*e-c*g*h,this.y=c*g*e-f*d*h,this.z=c*d*h+f*g*e,this.w=c*d*e+f*g*h),this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);return this.x=a.x*d,this.y=a.y*d,this.z=a.z*d,this.w=Math.cos(c),this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0],d=b[4],e=b[8],f=b[1],g=b[5],h=b[9],i=b[2],j=b[6],k=b[10],l=c+g+k,m;return l>0?(m=.5/Math.sqrt(l+1),this.w=.25/m,this.x=(j-h)*m,this.y=(e-i)*m,this.z=(f-d)*m):c>g&&c>k?(m=2*Math.sqrt(1+c-g-k),this.w=(j-h)/m,this.x=.25*m,this.y=(d+f)/m,this.z=(e+i)/m):g>k?(m=2*Math.sqrt(1+g-c-k),this.w=(e-i)/m,this.x=(d+f)/m,this.y=.25*m,this.z=(h+j)/m):(m=2*Math.sqrt(1+k-c-g),this.w=(f-d)/m,this.x=(e+i)/m,this.y=(h+j)/m,this.z=.25*m),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return a===0?(this.x=0,this.y=0,this.z=0,this.w=1):(a=1/a,this.x=this.x*a,this.y=this.y*a,this.z=this.z*a,this.w=this.w*a),this},multiply:function(a,b){var c=a.x,d=a.y,e=a.z,f=a.w,g=b.x,h=b.y,i=b.z,j=b.w;return this.x=c*j+d*i-e*h+f*g,this.y=-c*i+d*j+e*g+f*h,this.z=c*h-d*g+e*j+f*i,this.w=-c*g-d*h-e*i+f*j,this},multiplySelf:function(a){var b=this.x,c=this.y,d=this.z,e=this.w,f=a.x,g=a.y,h=a.z,i=a.w;return this.x=b*i+e*f+c*h-d*g,this.y=c*i+e*g+d*f-b*h,this.z=d*i+e*h+b*g-c*f,this.w=e*i-b*f-c*g-d*h,this},multiplyVector3:function(a,b){b||(b=a);var c=a.x,d=a.y,e=a.z,f=this.x,g=this.y,h=this.z,i=this.w,j=i*c+g*e-h*d,k=i*d+h*c-f*e,l=i*e+f*d-g*c,m=-f*c-g*d-h*e;return b.x=j*i+m*-f+k*-h-l*-g,b.y=k*i+m*-g+l*-f-j*-h,b.z=l*i+m*-h+j*-g-k*-f,b},slerpSelf:function(a,b){var c=this.x,d=this.y,e=this.z,f=this.w,g=f*a.w+c*a.x+d*a.y+e*a.z;g<0?(this.w=-a.w,this.x=-a.x,this.y=-a.y,this.z=-a.z,g=-g):this.copy(a);if(g>=1)return this.w=f,this.x=c,this.y=d,this.z=e,this;var h=Math.acos(g),i=Math.sqrt(1-g*g);if(Math.abs(i)<.001)return this.w=.5*(f+this.w),this.x=.5*(c+this.x),this.y=.5*(d+this.y),this.z=.5*(e+this.z),this;var j=Math.sin((1-b)*h)/i,k=Math.sin(b*h)/i;return this.w=f*j+this.w*k,this.x=c*j+this.x*k,this.y=d*j+this.y*k,this.z=e*j+this.z*k,this},clone:function(){return new a.Quaternion(this.x,this.y,this.z,this.w)}},a.Quaternion.slerp=function(a,b,c,d){var e=a.w*b.w+a.x*b.x+a.y*b.y+a.z*b.z;e<0?(c.w=-b.w,c.x=-b.x,c.y=-b.y,c.z=-b.z,e=-e):c.copy(b);if(Math.abs(e)>=1)return c.w=a.w,c.x=a.x,c.y=a.y,c.z=a.z,c;var f=Math.acos(e),g=Math.sqrt(1-e*e);if(Math.abs(g)<.001)return c.w=.5*(a.w+c.w),c.x=.5*(a.x+c.x),c.y=.5*(a.y+c.y),c.z=.5*(a.z+c.z),c;var h=Math.sin((1-d)*f)/g,i=Math.sin(d*f)/g;return c.w=a.w*h+c.w*i,c.x=a.x*h+c.x*i,c.y=a.y*h+c.y*i,c.z=a.z*h+c.z*i,c},a.Vertex=function(a){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),a},a.Face3=function(b,c,d,e,f,g){this.a=b,this.b=c,this.c=d,this.normal=e instanceof a.Vector3?e:new a.Vector3,this.vertexNormals=e instanceof Array?e:[],this.color=f instanceof a.Color?f:new a.Color,this.vertexColors=f instanceof Array?f:[],this.vertexTangents=[],this.materialIndex=g,this.centroid=new a.Vector3},a.Face3.prototype={constructor:a.Face3,clone:function(){var b=new a.Face3(this.a,this.b,this.c);b.normal.copy(this.normal),b.color.copy(this.color),b.centroid.copy(this.centroid),b.materialIndex=this.materialIndex;var c,d;for(c=0,d=this.vertexNormals.length;c<d;c++)b.vertexNormals[c]=this.vertexNormals[c].clone();for(c=0,d=this.vertexColors.length;c<d;c++)b.vertexColors[c]=this.vertexColors[c].clone();for(c=0,d=this.vertexTangents.length;c<d;c++)b.vertexTangents[c]=this.vertexTangents[c].clone();return b}},a.Face4=function(b,c,d,e,f,g,h){this.a=b,this.b=c,this.c=d,this.d=e,this.normal=f instanceof a.Vector3?f:new a.Vector3,this.vertexNormals=f instanceof Array?f:[],this.color=g instanceof a.Color?g:new a.Color,this.vertexColors=g instanceof Array?g:[],this.vertexTangents=[],this.materialIndex=h,this.centroid=new a.Vector3},a.Face4.prototype={constructor:a.Face4,clone:function(){var b=new a.Face4(this.a,this.b,this.c,this.d);b.normal.copy(this.normal),b.color.copy(this.color),b.centroid.copy(this.centroid),b.materialIndex=this.materialIndex;var c,d;for(c=0,d=this.vertexNormals.length;c<d;c++)b.vertexNormals[c]=this.vertexNormals[c].clone();for(c=0,d=this.vertexColors.length;c<d;c++)b.vertexColors[c]=this.vertexColors[c].clone();for(c=0,d=this.vertexTangents.length;c<d;c++)b.vertexTangents[c]=this.vertexTangents[c].clone();return b}},a.UV=function(a,b){this.u=a||0,this.v=b||0},a.UV.prototype={constructor:a.UV,set:function(a,b){return this.u=a,this.v=b,this},copy:function(a){return this.u=a.u,this.v=a.v,this},lerpSelf:function(a,b){return this.u+=(a.u-this.u)*b,this.v+=(a.v-this.v)*b,this},clone:function(){return new a.UV(this.u,this.v)}},a.Geometry=function(){a.GeometryLibrary.push(this),this.id=a.GeometryIdCount++,this.name="",this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},a.Geometry.prototype={constructor:a.Geometry,applyMatrix:function(b){var c=new a.Matrix3;c.getInverse(b).transpose();for(var d=0,e=this.vertices.length;d<e;d++){var f=this.vertices[d];b.multiplyVector3(f)}for(var d=0,e=this.faces.length;d<e;d++){var g=this.faces[d];c.multiplyVector3(g.normal).normalize();for(var h=0,i=g.vertexNormals.length;h<i;h++)c.multiplyVector3(g.vertexNormals[h]).normalize();b.multiplyVector3(g.centroid)}},computeCentroids:function(){var b,c,d;for(b=0,c=this.faces.length;b<c;b++)d=this.faces[b],d.centroid.set(0,0,0),d instanceof a.Face3?(d.centroid.addSelf(this.vertices[d.a]),d.centroid.addSelf(this.vertices[d.b]),d.centroid.addSelf(this.vertices[d.c]),d.centroid.divideScalar(3)):d instanceof a.Face4&&(d.centroid.addSelf(this.vertices[d.a]),d.centroid.addSelf(this.vertices[d.b]),d.centroid.addSelf(this.vertices[d.c]),d.centroid.addSelf(this.vertices[d.d]),d.centroid.divideScalar(4))},computeFaceNormals:function(){var b,c,d,e,f,g,h,i,j,k,l,m=new a.Vector3,n=new a.Vector3;for(g=0,h=this.faces.length;g<h;g++)i=this.faces[g],j=this.vertices[i.a],k=this.vertices[i.b],l=this.vertices[i.c],m.sub(l,k),n.sub(j,k),m.crossSelf(n),m.normalize(),i.normal.copy(m)},computeVertexNormals:function(b){var c,d,e,f,g,h;if(this.__tmpVertices===undefined){this.__tmpVertices=new Array(this.vertices.length),h=this.__tmpVertices;for(c=0,d=this.vertices.length;c<d;c++)h[c]=new a.Vector3;for(e=0,f=this.faces.length;e<f;e++)g=this.faces[e],g instanceof a.Face3?g.vertexNormals=[new a.Vector3,new a.Vector3,new a.Vector3]:g instanceof a.Face4&&(g.vertexNormals=[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3])}else{h=this.__tmpVertices;for(c=0,d=this.vertices.length;c<d;c++)h[c].set(0,0,0)}if(b){var i,j,k,l,m=new a.Vector3,n=new a.Vector3,o=new a.Vector3,p=new a.Vector3,q=new a.Vector3;for(e=0,f=this.faces.length;e<f;e++)g=this.faces[e],g instanceof a.Face3?(i=this.vertices[g.a],j=this.vertices[g.b],k=this.vertices[g.c],m.sub(k,j),n.sub(i,j),m.crossSelf(n),h[g.a].addSelf(m),h[g.b].addSelf(m),h[g.c].addSelf(m)):g instanceof a.Face4&&(i=this.vertices[g.a],j=this.vertices[g.b],k=this.vertices[g.c],l=this.vertices[g.d],o.sub(l,j),n.sub(i,j),o.crossSelf(n),h[g.a].addSelf(o),h[g.b].addSelf(o),h[g.d].addSelf(o),p.sub(l,k),q.sub(j,k),p.crossSelf(q),h[g.b].addSelf(p),h[g.c].addSelf(p),h[g.d].addSelf(p))}else for(e=0,f=this.faces.length;e<f;e++)g=this.faces[e],g instanceof a.Face3?(h[g.a].addSelf(g.normal),h[g.b].addSelf(g.normal),h[g.c].addSelf(g.normal)):g instanceof a.Face4&&(h[g.a].addSelf(g.normal),h[g.b].addSelf(g.normal),h[g.c].addSelf(g.normal),h[g.d].addSelf(g.normal));for(c=0,d=this.vertices.length;c<d;c++)h[c].normalize();for(e=0,f=this.faces.length;e<f;e++)g=this.faces[e],g instanceof a.Face3?(g.vertexNormals[0].copy(h[g.a]),g.vertexNormals[1].copy(h[g.b]),g.vertexNormals[2].copy(h[g.c])):g instanceof a.Face4&&(g.vertexNormals[0].copy(h[g.a]),g.vertexNormals[1].copy(h[g.b]),g.vertexNormals[2].copy(h[g.c]),g.vertexNormals[3].copy(h[g.d]))},computeMorphNormals:function(){var b,c,d,e,f;for(d=0,e=this.faces.length;d<e;d++){f=this.faces[d],f.__originalFaceNormal?f.__originalFaceNormal.copy(f.normal):f.__originalFaceNormal=f.normal.clone(),f.__originalVertexNormals||(f.__originalVertexNormals=[]);for(b=0,c=f.vertexNormals.length;b<c;b++)f.__originalVertexNormals[b]?f.__originalVertexNormals[b].copy(f.vertexNormals[b]):f.__originalVertexNormals[b]=f.vertexNormals[b].clone()}var g=new a.Geometry;g.faces=this.faces;for(b=0,c=this.morphTargets.length;b<c;b++){if(!this.morphNormals[b]){this.morphNormals[b]={},this.morphNormals[b].faceNormals=[],this.morphNormals[b].vertexNormals=[];var h=this.morphNormals[b].faceNormals,i=this.morphNormals[b].vertexNormals,j,k;for(d=0,e=this.faces.length;d<e;d++)f=this.faces[d],j=new a.Vector3,f instanceof a.Face3?k={a:new a.Vector3,b:new a.Vector3,c:new a.Vector3}:k={a:new a.Vector3,b:new a.Vector3,c:new a.Vector3,d:new a.Vector3},h.push(j),i.push(k)}var l=this.morphNormals[b];g.vertices=this.morphTargets[b].vertices,g.computeFaceNormals(),g.computeVertexNormals();var j,k;for(d=0,e=this.faces.length;d<e;d++)f=this.faces[d],j=l.faceNormals[d],k=l.vertexNormals[d],j.copy(f.normal),f instanceof a.Face3?(k.a.copy(f.vertexNormals[0]),k.b.copy(f.vertexNormals[1]),k.c.copy(f.vertexNormals[2])):(k.a.copy(f.vertexNormals[0]),k.b.copy(f.vertexNormals[1]),k.c.copy(f.vertexNormals[2]),k.d.copy(f.vertexNormals[3]))}for(d=0,e=this.faces.length;d<e;d++)f=this.faces[d],f.normal=f.__originalFaceNormal,f.vertexNormals=f.__originalVertexNormals},computeTangents:function(){function L(a,b,c,d,e,f,g){k=a.vertices[b],l=a.vertices[c],m=a.vertices[d],n=j[e],o=j[f],p=j[g],q=l.x-k.x,r=m.x-k.x,s=l.y-k.y,t=m.y-k.y,u=l.z-k.z,v=m.z-k.z,w=o.u-n.u,x=p.u-n.u,y=o.v-n.v,z=p.v-n.v,A=1/(w*z-x*y),F.set((z*q-y*r)*A,(z*s-y*t)*A,(z*u-y*v)*A),G.set((w*r-x*q)*A,(w*t-x*s)*A,(w*v-x*u)*A),D[b].addSelf(F),D[c].addSelf(F),D[d].addSelf(F),E[b].addSelf(G),E[c].addSelf(G),E[d].addSelf(G)}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=[],E=[],F=new a.Vector3,G=new a.Vector3,H=new a.Vector3,I=new a.Vector3,J=new a.Vector3,K;for(d=0,e=this.vertices.length;d<e;d++)D[d]=new a.Vector3,E[d]=new a.Vector3;for(b=0,c=this.faces.length;b<c;b++)i=this.faces[b],j=this.faceVertexUvs[0][b],i instanceof a.Face3?L(this,i.a,i.b,i.c,0,1,2):i instanceof a.Face4&&(L(this,i.a,i.b,i.d,0,1,3),L(this,i.b,i.c,i.d,1,2,3));var M=["a","b","c","d"];for(b=0,c=this.faces.length;b<c;b++){i=this.faces[b];for(f=0;f<i.vertexNormals.length;f++)J.copy(i.vertexNormals[f]),h=i[M[f]],B=D[h],H.copy(B),H.subSelf(J.multiplyScalar(J.dot(B))).normalize(),I.cross(i.vertexNormals[f],B),C=I.dot(E[h]),K=C<0?-1:1,i.vertexTangents[f]=new a.Vector4(H.x,H.y,H.z,K)}this.hasTangents=!0},computeLineDistances:function(){var a=0,b=this.vertices;for(var c=0,d=b.length;c<d;c++)c>0&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){this.boundingBox||(this.boundingBox={min:new a.Vector3,max:new a.Vector3});if(this.vertices.length>0){var b,c=this.vertices[0];this.boundingBox.min.copy(c),this.boundingBox.max.copy(c);var d=this.boundingBox.min,e=this.boundingBox.max;for(var f=1,g=this.vertices.length;f<g;f++)b=this.vertices[f],b.x<d.x?d.x=b.x:b.x>e.x&&(e.x=b.x),b.y<d.y?d.y=b.y:b.y>e.y&&(e.y=b.y),b.z<d.z?d.z=b.z:b.z>e.z&&(e.z=b.z)}else this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){var a=0;this.boundingSphere===null&&(this.boundingSphere={radius:0});for(var b=0,c=this.vertices.length;b<c;b++){var d=this.vertices[b].lengthSq();d>a&&(a=d)}this.boundingSphere.radius=Math.sqrt(a)},mergeVertices:function(){var b={},c=[],d=[],e,f,g=4,h=Math.pow(10,g),i,j,k,l="abcd",m,n,o,p,q;for(i=0,j=this.vertices.length;i<j;i++)e=this.vertices[i],f=[Math.round(e.x*h),Math.round(e.y*h),Math.round(e.z*h)].join("_"),b[f]===undefined?(b[f]=i,c.push(this.vertices[i]),d[i]=c.length-1):d[i]=d[b[f]];for(i=0,j=this.faces.length;i<j;i++){k=this.faces[i];if(k instanceof a.Face3)k.a=d[k.a],k.b=d[k.b],k.c=d[k.c];else if(k instanceof a.Face4){k.a=d[k.a],k.b=d[k.b],k.c=d[k.c],k.d=d[k.d],m=[k.a,k.b,k.c,k.d];for(n=3;n>0;n--)if(m.indexOf(k[l[n]])!==n){m.splice(n,1),this.faces[i]=new a.Face3(m[0],m[1],m[2],k.normal,k.color,k.materialIndex);for(o=0,p=this.faceVertexUvs.length;o<p;o++)q=this.faceVertexUvs[o][i],q&&q.splice(n,1);this.faces[i].vertexColors=k.vertexColors;break}}}var r=this.vertices.length-c.length;return this.vertices=c,r},clone:function(){var b=new a.Geometry,c=this.vertices;for(var d=0,e=c.length;d<e;d++)b.vertices.push(c[d].clone());var f=this.faces;for(var d=0,e=f.length;d<e;d++)b.faces.push(f[d].clone());var g=this.faceVertexUvs[0];for(var d=0,e=g.length;d<e;d++){var h=g[d],i=[];for(var j=0,k=h.length;j<k;j++)i.push(new a.UV(h[j].u,h[j].v));b.faceVertexUvs[0].push(i)}return b},deallocate:function(){var b=a.GeometryLibrary.indexOf(this);b!==-1&&a.GeometryLibrary.splice(b,1)}},a.GeometryIdCount=0,a.GeometryLibrary=[],a.BufferGeometry=function(){a.GeometryLibrary.push(this),this.id=a.GeometryIdCount++,this.attributes={},this.dynamic=!1,this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[]},a.BufferGeometry.prototype={constructor:a.BufferGeometry,applyMatrix:function(b){var c,d;this.attributes.position&&(c=this.attributes.position.array),this.attributes.normal&&(d=this.attributes.normal.array),c!==undefined&&(b.multiplyVector3Array(c),this.verticesNeedUpdate=!0);if(d!==undefined){var e=new a.Matrix3;e.getInverse(b).transpose(),e.multiplyVector3Array(d),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){this.boundingBox||(this.boundingBox={min:new a.Vector3(Infinity,Infinity,Infinity),max:new a.Vector3(-Infinity,-Infinity,-Infinity)});var b=this.attributes.position.array;if(b){var c=this.boundingBox,d,e,f;for(var g=0,h=b.length;g<h;g+=3)d=b[g],e=b[g+1],f=b[g+2],d<c.min.x?c.min.x=d:d>c.max.x&&(c.max.x=d),e<c.min.y?c.min.y=e:e>c.max.y&&(c.max.y=e),f<c.min.z?c.min.z=f:f>c.max.z&&(c.max.z=f)}if(b===undefined||b.length===0)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){this.boundingSphere||(this.boundingSphere={radius:0});var a=this.attributes.position.array;if(a){var b,c=0,d,e,f;for(var g=0,h=a.length;g<h;g+=3)d=a[g],e=a[g+1],f=a[g+2],b=d*d+e*e+f*f,b>c&&(c=b);this.boundingSphere.radius=Math.sqrt(c)}},computeVertexNormals:function(){if(this.attributes.position&&this.attributes.index){var b,c,d,e,f=this.attributes.position.array.length;if(this.attributes.normal===undefined)this.attributes.normal={itemSize:3,array:new Float32Array(f),numItems:f};else for(b=0,c=this.attributes.normal.array.length;b<c;b++)this.attributes.normal.array[b]=0;var g=this.offsets,h=this.attributes.index.array,i=this.attributes.position.array,j=this.attributes.normal.array,k,l,m,n,o,p,q=new a.Vector3,r=new a.Vector3,s=new a.Vector3,t=new a.Vector3,u=new a.Vector3;for(d=0,e=g.length;d<e;++d){var v=g[d].start,w=g[d].count,x=g[d].index;for(b=v,c=v+w;b<c;b+=3)k=x+h[b],l=x+h[b+1],m=x+h[b+2],n=i[k*3],o=i[k*3+1],p=i[k*3+2],q.set(n,o,p),n=i[l*3],o=i[l*3+1],p=i[l*3+2],r.set(n,o,p),n=i[m*3],o=i[m*3+1],p=i[m*3+2],s.set(n,o,p),t.sub(s,r),u.sub(q,r),t.crossSelf(u),j[k*3]+=t.x,j[k*3+1]+=t.y,j[k*3+2]+=t.z,j[l*3]+=t.x,j[l*3+1]+=t.y,j[l*3+2]+=t.z,j[m*3]+=t.x,j[m*3+1]+=t.y,j[m*3+2]+=t.z}this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){var a=this.attributes.normal.array,b,c,d,e;for(var f=0,g=a.length;f<g;f+=3)b=a[f],c=a[f+1],d=a[f+2],e=1/Math.sqrt(b*b+c*c+d*d),a[f]*=e,a[f+1]*=e,a[f+2]*=e},computeTangents:function(){function N(a,b,d){l=c[a*3],m=c[a*3+1],n=c[a*3+2],o=c[b*3],p=c[b*3+1],q=c[b*3+2],r=c[d*3],s=c[d*3+1],t=c[d*3+2],u=e[a*2],v=e[a*2+1],w=e[b*2],x=e[b*2+1],y=e[d*2],z=e[d*2+1],A=o-l,B=r-l,C=p-m,D=s-m,E=q-n,F=t-n,G=w-u,H=y-u,I=x-v,J=z-v,K=1/(G*J-H*I),L.set((J*A-I*B)*K,(J*C-I*D)*K,(J*E-I*F)*K),M.set((G*B-H*A)*K,(G*D-H*C)*K,(G*F-H*E)*K),i[a].addSelf(L),i[b].addSelf(L),i[d].addSelf(L),j[a].addSelf(M),j[b].addSelf(M),j[d].addSelf(M)}function hb(a){_.x=d[a*3],_.y=d[a*3+1],_.z=d[a*3+2],ab.copy(_),cb=i[a],Z.copy(cb),Z.subSelf(_.multiplyScalar(_.dot(cb))).normalize(),$.cross(ab,cb),db=$.dot(j[a]),bb=db<0?-1:1,h[a*4]=Z.x,h[a*4+1]=Z.y,h[a*4+2]=Z.z,h[a*4+3]=bb}if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var b=this.attributes.index.array,c=this.attributes.position.array,d=this.attributes.normal.array,e=this.attributes.uv.array,f=c.length/3;if(this.attributes.tangent===undefined){var g=4*f;this.attributes.tangent={itemSize:4,array:new Float32Array(g),numItems:g}}var h=this.attributes.tangent.array,i=[],j=[];for(var k=0;k<f;k++)i[k]=new a.Vector3,j[k]=new a.Vector3;var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L=new a.Vector3,M=new a.Vector3,O,P,Q,R,S,T,U,V=this.offsets;for(Q=0,R=V.length;Q<R;++Q){var W=V[Q].start,X=V[Q].count,Y=V[Q].index;for(O=W,P=W+X;O<P;O+=3)S=Y+b[O],T=Y+b[O+1],U=Y+b[O+2],N(S,T,U)}var Z=new a.Vector3,$=new a.Vector3,_=new a.Vector3,ab=new a.Vector3,bb,cb,db,eb,fb,gb;for(Q=0,R=V.length;Q<R;++Q){var W=V[Q].start,X=V[Q].count,Y=V[Q].index;for(O=W,P=W+X;O<P;O+=3)S=Y+b[O],T=Y+b[O+1],U=Y+b[O+2],hb(S),hb(T),hb(U)}this.hasTangents=!0,this.tangentsNeedUpdate=!0},deallocate:function(){var b=a.GeometryLibrary.indexOf(this);b!==-1&&a.GeometryLibrary.splice(b,1)}},a.Spline=function(b){function n(a,b,c,d,e,f,g){var h=(c-a)*.5,i=(d-b)*.5;return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b}this.points=b;var c=[],d={x:0,y:0,z:0},e,f,g,h,i,j,k,l,m;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}},this.getPoint=function(a){return e=(this.points.length-1)*a,f=Math.floor(e),g=e-f,c[0]=f===0?f:f-1,c[1]=f,c[2]=f>this.points.length-2?this.points.length-1:f+1,c[3]=f>this.points.length-3?this.points.length-1:f+2,j=this.points[c[0]],k=this.points[c[1]],l=this.points[c[2]],m=this.points[c[3]],h=g*g,i=g*h,d.x=n(j.x,k.x,l.x,m.x,g,h,i),d.y=n(j.y,k.y,l.y,m.y,g,h,i),d.z=n(j.z,k.z,l.z,m.z,g,h,i),d},this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d},this.getLength=function(b){var c,d,e,f,g=0,h=0,i=0,j=new a.Vector3,k=new a.Vector3,l=[],m=0;l[0]=0,b||(b=100),e=this.points.length*b,j.copy(this.points[0]);for(c=1;c<e;c++)d=c/e,f=this.getPoint(d),k.copy(f),m+=k.distanceTo(j),j.copy(f),g=(this.points.length-1)*d,h=Math.floor(g),h!=i&&(l[h]=m,i=h);return l[l.length]=m,{chunks:l,total:m}},this.reparametrizeByArcLength=function(b){var c,d,e,f,g,h,i,j,k,l=[],m=new a.Vector3,n=this.getLength();l.push(m.copy(this.points[0]).clone());for(c=1;c<this.points.length;c++){i=n.chunks[c]-n.chunks[c-1],j=Math.ceil(b*i/n.total),f=(c-1)/(this.points.length-1),g=c/(this.points.length-1);for(d=1;d<j-1;d++)e=f+d*(1/j)*(g-f),k=this.getPoint(e),l.push(m.copy(k).clone());l.push(m.copy(this.points[c]).clone())}this.points=l}},a.Camera=function(){a.Object3D.call(this),this.matrixWorldInverse=new a.Matrix4,this.projectionMatrix=new a.Matrix4,this.projectionMatrixInverse=new a.Matrix4},a.Camera.prototype=Object.create(a.Object3D.prototype),a.Camera.prototype.lookAt=function(a){this.matrix.lookAt(this.position,a,this.up),this.rotationAutoUpdate===!0&&(this.useQuaternion===!1?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},a.OrthographicCamera=function(b,c,d,e,f,g){a.Camera.call(this),this.left=b,this.right=c,this.top=d,this.bottom=e,this.near=f!==undefined?f:.1,this.far=g!==undefined?g:2e3,this.updateProjectionMatrix()},a.OrthographicCamera.prototype=Object.create(a.Camera.prototype),a.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},a.PerspectiveCamera=function(b,c,d,e){a.Camera.call(this),this.fov=b!==undefined?b:50,this.aspect=c!==undefined?c:1,this.near=d!==undefined?d:.1,this.far=e!==undefined?e:2e3,this.updateProjectionMatrix()},a.PerspectiveCamera.prototype=Object.create(a.Camera.prototype),a.PerspectiveCamera.prototype.setLens=function(a,b){b===undefined&&(b=24),this.fov=2*Math.atan(b/(a*2))*(180/Math.PI),this.updateProjectionMatrix()},a.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a,this.fullHeight=b,this.x=c,this.y=d,this.width=e,this.height=f,this.updateProjectionMatrix()},a.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var a=this.fullWidth/this.fullHeight,b=Math.tan(this.fov*Math.PI/360)*this.near,c=-b,d=a*c,e=a*b,f=Math.abs(e-d),g=Math.abs(b-c);this.projectionMatrix.makeFrustum(d+this.x*f/this.fullWidth,d+(this.x+this.width)*f/this.fullWidth,b-(this.y+this.height)*g/this.fullHeight,b-this.y*g/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},a.Light=function(b){a.Object3D.call(this),this.color=new a.Color(b)},a.Light.prototype=Object.create(a.Object3D.prototype),a.AmbientLight=function(b){a.Light.call(this,b)},a.AmbientLight.prototype=Object.create(a.Light.prototype),a.DirectionalLight=function(b,c){a.Light.call(this,b),this.position=new a.Vector3(0,1,0),this.target=new a.Object3D,this.intensity=c!==undefined?c:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new a.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},a.DirectionalLight.prototype=Object.create(a.Light.prototype),a.HemisphereLight=function(b,c,d){a.Light.call(this,b),this.groundColor=new a.Color(c),this.position=new a.Vector3(0,100,0),this.intensity=d!==undefined?d:1},a.HemisphereLight.prototype=Object.create(a.Light.prototype),a.PointLight=function(b,c,d){a.Light.call(this,b),this.position=new a.Vector3(0,0,0),this.intensity=c!==undefined?c:1,this.distance=d!==undefined?d:0},a.PointLight.prototype=Object.create(a.Light.prototype),a.SpotLight=function(b,c,d,e,f){a.Light.call(this,b),this.position=new a.Vector3(0,1,0),this.target=new a.Object3D,this.intensity=c!==undefined?c:1,this.distance=d!==undefined?d:0,this.angle=e!==undefined?e:Math.PI/2,this.exponent=f!==undefined?f:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},a.SpotLight.prototype=Object.create(a.Light.prototype),a.Loader=function(b){this.showStatus=b,this.statusDomElement=b?a.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},a.Loader.prototype={constructor:a.Loader,crossOrigin:"anonymous",addStatusElement:function(){var a=document.createElement("div");return a.style.position="absolute",a.style.right="0px",a.style.top="0px",a.style.fontSize="0.8em",a.style.textAlign="left",a.style.background="rgba(0,0,0,0.25)",a.style.color="#fff",a.style.width="120px",a.style.padding="0.5em 0.5em 0.5em 0.5em",a.style.zIndex=1e3,a.innerHTML="Loading ...",a},updateProgress:function(a){var b="Loaded ";a.total?b+=(100*a.loaded/a.total).toFixed(0)+"%":b+=(a.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=b},extractUrlBase:function(a){var b=a.split("/");return b.pop(),(b.length<1?".":b.join("/"))+"/"},initMaterials:function(b,c){var d=[];for(var e=0;e<b.length;++e)d[e]=a.Loader.prototype.createMaterial(b[e],c);return d},needsTangents:function(b){for(var c=0,d=b.length;c<d;c++){var e=b[c];if(e instanceof a.ShaderMaterial)return!0}return!1},createMaterial:function(b,c){function e(a){var b=Math.log(a)/Math.LN2;return Math.floor(b)==b}function f(a){var b=Math.log(a)/Math.LN2;return Math.pow(2,Math.round(b))}function g(a,b){var c=new Image;c.onload=function(){if(!e(this.width)||!e(this.height)){var b=f(this.width),c=f(this.height);a.image.width=b,a.image.height=c,a.image.getContext("2d").drawImage(this,0,0,b,c)}else a.image=this;a.needsUpdate=!0},c.crossOrigin=d.crossOrigin,c.src=b}function h(b,d,e,f,h,i,j){var k=e.toLowerCase().endsWith(".dds"),l=c+"/"+e;if(k){var m=a.ImageUtils.loadCompressedTexture(l);b[d]=m}else{var m=document.createElement("canvas");b[d]=new a.Texture(m)}b[d].sourceFile=e,f&&(b[d].repeat.set(f[0],f[1]),f[0]!==1&&(b[d].wrapS=a.RepeatWrapping),f[1]!==1&&(b[d].wrapT=a.RepeatWrapping)),h&&b[d].offset.set(h[0],h[1]);if(i){var n={repeat:a.RepeatWrapping,mirror:a.MirroredRepeatWrapping};n[i[0]]!==undefined&&(b[d].wrapS=n[i[0]]),n[i[1]]!==undefined&&(b[d].wrapT=n[i[1]])}j&&(b[d].anisotropy=j),k||g(b[d],l)}function i(a){return(a[0]*255<<16)+(a[1]*255<<8)+a[2]*255}var d=this,j="MeshLambertMaterial",k={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(b.shading){var l=b.shading.toLowerCase();l==="phong"?j="MeshPhongMaterial":l==="basic"&&(j="MeshBasicMaterial")}b.blending!==undefined&&a[b.blending]!==undefined&&(k.blending=a[b.blending]);if(b.transparent!==undefined||b.opacity<1)k.transparent=b.transparent;b.depthTest!==undefined&&(k.depthTest=b.depthTest),b.depthWrite!==undefined&&(k.depthWrite=b.depthWrite),b.visible!==undefined&&(k.visible=b.visible),b.flipSided!==undefined&&(k.side=a.BackSide),b.doubleSided!==undefined&&(k.side=a.DoubleSide),b.wireframe!==undefined&&(k.wireframe=b.wireframe),b.vertexColors!==undefined&&(b.vertexColors==="face"?k.vertexColors=a.FaceColors:b.vertexColors&&(k.vertexColors=a.VertexColors)),b.colorDiffuse?k.color=i(b.colorDiffuse):b.DbgColor&&(k.color=b.DbgColor),b.colorSpecular&&(k.specular=i(b.colorSpecular)),b.colorAmbient&&(k.ambient=i(b.colorAmbient)),b.transparency&&(k.opacity=b.transparency),b.specularCoef&&(k.shininess=b.specularCoef),b.mapDiffuse&&c&&h(k,"map",b.mapDiffuse,b.mapDiffuseRepeat,b.mapDiffuseOffset,b.mapDiffuseWrap,b.mapDiffuseAnisotropy),b.mapLight&&c&&h(k,"lightMap",b.mapLight,b.mapLightRepeat,b.mapLightOffset,b.mapLightWrap,b.mapLightAnisotropy),b.mapBump&&c&&h(k,"bumpMap",b.mapBump,b.mapBumpRepeat,b.mapBumpOffset,b.mapBumpWrap,b.mapBumpAnisotropy),b.mapNormal&&c&&h(k,"normalMap",b.mapNormal,b.mapNormalRepeat,b.mapNormalOffset,b.mapNormalWrap,b.mapNormalAnisotropy),b.mapSpecular&&c&&h(k,"specularMap",b.mapSpecular,b.mapSpecularRepeat,b.mapSpecularOffset,b.mapSpecularWrap,b.mapSpecularAnisotropy),b.mapBumpScale&&(k.bumpScale=b.mapBumpScale);if(b.mapNormal){var m=a.ShaderUtils.lib.normal,n=a.UniformsUtils.clone(m.uniforms);n.tNormal.value=k.normalMap,b.mapNormalFactor&&n.uNormalScale.value.set(b.mapNormalFactor,b.mapNormalFactor),k.map&&(n.tDiffuse.value=k.map,n.enableDiffuse.value=!0),k.specularMap&&(n.tSpecular.value=k.specularMap,n.enableSpecular.value=!0),k.lightMap&&(n.tAO.value=k.lightMap,n.enableAO.value=!0),n.uDiffuseColor.value.setHex(k.color),n.uSpecularColor.value.setHex(k.specular),n.uAmbientColor.value.setHex(k.ambient),n.uShininess.value=k.shininess,k.opacity!==undefined&&(n.uOpacity.value=k.opacity);var o={fragmentShader:m.fragmentShader,vertexShader:m.vertexShader,uniforms:n,lights:!0,fog:!0},p=new a.ShaderMaterial(o)}else var p=new a[j](k);return b.DbgName!==undefined&&(p.name=b.DbgName),p}},a.BinaryLoader=function(b){a.Loader.call(this,b)},a.BinaryLoader.prototype=Object.create(a.Loader.prototype),a.BinaryLoader.prototype.load=function(b,c,d,e){d=d&&typeof d=="string"?d:this.extractUrlBase(b),e=e&&typeof e=="string"?e:this.extractUrlBase(b);var f=this.showProgress?a.Loader.prototype.updateProgress:null;this.onLoadStart(),this.loadAjaxJSON(this,b,c,d,e,f)},a.BinaryLoader.prototype.loadAjaxJSON=function(a,b,c,d,e,f){var g=new XMLHttpRequest;g.onreadystatechange=function(){if(g.readyState==4)if(g.status==200||g.status==0){var h=JSON.parse(g.responseText);a.loadAjaxBuffers(h,c,e,d,f)}else console.error("THREE.BinaryLoader: Couldn't load ["+b+"] ["+g.status+"]")},g.open("GET",b,!0),g.send(null)},a.BinaryLoader.prototype.loadAjaxBuffers=function(b,c,d,e,f){var g=new XMLHttpRequest,h=d+"/"+b.buffers,i=0;g.onreadystatechange=function(){if(g.readyState==4)if(g.status==200||g.status==0){var d=g.response;d===undefined&&(d=(new Uint8Array(g.responseBody)).buffer),a.BinaryLoader.prototype.createBinModel(d,c,e,b.materials)}else console.error("THREE.BinaryLoader: Couldn't load ["+h+"] ["+g.status+"]");else g.readyState==3?f&&(i==0&&(i=g.getResponseHeader("Content-Length")),f({total:i,loaded:g.responseText.length})):g.readyState==2&&(i=g.getResponseHeader("Content-Length"))},g.open("GET",h,!0),g.responseType="arraybuffer",g.send(null)},a.BinaryLoader.prototype.createBinModel=function(b,c,d,e){function g(b,c,d,e){b.vertices.push(new a.Vector3(c,d,e))}function h(b,c,d,e,f){b.faces.push(new a.Face3(c,d,e,null,null,f))}function i(b,c,d,e,f,g){b.faces.push(new a.Face4(c,d,e,f,null,null,g))}function j(b,c,d,e,f,g,h,i,j){var k=c[h*3],l=c[h*3+1],m=c[h*3+2],n=c[i*3],o=c[i*3+1],p=c[i*3+2],q=c[j*3],r=c[j*3+1],s=c[j*3+2];b.faces.push(new a.Face3(d,e,f,[new a.Vector3(k,l,m),new a.Vector3(n,o,p),new a.Vector3(q,r,s)],null,g))}function k(b,c,d,e,f,g,h,i,j,k,l){var m=c[i*3],n=c[i*3+1],o=c[i*3+2],p=c[j*3],q=c[j*3+1],r=c[j*3+2],s=c[k*3],t=c[k*3+1],u=c[k*3+2],v=c[l*3],w=c[l*3+1],x=c[l*3+2];b.faces.push(new a.Face4(d,e,f,g,[new a.Vector3(m,n,o),new a.Vector3(p,q,r),new a.Vector3(s,t,u),new a.Vector3(v,w,x)],null,h))}function l(b,c,d,e,f,g,h){b.push([new a.UV(c,d),new a.UV(e,f),new a.UV(g,h)])}function m(b,c,d,e,f,g,h,i,j){b.push([new a.UV(c,d),new a.UV(e,f),new a.UV(g,h),new a.UV(i,j)])}var f=function(c){function H(a){return a%4?4-a%4:0}function I(a,b){var c={signature:J(a,b,12),header_bytes:K(a,b+12),vertex_coordinate_bytes:K(a,b+13),normal_coordinate_bytes:K(a,b+14),uv_coordinate_bytes:K(a,b+15),vertex_index_bytes:K(a,b+16),normal_index_bytes:K(a,b+17),uv_index_bytes:K(a,b+18),material_index_bytes:K(a,b+19),nvertices:L(a,b+20),nnormals:L(a,b+20+4),nuvs:L(a,b+20+8),ntri_flat:L(a,b+20+12),ntri_smooth:L(a,b+20+16),ntri_flat_uv:L(a,b+20+20),ntri_smooth_uv:L(a,b+20+24),nquad_flat:L(a,b+20+28),nquad_smooth:L(a,b+20+32),nquad_flat_uv:L(a,b+20+36),nquad_smooth_uv:L(a,b+20+40)};return c}function J(a,b,c){var d=new Uint8Array(a,b,c),e="";for(var f=0;f<c;f++)e+=String.fromCharCode(d[b+f]);return e}function K(a,b){var c=new Uint8Array(a,b,1);return c[0]}function L(a,b){var c=new Uint32Array(a,b,1);return c[0]}function M(a){var c=f.nvertices,e=new Float32Array(b,a,c*3),h,i,j,k;for(h=0;h<c;h++)i=e[h*3],j=e[h*3+1],k=e[h*3+2],g(d,i,j,k);return c*3*Float32Array.BYTES_PER_ELEMENT}function N(a){var c=f.nnormals;if(c){var d=new Int8Array(b,a,c*3),e,g,h,i;for(e=0;e<c;e++)g=d[e*3],h=d[e*3+1],i=d[e*3+2],n.push(g/127,h/127,i/127)}return c*3*Int8Array.BYTES_PER_ELEMENT}function O(a){var c=f.nuvs;if(c){var d=new Float32Array(b,a,c*2),e,g,h;for(e=0;e<c;e++)g=d[e*2],h=d[e*2+1],o.push(g,h)}return c*2*Float32Array.BYTES_PER_ELEMENT}function P(a,c){var e,f,g,h,i,j,k,m,n,p,q=new Uint32Array(b,c,3*a);for(e=0;e<a;e++)f=q[e*3],g=q[e*3+1],h=q[e*3+2],i=o[f*2],m=o[f*2+1],j=o[g*2],n=o[g*2+1],k=o[h*2],p=o[h*2+1],l(d.faceVertexUvs[0],i,m,j,n,k,p)}function Q(a,c){var e,f,g,h,i,j,k,l,n,p,q,r,s,t=new Uint32Array(b,c,4*a);for(e=0;e<a;e++)f=t[e*4],g=t[e*4+1],h=t[e*4+2],i=t[e*4+3],j=o[f*2],p=o[f*2+1],k=o[g*2],q=o[g*2+1],l=o[h*2],r=o[h*2+1],n=o[i*2],s=o[i*2+1],m(d.faceVertexUvs[0],j,p,k,q,l,r,n,s)}function R(a,c,e){var f,g,i,j,k,l=new Uint32Array(b,c,3*a),m=new Uint16Array(b,e,a);for(f=0;f<a;f++)g=l[f*3],i=l[f*3+1],j=l[f*3+2],k=m[f],h(d,g,i,j,k)}function S(a,c,e){var f,g,h,j,k,l,m=new Uint32Array(b,c,4*a),n=new Uint16Array(b,e,a);for(f=0;f<a;f++)g=m[f*4],h=m[f*4+1],j=m[f*4+2],k=m[f*4+3],l=n[f],i(d,g,h,j,k,l)}function T(a,c,e,f){var g,h,i,k,l,m,o,p,q=new Uint32Array(b,c,3*a),r=new Uint32Array(b,e,3*a),s=new Uint16Array(b,f,a);for(g=0;g<a;g++)h=q[g*3],i=q[g*3+1],k=q[g*3+2],m=r[g*3],o=r[g*3+1],p=r[g*3+2],l=s[g],j(d,n,h,i,k,l,m,o,p)}function U(a,c,e,f){var g,h,i,j,l,m,o,p,q,r,s=new Uint32Array(b,c,4*a),t=new Uint32Array(b,e,4*a),u=new Uint16Array(b,f,a);for(g=0;g<a;g++)h=s[g*4],i=s[g*4+1],j=s[g*4+2],l=s[g*4+3],o=t[g*4],p=t[g*4+1],q=t[g*4+2],r=t[g*4+3],m=u[g],k(d,n,h,i,j,l,m,o,p,q,r)}function V(a){var b=f.ntri_flat;if(b){var c=a+b*Uint32Array.BYTES_PER_ELEMENT*3;R(b,a,c)}}function W(a){var b=f.ntri_flat_uv;if(b){var c=a+b*Uint32Array.BYTES_PER_ELEMENT*3,d=c+b*Uint32Array.BYTES_PER_ELEMENT*3;R(b,a,d),P(b,c)}}function X(a){var b=f.ntri_smooth;if(b){var c=a+b*Uint32Array.BYTES_PER_ELEMENT*3,d=c+b*Uint32Array.BYTES_PER_ELEMENT*3;T(b,a,c,d)}}function Y(a){var b=f.ntri_smooth_uv;if(b){var c=a+b*Uint32Array.BYTES_PER_ELEMENT*3,d=c+b*Uint32Array.BYTES_PER_ELEMENT*3,e=d+b*Uint32Array.BYTES_PER_ELEMENT*3;T(b,a,c,e),P(b,d)}}function Z(a){var b=f.nquad_flat;if(b){var c=a+b*Uint32Array.BYTES_PER_ELEMENT*4;S(b,a,c)}}function $(a){var b=f.nquad_flat_uv;if(b){var c=a+b*Uint32Array.BYTES_PER_ELEMENT*4,d=c+b*Uint32Array.BYTES_PER_ELEMENT*4;S(b,a,d),Q(b,c)}}function _(a){var b=f.nquad_smooth;if(b){var c=a+b*Uint32Array.BYTES_PER_ELEMENT*4,d=c+b*Uint32Array.BYTES_PER_ELEMENT*4;U(b,a,c,d)}}function ab(a){var b=f.nquad_smooth_uv;if(b){var c=a+b*Uint32Array.BYTES_PER_ELEMENT*4,d=c+b*Uint32Array.BYTES_PER_ELEMENT*4,e=d+b*Uint32Array.BYTES_PER_ELEMENT*4;U(b,a,c,e),Q(b,d)}}var d=this,e=0,f,n=[],o=[],p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;a.Geometry.call(this),f=I(b,e),e+=f.header_bytes,x=f.vertex_index_bytes*3+f.material_index_bytes,y=f.vertex_index_bytes*4+f.material_index_bytes,z=f.ntri_flat*x,A=f.ntri_smooth*(x+f.normal_index_bytes*3),B=f.ntri_flat_uv*(x+f.uv_index_bytes*3),C=f.ntri_smooth_uv*(x+f.normal_index_bytes*3+f.uv_index_bytes*3),D=f.nquad_flat*y,E=f.nquad_smooth*(y+f.normal_index_bytes*4),F=f.nquad_flat_uv*(y+f.uv_index_bytes*4),G=f.nquad_smooth_uv*(y+f.normal_index_bytes*4+f.uv_index_bytes*4),e+=M(e),e+=N(e),e+=H(f.nnormals*3),e+=O(e),p=e,q=p+z+H(f.ntri_flat*2),r=q+A+H(f.ntri_smooth*2),s=r+B+H(f.ntri_flat_uv*2),t=s+C+H(f.ntri_smooth_uv*2),u=t+D+H(f.nquad_flat*2),v=u+E+H(f.nquad_smooth*2),w=v+F+H(f.nquad_flat_uv*2),W(r),Y(s),$(v),ab(w),V(p),X(q),Z(t),_(u),this.computeCentroids(),this.computeFaceNormals()};f.prototype=Object.create(a.Geometry.prototype);var n=new f(d),o=this.initMaterials(e,d);this.needsTangents(o)&&n.computeTangents(),c(n,o)},a.ImageLoader=function(){a.EventTarget.call(this),this.crossOrigin=null},a.ImageLoader.prototype={constructor:a.ImageLoader,load:function(a,b){var c=this;b===undefined&&(b=new Image),b.addEventListener("load",function(){c.dispatchEvent({type:"load",content:b})},!1),b.addEventListener("error",function(){c.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},!1),c.crossOrigin&&(b.crossOrigin=c.crossOrigin),b.src=a}},a.JSONLoader=function(b){a.Loader.call(this,b),this.withCredentials=!1},a.JSONLoader.prototype=Object.create(a.Loader.prototype),a.JSONLoader.prototype.load=function(a,b,c){var d=this;c=c&&typeof c=="string"?c:this.extractUrlBase(a),this.onLoadStart(),this.loadAjaxJSON(this,a,b,c)},a.JSONLoader.prototype.loadAjaxJSON=function(a,b,c,d,e){var f=new XMLHttpRequest,g=0;f.withCredentials=this.withCredentials,f.onreadystatechange=function(){if(f.readyState===f.DONE)if(f.status===200||f.status===0){if(f.responseText){var h=JSON.parse(f.responseText);a.createModel(h,c,d)}else console.warn("THREE.JSONLoader: ["+b+"] seems to be unreachable or file there is empty");a.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+b+"] ["+f.status+"]");else f.readyState===f.LOADING?e&&(g===0&&(g=f.getResponseHeader("Content-Length")),e({total:g,loaded:f.responseText.length})):f.readyState===f.HEADERS_RECEIVED&&(g=f.getResponseHeader("Content-Length"))},f.open("GET",b,!0),f.send(null)},a.JSONLoader.prototype.createModel=function(b,c,d){function h(c){function d(a,b){return a&1<<b}var e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=b.faces,H=b.vertices,I=b.normals,J=b.colors,K=0;for(e=0;e<b.uvs.length;e++)b.uvs[e].length&&K++;for(e=0;e<K;e++)f.faceUvs[e]=[],f.faceVertexUvs[e]=[];i=0,j=H.length;while(i<j)y=new a.Vector3,y.x=H[i++]*c,y.y=H[i++]*c,y.z=H[i++]*c,f.vertices.push(y);i=0,j=G.length;while(i<j){p=G[i++],q=d(p,0),r=d(p,1),s=d(p,2),t=d(p,3),u=d(p,4),v=d(p,5),w=d(p,6),x=d(p,7),q?(z=new a.Face4,z.a=G[i++],z.b=G[i++],z.c=G[i++],z.d=G[i++],k=4):(z=new a.Face3,z.a=G[i++],z.b=G[i++],z.c=G[i++],k=3),r&&(o=G[i++],z.materialIndex=o),h=f.faces.length;if(s)for(e=0;e<K;e++)C=b.uvs[e],n=G[i++],E=C[n*2],F=C[n*2+1],f.faceUvs[e][h]=new a.UV(E,F);if(t)for(e=0;e<K;e++){C=b.uvs[e],D=[];for(g=0;g<k;g++)n=G[i++],E=C[n*2],F=C[n*2+1],D[g]=new a.UV(E,F);f.faceVertexUvs[e][h]=D}u&&(m=G[i++]*3,B=new a.Vector3,B.x=I[m++],B.y=I[m++],B.z=I[m],z.normal=B);if(v)for(e=0;e<k;e++)m=G[i++]*3,B=new a.Vector3,B.x=I[m++],B.y=I[m++],B.z=I[m],z.vertexNormals.push(B);w&&(l=G[i++],A=new a.Color(J[l]),z.color=A);if(x)for(e=0;e<k;e++)l=G[i++],A=new a.Color(J[l]),z.vertexColors.push(A);f.faces.push(z)}}function i(){var c,d,e,g,h,i,j,k,l,m;if(b.skinWeights)for(c=0,d=b.skinWeights.length;c<d;c+=2)e=b.skinWeights[c],g=b.skinWeights[c+1],h=0,i=0,f.skinWeights.push(new a.Vector4(e,g,h,i));if(b.skinIndices)for(c=0,d=b.skinIndices.length;c<d;c+=2)j=b.skinIndices[c],k=b.skinIndices[c+1],l=0,m=0,f.skinIndices.push(new a.Vector4(j,k,l,m));f.bones=b.bones,f.animation=b.animation}function j(c){if(b.morphTargets!==undefined){var d,e,g,h,i,j;for(d=0,e=b.morphTargets.length;d<e;d++){f.morphTargets[d]={},f.morphTargets[d].name=b.morphTargets[d].name,f.morphTargets[d].vertices=[],i=f.morphTargets[d].vertices,j=b.morphTargets[d].vertices;for(g=0,h=j.length;g<h;g+=3){var k=new a.Vector3;k.x=j[g]*c,k.y=j[g+1]*c,k.z=j[g+2]*c,i.push(k)}}}if(b.morphColors!==undefined){var d,e,l,m,n,o,p;for(d=0,e=b.morphColors.length;d<e;d++){f.morphColors[d]={},f.morphColors[d].name=b.morphColors[d].name,f.morphColors[d].colors=[],n=f.morphColors[d].colors,o=b.morphColors[d].colors;for(l=0,m=o.length;l<m;l+=3)p=new a.Color(16755200),p.setRGB(o[l],o[l+1],o[l+2]),n.push(p)}}}var e=this,f=new a.Geometry,g=b.scale!==undefined?1/b.scale:1;h(g),i(),j(g),f.computeCentroids(),f.computeFaceNormals();var k=this.initMaterials(b.materials,d);this.needsTangents(k)&&f.computeTangents(),c(f,k)},a.LoadingMonitor=function(){a.EventTarget.call(this);var b=this,c=0,d=0,e=function(a){c++,b.dispatchEvent({type:"progress",loaded:c,total:d}),c===d&&b.dispatchEvent({type:"load"})};this.add=function(a){d++,a.addEventListener("load",e,!1)}},a.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.hierarchyHandlerMap={},this.addGeometryHandler("ascii",a.JSONLoader),this.addGeometryHandler("binary",a.BinaryLoader)},a.SceneLoader.prototype.constructor=a.SceneLoader,a.SceneLoader.prototype.load=function(a,b){var c=this,d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState===4)if(d.status===200||d.status===0){var e=JSON.parse(d.responseText);c.parse(e,b,a)}else console.error("THREE.SceneLoader: Couldn't load ["+a+"] ["+d.status+"]")},d.open("GET",a,!0),d.send(null)},a.SceneLoader.prototype.addGeometryHandler=function(a,b){this.geometryHandlerMap[a]={loaderClass:b}},a.SceneLoader.prototype.addHierarchyHandler=function(a,b){this.hierarchyHandlerMap[a]={loaderClass:b}},a.SceneLoader.prototype.parse=function(b,c,d){function U(a,b){return b=="relativeToHTML"?a:f+"/"+a}function V(){W(M.scene,O.objects)}function W(b,c){for(var d in c)if(M.objects[d]===undefined){var f=c[d],g=null;if(f.type&&f.type in e.hierarchyHandlerMap&&f.loading===undefined){var h={};for(var i in l)i!=="type"&&i!=="url"&&(h[i]=l[i]);A=M.materials[f.material],f.loading=!0;var j=e.hierarchyHandlerMap[f.type].loaderObject;j.addEventListener?(j.addEventListener("load",$(d,b,A,f)),j.load(U(f.url,O.urlBaseType))):j.options?j.load(U(f.url,O.urlBaseType),$(d,b,A,f)):j.load(U(f.url,O.urlBaseType),$(d,b,A,f),h)}else if(f.geometry!==undefined){z=M.geometries[f.geometry];if(z){var k=!1;A=M.materials[f.material],k=A instanceof a.ShaderMaterial,p=f.position,q=f.rotation,r=f.quaternion,s=f.scale,m=f.matrix,r=0,f.material||(A=new a.MeshFaceMaterial(M.face_materials[f.geometry])),A instanceof a.MeshFaceMaterial&&A.materials.length===0&&(A=new a.MeshFaceMaterial(M.face_materials[f.geometry]));if(A instanceof a.MeshFaceMaterial)for(var n=0;n<A.materials.length;n++)k=k||A.materials[n]instanceof a.ShaderMaterial;k&&z.computeTangents(),f.skin?g=new a.SkinnedMesh(z,A):f.morph?(g=new a.MorphAnimMesh(z,A),f.duration!==undefined&&(g.duration=f.duration),f.time!==undefined&&(g.time=f.time),f.mirroredLoop!==undefined&&(g.mirroredLoop=f.mirroredLoop),A.morphNormals&&z.computeMorphNormals()):g=new a.Mesh(z,A),g.name=d,m?(g.matrixAutoUpdate=!1,g.matrix.set(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15])):(g.position.set(p[0],p[1],p[2]),r?(g.quaternion.set(r[0],r[1],r[2],r[3]),g.useQuaternion=!0):g.rotation.set(q[0],q[1],q[2]),g.scale.set(s[0],s[1],s[2])),g.visible=f.visible,g.castShadow=f.castShadow,g.receiveShadow=f.receiveShadow,b.add(g),M.objects[d]=g}}else f.type==="DirectionalLight"||f.type==="PointLight"||f.type==="AmbientLight"?(G=f.color!==undefined?f.color:16777215,H=f.intensity!==undefined?f.intensity:1,f.type==="DirectionalLight"?(p=f.direction,F=new a.DirectionalLight(G,H),F.position.set(p[0],p[1],p[2]),f.target&&(N.push({object:F,targetName:f.target}),F.target=null)):f.type==="PointLight"?(p=f.position,o=f.distance,F=new a.PointLight(G,H,o),F.position.set(p[0],p[1],p[2])):f.type==="AmbientLight"&&(F=new a.AmbientLight(G)),b.add(F),F.name=d,M.lights[d]=F,M.objects[d]=F):f.type==="PerspectiveCamera"||f.type==="OrthographicCamera"?(f.type==="PerspectiveCamera"?B=new a.PerspectiveCamera(f.fov,f.aspect,f.near,f.far):f.type==="OrthographicCamera"&&(B=new a.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far)),p=f.position,B.position.set(p[0],p[1],p[2]),b.add(B),B.name=d,M.cameras[d]=B,M.objects[d]=B):(p=f.position,q=f.rotation,r=f.quaternion,s=f.scale,r=0,g=new a.Object3D,g.name=d,g.position.set(p[0],p[1],p[2]),r?(g.quaternion.set(r[0],r[1],r[2],r[3]),g.useQuaternion=!0):g.rotation.set(q[0],q[1],q[2]),g.scale.set(s[0],s[1],s[2]),g.visible=f.visible!==undefined?f.visible:!1,b.add(g),M.objects[d]=g,M.empties[d]=g);if(g){if(f.properties!==undefined)for(var u in f.properties){var v=f.properties[u];g.properties[u]=v}f.children!==undefined&&W(g,f.children)}}}function X(a,b,c){M.geometries[c]=a,M.face_materials[c]=b,V()}function Y(a,b,c,d,e){var f=e.position,g=e.rotation,h=e.quaternion,i=e.scale;a.position.set(f[0],f[1],f[2]),h?(a.quaternion.set(h[0],h[1],h[2],h[3]),a.useQuaternion=!0):a.rotation.set(g[0],g[1],g[2]),a.scale.set(i[0],i[1],i[2]),d&&a.traverse(function(a){a.material=d}),c.add(a),M.objects[b]=a,V()}function Z(a){return function(b,c){X(b,c,a),I-=1,e.onLoadComplete(),ab()}}function $(a,b,c,d){return function(f){var g;f.content?g=f.content:f.dae?g=f.scene:g=f,Y(g,a,b,c,d),I-=1,e.onLoadComplete(),ab()}}function _(a){return function(b,c){M.geometries[a]=b,M.face_materials[a]=c}}function ab(){var a={totalModels:K,totalTextures:L,loadedModels:K-I,loadedTextures:L-J};e.callbackProgress(a,M),e.onLoadProgress(),I===0&&J===0&&(bb(),c(M))}function bb(){for(var b=0;b<N.length;b++){var c=N[b],d=M.objects[c.targetName];d?c.object.target=d:(c.object.target=new a.Object3D,M.scene.add(c.object.target)),c.object.target.properties.targetInverse=c.object}}var e=this,f=a.Loader.prototype.extractUrlBase(d),g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N=[],O=b;for(var P in this.geometryHandlerMap){var Q=this.geometryHandlerMap[P].loaderClass;this.geometryHandlerMap[P].loaderObject=new Q}for(var P in this.hierarchyHandlerMap){var Q=this.hierarchyHandlerMap[P].loaderClass;this.hierarchyHandlerMap[P].loaderObject=new Q}I=0,J=0,M={scene:new a.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}};if(O.transform){var R=O.transform.position,S=O.transform.rotation,T=O.transform.scale;R&&M.scene.position.set(R[0],R[1],R[2]),S&&M.scene.rotation.set(S[0],S[1],S[2]),T&&M.scene.scale.set(T[0],T[1],T[2]);if(R||S||T)M.scene.updateMatrix(),M.scene.updateMatrixWorld()}var cb=function(a){J-=a,ab(),e.onLoadComplete()},db=function(a){return function(){cb(a)}};for(j in O.fogs)v=O.fogs[j],v.type==="linear"?C=new a.Fog(0,v.near,v.far):v.type==="exp2"&&(C=new a.FogExp2(0,v.density)),t=v.color,C.color.setRGB(t[0],t[1],t[2]),M.fogs[j]=C;for(g in O.geometries)l=O.geometries[g],l.type in this.geometryHandlerMap&&(I+=1,e.onLoadStart());for(var eb in O.objects){var fb=O.objects[eb];fb.type&&fb.type in this.hierarchyHandlerMap&&(I+=1,e.onLoadStart())}K=I;for(g in O.geometries){l=O.geometries[g];if(l.type==="cube")z=new a.CubeGeometry(l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments),M.geometries[g]=z;else if(l.type==="plane")z=new a.PlaneGeometry(l.width,l.height,l.widthSegments,l.heightSegments),M.geometries[g]=z;else if(l.type==="sphere")z=new a.SphereGeometry(l.radius,l.widthSegments,l.heightSegments),M.geometries[g]=z;else if(l.type==="cylinder")z=new a.CylinderGeometry(l.topRad,l.botRad,l.height,l.radSegs,l.heightSegs),M.geometries[g]=z;else if(l.type==="torus")z=new a.TorusGeometry(l.radius,l.tube,l.segmentsR,l.segmentsT),M.geometries[g]=z;else if(l.type==="icosahedron")z=new a.IcosahedronGeometry(l.radius,l.subdivisions),M.geometries[g]=z;else if(l.type in this.geometryHandlerMap){var gb={};for(var hb in l)hb!=="type"&&hb!=="url"&&(gb[hb]=l[hb]);var ib=this.geometryHandlerMap[l.type].loaderObject;ib.load(U(l.url,O.urlBaseType),Z(g),gb)}else if(l.type==="embedded"){var jb=O.embeds[l.id],kb="";jb.metadata=O.metadata;if(jb){var lb=this.geometryHandlerMap.ascii.loaderObject;lb.createModel(jb,_(g),kb)}}}for(k in O.textures){w=O.textures[k];if(w.url instanceof Array){J+=w.url.length;for(var mb=0;mb<w.url.length;mb++)e.onLoadStart()}else J+=1,e.onLoadStart()}L=J;for(k in O.textures){w=O.textures[k],w.mapping!==undefined&&a[w.mapping]!==undefined&&(w.mapping=new a[w.mapping]);if(w.url instanceof Array){var nb=w.url.length,ob=[];for(var pb=0;pb<nb;pb++)ob[pb]=U(w.url[pb],O.urlBaseType);var qb=ob[0].endsWith(".dds");qb?D=a.ImageUtils.loadCompressedTextureCube(ob,w.mapping,db(nb)):D=a.ImageUtils.loadTextureCube(ob,w.mapping,db(nb))}else{var qb=w.url.toLowerCase().endsWith(".dds"),rb=U(w.url,O.urlBaseType),sb=db(1);qb?D=a.ImageUtils.loadCompressedTexture(rb,w.mapping,sb):D=a.ImageUtils.loadTexture(rb,w.mapping,sb),a[w.minFilter]!==undefined&&(D.minFilter=a[w.minFilter]),a[w.magFilter]!==undefined&&(D.magFilter=a[w.magFilter]),w.anisotropy&&(D.anisotropy=w.anisotropy),w.repeat&&(D.repeat.set(w.repeat[0],w.repeat[1]),w.repeat[0]!==1&&(D.wrapS=a.RepeatWrapping),w.repeat[1]!==1&&(D.wrapT=a.RepeatWrapping)),w.offset&&D.offset.set(w.offset[0],w.offset[1]);if(w.wrap){var tb={repeat:a.RepeatWrapping,mirror:a.MirroredRepeatWrapping};tb[w.wrap[0]]!==undefined&&(D.wrapS=tb[w.wrap[0]]),tb[w.wrap[1]]!==undefined&&(D.wrapT=tb[w.wrap[1]])}}M.textures[k]=D}for(h in O.materials){m=O.materials[h];for(x in m.parameters)if(x==="envMap"||x==="map"||x==="lightMap"||x==="bumpMap")m.parameters[x]=M.textures[m.parameters[x]];else if(x==="shading")m.parameters[x]=m.parameters[x]==="flat"?a.FlatShading:a.SmoothShading;else if(x==="side")m.parameters[x]=="double"?m.parameters[x]=a.DoubleSide:m.parameters[x]=="back"?m.parameters[x]=a.BackSide:m.parameters[x]=a.FrontSide;else if(x==="blending")m.parameters[x]=m.parameters[x]in a?a[m.parameters[x]]:a.NormalBlending;else if(x==="combine")m.parameters[x]=m.parameters[x]=="MixOperation"?a.MixOperation:a.MultiplyOperation;else if(x==="vertexColors")m.parameters[x]=="face"?m.parameters[x]=a.FaceColors:m.parameters[x]&&(m.parameters[x]=a.VertexColors);else if(x==="wrapRGB"){var ub=m.parameters[x];m.parameters[x]=new a.Vector3(ub[0],ub[1],ub[2])}m.parameters.opacity!==undefined&&m.parameters.opacity<1&&(m.parameters.transparent=!0);if(m.parameters.normalMap){var vb=a.ShaderUtils.lib.normal,wb=a.UniformsUtils.clone(vb.uniforms),xb=m.parameters.color,yb=m.parameters.specular,zb=m.parameters.ambient,Ab=m.parameters.shininess;wb.tNormal.value=M.textures[m.parameters.normalMap],m.parameters.normalScale&&wb.uNormalScale.value.set(m.parameters.normalScale[0],m.parameters.normalScale[1]),m.parameters.map&&(wb.tDiffuse.value=m.parameters.map,wb.enableDiffuse.value=!0),m.parameters.envMap&&(wb.tCube.value=m.parameters.envMap,wb.enableReflection.value=!0,wb.uReflectivity.value=m.parameters.reflectivity),m.parameters.lightMap&&(wb.tAO.value=m.parameters.lightMap,wb.enableAO.value=!0),m.parameters.specularMap&&(wb.tSpecular.value=M.textures[m.parameters.specularMap],wb.enableSpecular.value=!0),m.parameters.displacementMap&&(wb.tDisplacement.value=M.textures[m.parameters.displacementMap],wb.enableDisplacement.value=!0,wb.uDisplacementBias.value=m.parameters.displacementBias,wb.uDisplacementScale.value=m.parameters.displacementScale),wb.uDiffuseColor.value.setHex(xb),wb.uSpecularColor.value.setHex(yb),wb.uAmbientColor.value.setHex(zb),wb.uShininess.value=Ab,m.parameters.opacity&&(wb.uOpacity.value=m.parameters.opacity);var Bb={fragmentShader:vb.fragmentShader,vertexShader:vb.vertexShader,uniforms:wb,lights:!0,fog:!0};A=new a.ShaderMaterial(Bb)}else A=new a[m.type](m.parameters);M.materials[h]=A}for(h in O.materials){m=O.materials[h];if(m.parameters.materials){var Cb=[];for(var pb=0;pb<m.parameters.materials.length;pb++){var Db=m.parameters.materials[pb];Cb.push(M.materials[Db])}M.materials[h].materials=Cb}}V(),M.cameras&&O.defaults.camera&&(M.currentCamera=M.cameras[O.defaults.camera]),M.fogs&&O.defaults.fog&&(M.scene.fog=M.fogs[O.defaults.fog]),t=O.defaults.bgcolor,M.bgColor=new a.Color,M.bgColor.setRGB(t[0],t[1],t[2]),M.bgColorAlpha=O.defaults.bgalpha,e.callbackSync(M),ab()},a.TextureLoader=function(){a.EventTarget.call(this),this.crossOrigin=null},a.TextureLoader.prototype={constructor:a.TextureLoader,load:function(b){var c=this,d=new Image;d.addEventListener("load",function(){var b=new a.Texture(d);b.needsUpdate=!0,c.dispatchEvent({type:"load",content:b})},!1),d.addEventListener("error",function(){c.dispatchEvent({type:"error",message:"Couldn't load URL ["+b+"]"})},!1),c.crossOrigin&&(d.crossOrigin=c.crossOrigin),d.src=b}},a.Material=function(){a.MaterialLibrary.push(this),this.id=a.MaterialIdCount++,this.name="",this.side=a.FrontSide,this.opacity=1,this.transparent=!1,this.blending=a.NormalBlending,this.blendSrc=a.SrcAlphaFactor,this.blendDst=a.OneMinusSrcAlphaFactor,this.blendEquation=a.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=!1,this.visible=!0,this.needsUpdate=!0},a.Material.prototype.setValues=function(b){if(b===undefined)return;for(var c in b){var d=b[c];if(d===undefined){console.warn("THREE.Material: '"+c+"' parameter is undefined.");continue}if(c in this){var e=this[c];e instanceof a.Color&&d instanceof a.Color?e.copy(d):e instanceof a.Color&&typeof d=="number"?e.setHex(d):e instanceof a.Vector3&&d instanceof a.Vector3?e.copy(d):this[c]=d}}},a.Material.prototype.clone=function(b){return b===undefined&&(b=new a.Material),b.name=this.name,b.side=this.side,b.opacity=this.opacity,b.transparent=this.transparent,b.blending=this.blending,b.blendSrc=this.blendSrc,b.blendDst=this.blendDst,b.blendEquation=this.blendEquation,b.depthTest=this.depthTest,b.depthWrite=this.depthWrite,b.polygonOffset=this.polygonOffset,b.polygonOffsetFactor=this.polygonOffsetFactor,b.polygonOffsetUnits=this.polygonOffsetUnits,b.alphaTest=this.alphaTest,b.overdraw=this.overdraw,b.visible=this.visible,b},a.Material.prototype.deallocate=function(){var b=a.MaterialLibrary.indexOf(this);b!==-1&&a.MaterialLibrary.splice(b,1)},a.MaterialIdCount=0,a.MaterialLibrary=[],a.LineBasicMaterial=function(b){a.Material.call(this),this.color=new a.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(b)},a.LineBasicMaterial.prototype=Object.create(a.Material.prototype),a.LineBasicMaterial.prototype.clone=function(){var b=new a.LineBasicMaterial;return a.Material.prototype.clone.call(this,b),b.color.copy(this.color),b.linewidth=this.linewidth,b.linecap=this.linecap,b.linejoin=this.linejoin,b.vertexColors=this.vertexColors,b.fog=this.fog,b},a.LineDashedMaterial=function(b){a.Material.call(this),this.color=new a.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(b)},a.LineDashedMaterial.prototype=Object.create(a.Material.prototype),a.LineDashedMaterial.prototype.clone=function(){var b=new a.LineDashedMaterial;return a.Material.prototype.clone.call(this,b),b.color.copy(this.color),b.linewidth=this.linewidth,b.scale=this.scale,b.dashSize=this.dashSize,b.gapSize=this.gapSize,b.vertexColors=this.vertexColors,b.fog=this.fog,b},a.MeshBasicMaterial=function(b){a.Material.call(this),this.color=new a.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=a.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=a.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=a.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(b)},a.MeshBasicMaterial.prototype=Object.create(a.Material.prototype),a.MeshBasicMaterial.prototype.clone=function(){var b=new a.MeshBasicMaterial;return a.Material.prototype.clone.call(this,b),b.color.copy(this.color),b.map=this.map,b.lightMap=this.lightMap,b.specularMap=this.specularMap,b.envMap=this.envMap,b.combine=this.combine,b.reflectivity=this.reflectivity,b.refractionRatio=this.refractionRatio,b.fog=this.fog,b.shading=this.shading,b.wireframe=this.wireframe,b.wireframeLinewidth=this.wireframeLinewidth,b.wireframeLinecap=this.wireframeLinecap,b.wireframeLinejoin=this.wireframeLinejoin,b.vertexColors=this.vertexColors,b.skinning=this.skinning,b.morphTargets=this.morphTargets,b},a.MeshLambertMaterial=function(b){a.Material.call(this),this.color=new a.Color(16777215),this.ambient=new a.Color(16777215),this.emissive=new a.Color(0),this.wrapAround=!1,this.wrapRGB=new a.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=a.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=a.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=a.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(b)},a.MeshLambertMaterial.prototype=Object.create(a.Material.prototype),a.MeshLambertMaterial.prototype.clone=function(){var b=new a.MeshLambertMaterial;return a.Material.prototype.clone.call(this,b),b.color.copy(this.color),b.ambient.copy(this.ambient),b.emissive.copy(this.emissive),b.wrapAround=this.wrapAround,b.wrapRGB.copy(this.wrapRGB),b.map=this.map,b.lightMap=this.lightMap,b.specularMap=this.specularMap,b.envMap=this.envMap,b.combine=this.combine,b.reflectivity=this.reflectivity,b.refractionRatio=this.refractionRatio,b.fog=this.fog,b.shading=this.shading,b.wireframe=this.wireframe,b.wireframeLinewidth=this.wireframeLinewidth,b.wireframeLinecap=this.wireframeLinecap,b.wireframeLinejoin=this.wireframeLinejoin,b.vertexColors=this.vertexColors,b.skinning=this.skinning,b.morphTargets=this.morphTargets,b.morphNormals=this.morphNormals,b},a.MeshPhongMaterial=function(b){a.Material.call(this),this.color=new a.Color(16777215),this.ambient=new a.Color(16777215),this.emissive=new a.Color(0),this.specular=new a.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new a.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new a.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=a.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=a.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=a.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(b)},a.MeshPhongMaterial.prototype=Object.create(a.Material.prototype),a.MeshPhongMaterial.prototype.clone=function(){var b=new a.MeshPhongMaterial;return a.Material.prototype.clone.call(this,b),b.color.copy(this.color),b.ambient.copy(this.ambient),b.emissive.copy(this.emissive),b.specular.copy(this.specular),b.shininess=this.shininess,b.metal=this.metal,b.perPixel=this.perPixel,b.wrapAround=this.wrapAround,b.wrapRGB.copy(this.wrapRGB),b.map=this.map,b.lightMap=this.lightMap,b.bumpMap=this.bumpMap,b.bumpScale=this.bumpScale,b.normalMap=this.normalMap,b.normalScale.copy(this.normalScale),b.specularMap=this.specularMap,b.envMap=this.envMap,b.combine=this.combine,b.reflectivity=this.reflectivity,b.refractionRatio=this.refractionRatio,b.fog=this.fog,b.shading=this.shading,b.wireframe=this.wireframe,b.wireframeLinewidth=this.wireframeLinewidth,b.wireframeLinecap=this.wireframeLinecap,b.wireframeLinejoin=this.wireframeLinejoin,b.vertexColors=this.vertexColors,b.skinning=this.skinning,b.morphTargets=this.morphTargets,b.morphNormals=this.morphNormals,b},a.MeshDepthMaterial=function(b){a.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(b)},a.MeshDepthMaterial.prototype=Object.create(a.Material.prototype),a.MeshDepthMaterial.prototype.clone=function(){var b=new a.LineBasicMaterial;return a.Material.prototype.clone.call(this,b),b.wireframe=this.wireframe,b.wireframeLinewidth=this.wireframeLinewidth,b},a.MeshNormalMaterial=function(b){a.Material.call(this,b),this.shading=a.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(b)},a.MeshNormalMaterial.prototype=Object.create(a.Material.prototype),a.MeshNormalMaterial.prototype.clone=function(){var b=new a.MeshNormalMaterial;return a.Material.prototype.clone.call(this,b),b.shading=this.shading,b.wireframe=this.wireframe,b.wireframeLinewidth=this.wireframeLinewidth,b},a.MeshFaceMaterial=function(a){this.materials=a instanceof Array?a:[]},a.MeshFaceMaterial.prototype.clone=function(){return new a.MeshFaceMaterial(this.materials.slice(0))},a.ParticleBasicMaterial=function(b){a.Material.call(this),this.color=new a.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(b)},a.ParticleBasicMaterial.prototype=Object.create(a.Material.prototype),a.ParticleBasicMaterial.prototype.clone=function(){var b=new a.ParticleBasicMaterial;return a.Material.prototype.clone.call(this,b),b.color.copy(this.color),b.map=this.map,b.size=this.size,b.sizeAttenuation=this.sizeAttenuation,b.vertexColors=this.vertexColors,b.fog=this.fog,b},a.ParticleCanvasMaterial=function(b){a.Material.call(this),this.color=new a.Color(16777215),this.program=function(a,b){},this.setValues(b)},a.ParticleCanvasMaterial.prototype=Object.create(a.Material.prototype),a.ParticleCanvasMaterial.prototype.clone=function(){var b=new a.ParticleCanvasMaterial;return a.Material.prototype.clone.call(this,b),b.color.copy(this.color),b.program=this.program,b},a.ParticleDOMMaterial=function(a){this.element=a},a.ParticleDOMMaterial.prototype.clone=function(){return new a.ParticleDOMMaterial(this.element)},a.ShaderMaterial=function(b){a.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=a.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=a.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(b)},a.ShaderMaterial.prototype=Object.create(a.Material.prototype),a.ShaderMaterial.prototype.clone=function(){var b=new a.ShaderMaterial;return a.Material.prototype.clone.call(this,b),b.fragmentShader=this.fragmentShader,b.vertexShader=this.vertexShader,b.uniforms=a.UniformsUtils.clone(this.uniforms),b.attributes=this.attributes,b.defines=this.defines,b.shading=this.shading,b.wireframe=this.wireframe,b.wireframeLinewidth=this.wireframeLinewidth,b.fog=this.fog,b.lights=this.lights,b.vertexColors=this.vertexColors,b.skinning=this.skinning,b.morphTargets=this.morphTargets,b.morphNormals=this.morphNormals,b},a.Texture=function(b,c,d,e,f,g,h,i,j){a.TextureLibrary.push(this),this.id=a.TextureIdCount++,this.name="",this.image=b,this.mapping=c!==undefined?c:new a.UVMapping,this.wrapS=d!==undefined?d:a.ClampToEdgeWrapping,this.wrapT=e!==undefined?e:a.ClampToEdgeWrapping,this.magFilter=f!==undefined?f:a.LinearFilter,this.minFilter=g!==undefined?g:a.LinearMipMapLinearFilter,this.anisotropy=j!==undefined?j:1,this.format=h!==undefined?h:a.RGBAFormat,this.type=i!==undefined?i:a.UnsignedByteType,this.offset=new a.Vector2(0,0),this.repeat=new a.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.needsUpdate=!1,this.onUpdate=null},a.Texture.prototype={constructor:a.Texture,clone:function(){var b=new a.Texture;return b.image=this.image,b.mapping=this.mapping,b.wrapS=this.wrapS,b.wrapT=this.wrapT,b.magFilter=this.magFilter,b.minFilter=this.minFilter,b.anisotropy=this.anisotropy,b.format=this.format,b.type=this.type,b.offset.copy(this.offset),b.repeat.copy(this.repeat),b.generateMipmaps=this.generateMipmaps,b.premultiplyAlpha=this.premultiplyAlpha,b.flipY=this.flipY,b},deallocate:function(){var b=a.TextureLibrary.indexOf(this);b!==-1&&a.TextureLibrary.splice(b,1)}},a.TextureIdCount=0,a.TextureLibrary=[],a.CompressedTexture=function(b,c,d,e,f,g,h,i,j,k){a.Texture.call(this,null,g,h,i,j,k,e,f),this.image={width:c,height:d},this.mipmaps=b},a.CompressedTexture.prototype=Object.create(a.Texture.prototype),a.CompressedTexture.prototype.clone=function(){var b=new a.CompressedTexture;return b.image=this.image,b.mipmaps=this.mipmaps,b.format=this.format,b.type=this.type,b.mapping=this.mapping,b.wrapS=this.wrapS,b.wrapT=this.wrapT,b.magFilter=this.magFilter,b.minFilter=this.minFilter,b.anisotropy=this.anisotropy,b.offset.copy(this.offset),b.repeat.copy(this.repeat),b},a.DataTexture=function(b,c,d,e,f,g,h,i,j,k){a.Texture.call(this,null,g,h,i,j,k,e,f),this.image={data:b,width:c,height:d}},a.DataTexture.prototype=Object.create(a.Texture.prototype),a.DataTexture.prototype.clone=function(){var b=new a.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return b.offset.copy(this.offset),b.repeat.copy(this.repeat),b},a.Particle=function(b){a.Object3D.call(this),this.material=b},a.Particle.prototype=Object.create(a.Object3D.prototype),a.Particle.prototype.clone=function(b){return b===undefined&&(b=new a.Particle(this.material)),a.Object3D.prototype.clone.call(this,b),b},a.ParticleSystem=function(b,c){a.Object3D.call(this),this.geometry=b,this.material=c!==undefined?c:new a.ParticleBasicMaterial({color:Math.random()*16777215}),this.sortParticles=!1,this.geometry&&(this.geometry.boundingSphere===null&&this.geometry.computeBoundingSphere(),this.boundRadius=b.boundingSphere.radius),this.frustumCulled=!1},a.ParticleSystem.prototype=Object.create(a.Object3D.prototype),a.ParticleSystem.prototype.clone=function(b){return b===undefined&&(b=new a.ParticleSystem(this.geometry,this.material)),b.sortParticles=this.sortParticles,a.Object3D.prototype.clone.call(this,b),b},a.Line=function(b,c,d){a.Object3D.call(this),this.geometry=b,this.material=c!==undefined?c:new a.LineBasicMaterial({color:Math.random()*16777215}),this.type=d!==undefined?d:a.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},a.LineStrip=0,a.LinePieces=1,a.Line.prototype=Object.create(a.Object3D.prototype),a.Line.prototype.clone=function(b){return b===undefined&&(b=new a.Line(this.geometry,this.material,this.type)),a.Object3D.prototype.clone.call(this,b),b},a.Mesh=function(b,c){a.Object3D.call(this),this.geometry=b,this.material=c!==undefined?c:new a.MeshBasicMaterial({color:Math.random()*16777215,wireframe:!0});if(this.geometry){this.geometry.boundingSphere===null&&this.geometry.computeBoundingSphere(),this.boundRadius=b.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var d=0;d<this.geometry.morphTargets.length;d++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[d].name]=d}}},a.Mesh.prototype=Object.create(a.Object3D.prototype),a.Mesh.prototype.getMorphTargetIndexByName=function(a){return this.morphTargetDictionary[a]!==undefined?this.morphTargetDictionary[a]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0."),0)},a.Mesh.prototype.clone=function(b){return b===undefined&&(b=new a.Mesh(this.geometry,this.material)),a.Object3D.prototype.clone.call(this,b),b},a.Bone=function(b){a.Object3D.call(this),this.skin=b,this.skinMatrix=new a.Matrix4},a.Bone.prototype=Object.create(a.Object3D.prototype),a.Bone.prototype.update=function(a,b){this.matrixAutoUpdate&&(b|=this.updateMatrix());if(b||this.matrixWorldNeedsUpdate)a?this.skinMatrix.multiply(a,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,b=!0;var c,d,e=this.children.length;for(d=0;d<e;d++)this.children[d].update(this.skinMatrix,b)},a.SkinnedMesh=function(b,c,d){a.Mesh.call(this,b,c),this.useVertexTexture=d!==undefined?d:!0,this.identityMatrix=new a.Matrix4,this.bones=[],this.boneMatrices=[];var e,f,g,h,i,j;if(this.geometry&&this.geometry.bones!==undefined){for(e=0;e<this.geometry.bones.length;e++)g=this.geometry.bones[e],h=g.pos,i=g.rotq,j=g.scl,f=this.addBone(),f.name=g.name,f.position.set(h[0],h[1],h[2]),f.quaternion.set(i[0],i[1],i[2],i[3]),f.useQuaternion=!0,j!==undefined?f.scale.set(j[0],j[1],j[2]):f.scale.set(1,1,1);for(e=0;e<this.bones.length;e++)g=this.geometry.bones[e],f=this.bones[e],g.parent===-1?this.add(f):this.bones[g.parent].add(f);var k=this.bones.length;if(this.useVertexTexture){var l;k>256?l=64:k>64?l=32:k>16?l=16:l=8,this.boneTextureWidth=l,this.boneTextureHeight=l,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new a.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,a.RGBAFormat,a.FloatType),this.boneTexture.minFilter=a.NearestFilter,this.boneTexture.magFilter=a.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*k);this.pose()}},a.SkinnedMesh.prototype=Object.create(a.Mesh.prototype),a.SkinnedMesh.prototype.addBone=function(b){return b===undefined&&(b=new a.Bone(this)),this.bones.push(b),b},a.SkinnedMesh.prototype.updateMatrixWorld=function(b){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||b)this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,b=!0;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c];e instanceof a.Bone?e.update(this.identityMatrix,!1):e.updateMatrixWorld(!0)}if(this.boneInverses==undefined){this.boneInverses=[];for(var f=0,g=this.bones.length;f<g;f++){var h=new a.Matrix4;h.getInverse(this.bones[f].skinMatrix),this.boneInverses.push(h)}}for(var f=0,g=this.bones.length;f<g;f++)a.SkinnedMesh.offsetMatrix.multiply(this.bones[f].skinMatrix,this.boneInverses[f]),a.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,f*16);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},a.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var a=0;a<this.geometry.skinIndices.length;a++){var b=this.geometry.skinWeights[a],c=1/b.lengthManhattan();c!==Infinity?b.multiplyScalar(c):b.set(1)}},a.SkinnedMesh.prototype.clone=function(b){return b===undefined&&(b=new a.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),a.Mesh.prototype.clone.call(this,b),b},a.SkinnedMesh.offsetMatrix=new a.Matrix4,a.MorphAnimMesh=function(b,c){a.Mesh.call(this,b,c),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},a.MorphAnimMesh.prototype=Object.create(a.Mesh.prototype),a.MorphAnimMesh.prototype.setFrameRange=function(a,b){this.startKeyframe=a,this.endKeyframe=b,this.length=this.endKeyframe-this.startKeyframe+1},a.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},a.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},a.MorphAnimMesh.prototype.parseAnimations=function(){var a=this.geometry;a.animations||(a.animations={});var b,c=a.animations,d=/([a-z]+)(\d+)/;for(var e=0,f=a.morphTargets.length;e<f;e++){var g=a.morphTargets[e],h=g.name.match(d);if(h&&h.length>1){var i=h[1],j=h[2];c[i]||(c[i]={start:Infinity,end:-Infinity});var k=c[i];e<k.start&&(k.start=e),e>k.end&&(k.end=e),b||(b=i)}}a.firstAnimation=b},a.MorphAnimMesh.prototype.setAnimationLabel=function(a,b,c){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[a]={start:b,end:c}},a.MorphAnimMesh.prototype.playAnimation=function(a,b){var c=this.geometry.animations[a];c?(this.setFrameRange(c.start,c.end),this.duration=1e3*((c.end-c.start)/b),this.time=0):console.warn("animation["+a+"] undefined")},a.MorphAnimMesh.prototype.updateAnimation=function(b){var c=this.duration/this.length;this.time+=this.direction*b;if(this.mirroredLoop){if(this.time>this.duration||this.time<0)this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)}else this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration);var d=this.startKeyframe+a.Math.clamp(Math.floor(this.time/c),0,this.length-1);d!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[d]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=d);var e=this.time%c/c;this.directionBackwards&&(e=1-e),this.morphTargetInfluences[this.currentKeyframe]=e,this.morphTargetInfluences[this.lastKeyframe]=1-e},a.MorphAnimMesh.prototype.clone=function(b){return b===undefined&&(b=new a.MorphAnimMesh(this.geometry,this.material)),b.duration=this.duration,b.mirroredLoop=this.mirroredLoop,b.time=this.time,b.lastKeyframe=this.lastKeyframe,b.currentKeyframe=this.currentKeyframe,b.direction=this.direction,b.directionBackwards=this.directionBackwards,a.Mesh.prototype.clone.call(this,b),b},a.Ribbon=function(b,c){a.Object3D.call(this),this.geometry=b,this.material=c},a.Ribbon.prototype=Object.create(a.Object3D.prototype),a.Ribbon.prototype.clone=function(b){return b===undefined&&(b=new a.Ribbon(this.geometry,this.material)),a.Object3D.prototype.clone.call(this,b),b},a.LOD=function(){a.Object3D.call(this),this.LODs=[]},a.LOD.prototype=Object.create(a.Object3D.prototype),a.LOD.prototype.addLevel=function(a,b){b===undefined&&(b=0),b=Math.abs(b);for(var c=0;c<this.LODs.length;c++)if(b<this.LODs[c].visibleAtDistance)break;this.LODs.splice(c,0,{visibleAtDistance:b,object3D:a}),this.add(a)},a.LOD.prototype.update=function(a){if(this.LODs.length>1){a.matrixWorldInverse.getInverse(a.matrixWorld);var b=a.matrixWorldInverse,c=-(b.elements[2]*this.matrixWorld.elements[12]+b.elements[6]*this.matrixWorld.elements[13]+b.elements[10]*this.matrixWorld.elements[14]+b.elements[14]);this.LODs[0].object3D.visible=!0;for(var d=1;d<this.LODs.length;d++){if(!(c>=this.LODs[d].visibleAtDistance))break;this.LODs[d-1].object3D.visible=!1,this.LODs[d].object3D.visible=!0}for(;d<this.LODs.length;d++)this.LODs[d].object3D.visible=!1}},a.LOD.prototype.clone=function(){},a.Sprite=function(b){a.Object3D.call(this),b=b||{},this.color=b.color!==undefined?new a.Color(b.color):new a.Color(16777215),this.map=b.map!==undefined?b.map:new a.Texture,this.blending=b.blending!==undefined?b.blending:a.NormalBlending,this.blendSrc=b.blendSrc!==undefined?b.blendSrc:a.SrcAlphaFactor,this.blendDst=b.blendDst!==undefined?b.blendDst:a.OneMinusSrcAlphaFactor,this.blendEquation=b.blendEquation!==undefined?b.blendEquation:a.AddEquation,this.useScreenCoordinates=b.useScreenCoordinates!==undefined?b.useScreenCoordinates:!0,this.mergeWith3D=b.mergeWith3D!==undefined?b.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=b.affectedByDistance!==undefined?b.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=b.scaleByViewport!==undefined?b.scaleByViewport:!this.affectedByDistance,this.alignment=b.alignment instanceof a.Vector2?b.alignment:a.SpriteAlignment.center.clone(),this.fog=b.fog!==undefined?b.fog:!1,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new a.Vector2(0,0),this.uvScale=new a.Vector2(1,1)},a.Sprite.prototype=Object.create(a.Object3D.prototype),a.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y);this.matrixWorldNeedsUpdate=!0},a.Sprite.prototype.clone=function(b){return b===undefined&&(b=new a.Sprite({})),b.color.copy(this.color),b.map=this.map,b.blending=this.blending,b.useScreenCoordinates=this.useScreenCoordinates,b.mergeWith3D=this.mergeWith3D,b.affectedByDistance=this.affectedByDistance,b.scaleByViewport=this.scaleByViewport,b.alignment=this.alignment,b.fog=this.fog,b.rotation3d.copy(this.rotation3d),b.rotation=this.rotation,b.opacity=this.opacity,b.uvOffset.copy(this.uvOffset),b.uvScale.copy(this.uvScale),a.Object3D.prototype.clone.call(this,b),b},a.SpriteAlignment={},a.SpriteAlignment.topLeft=new a.Vector2(1,-1),a.SpriteAlignment.topCenter=new a.Vector2(0,-1),a.SpriteAlignment.topRight=new a.Vector2(-1,-1),a.SpriteAlignment.centerLeft=new a.Vector2(1,0),a.SpriteAlignment.center=new a.Vector2(0,0),a.SpriteAlignment.centerRight=new a.Vector2(-1,0),a.SpriteAlignment.bottomLeft=new a.Vector2(1,1),a.SpriteAlignment.bottomCenter=new a.Vector2(0,1),a.SpriteAlignment.bottomRight=new a.Vector2(-1,1),a.Scene=function(){a.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},a.Scene.prototype=Object.create(a.Object3D.prototype),a.Scene.prototype.__addObject=function(b){if(b instanceof a.Light)this.__lights.indexOf(b)===-1&&this.__lights.push(b),b.target&&b.target.parent===undefined&&this.add(b.target);else if(!(b instanceof a.Camera||b instanceof a.Bone)&&this.__objects.indexOf(b)===-1){this.__objects.push(b),this.__objectsAdded.push(b);var c=this.__objectsRemoved.indexOf(b);c!==-1&&this.__objectsRemoved.splice(c,1)}for(var d=0;d<b.children.length;d++)this.__addObject(b.children[d])},a.Scene.prototype.__removeObject=function(b){if(b instanceof a.Light){var c=this.__lights.indexOf(b);c!==-1&&this.__lights.splice(c,1)}else if(!(b instanceof a.Camera)){var c=this.__objects.indexOf(b);if(c!==-1){this.__objects.splice(c,1),this.__objectsRemoved.push(b);var d=this.__objectsAdded.indexOf(b);d!==-1&&this.__objectsAdded.splice(d,1)}}for(var e=0;e<b.children.length;e++)this.__removeObject(b.children[e])},a.Fog=function(b,c,d){this.name="",this.color=new a.Color(b),this.near=c!==undefined?c:1,this.far=d!==undefined?d:1e3},a.Fog.prototype.clone=function(){return new a.Fog(this.color.getHex(),this.near,this.far)},a.FogExp2=function(b,c){this.name="",this.color=new a.Color(b),this.density=c!==undefined?c:25e-5},a.FogExp2.prototype.clone=function(){return new a.FogExp2(this.color.getHex(),this.density)},a.CanvasRenderer=function(b){function vb(a){p!==a&&(m.globalAlpha=a,p=a)}function wb(b){q!==b&&(b===a.NormalBlending?m.globalCompositeOperation="source-over":b===a.AdditiveBlending?m.globalCompositeOperation="lighter":b===a.SubtractiveBlending&&(m.globalCompositeOperation="darker"),q=b)}function xb(a){t!==a&&(m.lineWidth=a,t=a)}function yb(a){u!==a&&(m.lineCap=a,u=a)}function zb(a){v!==a&&(m.lineJoin=a,v=a)}function Ab(a){r!==a&&(m.strokeStyle=a,r=a)}function Bb(a){s!==a&&(m.fillStyle=a,s=a)}console.log("THREE.CanvasRenderer",a.REVISION),b=b||{};var c=this,d,e,f,g=new a.Projector,h=b.canvas!==undefined?b.canvas:document.createElement("canvas"),i,j,k,l,m=h.getContext("2d"),n=new a.Color(0),o=0,p=1,q=0,r=null,s=null,t=null,u=null,v=null,w,x,y,z,A=new a.RenderableVertex,B=new a.RenderableVertex,C,D,E,F,G,H,I,J,K,L,M,N,O=new a.Color,P=new a.Color,Q=new a.Color,R=new a.Color,S=new a.Color,T=new a.Color,U=new a.Color,V={},W={},X,Y,Z,$,_,ab,bb,cb,db,eb,fb=new a.Rectangle,gb=new a.Rectangle,hb=new a.Rectangle,ib=!1,jb=new a.Color,kb=new a.Color,lb=new a.Color,mb=Math.PI*2,nb=new a.Vector3,ob,pb,qb,rb,sb,tb,ub=16;ob=document.createElement("canvas"),ob.width=ob.height=2,pb=ob.getContext("2d"),pb.fillStyle="rgba(0,0,0,1)",pb.fillRect(0,0,2,2),qb=pb.getImageData(0,0,2,2),rb=qb.data,sb=document.createElement("canvas"),sb.width=sb.height=ub,tb=sb.getContext("2d"),tb.translate(-ub/2,-ub/2),tb.scale(ub,ub),ub--,this.domElement=h,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(a,b){i=a,j=b,k=Math.floor(i/2),l=Math.floor(j/2),h.width=i,h.height=j,fb.set(-k,-l,k,l),gb.set(-k,-l,k,l),p=1,q=0,r=null,s=null,t=null,u=null,v=null},this.setClearColor=function(a,b){n.copy(a),o=b!==undefined?b:1,gb.set(-k,-l,k,l)},this.setClearColorHex=function(a,b){n.setHex(a),o=b!==undefined?b:1,gb.set(-k,-l,k,l)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){m.setTransform(1,0,0,-1,k,l),gb.isEmpty()===!1&&(gb.minSelf(fb),gb.inflate(2),o<1&&m.clearRect(Math.floor(gb.getX()),Math.floor(gb.getY()),Math.floor(gb.getWidth()),Math.floor(gb.getHeight())),o>0&&(wb(a.NormalBlending),vb(1),Bb("rgba("+Math.floor(n.r*255)+","+Math.floor(n.g*255)+","+Math.floor(n.b*255)+","+o+")"),m.fillRect(Math.floor(gb.getX()),Math.floor(gb.getY()),Math.floor(gb.getWidth()),Math.floor(gb.getHeight()))),gb.empty())},this.render=function(b,h){function p(){jb.setRGB(0,0,0),kb.setRGB(0,0,0),lb.setRGB(0,0,0);for(var b=0,c=f.length;b<c;b++){var d=f[b],e=d.color;d instanceof a.AmbientLight?(jb.r+=e.r,jb.g+=e.g,jb.b+=e.b):d instanceof a.DirectionalLight?(kb.r+=e.r,kb.g+=e.g,kb.b+=e.b):d instanceof a.PointLight&&(lb.r+=e.r,lb.g+=e.g,lb.b+=e.b)}}function q(b,c,d){for(var e=0,g=f.length;e<g;e++){var h=f[e],i=h.color;if(h instanceof a.DirectionalLight){var j=h.matrixWorld.getPosition().normalize(),k=c.dot(j);if(k<=0)continue;k*=h.intensity,d.r+=i.r*k,d.g+=i.g*k,d.b+=i.b*k}else if(h instanceof a.PointLight){var j=h.matrixWorld.getPosition(),k=c.dot(nb.sub(j,b).normalize());if(k<=0)continue;k*=h.distance==0?1:1-Math.min(b.distanceTo(j)/h.distance,1);if(k==0)continue;k*=h.intensity,d.r+=i.r*k,d.g+=i.g*k,d.b+=i.b*k}}}function r(b,c,d,e){vb(d.opacity),wb(d.blending);var f,g,h,i,j,n,o;if(d instanceof a.ParticleBasicMaterial)if(d.map===null){h=c.object.scale.x,i=c.object.scale.y,h*=c.scale.x*k,i*=c.scale.y*l,hb.set(b.x-h,b.y-i,b.x+h,b.y+i);if(fb.intersects(hb)===!1)return;Bb(d.color.getContextStyle()),m.save(),m.translate(b.x,b.y),m.rotate(-c.rotation),m.scale(h,i),m.fillRect(-1,-1,2,2),m.restore()}else{j=d.map.image,n=j.width>>1,o=j.height>>1,h=c.scale.x*k,i=c.scale.y*l,f=h*n,g=i*o,hb.set(b.x-f,b.y-g,b.x+f,b.y+g);if(fb.intersects(hb)===!1)return;m.save(),m.translate(b.x,b.y),m.rotate(-c.rotation),m.scale(h,-i),m.translate(-n,-o),m.drawImage(j,0,0),m.restore()}else if(d instanceof a.ParticleCanvasMaterial){f=c.scale.x*k,g=c.scale.y*l,hb.set(b.x-f,b.y-g,b.x+f,b.y+g);if(fb.intersects(hb)===!1)return;Ab(d.color.getContextStyle()),Bb(d.color.getContextStyle()),m.save(),m.translate(b.x,b.y),m.rotate(-c.rotation),m.scale(f,g),d.program(m),m.restore()}}function s(b,c,d,e,f){vb(e.opacity),wb(e.blending),m.beginPath(),m.moveTo(b.positionScreen.x,b.positionScreen.y),m.lineTo(c.positionScreen.x,c.positionScreen.y),e instanceof a.LineBasicMaterial&&(xb(e.linewidth),yb(e.linecap),zb(e.linejoin),Ab(e.color.getContextStyle()),m.stroke(),hb.inflate(e.linewidth*2))}function t(b,d,e,f,g,i,j,k,l){c.info.render.vertices+=3,c.info.render.faces++,vb(k.opacity),wb(k.blending),C=b.positionScreen.x,D=b.positionScreen.y,E=d.positionScreen.x,F=d.positionScreen.y,G=e.positionScreen.x,H=e.positionScreen.y,v(C,D,E,F,G,H);if((k instanceof a.MeshLambertMaterial||k instanceof a.MeshPhongMaterial)&&k.map===null&&k.map===null)T.copy(k.color),U.copy(k.emissive),k.vertexColors===a.FaceColors&&(T.r*=j.color.r,T.g*=j.color.g,T.b*=j.color.b),ib===!0?k.wireframe===!1&&k.shading==a.SmoothShading&&j.vertexNormalsLength==3?(P.r=Q.r=R.r=jb.r,P.g=Q.g=R.g=jb.g,P.b=Q.b=R.b=jb.b,q(j.v1.positionWorld,j.vertexNormalsWorld[0],P),q(j.v2.positionWorld,j.vertexNormalsWorld[1],Q),q(j.v3.positionWorld,j.vertexNormalsWorld[2],R),P.r=P.r*T.r+U.r,P.g=P.g*T.g+U.g,P.b=P.b*T.b+U.b,Q.r=Q.r*T.r+U.r,Q.g=Q.g*T.g+U.g,Q.b=Q.b*T.b+U.b,R.r=R.r*T.r+U.r,R.g=R.g*T.g+U.g,R.b=R.b*T.b+U.b,S.r=(Q.r+R.r)*.5,S.g=(Q.g+R.g)*.5,S.b=(Q.b+R.b)*.5,Z=Fb(P,Q,R,S),Eb(C,D,E,F,G,H,0,0,1,0,0,1,Z)):(O.r=jb.r,O.g=jb.g,O.b=jb.b,q(j.centroidWorld,j.normalWorld,O),O.r=O.r*T.r+U.r,O.g=O.g*T.g+U.g,O.b=O.b*T.b+U.b,k.wireframe===!0?ub(O,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):Cb(O)):k.wireframe===!0?ub(k.color,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):Cb(k.color);else if(k instanceof a.MeshBasicMaterial||k instanceof a.MeshLambertMaterial||k instanceof a.MeshPhongMaterial)if(k.map!==null)k.map.mapping instanceof a.UVMapping&&($=j.uvs[0],Db(C,D,E,F,G,H,$[f].u,$[f].v,$[g].u,$[g].v,$[i].u,$[i].v,k.map));else if(k.envMap!==null){if(k.envMap.mapping instanceof a.SphericalReflectionMapping){var m=h.matrixWorldInverse;nb.copy(j.vertexNormalsWorld[f]),_=(nb.x*m.elements[0]+nb.y*m.elements[4]+nb.z*m.elements[8])*.5+.5,ab=(nb.x*m.elements[1]+nb.y*m.elements[5]+nb.z*m.elements[9])*.5+.5,nb.copy(j.vertexNormalsWorld[g]),bb=(nb.x*m.elements[0]+nb.y*m.elements[4]+nb.z*m.elements[8])*.5+.5,cb=(nb.x*m.elements[1]+nb.y*m.elements[5]+nb.z*m.elements[9])*.5+.5,nb.copy(j.vertexNormalsWorld[i]),db=(nb.x*m.elements[0]+nb.y*m.elements[4]+nb.z*m.elements[8])*.5+.5,eb=(nb.x*m.elements[1]+nb.y*m.elements[5]+nb.z*m.elements[9])*.5+.5,Db(C,D,E,F,G,H,_,ab,bb,cb,db,eb,k.envMap)}}else O.copy(k.color),k.vertexColors===a.FaceColors&&(O.r*=j.color.r,O.g*=j.color.g,O.b*=j.color.b),k.wireframe===!0?ub(O,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):Cb(O);else k instanceof a.MeshDepthMaterial?(X=h.near,Y=h.far,P.r=P.g=P.b=1-Gb(b.positionScreen.z,X,Y),Q.r=Q.g=Q.b=1-Gb(d.positionScreen.z,X,Y),R.r=R.g=R.b=1-Gb(e.positionScreen.z,X,Y),S.r=(Q.r+R.r)*.5,S.g=(Q.g+R.g)*.5,S.b=(Q.b+R.b)*.5,Z=Fb(P,Q,R,S),Eb(C,D,E,F,G,H,0,0,1,0,0,1,Z)):k instanceof a.MeshNormalMaterial&&(O.r=Hb(j.normalWorld.x),O.g=Hb(j.normalWorld.y),O.b=Hb(j.normalWorld.z),k.wireframe===!0?ub(O,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):Cb(O))}function u(b,d,e,f,g,i,j,k,l){c.info.render.vertices+=4,c.info.render.faces++,vb(k.opacity),wb(k.blending);if(k.map!==undefined&&k.map!==null||k.envMap!==undefined&&k.envMap!==null){t(b,d,f,0,1,3,j,k,l),t(g,e,i,1,2,3,j,k,l);return}C=b.positionScreen.x,D=b.positionScreen.y,E=d.positionScreen.x,F=d.positionScreen.y,G=e.positionScreen.x,H=e.positionScreen.y,I=f.positionScreen.x,J=f.positionScreen.y,K=g.positionScreen.x,L=g.positionScreen.y,M=i.positionScreen.x,N=i.positionScreen.y,k instanceof a.MeshLambertMaterial||k instanceof a.MeshPhongMaterial?(T.copy(k.color),U.copy(k.emissive),k.vertexColors===a.FaceColors&&(T.r*=j.color.r,T.g*=j.color.g,T.b*=j.color.b),ib===!0?k.wireframe===!1&&k.shading==a.SmoothShading&&j.vertexNormalsLength==4?(P.r=Q.r=R.r=S.r=jb.r,P.g=Q.g=R.g=S.g=jb.g,P.b=Q.b=R.b=S.b=jb.b,q(j.v1.positionWorld,j.vertexNormalsWorld[0],P),q(j.v2.positionWorld,j.vertexNormalsWorld[1],Q),q(j.v4.positionWorld,j.vertexNormalsWorld[3],R),q(j.v3.positionWorld,j.vertexNormalsWorld[2],S),P.r=P.r*T.r+U.r,P.g=P.g*T.g+U.g,P.b=P.b*T.b+U.b,Q.r=Q.r*T.r+U.r,Q.g=Q.g*T.g+U.g,Q.b=Q.b*T.b+U.b,R.r=R.r*T.r+U.r,R.g=R.g*T.g+U.g,R.b=R.b*T.b+U.b,S.r=S.r*T.r+U.r,S.g=S.g*T.g+U.g,S.b=S.b*T.b+U.b,Z=Fb(P,Q,R,S),v(C,D,E,F,I,J),Eb(C,D,E,F,I,J,0,0,1,0,0,1,Z),v(K,L,G,H,M,N),Eb(K,L,G,H,M,N,1,0,1,1,0,1,Z)):(O.r=jb.r,O.g=jb.g,O.b=jb.b,q(j.centroidWorld,j.normalWorld,O),O.r=O.r*T.r+U.r,O.g=O.g*T.g+U.g,O.b=O.b*T.b+U.b,mb(C,D,E,F,G,H,I,J),k.wireframe===!0?ub(O,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):Cb(O)):(O.r=T.r+U.r,O.g=T.g+U.g,O.b=T.b+U.b,mb(C,D,E,F,G,H,I,J),k.wireframe===!0?ub(O,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):Cb(O))):k instanceof a.MeshBasicMaterial?(O.copy(k.color),k.vertexColors===a.FaceColors&&(O.r*=j.color.r,O.g*=j.color.g,O.b*=j.color.b),mb(C,D,E,F,G,H,I,J),k.wireframe===!0?ub(O,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):Cb(O)):k instanceof a.MeshNormalMaterial?(O.r=Hb(j.normalWorld.x),O.g=Hb(j.normalWorld.y),O.b=Hb(j.normalWorld.z),mb(C,D,E,F,G,H,I,J),k.wireframe===!0?ub(O,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):Cb(O)):k instanceof a.MeshDepthMaterial&&(X=h.near,Y=h.far,P.r=P.g=P.b=1-Gb(b.positionScreen.z,X,Y),Q.r=Q.g=Q.b=1-Gb(d.positionScreen.z,X,Y),R.r=R.g=R.b=1-Gb(f.positionScreen.z,X,Y),S.r=S.g=S.b=1-Gb(e.positionScreen.z,X,Y),Z=Fb(P,Q,R,S),v(C,D,E,F,I,J),Eb(C,D,E,F,I,J,0,0,1,0,0,1,Z),v(K,L,G,H,M,N),Eb(K,L,G,H,M,N,1,0,1,1,0,1,Z))}function v(a,b,c,d,e,f){m.beginPath(),m.moveTo(a,b),m.lineTo(c,d),m.lineTo(e,f),m.closePath()}function mb(a,b,c,d,e,f,g,h){m.beginPath(),m.moveTo(a,b),m.lineTo(c,d),m.lineTo(e,f),m.lineTo(g,h),m.closePath()}function ub(a,b,c,d){xb(b),yb(c),zb(d),Ab(a.getContextStyle()),m.stroke(),hb.inflate(b*2)}function Cb(a){Bb(a.getContextStyle()),m.fill()}function Db(b,c,d,e,f,g,h,i,j,k,l,n,o){if(o instanceof a.DataTexture||o.image===undefined||o.image.width==0)return;if(o.needsUpdate===!0){var p=o.wrapS==a.RepeatWrapping,q=o.wrapT==a.RepeatWrapping;V[o.id]=m.createPattern(o.image,p===!0&&q===!0?"repeat":p===!0&&q===!1?"repeat-x":p===!1&&q===!0?"repeat-y":"no-repeat"),o.needsUpdate=!1}V[o.id]===undefined?Bb("rgba(0,0,0,1)"):Bb(V[o.id]);var r,s,t,u,v,w,x,y,z=o.offset.x/o.repeat.x,A=o.offset.y/o.repeat.y,B=o.image.width*o.repeat.x,C=o.image.height*o.repeat.y;h=(h+z)*B,i=(1-i+A)*C,j=(j+z)*B,k=(1-k+A)*C,l=(l+z)*B,n=(1-n+A)*C,d-=b,e-=c,f-=b,g-=c,j-=h,k-=i,l-=h,n-=i,x=j*n-l*k;if(x===0){if(W[o.id]===undefined){var D=document.createElement("canvas");D.width=o.image.width,D.height=o.image.height;var E=D.getContext("2d");E.drawImage(o.image,0,0),W[o.id]=E.getImageData(0,0,o.image.width,o.image.height).data}var F=W[o.id],G=(Math.floor(h)+Math.floor(i)*o.image.width)*4;O.setRGB(F[G]/255,F[G+1]/255,F[G+2]/255),Cb(O);return}y=1/x,r=(n*d-k*f)*y,s=(n*e-k*g)*y,t=(j*f-l*d)*y,u=(j*g-l*e)*y,v=b-r*h-t*i,w=c-s*h-u*i,m.save(),m.transform(r,s,t,u,v,w),m.fill(),m.restore()}function Eb(a,b,c,d,e,f,g,h,i,j,k,l,n){var o,p,q,r,s,t,u,v,w=n.width-1,x=n.height-1;g*=w,h*=x,i*=w,j*=x,k*=w,l*=x,c-=a,d-=b,e-=a,f-=b,i-=g,j-=h,k-=g,l-=h,u=i*l-k*j,v=1/u,o=(l*c-j*e)*v,p=(l*d-j*f)*v,q=(i*e-k*c)*v,r=(i*f-k*d)*v,s=a-o*g-q*h,t=b-p*g-r*h,m.save(),m.transform(o,p,q,r,s,t),m.clip(),m.drawImage(n,0,0),m.restore()}function Fb(a,b,c,d){return rb[0]=a.r*255|0,rb[1]=a.g*255|0,rb[2]=a.b*255|0,rb[4]=b.r*255|0,rb[5]=b.g*255|0,rb[6]=b.b*255|0,rb[8]=c.r*255|0,rb[9]=c.g*255|0,rb[10]=c.b*255|0,rb[12]=d.r*255|0,rb[13]=d.g*255|0,rb[14]=d.b*255|0,pb.putImageData(qb,0,0),tb.drawImage(ob,0,0),sb}function Gb(a,b,c){var d=(a-b)/(c-b);return d*d*(3-2*d)}function Hb(a){var b=(a+1)*.5;return b<0?0:b>1?1:b}function Ib(a,b){var c=b.x-a.x,d=b.y-a.y,e=c*c+d*d,f;if(e===0)return;f=1/Math.sqrt(e),c*=f,d*=f,b.x+=c,b.y+=d,a.x-=c,a.y-=d}if(h instanceof a.Camera==0){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}var i,j,n,o;this.autoClear===!0?this.clear():m.setTransform(1,0,0,-1,k,l),c.info.render.vertices=0,c.info.render.faces=0,d=g.projectScene(b,h,this.sortObjects,this.sortElements),e=d.elements,f=d.lights,ib=f.length>0,ib===!0&&p();for(i=0,j=e.length;i<j;i++){n=e[i],o=n.material;if(o===undefined||o.visible===!1)continue;hb.empty(),n instanceof a.RenderableParticle?(w=n,w.x*=k,w.y*=l,r(w,n,o,b)):n instanceof a.RenderableLine?(w=n.v1,x=n.v2,w.positionScreen.x*=k,w.positionScreen.y*=l,x.positionScreen.x*=k,x.positionScreen.y*=l,hb.addPoint(w.positionScreen.x,w.positionScreen.y),hb.addPoint(x.positionScreen.x,x.positionScreen.y),fb.intersects(hb)===!0&&s(w,x,n,o,b)):n instanceof a.RenderableFace3?(w=n.v1,x=n.v2,y=n.v3,w.positionScreen.x*=k,w.positionScreen.y*=l,x.positionScreen.x*=k,x.positionScreen.y*=l,y.positionScreen.x*=k,y.positionScreen.y*=l,o.overdraw===!0&&(Ib(w.positionScreen,x.positionScreen),Ib(x.positionScreen,y.positionScreen),Ib(y.positionScreen,w.positionScreen)),hb.add3Points(w.positionScreen.x,w.positionScreen.y,x.positionScreen.x,x.positionScreen.y,y.positionScreen.x,y.positionScreen.y),fb.intersects(hb)===!0&&t(w,x,y,0,1,2,n,o,b)):n instanceof a.RenderableFace4&&(w=n.v1,x=n.v2,y=n.v3,z=n.v4,w.positionScreen.x*=k,w.positionScreen.y*=l,x.positionScreen.x*=k,x.positionScreen.y*=l,y.positionScreen.x*=k,y.positionScreen.y*=l,z.positionScreen.x*=k,z.positionScreen.y*=l,A.positionScreen.copy(x.positionScreen),B.positionScreen.copy(z.positionScreen),o.overdraw===!0&&(Ib(w.positionScreen,x.positionScreen),Ib(x.positionScreen,z.positionScreen),Ib(z.positionScreen,w.positionScreen),Ib(y.positionScreen,A.positionScreen),Ib(y.positionScreen,B.positionScreen)),hb.addPoint(w.positionScreen.x,w.positionScreen.y),hb.addPoint(x.positionScreen.x,x.positionScreen.y),hb.addPoint(y.positionScreen.x,y.positionScreen.y),hb.addPoint(z.positionScreen.x,z.positionScreen.y),fb.intersects(hb)===!0&&u(w,x,y,z,A,B,n,o,b)),gb.addRectangle(hb)}m.setTransform(1,0,0,1,0,0)}},a.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( map, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( map, vUv );","#endif","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#ifdef SHADOWMAP_SOFT","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},a.UniformsUtils={merge:function(a){var b,c,d,e={};for(b=0;b<a.length;b++){d=this.clone(a[b]);for(c in d)e[c]=d[c]}return e},clone:function(b){var c,d,e,f,g={};for(c in b){g[c]={};for(d in b[c])f=b[c][d],f instanceof a.Color||f instanceof a.Vector2||f instanceof a.Vector3||f instanceof a.Vector4||f instanceof a.Matrix4||f instanceof a.Texture?g[c][d]=f.clone():f instanceof Array?g[c][d]=f.slice():g[c][d]=f}return g}},a.UniformsLib={common:{diffuse:{type:"c",value:new a.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new a.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new a.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new a.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new a.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new a.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},a.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},basic:{uniforms:a.UniformsUtils.merge([a.UniformsLib.common,a.UniformsLib.fog,a.UniformsLib.shadowmap]),vertexShader:[a.ShaderChunk.map_pars_vertex,a.ShaderChunk.lightmap_pars_vertex,a.ShaderChunk.envmap_pars_vertex,a.ShaderChunk.color_pars_vertex,a.ShaderChunk.morphtarget_pars_vertex,a.ShaderChunk.skinning_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {",a.ShaderChunk.map_vertex,a.ShaderChunk.lightmap_vertex,a.ShaderChunk.color_vertex,"#ifdef USE_ENVMAP",a.ShaderChunk.morphnormal_vertex,a.ShaderChunk.skinbase_vertex,a.ShaderChunk.skinnormal_vertex,a.ShaderChunk.defaultnormal_vertex,"#endif",a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.skinning_vertex,a.ShaderChunk.default_vertex,a.ShaderChunk.worldpos_vertex,a.ShaderChunk.envmap_vertex,a.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.map_pars_fragment,a.ShaderChunk.lightmap_pars_fragment,a.ShaderChunk.envmap_pars_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,a.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",a.ShaderChunk.map_fragment,a.ShaderChunk.alphatest_fragment,a.ShaderChunk.specularmap_fragment,a.ShaderChunk.lightmap_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.envmap_fragment,a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.linear_to_gamma_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:a.UniformsUtils.merge([a.UniformsLib.common,a.UniformsLib.fog,a.UniformsLib.lights,a.UniformsLib.shadowmap,{ambient:{type:"c",value:new a.Color(16777215)},emissive:{type:"c",value:new a.Color(0)},wrapRGB:{type:"v3",value:new a.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",a.ShaderChunk.map_pars_vertex,a.ShaderChunk.lightmap_pars_vertex,a.ShaderChunk.envmap_pars_vertex,a.ShaderChunk.lights_lambert_pars_vertex,a.ShaderChunk.color_pars_vertex,a.ShaderChunk.morphtarget_pars_vertex,a.ShaderChunk.skinning_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {",a.ShaderChunk.map_vertex,a.ShaderChunk.lightmap_vertex,a.ShaderChunk.color_vertex,a.ShaderChunk.morphnormal_vertex,a.ShaderChunk.skinbase_vertex,a.ShaderChunk.skinnormal_vertex,a.ShaderChunk.defaultnormal_vertex,a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.skinning_vertex,a.ShaderChunk.default_vertex,a.ShaderChunk.worldpos_vertex,a.ShaderChunk.envmap_vertex,a.ShaderChunk.lights_lambert_vertex,a.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.map_pars_fragment,a.ShaderChunk.lightmap_pars_fragment,a.ShaderChunk.envmap_pars_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,a.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",a.ShaderChunk.map_fragment,a.ShaderChunk.alphatest_fragment,a.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",a.ShaderChunk.lightmap_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.envmap_fragment,a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.linear_to_gamma_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:a.UniformsUtils.merge([a.UniformsLib.common,a.UniformsLib.bump,a.UniformsLib.normalmap,a.UniformsLib.fog,a.UniformsLib.lights,a.UniformsLib.shadowmap,{ambient:{type:"c",value:new a.Color(16777215)},emissive:{type:"c",value:new a.Color(0)},specular:{type:"c",value:new a.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new a.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",a.ShaderChunk.map_pars_vertex,a.ShaderChunk.lightmap_pars_vertex,a.ShaderChunk.envmap_pars_vertex,a.ShaderChunk.lights_phong_pars_vertex,a.ShaderChunk.color_pars_vertex,a.ShaderChunk.morphtarget_pars_vertex,a.ShaderChunk.skinning_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {",a.ShaderChunk.map_vertex,a.ShaderChunk.lightmap_vertex,a.ShaderChunk.color_vertex,a.ShaderChunk.morphnormal_vertex,a.ShaderChunk.skinbase_vertex,a.ShaderChunk.skinnormal_vertex,a.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.skinning_vertex,a.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",a.ShaderChunk.worldpos_vertex,a.ShaderChunk.envmap_vertex,a.ShaderChunk.lights_phong_vertex,a.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.map_pars_fragment,a.ShaderChunk.lightmap_pars_fragment,a.ShaderChunk.envmap_pars_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.lights_phong_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,a.ShaderChunk.bumpmap_pars_fragment,a.ShaderChunk.normalmap_pars_fragment,a.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",a.ShaderChunk.map_fragment,a.ShaderChunk.alphatest_fragment,a.ShaderChunk.specularmap_fragment,a.ShaderChunk.lights_phong_fragment,a.ShaderChunk.lightmap_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.envmap_fragment,a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.linear_to_gamma_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:a.UniformsUtils.merge([a.UniformsLib.particle,a.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",a.ShaderChunk.color_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {",a.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",a.ShaderChunk.worldpos_vertex,a.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.map_particle_pars_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",a.ShaderChunk.map_particle_fragment,a.ShaderChunk.alphatest_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:a.UniformsUtils.merge([a.UniformsLib.common,a.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",a.ShaderChunk.color_pars_vertex,"void main() {",a.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",a.ShaderChunk.color_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[a.ShaderChunk.morphtarget_pars_vertex,a.ShaderChunk.skinning_pars_vertex,"void main() {",a.ShaderChunk.skinbase_vertex,a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.skinning_vertex,a.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}},a.WebGLRenderer=function(b){function fb(a){a.__webglVertexBuffer=U.createBuffer(),a.__webglColorBuffer=U.createBuffer(),l.info.memory.geometries++}function gb(a){a.__webglVertexBuffer=U.createBuffer(),a.__webglColorBuffer=U.createBuffer(),a.__webglLineDistanceBuffer=U.createBuffer(),l.info.memory.geometries++}function hb(a){a.__webglVertexBuffer=U.createBuffer(),a.__webglColorBuffer=U.createBuffer(),a.__webglNormalBuffer=U.createBuffer(),l.info.memory.geometries++}function ib(a){a.__webglVertexBuffer=U.createBuffer(),a.__webglNormalBuffer=U.createBuffer(),a.__webglTangentBuffer=U.createBuffer(),a.__webglColorBuffer=U.createBuffer(),a.__webglUVBuffer=U.createBuffer(),a.__webglUV2Buffer=U.createBuffer(),a.__webglSkinIndicesBuffer=U.createBuffer(),a.__webglSkinWeightsBuffer=U.createBuffer(),a.__webglFaceBuffer=U.createBuffer(),a.__webglLineBuffer=U.createBuffer();var b,c;if(a.numMorphTargets){a.__webglMorphTargetsBuffers=[];for(b=0,c=a.numMorphTargets;b<c;b++)a.__webglMorphTargetsBuffers.push(U.createBuffer())}if(a.numMorphNormals){a.__webglMorphNormalsBuffers=[];for(b=0,c=a.numMorphNormals;b<c;b++)a.__webglMorphNormalsBuffers.push(U.createBuffer())}l.info.memory.geometries++}function jb(a){U.deleteBuffer(a.__webglVertexBuffer),U.deleteBuffer(a.__webglColorBuffer),nb(a),l.info.memory.geometries--}function kb(a){U.deleteBuffer(a.__webglVertexBuffer),U.deleteBuffer(a.__webglColorBuffer),U.deleteBuffer(a.__webglLineDistanceBuffer),nb(a),l.info.memory.geometries--}function lb(a){U.deleteBuffer(a.__webglVertexBuffer),U.deleteBuffer(a.__webglColorBuffer),U.deleteBuffer(a.__webglNormalBuffer),nb(a),l.info.memory.geometries--}function mb(a){U.deleteBuffer(a.__webglVertexBuffer),U.deleteBuffer(a.__webglNormalBuffer),U.deleteBuffer(a.__webglTangentBuffer),U.deleteBuffer(a.__webglColorBuffer),U.deleteBuffer(a.__webglUVBuffer),U.deleteBuffer(a.__webglUV2Buffer),U.deleteBuffer(a.__webglSkinIndicesBuffer),U.deleteBuffer(a.__webglSkinWeightsBuffer),U.deleteBuffer(a.__webglFaceBuffer),U.deleteBuffer(a.__webglLineBuffer);var b,c;if(a.numMorphTargets)for(b=0,c=a.numMorphTargets;b<c;b++)U.deleteBuffer(a.__webglMorphTargetsBuffers[b]);if(a.numMorphNormals)for(b=0,c=a.numMorphNormals;b<c;b++)U.deleteBuffer(a.__webglMorphNormalsBuffers[b]);nb(a),l.info.memory.geometries--}function nb(a){if(a.__webglCustomAttributesList)for(var b in a.__webglCustomAttributesList)U.deleteBuffer(a.__webglCustomAttributesList[b].buffer)}function ob(a,b){var c=a.vertices.length,d=b.material;if(d.attributes){a.__webglCustomAttributesList===undefined&&(a.__webglCustomAttributesList=[]);for(var e in d.attributes){var f=d.attributes[e];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=!0;var g=1;f.type==="v2"?g=2:f.type==="v3"?g=3:f.type==="v4"?g=4:f.type==="c"&&(g=3),f.size=g,f.array=new Float32Array(c*g),f.buffer=U.createBuffer(),f.buffer.belongsToAttribute=e,f.needsUpdate=!0}a.__webglCustomAttributesList.push(f)}}}function pb(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(c*3),a.__colorArray=new Float32Array(c*3),a.__sortArray=[],a.__webglParticleCount=c,ob(a,b)}function qb(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(c*3),a.__colorArray=new Float32Array(c*3),a.__lineDistanceArray=new Float32Array(c*1),a.__webglLineCount=c,ob(a,b)}function rb(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(c*3),a.__colorArray=new Float32Array(c*3),a.__normalArray=new Float32Array(c*3),a.__webglVertexCount=c,ob(a,b)}function sb(a,b){var c=b.geometry,d=a.faces3,e=a.faces4,f=d.length*3+e.length*4,g=d.length*1+e.length*2,h=d.length*3+e.length*4,i=tb(b,a),j=xb(i),k=vb(i),l=wb(i);a.__vertexArray=new Float32Array(f*3),k&&(a.__normalArray=new Float32Array(f*3)),c.hasTangents&&(a.__tangentArray=new Float32Array(f*4)),l&&(a.__colorArray=new Float32Array(f*3));if(j){if(c.faceUvs.length>0||c.faceVertexUvs.length>0)a.__uvArray=new Float32Array(f*2);if(c.faceUvs.length>1||c.faceVertexUvs.length>1)a.__uv2Array=new Float32Array(f*2)}b.geometry.skinWeights.length&&b.geometry.skinIndices.length&&(a.__skinIndexArray=new Float32Array(f*4),a.__skinWeightArray=new Float32Array(f*4)),a.__faceArray=new Uint16Array(g*3),a.__lineArray=new Uint16Array(h*2);var m,n;if(a.numMorphTargets){a.__morphTargetsArrays=[];for(m=0,n=a.numMorphTargets;m<n;m++)a.__morphTargetsArrays.push(new Float32Array(f*3))}if(a.numMorphNormals){a.__morphNormalsArrays=[];for(m=0,n=a.numMorphNormals;m<n;m++)a.__morphNormalsArrays.push(new Float32Array(f*3))}a.__webglFaceCount=g*3,a.__webglLineCount=h*2;if(i.attributes){a.__webglCustomAttributesList===undefined&&(a.__webglCustomAttributesList=[]);for(var o in i.attributes){var p=i.attributes[o],q={};for(var r in p)q[r]=p[r];if(!q.__webglInitialized||q.createUniqueBuffers){q.__webglInitialized=!0;var s=1;q.type==="v2"?s=2:q.type==="v3"?s=3:q.type==="v4"?s=4:q.type==="c"&&(s=3),q.size=s,q.array=new Float32Array(f*s),q.buffer=U.createBuffer(),q.buffer.belongsToAttribute=o,p.needsUpdate=!0,q.__original=p}a.__webglCustomAttributesList.push(q)}}a.__inittedArrays=!0}function tb(b,c){return b.material instanceof a.MeshFaceMaterial?b.material.materials[c.materialIndex]:b.material}function ub(b){return b&&b.shading!==undefined&&b.shading===a.SmoothShading}function vb(b){return b instanceof a.MeshBasicMaterial&&!b.envMap||b instanceof a.MeshDepthMaterial?!1:ub(b)?a.SmoothShading:a.FlatShading}function wb(a){return a.vertexColors?a.vertexColors:!1}function xb(b){return b.map||b.lightMap||b.bumpMap||b.normalMap||b.specularMap||b instanceof a.ShaderMaterial?!0:!1}function yb(a){var b,c,d;for(b in a.attributes)b==="index"?d=U.ELEMENT_ARRAY_BUFFER:d=U.ARRAY_BUFFER,c=a.attributes[b],c.buffer=U.createBuffer(),U.bindBuffer(d,c.buffer),U.bufferData(d,c.array,U.STATIC_DRAW)}function zb(a,b,c){var d,e,f,g,h,i,j=a.vertices,k=j.length,l=a.colors,m=l.length,n=a.__vertexArray,o=a.__colorArray,p=a.__sortArray,q=a.verticesNeedUpdate,r=a.elementsNeedUpdate,s=a.colorsNeedUpdate,t=a.__webglCustomAttributesList,u,v,w,x,y,z,A;if(c.sortParticles){P.copy(O),P.multiplySelf(c.matrixWorld);for(d=0;d<k;d++)f=j[d],Q.copy(f),P.multiplyVector3(Q),p[d]=[Q.z,d];p.sort(function(a,b){return b[0]-a[0]});for(d=0;d<k;d++)f=j[p[d][1]],g=d*3,n[g]=f.x,n[g+1]=f.y,n[g+2]=f.z;for(e=0;e<m;e++)g=e*3,i=l[p[e][1]],o[g]=i.r,o[g+1]=i.g,o[g+2]=i.b;if(t)for(u=0,v=t.length;u<v;u++){A=t[u];if(A.boundTo!==undefined&&A.boundTo!=="vertices")continue;g=0,y=A.value.length;if(A.size===1)for(x=0;x<y;x++)h=p[x][1],A.array[x]=A.value[h];else if(A.size===2)for(x=0;x<y;x++)h=p[x][1],z=A.value[h],A.array[g]=z.x,A.array[g+1]=z.y,g+=2;else if(A.size===3)if(A.type==="c")for(x=0;x<y;x++)h=p[x][1],z=A.value[h],A.array[g]=z.r,A.array[g+1]=z.g,A.array[g+2]=z.b,g+=3;else for(x=0;x<y;x++)h=p[x][1],z=A.value[h],A.array[g]=z.x,A.array[g+1]=z.y,A.array[g+2]=z.z,g+=3;else if(A.size===4)for(x=0;x<y;x++)h=p[x][1],z=A.value[h],A.array[g]=z.x,A.array[g+1]=z.y,A.array[g+2]=z.z,A.array[g+3]=z.w,g+=4}}else{if(q)for(d=0;d<k;d++)f=j[d],g=d*3,n[g]=f.x,n[g+1]=f.y,n[g+2]=f.z;if(s)for(e=0;e<m;e++)i=l[e],g=e*3,o[g]=i.r,o[g+1]=i.g,o[g+2]=i.b;if(t)for(u=0,v=t.length;u<v;u++){A=t[u];if(A.needsUpdate&&(A.boundTo===undefined||A.boundTo==="vertices")){y=A.value.length,g=0;if(A.size===1)for(x=0;x<y;x++)A.array[x]=A.value[x];else if(A.size===2)for(x=0;x<y;x++)z=A.value[x],A.array[g]=z.x,A.array[g+1]=z.y,g+=2;else if(A.size===3)if(A.type==="c")for(x=0;x<y;x++)z=A.value[x],A.array[g]=z.r,A.array[g+1]=z.g,A.array[g+2]=z.b,g+=3;else for(x=0;x<y;x++)z=A.value[x],A.array[g]=z.x,A.array[g+1]=z.y,A.array[g+2]=z.z,g+=3;else if(A.size===4)for(x=0;x<y;x++)z=A.value[x],A.array[g]=z.x,A.array[g+1]=z.y,A.array[g+2]=z.z,A.array[g+3]=z.w,g+=4}}}if(q||c.sortParticles)U.bindBuffer(U.ARRAY_BUFFER,a.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,n,b);if(s||c.sortParticles)U.bindBuffer(U.ARRAY_BUFFER,a.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,o,b);if(t)for(u=0,v=t.length;u<v;u++){A=t[u];if(A.needsUpdate||c.sortParticles)U.bindBuffer(U.ARRAY_BUFFER,A.buffer),U.bufferData(U.ARRAY_BUFFER,A.array,b)}}function Ab(a,b){var c,d,e,f,g,h,i=a.vertices,j=a.colors,k=a.lineDistances,l=i.length,m=j.length,n=k.length,o=a.__vertexArray,p=a.__colorArray,q=a.__lineDistanceArray,r=a.verticesNeedUpdate,s=a.colorsNeedUpdate,t=a.lineDistancesNeedUpdate,u=a.__webglCustomAttributesList,v,w,x,y,z,A,B;if(r){for(c=0;c<l;c++)f=i[c],g=c*3,o[g]=f.x,o[g+1]=f.y,o[g+2]=f.z;U.bindBuffer(U.ARRAY_BUFFER,a.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,o,b)}if(s){for(d=0;d<m;d++)h=j[d],g=d*3,p[g]=h.r,p[g+1]=h.g,p[g+2]=h.b;U.bindBuffer(U.ARRAY_BUFFER,a.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,p,b)}if(t){for(e=0;e<n;e++)q[e]=k[e];U.bindBuffer(U.ARRAY_BUFFER,a.__webglLineDistanceBuffer),U.bufferData(U.ARRAY_BUFFER,q,b)}if(u)for(v=0,w=u.length;v<w;v++){B=u[v];if(B.needsUpdate&&(B.boundTo===undefined||B.boundTo==="vertices")){g=0,z=B.value.length;if(B.size===1)for(y=0;y<z;y++)B.array[y]=B.value[y];else if(B.size===2)for(y=0;y<z;y++)A=B.value[y],B.array[g]=A.x,B.array[g+1]=A.y,g+=2;else if(B.size===3)if(B.type==="c")for(y=0;y<z;y++)A=B.value[y],B.array[g]=A.r,B.array[g+1]=A.g,B.array[g+2]=A.b,g+=3;else for(y=0;y<z;y++)A=B.value[y],B.array[g]=A.x,B.array[g+1]=A.y,B.array[g+2]=A.z,g+=3;else if(B.size===4)for(y=0;y<z;y++)A=B.value[y],B.array[g]=A.x,B.array[g+1]=A.y,B.array[g+2]=A.z,B.array[g+3]=A.w,g+=4;U.bindBuffer(U.ARRAY_BUFFER,B.buffer),U.bufferData(U.ARRAY_BUFFER,B.array,b)}}}function Bb(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p=a.vertices,q=a.colors,r=a.normals,s=p.length,t=q.length,u=r.length,v=a.__vertexArray,w=a.__colorArray,x=a.__normalArray,y=a.verticesNeedUpdate,z=a.colorsNeedUpdate,A=a.normalsNeedUpdate,B=a.__webglCustomAttributesList;if(y){for(c=0;c<s;c++)f=p[c],g=c*3,v[g]=f.x,v[g+1]=f.y,v[g+2]=f.z;U.bindBuffer(U.ARRAY_BUFFER,a.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,v,b)}if(z){for(d=0;d<t;d++)h=q[d],g=d*3,w[g]=h.r,w[g+1]=h.g,w[g+2]=h.b;U.bindBuffer(U.ARRAY_BUFFER,a.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,w,b)}if(A){for(e=0;e<u;e++)i=r[e],g=e*3,x[g]=i.x,x[g+1]=i.y,x[g+2]=i.z;U.bindBuffer(U.ARRAY_BUFFER,a.__webglNormalBuffer),U.bufferData(U.ARRAY_BUFFER,x,b)}if(B)for(j=0,k=B.length;j<k;j++){n=B[j];if(n.needsUpdate&&(n.boundTo===undefined||n.boundTo==="vertices")){g=0,m=n.value.length;if(n.size===1)for(l=0;l<m;l++)n.array[l]=n.value[l];else if(n.size===2)for(l=0;l<m;l++)o=n.value[l],n.array[g]=o.x,n.array[g+1]=o.y,g+=2;else if(n.size===3)if(n.type==="c")for(l=0;l<m;l++)o=n.value[l],n.array[g]=o.r,n.array[g+1]=o.g,n.array[g+2]=o.b,g+=3;else for(l=0;l<m;l++)o=n.value[l],n.array[g]=o.x,n.array[g+1]=o.y,n.array[g+2]=o.z,g+=3;else if(n.size===4)for(l=0;l<m;l++)o=n.value[l],n.array[g]=o.x,n.array[g+1]=o.y,n.array[g+2]=o.z,n.array[g+3]=o.w,g+=4;U.bindBuffer(U.ARRAY_BUFFER,n.buffer),U.bufferData(U.ARRAY_BUFFER,n.array,b)}}}function Cb(b,c,d,e,f){if(!b.__inittedArrays)return;var g=vb(f),h=wb(f),i=xb(f),j=g===a.SmoothShading,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb=0,qb=0,rb=0,sb=0,tb=0,ub=0,yb=0,zb=0,Ab=0,Bb=0,Cb=0,Db=0,Eb=0,Fb,Gb=b.__vertexArray,Hb=b.__uvArray,Ib=b.__uv2Array,Jb=b.__normalArray,Kb=b.__tangentArray,Lb=b.__colorArray,Mb=b.__skinIndexArray,Nb=b.__skinWeightArray,Ob=b.__morphTargetsArrays,Pb=b.__morphNormalsArrays,Qb=b.__webglCustomAttributesList,Rb,Sb=b.__faceArray,Tb=b.__lineArray,Ub=c.geometry,Vb=Ub.verticesNeedUpdate,Wb=Ub.elementsNeedUpdate,Xb=Ub.uvsNeedUpdate,Yb=Ub.normalsNeedUpdate,Zb=Ub.tangentsNeedUpdate,$b=Ub.colorsNeedUpdate,_b=Ub.morphTargetsNeedUpdate,ac=Ub.vertices,bc=b.faces3,cc=b.faces4,dc=Ub.faces,ec=Ub.faceVertexUvs[0],fc=Ub.faceVertexUvs[1],gc=Ub.colors,hc=Ub.skinIndices,ic=Ub.skinWeights,jc=Ub.morphTargets,kc=Ub.morphNormals;if(Vb){for(k=0,l=bc.length;k<l;k++)n=dc[bc[k]],w=ac[n.a],x=ac[n.b],y=ac[n.c],Gb[qb]=w.x,Gb[qb+1]=w.y,Gb[qb+2]=w.z,Gb[qb+3]=x.x,Gb[qb+4]=x.y,Gb[qb+5]=x.z,Gb[qb+6]=y.x,Gb[qb+7]=y.y,Gb[qb+8]=y.z,qb+=9;for(k=0,l=cc.length;k<l;k++)n=dc[cc[k]],w=ac[n.a],x=ac[n.b],y=ac[n.c],z=ac[n.d],Gb[qb]=w.x,Gb[qb+1]=w.y,Gb[qb+2]=w.z,Gb[qb+3]=x.x,Gb[qb+4]=x.y,Gb[qb+5]=x.z,Gb[qb+6]=y.x,Gb[qb+7]=y.y,Gb[qb+8]=y.z,Gb[qb+9]=z.x,Gb[qb+10]=z.y,Gb[qb+11]=z.z,qb+=12;U.bindBuffer(U.ARRAY_BUFFER,b.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,Gb,d)}if(_b)for(ib=0,jb=jc.length;ib<jb;ib++){Cb=0;for(k=0,l=bc.length;k<l;k++)mb=bc[k],n=dc[mb],w=jc[ib].vertices[n.a],x=jc[ib].vertices[n.b],y=jc[ib].vertices[n.c],kb=Ob[ib],kb[Cb]=w.x,kb[Cb+1]=w.y,kb[Cb+2]=w.z,kb[Cb+3]=x.x,kb[Cb+4]=x.y,kb[Cb+5]=x.z,kb[Cb+6]=y.x,kb[Cb+7]=y.y,kb[Cb+8]=y.z,f.morphNormals&&(j?(nb=kc[ib].vertexNormals[mb],E=nb.a,F=nb.b,G=nb.c):(E=kc[ib].faceNormals[mb],F=E,G=E),lb=Pb[ib],lb[Cb]=E.x,lb[Cb+1]=E.y,lb[Cb+2]=E.z,lb[Cb+3]=F.x,lb[Cb+4]=F.y,lb[Cb+5]=F.z,lb[Cb+6]=G.x,lb[Cb+7]=G.y,lb[Cb+8]=G.z),Cb+=9;for(k=0,l=cc.length;k<l;k++)mb=cc[k],n=dc[mb],w=jc[ib].vertices[n.a],x=jc[ib].vertices[n.b],y=jc[ib].vertices[n.c],z=jc[ib].vertices[n.d],kb=Ob[ib],kb[Cb]=w.x,kb[Cb+1]=w.y,kb[Cb+2]=w.z,kb[Cb+3]=x.x,kb[Cb+4]=x.y,kb[Cb+5]=x.z,kb[Cb+6]=y.x,kb[Cb+7]=y.y,kb[Cb+8]=y.z,kb[Cb+9]=z.x,kb[Cb+10]=z.y,kb[Cb+11]=z.z,f.morphNormals&&(j?(nb=kc[ib].vertexNormals[mb],E=nb.a,F=nb.b,G=nb.c,H=nb.d):(E=kc[ib].faceNormals[mb],F=E,G=E,H=E),lb=Pb[ib],lb[Cb]=E.x,lb[Cb+1]=E.y,lb[Cb+2]=E.z,lb[Cb+3]=F.x,lb[Cb+4]=F.y,lb[Cb+5]=F.z,lb[Cb+6]=G.x,lb[Cb+7]=G.y,lb[Cb+8]=G.z,lb[Cb+9]=H.x,lb[Cb+10]=H.y,lb[Cb+11]=H.z),Cb+=12;U.bindBuffer(U.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[ib]),U.bufferData(U.ARRAY_BUFFER,Ob[ib],d),f.morphNormals&&(U.bindBuffer(U.ARRAY_BUFFER,b.__webglMorphNormalsBuffers[ib]),U.bufferData(U.ARRAY_BUFFER,Pb[ib],d))}if(ic.length){for(k=0,l=bc.length;k<l;k++)n=dc[bc[k]],M=ic[n.a],N=ic[n.b],O=ic[n.c],Nb[Bb]=M.x,Nb[Bb+1]=M.y,Nb[Bb+2]=M.z,Nb[Bb+3]=M.w,Nb[Bb+4]=N.x,Nb[Bb+5]=N.y,Nb[Bb+6]=N.z,Nb[Bb+7]=N.w,Nb[Bb+8]=O.x,Nb[Bb+9]=O.y,Nb[Bb+10]=O.z,Nb[Bb+11]=O.w,Q=hc[n.a],R=hc[n.b],S=hc[n.c],Mb[Bb]=Q.x,Mb[Bb+1]=Q.y,Mb[Bb+2]=Q.z,Mb[Bb+3]=Q.w,Mb[Bb+4]=R.x,Mb[Bb+5]=R.y,Mb[Bb+6]=R.z,Mb[Bb+7]=R.w,Mb[Bb+8]=S.x,Mb[Bb+9]=S.y,Mb[Bb+10]=S.z,Mb[Bb+11]=S.w,Bb+=12;for(k=0,l=cc.length;k<l;k++)n=dc[cc[k]],M=ic[n.a],N=ic[n.b],O=ic[n.c],P=ic[n.d],Nb[Bb]=M.x,Nb[Bb+1]=M.y,Nb[Bb+2]=M.z,Nb[Bb+3]=M.w,Nb[Bb+4]=N.x,Nb[Bb+5]=N.y,Nb[Bb+6]=N.z,Nb[Bb+7]=N.w,Nb[Bb+8]=O.x,Nb[Bb+9]=O.y,Nb[Bb+10]=O.z,Nb[Bb+11]=O.w,Nb[Bb+12]=P.x,Nb[Bb+13]=P.y,Nb[Bb+14]=P.z,Nb[Bb+15]=P.w,Q=hc[n.a],R=hc[n.b],S=hc[n.c],T=hc[n.d],Mb[Bb]=Q.x,Mb[Bb+1]=Q.y,Mb[Bb+2]=Q.z,Mb[Bb+3]=Q.w,Mb[Bb+4]=R.x,Mb[Bb+5]=R.y,Mb[Bb+6]=R.z,Mb[Bb+7]=R.w,Mb[Bb+8]=S.x,Mb[Bb+9]=S.y,Mb[Bb+10]=S.z,Mb[Bb+11]=S.w,Mb[Bb+12]=T.x,Mb[Bb+13]=T.y,Mb[Bb+14]=T.z,Mb[Bb+15]=T.w,Bb+=16;Bb>0&&(U.bindBuffer(U.ARRAY_BUFFER,b.__webglSkinIndicesBuffer),U.bufferData(U.ARRAY_BUFFER,Mb,d),U.bindBuffer(U.ARRAY_BUFFER,b.__webglSkinWeightsBuffer),U.bufferData(U.ARRAY_BUFFER,Nb,d))}if($b&&h){for(k=0,l=bc.length;k<l;k++)n=dc[bc[k]],r=n.vertexColors,s=n.color,r.length===3&&h===a.VertexColors?(I=r[0],J=r[1],K=r[2]):(I=s,J=s,K=s),Lb[Ab]=I.r,Lb[Ab+1]=I.g,Lb[Ab+2]=I.b,Lb[Ab+3]=J.r,Lb[Ab+4]=J.g,Lb[Ab+5]=J.b,Lb[Ab+6]=K.r,Lb[Ab+7]=K.g,Lb[Ab+8]=K.b,Ab+=9;for(k=0,l=cc.length;k<l;k++)n=dc[cc[k]],r=n.vertexColors,s=n.color,r.length===4&&h===a.VertexColors?(I=r[0],J=r[1],K=r[2],L=r[3]):(I=s,J=s,K=s,L=s),Lb[Ab]=I.r,Lb[Ab+1]=I.g,Lb[Ab+2]=I.b,Lb[Ab+3]=J.r,Lb[Ab+4]=J.g,Lb[Ab+5]=J.b,Lb[Ab+6]=K.r,Lb[Ab+7]=K.g,Lb[Ab+8]=K.b,Lb[Ab+9]=L.r,Lb[Ab+10]=L.g,Lb[Ab+11]=L.b,Ab+=12;Ab>0&&(U.bindBuffer(U.ARRAY_BUFFER,b.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,Lb,d))}if(Zb&&Ub.hasTangents){for(k=0,l=bc.length;k<l;k++)n=dc[bc[k]],t=n.vertexTangents,A=t[0],B=t[1],C=t[2],Kb[yb]=A.x,Kb[yb+1]=A.y,Kb[yb+2]=A.z,Kb[yb+3]=A.w,Kb[yb+4]=B.x,Kb[yb+5]=B.y,Kb[yb+6]=B.z,Kb[yb+7]=B.w,Kb[yb+8]=C.x,Kb[yb+9]=C.y,Kb[yb+10]=C.z,Kb[yb+11]=C.w,yb+=12;for(k=0,l=cc.length;k<l;k++)n=dc[cc[k]],t=n.vertexTangents,A=t[0],B=t[1],C=t[2],D=t[3],Kb[yb]=A.x,Kb[yb+1]=A.y,Kb[yb+2]=A.z,Kb[yb+3]=A.w,Kb[yb+4]=B.x,Kb[yb+5]=B.y,Kb[yb+6]=B.z,Kb[yb+7]=B.w,Kb[yb+8]=C.x,Kb[yb+9]=C.y,Kb[yb+10]=C.z,Kb[yb+11]=C.w,Kb[yb+12]=D.x,Kb[yb+13]=D.y,Kb[yb+14]=D.z,Kb[yb+15]=D.w,yb+=16;U.bindBuffer(U.ARRAY_BUFFER,b.__webglTangentBuffer),U.bufferData(U.ARRAY_BUFFER,Kb,d)}if(Yb&&g){for(k=0,l=bc.length;k<l;k++){n=dc[bc[k]],o=n.vertexNormals,p=n.normal;if(o.length===3&&j)for(db=0;db<3;db++)fb=o[db],Jb[ub]=fb.x,Jb[ub+1]=fb.y,Jb[ub+2]=fb.z,ub+=3;else for(db=0;db<3;db++)Jb[ub]=p.x,Jb[ub+1]=p.y,Jb[ub+2]=p.z,ub+=3}for(k=0,l=cc.length;k<l;k++){n=dc[cc[k]],o=n.vertexNormals,p=n.normal;if(o.length===4&&j)for(db=0;db<4;db++)fb=o[db],Jb[ub]=fb.x,Jb[ub+1]=fb.y,Jb[ub+2]=fb.z,ub+=3;else for(db=0;db<4;db++)Jb[ub]=p.x,Jb[ub+1]=p.y,Jb[ub+2]=p.z,ub+=3}U.bindBuffer(U.ARRAY_BUFFER,b.__webglNormalBuffer),U.bufferData(U.ARRAY_BUFFER,Jb,d)}if(Xb&&ec&&i){for(k=0,l=bc.length;k<l;k++){m=bc[k],u=ec[m];if(u===undefined)continue;for(db=0;db<3;db++)gb=u[db],Hb[rb]=gb.u,Hb[rb+1]=gb.v,rb+=2}for(k=0,l=cc.length;k<l;k++){m=cc[k],u=ec[m];if(u===undefined)continue;for(db=0;db<4;db++)gb=u[db],Hb[rb]=gb.u,Hb[rb+1]=gb.v,rb+=2}rb>0&&(U.bindBuffer(U.ARRAY_BUFFER,b.__webglUVBuffer),U.bufferData(U.ARRAY_BUFFER,Hb,d))}if(Xb&&fc&&i){for(k=0,l=bc.length;k<l;k++){m=bc[k],v=fc[m];if(v===undefined)continue;for(db=0;db<3;db++)hb=v[db],Ib[sb]=hb.u,Ib[sb+1]=hb.v,sb+=2}for(k=0,l=cc.length;k<l;k++){m=cc[k],v=fc[m];if(v===undefined)continue;for(db=0;db<4;db++)hb=v[db],Ib[sb]=hb.u,Ib[sb+1]=hb.v,sb+=2}sb>0&&(U.bindBuffer(U.ARRAY_BUFFER,b.__webglUV2Buffer),U.bufferData(U.ARRAY_BUFFER,Ib,d))}if(Wb){for(k=0,l=bc.length;k<l;k++)Sb[tb]=pb,Sb[tb+1]=pb+1,Sb[tb+2]=pb+2,tb+=3,Tb[zb]=pb,Tb[zb+1]=pb+1,Tb[zb+2]=pb,Tb[zb+3]=pb+2,Tb[zb+4]=pb+1,Tb[zb+5]=pb+2,zb+=6,pb+=3;for(k=0,l=cc.length;k<l;k++)Sb[tb]=pb,Sb[tb+1]=pb+1,Sb[tb+2]=pb+3,Sb[tb+3]=pb+1,Sb[tb+4]=pb+2,Sb[tb+5]=pb+3,tb+=6,Tb[zb]=pb,Tb[zb+1]=pb+1,Tb[zb+2]=pb,Tb[zb+3]=pb+3,Tb[zb+4]=pb+1,Tb[zb+5]=pb+2,Tb[zb+6]=pb+2,Tb[zb+7]=pb+3,zb+=8,pb+=4;U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,b.__webglFaceBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,Sb,d),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,b.__webglLineBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,Tb,d)}if(Qb)for(db=0,eb=Qb.length;db<eb;db++){Rb=Qb[db];if(!Rb.__original.needsUpdate)continue;Db=0,Eb=0;if(Rb.size===1){if(Rb.boundTo===undefined||Rb.boundTo==="vertices"){for(k=0,l=bc.length;k<l;k++)n=dc[bc[k]],Rb.array[Db]=Rb.value[n.a],Rb.array[Db+1]=Rb.value[n.b],Rb.array[Db+2]=Rb.value[n.c],Db+=3;for(k=0,l=cc.length;k<l;k++)n=dc[cc[k]],Rb.array[Db]=Rb.value[n.a],Rb.array[Db+1]=Rb.value[n.b],Rb.array[Db+2]=Rb.value[n.c],Rb.array[Db+3]=Rb.value[n.d],Db+=4}else if(Rb.boundTo==="faces"){for(k=0,l=bc.length;k<l;k++)Fb=Rb.value[bc[k]],Rb.array[Db]=Fb,Rb.array[Db+1]=Fb,Rb.array[Db+2]=Fb,Db+=3;for(k=0,l=cc.length;k<l;k++)Fb=Rb.value[cc[k]],Rb.array[Db]=Fb,Rb.array[Db+1]=Fb,Rb.array[Db+2]=Fb,Rb.array[Db+3]=Fb,Db+=4}}else if(Rb.size===2){if(Rb.boundTo===undefined||Rb.boundTo==="vertices"){for(k=0,l=bc.length;k<l;k++)n=dc[bc[k]],w=Rb.value[n.a],x=Rb.value[n.b],y=Rb.value[n.c],Rb.array[Db]=w.x,Rb.array[Db+1]=w.y,Rb.array[Db+2]=x.x,Rb.array[Db+3]=x.y,Rb.array[Db+4]=y.x,Rb.array[Db+5]=y.y,Db+=6;for(k=0,l=cc.length;k<l;k++)n=dc[cc[k]],w=Rb.value[n.a],x=Rb.value[n.b],y=Rb.value[n.c],z=Rb.value[n.d],Rb.array[Db]=w.x,Rb.array[Db+1]=w.y,Rb.array[Db+2]=x.x,Rb.array[Db+3]=x.y,Rb.array[Db+4]=y.x,Rb.array[Db+5]=y.y,Rb.array[Db+6]=z.x,Rb.array[Db+7]=z.y,Db+=8}else if(Rb.boundTo==="faces"){for(k=0,l=bc.length;k<l;k++)Fb=Rb.value[bc[k]],w=Fb,x=Fb,y=Fb,Rb.array[Db]=w.x,Rb.array[Db+1]=w.y,Rb.array[Db+2]=x.x,Rb.array[Db+3]=x.y,Rb.array[Db+4]=y.x,Rb.array[Db+5]=y.y,Db+=6;for(k=0,l=cc.length;k<l;k++)Fb=Rb.value[cc[k]],w=Fb,x=Fb,y=Fb,z=Fb,Rb.array[Db]=w.x,Rb.array[Db+1]=w.y,Rb.array[Db+2]=x.x,Rb.array[Db+3]=x.y,Rb.array[Db+4]=y.x,Rb.array[Db+5]=y.y,Rb.array[Db+6]=z.x,Rb.array[Db+7]=z.y,Db+=8}}else if(Rb.size===3){var lc;Rb.type==="c"?lc=["r","g","b"]:lc=["x","y","z"];if(Rb.boundTo===undefined||Rb.boundTo==="vertices"){for(k=0,l=bc.length;k<l;k++)n=dc[bc[k]],w=Rb.value[n.a],x=Rb.value[n.b],y=Rb.value[n.c],Rb.array[Db]=w[lc[0]],Rb.array[Db+1]=w[lc[1]],Rb.array[Db+2]=w[lc[2]],Rb.array[Db+3]=x[lc[0]],Rb.array[Db+4]=x[lc[1]],Rb.array[Db+5]=x[lc[2]],Rb.array[Db+6]=y[lc[0]],Rb.array[Db+7]=y[lc[1]],Rb.array[Db+8]=y[lc[2]],Db+=9;for(k=0,l=cc.length;k<l;k++)n=dc[cc[k]],w=Rb.value[n.a],x=Rb.value[n.b],y=Rb.value[n.c],z=Rb.value[n.d],Rb.array[Db]=w[lc[0]],Rb.array[Db+1]=w[lc[1]],Rb.array[Db+2]=w[lc[2]],Rb.array[Db+3]=x[lc[0]],Rb.array[Db+4]=x[lc[1]],Rb.array[Db+5]=x[lc[2]],Rb.array[Db+6]=y[lc[0]],Rb.array[Db+7]=y[lc[1]],Rb.array[Db+8]=y[lc[2]],Rb.array[Db+9]=z[lc[0]],Rb.array[Db+10]=z[lc[1]],Rb.array[Db+11]=z[lc[2]],Db+=12}else if(Rb.boundTo==="faces"){for(k=0,l=bc.length;k<l;k++)Fb=Rb.value[bc[k]],w=Fb,x=Fb,y=Fb,Rb.array[Db]=w[lc[0]],Rb.array[Db+1]=w[lc[1]],Rb.array[Db+2]=w[lc[2]],Rb.array[Db+3]=x[lc[0]],Rb.array[Db+4]=x[lc[1]],Rb.array[Db+5]=x[lc[2]],Rb.array[Db+6]=y[lc[0]],Rb.array[Db+7]=y[lc[1]],Rb.array[Db+8]=y[lc[2]],Db+=9;for(k=0,l=cc.length;k<l;k++)Fb=Rb.value[cc[k]],w=Fb,x=Fb,y=Fb,z=Fb,Rb.array[Db]=w[lc[0]],Rb.array[Db+1]=w[lc[1]],Rb.array[Db+2]=w[lc[2]],Rb.array[Db+3]=x[lc[0]],Rb.array[Db+4]=x[lc[1]],Rb.array[Db+5]=x[lc[2]],Rb.array[Db+6]=y[lc[0]],Rb.array[Db+7]=y[lc[1]],Rb.array[Db+8]=y[lc[2]],Rb.array[Db+9]=z[lc[0]],Rb.array[Db+10]=z[lc[1]],Rb.array[Db+11]=z[lc[2]],Db+=12}else if(Rb.boundTo==="faceVertices"){for(k=0,l=bc.length;k<l;k++)Fb=Rb.value[bc[k]],w=Fb[0],x=Fb[1],y=Fb[2],Rb.array[Db]=w[lc[0]],Rb.array[Db+1]=w[lc[1]],Rb.array[Db+2]=w[lc[2]],Rb.array[Db+3]=x[lc[0]],Rb.array[Db+4]=x[lc[1]],Rb.array[Db+5]=x[lc[2]],Rb.array[Db+6]=y[lc[0]],Rb.array[Db+7]=y[lc[1]],Rb.array[Db+8]=y[lc[2]],Db+=9;for(k=0,l=cc.length;k<l;k++)Fb=Rb.value[cc[k]],w=Fb[0],x=Fb[1],y=Fb[2],z=Fb[3],Rb.array[Db]=w[lc[0]],Rb.array[Db+1]=w[lc[1]],Rb.array[Db+2]=w[lc[2]],Rb.array[Db+3]=x[lc[0]],Rb.array[Db+4]=x[lc[1]],Rb.array[Db+5]=x[lc[2]],Rb.array[Db+6]=y[lc[0]],Rb.array[Db+7]=y[lc[1]],Rb.array[Db+8]=y[lc[2]],Rb.array[Db+9]=z[lc[0]],Rb.array[Db+10]=z[lc[1]],Rb.array[Db+11]=z[lc[2]],Db+=12}}else if(Rb.size===4)if(Rb.boundTo===undefined||Rb.boundTo==="vertices"){for(k=0,l=bc.length;k<l;k++)n=dc[bc[k]],w=Rb.value[n.a],x=Rb.value[n.b],y=Rb.value[n.c],Rb.array[Db]=w.x,Rb.array[Db+1]=w.y,Rb.array[Db+2]=w.z,Rb.array[Db+3]=w.w,Rb.array[Db+4]=x.x,Rb.array[Db+5]=x.y,Rb.array[Db+6]=x.z,Rb.array[Db+7]=x.w,Rb.array[Db+8]=y.x,Rb.array[Db+9]=y.y,Rb.array[Db+10]=y.z,Rb.array[Db+11]=y.w,Db+=12;for(k=0,l=cc.length;k<l;k++)n=dc[cc[k]],w=Rb.value[n.a],x=Rb.value[n.b],y=Rb.value[n.c],z=Rb.value[n.d],Rb.array[Db]=w.x,Rb.array[Db+1]=w.y,Rb.array[Db+2]=w.z,Rb.array[Db+3]=w.w,Rb.array[Db+4]=x.x,Rb.array[Db+5]=x.y,Rb.array[Db+6]=x.z,Rb.array[Db+7]=x.w,Rb.array[Db+8]=y.x,Rb.array[Db+9]=y.y,Rb.array[Db+10]=y.z,Rb.array[Db+11]=y.w,Rb.array[Db+12]=z.x,Rb.array[Db+13]=z.y,Rb.array[Db+14]=z.z,Rb.array[Db+15]=z.w,Db+=16}else if(Rb.boundTo==="faces"){for(k=0,l=bc.length;k<l;k++)Fb=Rb.value[bc[k]],w=Fb,x=Fb,y=Fb,Rb.array[Db]=w.x,Rb.array[Db+1]=w.y,Rb.array[Db+2]=w.z,Rb.array[Db+3]=w.w,Rb.array[Db+4]=x.x,Rb.array[Db+5]=x.y,Rb.array[Db+6]=x.z,Rb.array[Db+7]=x.w,Rb.array[Db+8]=y.x,Rb.array[Db+9]=y.y,Rb.array[Db+10]=y.z,Rb.array[Db+11]=y.w,Db+=12;for(k=0,l=cc.length;k<l;k++)Fb=Rb.value[cc[k]],w=Fb,x=Fb,y=Fb,z=Fb,Rb.array[Db]=w.x,Rb.array[Db+1]=w.y,Rb.array[Db+2]=w.z,Rb.array[Db+3]=w.w,Rb.array[Db+4]=x.x,Rb.array[Db+5]=x.y,Rb.array[Db+6]=x.z,Rb.array[Db+7]=x.w,Rb.array[Db+8]=y.x,Rb.array[Db+9]=y.y,Rb.array[Db+10]=y.z,Rb.array[Db+11]=y.w,Rb.array[Db+12]=z.x,Rb.array[Db+13]=z.y,Rb.array[Db+14]=z.z,Rb.array[Db+15]=z.w,Db+=16}else if(Rb.boundTo==="faceVertices"){for(k=0,l=bc.length;k<l;k++)Fb=Rb.value[bc[k]],w=Fb[0],x=Fb[1],y=Fb[2],Rb.array[Db]=w.x,Rb.array[Db+1]=w.y,Rb.array[Db+2]=w.z,Rb.array[Db+3]=w.w,Rb.array[Db+4]=x.x,Rb.array[Db+5]=x.y,Rb.array[Db+6]=x.z,Rb.array[Db+7]=x.w,Rb.array[Db+8]=y.x,Rb.array[Db+9]=y.y,Rb.array[Db+10]=y.z,Rb.array[Db+11]=y.w,Db+=12;for(k=0,l=cc.length;k<l;k++)Fb=Rb.value[cc[k]],w=Fb[0],x=Fb[1],y=Fb[2],z=Fb[3],Rb.array[Db]=w.x,Rb.array[Db+1]=w.y,Rb.array[Db+2]=w.z,Rb.array[Db+3]=w.w,Rb.array[Db+4]=x.x,Rb.array[Db+5]=x.y,Rb.array[Db+6]=x.z,Rb.array[Db+7]=x.w,Rb.array[Db+8]=y.x,Rb.array[Db+9]=y.y,Rb.array[Db+10]=y.z,Rb.array[Db+11]=y.w,Rb.array[Db+12]=z.x,Rb.array[Db+13]=z.y,Rb.array[Db+14]=z.z,Rb.array[Db+15]=z.w,Db+=16}U.bindBuffer(U.ARRAY_BUFFER,Rb.buffer),U.bufferData(U.ARRAY_BUFFER,Rb.array,d)}e&&(delete b.__inittedArrays,delete b.__colorArray,delete b.__normalArray,delete b.__tangentArray,delete b.__uvArray,delete b.__uv2Array,delete b.__faceArray,delete b.__vertexArray,delete b.__lineArray,delete b.__skinIndexArray,delete b.__skinWeightArray)}function Db(a,b,c){var d=a.attributes,e=d.index,f=d.position,g=d.normal,h=d.uv,i=d.color,j=d.tangent;a.elementsNeedUpdate&&e!==undefined&&(U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,e.buffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,e.array,b)),a.verticesNeedUpdate&&f!==undefined&&(U.bindBuffer(U.ARRAY_BUFFER,f.buffer),U.bufferData(U.ARRAY_BUFFER,f.array,b)),a.normalsNeedUpdate&&g!==undefined&&(U.bindBuffer(U.ARRAY_BUFFER,g.buffer),U.bufferData(U.ARRAY_BUFFER,g.array,b)),a.uvsNeedUpdate&&h!==undefined&&(U.bindBuffer(U.ARRAY_BUFFER,h.buffer),U.bufferData(U.ARRAY_BUFFER,h.array,b)),a.colorsNeedUpdate&&i!==undefined&&(U.bindBuffer(U.ARRAY_BUFFER,i.buffer),U.bufferData(U.ARRAY_BUFFER,i.array,b)),a.tangentsNeedUpdate&&j!==undefined&&(U.bindBuffer(U.ARRAY_BUFFER,j.buffer),U.bufferData(U.ARRAY_BUFFER,j.array,b));if(c)for(var k in a.attributes)delete a.attributes[k].array}function Eb(a,b,c){var d=a.program.attributes;c.morphTargetBase!==-1?(U.bindBuffer(U.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[c.morphTargetBase]),U.vertexAttribPointer(d.position,3,U.FLOAT,!1,0,0)):d.position>=0&&(U.bindBuffer(U.ARRAY_BUFFER,b.__webglVertexBuffer),U.vertexAttribPointer(d.position,3,U.FLOAT,!1,0,0));if(c.morphTargetForcedOrder.length){var e=0,f=c.morphTargetForcedOrder,g=c.morphTargetInfluences;while(e<a.numSupportedMorphTargets&&e<f.length)U.bindBuffer(U.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[f[e]]),U.vertexAttribPointer(d["morphTarget"+e],3,U.FLOAT,!1,0,0),a.morphNormals&&(U.bindBuffer(U.ARRAY_BUFFER,b.__webglMorphNormalsBuffers[f[e]]),U.vertexAttribPointer(d["morphNormal"+e],3,U.FLOAT,!1,0,0)),c.__webglMorphTargetInfluences[e]=g[f[e]],e++}else{var h,i=[],g=c.morphTargetInfluences,j,k=g.length;for(j=0;j<k;j++)h=g[j],h>0&&i.push([j,h]);i.length>a.numSupportedMorphTargets?(i.sort(Gb),i.length=a.numSupportedMorphTargets):i.length>a.numSupportedMorphNormals?i.sort(Gb):i.length===0&&i.push([0,0]);var l,e=0;while(e<a.numSupportedMorphTargets)i[e]?(l=i[e][0],U.bindBuffer(U.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[l]),U.vertexAttribPointer(d["morphTarget"+e],3,U.FLOAT,!1,0,0),a.morphNormals&&(U.bindBuffer(U.ARRAY_BUFFER,b.__webglMorphNormalsBuffers[l]),U.vertexAttribPointer(d["morphNormal"+e],3,U.FLOAT,!1,0,0)),c.__webglMorphTargetInfluences[e]=g[l]):(U.vertexAttribPointer(d["morphTarget"+e],3,U.FLOAT,!1,0,0),a.morphNormals&&U.vertexAttribPointer(d["morphNormal"+e],3,U.FLOAT,!1,0,0),c.__webglMorphTargetInfluences[e]=0),e++}a.program.uniforms.morphTargetInfluences!==null&&U.uniform1fv(a.program.uniforms.morphTargetInfluences,c.__webglMorphTargetInfluences)}function Fb(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}function Gb(a,b){return b[1]-a[1]}function Hb(a,b,c){if(!a.length)return;for(var d=0,e=a.length;d<e;d++)o=null,s=null,x=-1,B=-1,C=-1,v=-1,w=-1,r=-1,q=-1,S=!0,a[d].render(b,c,L,M),o=null,s=null,x=-1,B=-1,C=-1,v=-1,w=-1,r=-1,q=-1,S=!0}function Ib(b,c,d,e,f,g,h,i){var j,k,m,n,o,p,q;c?(o=b.length-1,p=-1,q=-1):(o=0,p=b.length,q=1);for(var r=o;r!==p;r+=q){j=b[r];if(j.render){k=j.object,m=j.buffer;if(i)n=i;else{n=j[d];if(!n)continue;h&&l.setBlending(n.blending,n.blendEquation,n.blendSrc,n.blendDst),l.setDepthTest(n.depthTest),l.setDepthWrite(n.depthWrite),nc(n.polygonOffset,n.polygonOffsetFactor,n.polygonOffsetUnits)}l.setMaterialFaces(n),m instanceof a.BufferGeometry?l.renderBufferDirect(e,f,g,n,m,k):l.renderBuffer(e,f,g,n,m,k)}}}function Jb(a,b,c,d,e,f,g){var h,i,j,k;for(var m=0,n=a.length;m<n;m++){h=a[m],i=h.object;if(i.visible){if(g)j=g;else{j=h[b];if(!j)continue;f&&l.setBlending(j.blending,j.blendEquation,j.blendSrc,j.blendDst),l.setDepthTest(j.depthTest),l.setDepthWrite(j.depthWrite),nc(j.polygonOffset,j.polygonOffsetFactor,j.polygonOffsetUnits)}l.renderImmediateObject(c,d,e,j,i)}}}function Kb(a){var b=a.object,c=b.material;c.transparent?(a.transparent=c,a.opaque=null):(a.opaque=c,a.transparent=null)}function Lb(b){var c=b.object,d=b.buffer,e,f,g;g=c.material,g instanceof a.MeshFaceMaterial?(f=d.materialIndex,f>=0&&(e=g.materials[f],e.transparent?(b.transparent=e,b.opaque=null):(b.opaque=e,b.transparent=null))):(e=g,e&&(e.transparent?(b.transparent=e,b.opaque=null):(b.opaque=e,b.transparent=null)))}function Mb(b,c){var d,e,f,g,h,i,j,k={},l=b.morphTargets.length,m=b.morphNormals.length,n=c instanceof a.MeshFaceMaterial;b.geometryGroups={};for(d=0,e=b.faces.length;d<e;d++)f=b.faces[d],g=n?f.materialIndex:undefined,i=g!==undefined?g:-1,k[i]===undefined&&(k[i]={hash:i,counter:0}),j=k[i].hash+"_"+k[i].counter,b.geometryGroups[j]===undefined&&(b.geometryGroups[j]={faces3:[],faces4:[],materialIndex:g,vertices:0,numMorphTargets:l,numMorphNormals:m}),h=f instanceof a.Face3?3:4,b.geometryGroups[j].vertices+h>65535&&(k[i].counter+=1,j=k[i].hash+"_"+k[i].counter,b.geometryGroups[j]===undefined&&(b.geometryGroups[j]={faces3:[],faces4:[],materialIndex:g,vertices:0,numMorphTargets:l,numMorphNormals:m})),f instanceof a.Face3?b.geometryGroups[j].faces3.push(d):b.geometryGroups[j].faces4.push(d),b.geometryGroups[j].vertices+=h;b.geometryGroupsList=[];for(var o in b.geometryGroups)b.geometryGroups[o].id=t++,b.geometryGroupsList.push(b.geometryGroups[o])}function Nb(b,c){var d,e,f,g;if(!b.__webglInit){b.__webglInit=!0,b._modelViewMatrix=new a.Matrix4,b._normalMatrix=new a.Matrix3;if(b instanceof a.Mesh){e=b.geometry,f=b.material;if(e instanceof a.Geometry){e.geometryGroups===undefined&&Mb(e,f);for(d in e.geometryGroups)g=e.geometryGroups[d],g.__webglVertexBuffer||(ib(g),sb(g,b),e.verticesNeedUpdate=!0,e.morphTargetsNeedUpdate=!0,e.elementsNeedUpdate=!0,e.uvsNeedUpdate=!0,e.normalsNeedUpdate=!0,e.tangentsNeedUpdate=!0,e.colorsNeedUpdate=!0)}else e instanceof a.BufferGeometry&&yb(e)}else b instanceof a.Ribbon?(e=b.geometry,e.__webglVertexBuffer||(hb(e),rb(e,b),e.verticesNeedUpdate=!0,e.colorsNeedUpdate=!0,e.normalsNeedUpdate=!0)):b instanceof a.Line?(e=b.geometry,e.__webglVertexBuffer||(gb(e),qb(e,b),e.verticesNeedUpdate=!0,e.colorsNeedUpdate=!0,e.lineDistancesNeedUpdate=!0)):b instanceof a.ParticleSystem&&(e=b.geometry,e.__webglVertexBuffer||(e instanceof a.Geometry?(fb(e),pb(e,b),e.verticesNeedUpdate=!0,e.colorsNeedUpdate=!0):e instanceof a.BufferGeometry&&yb(e)))}if(!b.__webglActive){if(b instanceof a.Mesh){e=b.geometry;if(e instanceof a.BufferGeometry)Ob(c.__webglObjects,e,b);else for(d in e.geometryGroups)g=e.geometryGroups[d],Ob(c.__webglObjects,g,b)}else b instanceof a.Ribbon||b instanceof a.Line||b instanceof a.ParticleSystem?(e=b.geometry,Ob(c.__webglObjects,e,b)):b instanceof a.ImmediateRenderObject||b.immediateRenderCallback?Pb(c.__webglObjectsImmediate,b):b instanceof a.Sprite?c.__webglSprites.push(b):b instanceof a.LensFlare&&c.__webglFlares.push(b);b.__webglActive=!0}}function Ob(a,b,c){a.push({buffer:b,object:c,opaque:null,transparent:null})}function Pb(a,b){a.push({object:b,opaque:null,transparent:null})}function Qb(b){var c=b.geometry,d,e,f;if(b instanceof a.Mesh)if(c instanceof a.BufferGeometry)(c.verticesNeedUpdate||c.elementsNeedUpdate||c.uvsNeedUpdate||c.normalsNeedUpdate||c.colorsNeedUpdate||c.tangentsNeedUpdate)&&Db(c,U.DYNAMIC_DRAW,!c.dynamic),c.verticesNeedUpdate=!1,c.elementsNeedUpdate=!1,c.uvsNeedUpdate=!1,c.normalsNeedUpdate=!1,c.colorsNeedUpdate=!1,c.tangentsNeedUpdate=!1;else{for(var g=0,h=c.geometryGroupsList.length;g<h;g++)d=c.geometryGroupsList[g],f=tb(b,d),c.buffersNeedUpdate&&sb(d,b),e=f.attributes&&Rb(f),(c.verticesNeedUpdate||c.morphTargetsNeedUpdate||c.elementsNeedUpdate||c.uvsNeedUpdate||c.normalsNeedUpdate||c.colorsNeedUpdate||c.tangentsNeedUpdate||e)&&Cb(d,b,U.DYNAMIC_DRAW,!c.dynamic,f);c.verticesNeedUpdate=!1,c.morphTargetsNeedUpdate=!1,c.elementsNeedUpdate=!1,c.uvsNeedUpdate=!1,c.normalsNeedUpdate=!1,c.colorsNeedUpdate=!1,c.tangentsNeedUpdate=!1,c.buffersNeedUpdate=!1,f.attributes&&Sb(f)}else b instanceof a.Ribbon?(f=tb(b,c),e=f.attributes&&Rb(f),(c.verticesNeedUpdate||c.colorsNeedUpdate||c.normalsNeedUpdate||e)&&Bb(c,U.DYNAMIC_DRAW),c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1,c.normalsNeedUpdate=!1,f.attributes&&Sb(f)):b instanceof a.Line?(f=tb(b,c),e=f.attributes&&Rb(f),(c.verticesNeedUpdate||c.colorsNeedUpdate||c.lineDistancesNeedUpdate||e)&&Ab(c,U.DYNAMIC_DRAW),c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1,c.lineDistancesNeedUpdate=!1,f.attributes&&Sb(f)):b instanceof a.ParticleSystem&&(c instanceof a.BufferGeometry?((c.verticesNeedUpdate||c.colorsNeedUpdate)&&Db(c,U.DYNAMIC_DRAW,!c.dynamic),c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1):(f=tb(b,c),e=f.attributes&&Rb(f),(c.verticesNeedUpdate||c.colorsNeedUpdate||b.sortParticles||e)&&zb(c,U.DYNAMIC_DRAW,b),c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1,f.attributes&&Sb(f)))}function Rb(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;return!1}function Sb(a){for(var b in a.attributes)a.attributes[b].needsUpdate=!1}function Tb(b,c){b instanceof a.Mesh||b instanceof a.ParticleSystem||b instanceof a.Ribbon||b instanceof a.Line?Ub(c.__webglObjects,b):b instanceof a.Sprite?Vb(c.__webglSprites,b):b instanceof a.LensFlare?Vb(c.__webglFlares,b):(b instanceof a.ImmediateRenderObject||b.immediateRenderCallback)&&Ub(c.__webglObjectsImmediate,b),b.__webglActive=!1}function Ub(a,b){for(var c=a.length-1;c>=0;c--)a[c].object===b&&a.splice(c,1)}function Vb(a,b){for(var c=a.length-1;c>=0;c--)a[c]===b&&a.splice(c,1)}function Wb(b,c){b.uniforms=a.UniformsUtils.clone(c.uniforms),b.vertexShader=c.vertexShader,b.fragmentShader=c.fragmentShader}function Xb(b,c,d,e,f){u=0,e.needsUpdate&&(e.program&&l.deallocateMaterial(e),l.initMaterial(e,c,d,f),e.needsUpdate=!1),e.morphTargets&&(f.__webglMorphTargetInfluences||(f.__webglMorphTargetInfluences=new Float32Array(l.maxMorphTargets)));var g=!1,h=e.program,i=h.uniforms,j=e.uniforms;h!==o&&(U.useProgram(h),o=h,g=!0),e.id!==q&&(q=e.id,g=!0);if(g||b!==s)U.uniformMatrix4fv(i.projectionMatrix,!1,b._projectionMatrixArray),b!==s&&(s=b);if(e.skinning)if(db&&f.useVertexTexture){if(i.boneTexture!==null){var k=gc();U.uniform1i(i.boneTexture,k),l.setTexture(f.boneTexture,k)}}else i.boneGlobalMatrices!==null&&U.uniformMatrix4fv(i.boneGlobalMatrices,!1,f.boneMatrices);if(g){d&&e.fog&&ac(j,d);if(e instanceof a.MeshPhongMaterial||e instanceof a.MeshLambertMaterial||e.lights)S&&(lc(h,c),S=!1),dc(j,T);(e instanceof a.MeshBasicMaterial||e instanceof a.MeshLambertMaterial||e instanceof a.MeshPhongMaterial)&&Yb(j,e),e instanceof a.LineBasicMaterial?Zb(j,e):e instanceof a.LineDashedMaterial?(Zb(j,e),$b(j,e)):e instanceof a.ParticleBasicMaterial?_b(j,e):e instanceof a.MeshPhongMaterial?bc(j,e):e instanceof a.MeshLambertMaterial?cc(j,e):e instanceof a.MeshDepthMaterial?(j.mNear.value=b.near,j.mFar.value=b.far,j.opacity.value=e.opacity):e instanceof a.MeshNormalMaterial&&(j.opacity.value=e.opacity),f.receiveShadow&&!e._shadowPass&&ec(j,c),hc(h,e.uniformsList);if(e instanceof a.ShaderMaterial||e instanceof a.MeshPhongMaterial||e.envMap)if(i.cameraPosition!==null){var m=b.matrixWorld.getPosition();U.uniform3f(i.cameraPosition,m.x,m.y,m.z)}(e instanceof a.MeshPhongMaterial||e instanceof a.MeshLambertMaterial||e instanceof a.ShaderMaterial||e.skinning)&&i.viewMatrix!==null&&U.uniformMatrix4fv(i.viewMatrix,!1,b._viewMatrixArray)}return fc(i,f),i.modelMatrix!==null&&U.uniformMatrix4fv(i.modelMatrix,!1,f.matrixWorld.elements),h}function Yb(b,c){b.opacity.value=c.opacity,l.gammaInput?b.diffuse.value.copyGammaToLinear(c.color):b.diffuse.value=c.color,b.map.value=c.map,b.lightMap.value=c.lightMap,b.specularMap.value=c.specularMap,c.bumpMap&&(b.bumpMap.value=c.bumpMap,b.bumpScale.value=c.bumpScale),c.normalMap&&(b.normalMap.value=c.normalMap,b.normalScale.value.copy(c.normalScale));var d;c.map?d=c.map:c.specularMap?d=c.specularMap:c.normalMap?d=c.normalMap:c.bumpMap&&(d=c.bumpMap);if(d!==undefined){var e=d.offset,f=d.repeat;b.offsetRepeat.value.set(e.x,e.y,f.x,f.y)}b.envMap.value=c.envMap,b.flipEnvMap.value=c.envMap instanceof a.WebGLRenderTargetCube?1:-1,l.gammaInput?b.reflectivity.value=c.reflectivity:b.reflectivity.value=c.reflectivity,b.refractionRatio.value=c.refractionRatio,b.combine.value=c.combine,b.useRefract.value=c.envMap&&c.envMap.mapping instanceof a.CubeRefractionMapping}function Zb(a,b){a.diffuse.value=b.color,a.opacity.value=b.opacity}function $b(a,b){a.dashSize.value=b.dashSize,a.totalSize.value=b.dashSize+b.gapSize,a.scale.value=b.scale}function _b(a,b){a.psColor.value=b.color,a.opacity.value=b.opacity,a.size.value=b.size,a.scale.value=c.height/2,a.map.value=b.map}function ac(b,c){b.fogColor.value=c.color,c instanceof a.Fog?(b.fogNear.value=c.near,b.fogFar.value=c.far):c instanceof a.FogExp2&&(b.fogDensity.value=c.density)}function bc(a,b){a.shininess.value=b.shininess,l.gammaInput?(a.ambient.value.copyGammaToLinear(b.ambient),a.emissive.value.copyGammaToLinear(b.emissive),a.specular.value.copyGammaToLinear(b.specular)):(a.ambient.value=b.ambient,a.emissive.value=b.emissive,a.specular.value=b.specular),b.wrapAround&&a.wrapRGB.value.copy(b.wrapRGB)}function cc(a,b){l.gammaInput?(a.ambient.value.copyGammaToLinear(b.ambient),a.emissive.value.copyGammaToLinear(b.emissive)):(a.ambient.value=b.ambient,a.emissive.value=b.emissive),b.wrapAround&&a.wrapRGB.value.copy(b.wrapRGB)}function dc(a,b){a.ambientLightColor.value=b.ambient,a.directionalLightColor.value=b.directional.colors,a.directionalLightDirection.value=b.directional.positions,a.pointLightColor.value=b.point.colors,a.pointLightPosition.value=b.point.positions,a.pointLightDistance.value=b.point.distances,a.spotLightColor.value=b.spot.colors,a.spotLightPosition.value=b.spot.positions,a.spotLightDistance.value=b.spot.distances,a.spotLightDirection.value=b.spot.directions,a.spotLightAngleCos.value=b.spot.anglesCos,a.spotLightExponent.value=b.spot.exponents,a.hemisphereLightSkyColor.value=b.hemi.skyColors,a.hemisphereLightGroundColor.value=b.hemi.groundColors,a.hemisphereLightDirection.value=b.hemi.positions}function ec(b,c){if(b.shadowMatrix){var d=0;for(var e=0,f=c.length;e<f;e++){var g=c[e];if(!g.castShadow)continue;if(g instanceof a.SpotLight||g instanceof a.DirectionalLight&&!g.shadowCascade)b.shadowMap.value[d]=g.shadowMap,b.shadowMapSize.value[d]=g.shadowMapSize,b.shadowMatrix.value[d]=g.shadowMatrix,b.shadowDarkness.value[d]=g.shadowDarkness,b.shadowBias.value[d]=g.shadowBias,d++}}}function fc(a,b){U.uniformMatrix4fv(a.modelViewMatrix,!1,b._modelViewMatrix.elements),a.normalMatrix&&U.uniformMatrix3fv(a.normalMatrix,!1,b._normalMatrix.elements)}function gc(){var a=u;return a>=Z&&console.warn("Trying to use "+a+" texture units while this GPU supports only "+Z),u+=1,a}function hc(b,c){var d,e,f,g,h,i,j,k,m,n,o;for(m=0,n=c.length;m<n;m++){g=b.uniforms[c[m][1]];if(!g)continue;d=c[m][0],f=d.type,e=d.value;if(f==="i")U.uniform1i(g,e);else if(f==="f")U.uniform1f(g,e);else if(f==="v2")U.uniform2f(g,e.x,e.y);else if(f==="v3")U.uniform3f(g,e.x,e.y,e.z);else if(f==="v4")U.uniform4f(g,e.x,e.y,e.z,e.w);else if(f==="c")U.uniform3f(g,e.r,e.g,e.b);else if(f==="iv1")U.uniform1iv(g,e);else if(f==="iv")U.uniform3iv(g,e);else if(f==="fv1")U.uniform1fv(g,e);else if(f==="fv")U.uniform3fv(g,e);else if(f==="v2v"){d._array===undefined&&(d._array=new Float32Array(2*e.length));for(j=0,k=e.length;j<k;j++)o=j*2,d._array[o]=e[j].x,d._array[o+1]=e[j].y;U.uniform2fv(g,d._array)}else if(f==="v3v"){d._array===undefined&&(d._array=new Float32Array(3*e.length));for(j=0,k=e.length;j<k;j++)o=j*3,d._array[o]=e[j].x,d._array[o+1]=e[j].y,d._array[o+2]=e[j].z;U.uniform3fv(g,d._array)}else if(f==="v4v"){d._array===undefined&&(d._array=new Float32Array(4*e.length));for(j=0,k=e.length;j<k;j++)o=j*4,d._array[o]=e[j].x,d._array[o+1]=e[j].y,d._array[o+2]=e[j].z,d._array[o+3]=e[j].w;U.uniform4fv(g,d._array)}else if(f==="m4")d._array===undefined&&(d._array=new Float32Array(16)),e.flattenToArray(d._array),U.uniformMatrix4fv(g,!1,d._array);else if(f==="m4v"){d._array===undefined&&(d._array=new Float32Array(16*e.length));for(j=0,k=e.length;j<k;j++)e[j].flattenToArrayOffset(d._array,j*16);U.uniformMatrix4fv(g,!1,d._array)}else if(f==="t"){h=e,i=gc(),U.uniform1i(g,i);if(!h)continue;h.image instanceof Array&&h.image.length===6?xc(h,i):h instanceof a.WebGLRenderTargetCube?yc(h,i):l.setTexture(h,i)}else if(f==="tv"){d._array===undefined&&(d._array=[]);for(j=0,k=d.value.length;j<k;j++)d._array[j]=gc();U.uniform1iv(g,d._array);for(j=0,k=d.value.length;j<k;j++){h=d.value[j],i=d._array[j];if(!h)continue;l.setTexture(h,i)}}}}function ic(a,b){a._modelViewMatrix.multiply(b.matrixWorldInverse,a.matrixWorld),a._normalMatrix.getInverse(a._modelViewMatrix),a._normalMatrix.transpose()}function jc(a,b,c,d){a[b]=c.r*c.r*d,a[b+1]=c.g*c.g*d,a[b+2]=c.b*c.b*d}function kc(a,b,c,d){a[b]=c.r*d,a[b+1]=c.g*d,a[b+2]=c.b*d}function lc(b,c){var d,e,f,g,h=0,i=0,j=0,k,m,n,o,p,q,r,s=T,t=s.directional.colors,u=s.directional.positions,v=s.point.colors,w=s.point.positions,x=s.point.distances,y=s.spot.colors,z=s.spot.positions,A=s.spot.distances,B=s.spot.directions,C=s.spot.anglesCos,D=s.spot.exponents,E=s.hemi.skyColors,F=s.hemi.groundColors,G=s.hemi.positions,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,Q=0,S=0,U=0;for(d=0,e=c.length;d<e;d++){f=c[d];if(f.onlyShadow)continue;k=f.color,o=f.intensity,r=f.distance;if(f instanceof a.AmbientLight){if(!f.visible)continue;l.gammaInput?(h+=k.r*k.r,i+=k.g*k.g,j+=k.b*k.b):(h+=k.r,i+=k.g,j+=k.b)}else if(f instanceof a.DirectionalLight){L+=1;if(!f.visible)continue;P=H*3,l.gammaInput?jc(t,P,k,o*o):kc(t,P,k,o),R.copy(f.matrixWorld.getPosition()),R.subSelf(f.target.matrixWorld.getPosition()),R.normalize(),u[P]=R.x,u[P+1]=R.y,u[P+2]=R.z,H+=1}else if(f instanceof a.PointLight){M+=1;if(!f.visible)continue;Q=I*3,l.gammaInput?jc(v,Q,k,o*o):kc(v,Q,k,o),q=f.matrixWorld.getPosition(),w[Q]=q.x,w[Q+1]=q.y,w[Q+2]=q.z,x[I]=r,I+=1}else if(f instanceof a.SpotLight){N+=1;if(!f.visible)continue;S=J*3,l.gammaInput?jc(y,S,k,o*o):kc(y,S,k,o),q=f.matrixWorld.getPosition(),z[S]=q.x,z[S+1]=q.y,z[S+2]=q.z,A[J]=r,R.copy(q),R.subSelf(f.target.matrixWorld.getPosition()),R.normalize(),B[S]=R.x,B[S+1]=R.y,B[S+2]=R.z,C[J]=Math.cos(f.angle),D[J]=f.exponent,J+=1}else if(f instanceof a.HemisphereLight){O+=1;if(!f.visible)continue;m=f.color,n=f.groundColor,U=K*3,l.gammaInput?(p=o*o,jc(E,U,m,p),jc(F,U,n,p)):(kc(E,U,m,o),kc(F,U,n,o)),R.copy(f.matrixWorld.getPosition()),R.normalize(),G[U]=R.x,G[U+1]=R.y,G[U+2]=R.z,K+=1}}for(d=H*3,e=Math.max(t.length,L*3);d<e;d++)t[d]=0;for(d=H*3,e=Math.max(u.length,L*3);d<e;d++)u[d]=0;for(d=I*3,e=Math.max(v.length,M*3);d<e;d++)v[d]=0;for(d=I*3,e=Math.max(w.length,M*3);d<e;d++)w[d]=0;for(d=I,e=Math.max(x.length,M);d<e;d++)x[d]=0;for(d=J*3,e=Math.max(y.length,N*3);d<e;d++)y[d]=0;for(d=J*3,e=Math.max(z.length,N*3);d<e;d++)z[d]=0;for(d=J*3,e=Math.max(B.length,N*3);d<e;d++)B[d]=0;for(d=J,e=Math.max(C.length,N);d<e;d++)C[d]=0;for(d=J,e=Math.max(D.length,N);d<e;d++)D[d]=0;for(d=J,e=Math.max(A.length,N);d<e;d++)A[d]=0;for(d=K*3,e=Math.max(E.length,O*3);d<e;d++)E[d]=0;for(d=K*3,e=Math.max(F.length,O*3);d<e;d++)F[d]=0;for(d=K*3,e=Math.max(G.length,O*3);d<e;d++)G[d]=0;s.directional.length=H,s.point.length=I,s.spot.length=J,s.hemi.length=K,s.ambient[0]=h,s.ambient[1]=i,s.ambient[2]=j}function mc(a){a!==G&&(U.lineWidth(a),G=a)}function nc(a,b,c){D!==a&&(a?U.enable(U.POLYGON_OFFSET_FILL):U.disable(U.POLYGON_OFFSET_FILL),D=a),a&&(E!==b||F!==c)&&(U.polygonOffset(b,c),E=b,F=c)}function oc(a){var b,c,d=[];for(var e in a){b=a[e];if(b===!1)continue;c="#define "+e+" "+b,d.push(c)}return d.join("\n")}function pc(a,b,c,e,f,g,h){var i,j,k,o,p,q=[];a?q.push(a):(q.push(b),q.push(c));for(k in g)q.push(k),q.push(g[k]);for(i in h)q.push(i),q.push(h[i]);p=q.join();for(i=0,j=m.length;i<j;i++){var r=m[i];if(r.code===p)return r.usedTimes++,r.program}var s=oc(g);o=U.createProgram();var t=["precision "+d+" float;",s,cb?"#define VERTEX_TEXTURES":"",l.gammaInput?"#define GAMMA_INPUT":"",l.gammaOutput?"#define GAMMA_OUTPUT":"",l.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,"#define MAX_BONES "+h.maxBones,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.vertexColors?"#define USE_COLOR":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.boneTextureWidth?"#define N_BONE_PIXEL_X "+h.boneTextureWidth.toFixed(1):"",h.boneTextureHeight?"#define N_BONE_PIXEL_Y "+h.boneTextureHeight.toFixed(1):"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals?"#define USE_MORPHNORMALS":"",h.perPixel?"#define PHONG_PER_PIXEL":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapSoft?"#define SHADOWMAP_SOFT":"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),u=["precision "+d+" float;",h.bumpMap||h.normalMap?"#extension GL_OES_standard_derivatives : enable":"",s,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",l.gammaInput?"#define GAMMA_INPUT":"",l.gammaOutput?"#define GAMMA_OUTPUT":"",l.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.vertexColors?"#define USE_COLOR":"",h.metal?"#define METAL":"",h.perPixel?"#define PHONG_PER_PIXEL":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapSoft?"#define SHADOWMAP_SOFT":"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),v=tc("fragment",u+b),w=tc("vertex",t+c);U.attachShader(o,w),U.attachShader(o,v),U.linkProgram(o),U.getProgramParameter(o,U.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+U.getProgramParameter(o,U.VALIDATE_STATUS)+", gl error ["+U.getError()+"]"),U.deleteShader(v),U.deleteShader(w),o.uniforms={},o.attributes={};var x,y,z,A;x=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],h.useVertexTexture?x.push("boneTexture"):x.push("boneGlobalMatrices");for(y in e)x.push(y);qc(o,x),x=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(A=0;A<h.maxMorphTargets;A++)x.push("morphTarget"+A);for(A=0;A<h.maxMorphNormals;A++)x.push("morphNormal"+A);for(z in f)x.push(z);return rc(o,x),o.id=n++,m.push({program:o,code:p,usedTimes:1}),l.info.memory.programs=m.length,o}function qc(a,b){var c,d,e;for(c=0,d=b.length;c<d;c++)e=b[c],a.uniforms[e]=U.getUniformLocation(a,e)}function rc(a,b){var c,d,e;for(c=0,d=b.length;c<d;c++)e=b[c],a.attributes[e]=U.getAttribLocation(a,e)}function sc(a){var b=a.split("\n");for(var c=0,d=b.length;c<d;c++)b[c]=c+1+": "+b[c];return b.join("\n")}function tc(a,b){var c;return a==="fragment"?c=U.createShader(U.FRAGMENT_SHADER):a==="vertex"&&(c=U.createShader(U.VERTEX_SHADER)),U.shaderSource(c,b),U.compileShader(c),U.getShaderParameter(c,U.COMPILE_STATUS)?c:(console.error(U.getShaderInfoLog(c)),console.error(sc(b)),null)}function uc(a){return(a&a-1)===0}function vc(b,c,d){d?(U.texParameteri(b,U.TEXTURE_WRAP_S,Dc(c.wrapS)),U.texParameteri(b,U.TEXTURE_WRAP_T,Dc(c.wrapT)),U.texParameteri(b,U.TEXTURE_MAG_FILTER,Dc(c.magFilter)),U.texParameteri(b,U.TEXTURE_MIN_FILTER,Dc(c.minFilter))):(U.texParameteri(b,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(b,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(b,U.TEXTURE_MAG_FILTER,Cc(c.magFilter)),U.texParameteri(b,U.TEXTURE_MIN_FILTER,Cc(c.minFilter))),X&&c.type!==a.FloatType&&(c.anisotropy>1||c.__oldAnisotropy)&&(U.texParameterf(b,X.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(c.anisotropy,bb)),c.__oldAnisotropy=c.anisotropy)}function wc(a,b){if(a.width<=b&&a.height<=b)return a;var c=Math.max(a.width,a.height),d=Math.floor(a.width*b/c),e=Math.floor(a.height*b/c),f=document.createElement("canvas");f.width=d,f.height=e;var g=f.getContext("2d");return g.drawImage(a,0,0,a.width,a.height,0,0,d,e),f}function xc(b,c){if(b.image.length===6)if(b.needsUpdate){b.image.__webglTextureCube||(b.image.__webglTextureCube=U.createTexture()),U.activeTexture(U.TEXTURE0+c),U.bindTexture(U.TEXTURE_CUBE_MAP,b.image.__webglTextureCube),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,b.flipY);var d=b instanceof a.CompressedTexture,e=[];for(var f=0;f<6;f++)l.autoScaleCubemaps&&!d?e[f]=wc(b.image[f],ab):e[f]=b.image[f];var g=e[0],h=uc(g.width)&&uc(g.height),i=Dc(b.format),j=Dc(b.type);vc(U.TEXTURE_CUBE_MAP,b,h);for(var f=0;f<6;f++)if(d){var k,m=e[f].mipmaps;for(var n=0,o=m.length;n<o;n++)k=m[n],U.compressedTexImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+f,n,i,k.width,k.height,0,k.data)}else U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,i,i,j,e[f]);b.generateMipmaps&&h&&U.generateMipmap(U.TEXTURE_CUBE_MAP),b.needsUpdate=!1,b.onUpdate&&b.onUpdate()}else U.activeTexture(U.TEXTURE0+c),U.bindTexture(U.TEXTURE_CUBE_MAP,b.image.__webglTextureCube)}function yc(a,b){U.activeTexture(U.TEXTURE0+b),U.bindTexture(U.TEXTURE_CUBE_MAP,a.__webglTexture)}function zc(a,b,c){U.bindFramebuffer(U.FRAMEBUFFER,a),U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,c,b.__webglTexture,0)}function Ac(a,b){U.bindRenderbuffer(U.RENDERBUFFER,a),b.depthBuffer&&!b.stencilBuffer?(U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_COMPONENT16,b.width,b.height),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_ATTACHMENT,U.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_STENCIL,b.width,b.height),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_STENCIL_ATTACHMENT,U.RENDERBUFFER,a)):U.renderbufferStorage(U.RENDERBUFFER,U.RGBA4,b.width,b.height)}function Bc(b){b instanceof a.WebGLRenderTargetCube?(U.bindTexture(U.TEXTURE_CUBE_MAP,b.__webglTexture),U.generateMipmap(U.TEXTURE_CUBE_MAP),U.bindTexture(U.TEXTURE_CUBE_MAP,null)):(U.bindTexture(U.TEXTURE_2D,b.__webglTexture),U.generateMipmap(U.TEXTURE_2D),U.bindTexture(U.TEXTURE_2D,null))}function Cc(b){return b===a.NearestFilter||b===a.NearestMipMapNearestFilter||b===a.NearestMipMapLinearFilter?U.NEAREST:U.LINEAR}function Dc(b){if(b===a.RepeatWrapping)return U.REPEAT;if(b===a.ClampToEdgeWrapping)return U.CLAMP_TO_EDGE;if(b===a.MirroredRepeatWrapping)return U.MIRRORED_REPEAT;if(b===a.NearestFilter)return U.NEAREST;if(b===a.NearestMipMapNearestFilter)return U.NEAREST_MIPMAP_NEAREST;if(b===a.NearestMipMapLinearFilter)return U.NEAREST_MIPMAP_LINEAR;if(b===a.LinearFilter)return U.LINEAR;if(b===a.LinearMipMapNearestFilter)return U.LINEAR_MIPMAP_NEAREST;if(b===a.LinearMipMapLinearFilter)return U.LINEAR_MIPMAP_LINEAR;if(b===a.UnsignedByteType)return U.UNSIGNED_BYTE;if(b===a.UnsignedShort4444Type)return U.UNSIGNED_SHORT_4_4_4_4;if(b===a.UnsignedShort5551Type)return U.UNSIGNED_SHORT_5_5_5_1;if(b===a.UnsignedShort565Type)return U.UNSIGNED_SHORT_5_6_5;if(b===a.ByteType)return U.BYTE;if(b===a.ShortType)return U.SHORT;if(b===a.UnsignedShortType)return U.UNSIGNED_SHORT;if(b===a.IntType)return U.INT;if(b===a.UnsignedIntType)return U.UNSIGNED_INT;if(b===a.FloatType)return U.FLOAT;if(b===a.AlphaFormat)return U.ALPHA;if(b===a.RGBFormat)return U.RGB;if(b===a.RGBAFormat)return U.RGBA;if(b===a.LuminanceFormat)return U.LUMINANCE;if(b===a.LuminanceAlphaFormat)return U.LUMINANCE_ALPHA;if(b===a.AddEquation)return U.FUNC_ADD;if(b===a.SubtractEquation)return U.FUNC_SUBTRACT;if(b===a.ReverseSubtractEquation)return U.FUNC_REVERSE_SUBTRACT;if(b===a.ZeroFactor)return U.ZERO;if(b===a.OneFactor)return U.ONE;if(b===a.SrcColorFactor)return U.SRC_COLOR;if(b===a.OneMinusSrcColorFactor)return U.ONE_MINUS_SRC_COLOR;if(b===a.SrcAlphaFactor)return U.SRC_ALPHA;if(b===a.OneMinusSrcAlphaFactor)return U.ONE_MINUS_SRC_ALPHA;if(b===a.DstAlphaFactor)return U.DST_ALPHA;if(b===a.OneMinusDstAlphaFactor)return U.ONE_MINUS_DST_ALPHA;if(b===a.DstColorFactor)return U.DST_COLOR;if(b===a.OneMinusDstColorFactor)return U.ONE_MINUS_DST_COLOR;if(b===a.SrcAlphaSaturateFactor)return U.SRC_ALPHA_SATURATE;if(Y!==undefined){if(b===a.RGB_S3TC_DXT1_Format)return Y.COMPRESSED_RGB_S3TC_DXT1_EXT;if(b===a.RGBA_S3TC_DXT1_Format)return Y.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(b===a.RGBA_S3TC_DXT3_Format)return Y.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(b===a.RGBA_S3TC_DXT5_Format)return Y.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function Ec(b){if(db&&b&&b.useVertexTexture)return 1024;var c=U.getParameter(U.MAX_VERTEX_UNIFORM_VECTORS),d=Math.floor((c-20)/4),e=d;return b!==undefined&&b instanceof a.SkinnedMesh&&(e=Math.min(b.bones.length,e),e<b.bones.length&&console.warn("WebGLRenderer: too many bones - "+b.bones.length+", this GPU supports just "+e+" (try OpenGL instead of ANGLE)")),e}function Fc(b){var c,d,e,f,g,h,i;f=g=h=i=0;for(c=0,d=b.length;c<d;c++){e=b[c];if(e.onlyShadow)continue;e instanceof a.DirectionalLight&&f++,e instanceof a.PointLight&&g++,e instanceof a.SpotLight&&h++,e instanceof a.HemisphereLight&&i++}return{directional:f,point:g,spot:h,hemi:i}}function Gc(b){var c,d,e,f=0;for(c=0,d=b.length;c<d;c++){e=b[c];if(!e.castShadow)continue;e instanceof a.SpotLight&&f++,e instanceof a.DirectionalLight&&!e.shadowCascade&&f++}return f}function Hc(){try{if(!(U=c.getContext("experimental-webgl",{alpha:e,premultipliedAlpha:f,antialias:g,stencil:h,preserveDrawingBuffer:i})))throw"Error creating WebGL context."}catch(a){console.error(a)}V=U.getExtension("OES_texture_float"),W=U.getExtension("OES_standard_derivatives"),X=U.getExtension("EXT_texture_filter_anisotropic")||U.getExtension("MOZ_EXT_texture_filter_anisotropic")||U.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),Y=U.getExtension("WEBGL_compressed_texture_s3tc")||U.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||U.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),V||console.log("THREE.WebGLRenderer: Float textures not supported."),W||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),X||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),Y||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported.")}function Ic(){U.clearColor(0,0,0,1),U.clearDepth(1),U.clearStencil(0),U.enable(U.DEPTH_TEST),U.depthFunc(U.LEQUAL),U.frontFace(U.CCW),U.cullFace(U.BACK),U.enable(U.CULL_FACE),U.enable(U.BLEND),U.blendEquation(U.FUNC_ADD),U.blendFunc(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA),U.clearColor(j.r,j.g,j.b,k)}console.log("THREE.WebGLRenderer",a.REVISION),b=b||{};var c=b.canvas!==undefined?b.canvas:document.createElement("canvas"),d=b.precision!==undefined?b.precision:"highp",e=b.alpha!==undefined?b.alpha:!0,f=b.premultipliedAlpha!==undefined?b.premultipliedAlpha:!0,g=b.antialias!==undefined?b.antialias:!1,h=b.stencil!==undefined?b.stencil:!0,i=b.preserveDrawingBuffer!==undefined?b.preserveDrawingBuffer:!1,j=b.clearColor!==undefined?new a.Color(b.clearColor):new a.Color(0),k=b.clearAlpha!==undefined?b.clearAlpha:0;this.domElement=c,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapSoft=!0,this.shadowMapCullFrontFaces=!0,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var l=this,m=[],n=0,o=null,p=null,q=-1,r=null,s=null,t=0,u=0,v=-1,w=-1,x=-1,y=-1,z=-1,A=-1,B=-1,C=-1,D=null,E=null,F=null,G=null,H=0,I=0,J=0,K=0,L=0,M=0,N=new a.Frustum,O=new a.Matrix4,P=new a.Matrix4,Q=new a.Vector4,R=new a.Vector3,S=!0,T={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}},U,V,W,X,Y;Hc(),Ic(),this.context=U;var Z=U.getParameter(U.MAX_TEXTURE_IMAGE_UNITS),$=U.getParameter(U.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_=U.getParameter(U.MAX_TEXTURE_SIZE),ab=U.getParameter(U.MAX_CUBE_MAP_TEXTURE_SIZE),bb=X?U.getParameter(X.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,cb=$>0,db=cb&&V,eb=Y?U.getParameter(U.COMPRESSED_TEXTURE_FORMATS):[];this.getContext=function(){return U},this.supportsVertexTextures=function(){return cb},this.getMaxAnisotropy=function(){return bb},this.setSize=function(a,b){c.width=a,c.height=b,this.setViewport(0,0,c.width,c.height)},this.setViewport=function(a,b,d,e){H=a!==undefined?a:0,I=b!==undefined?b:0,J=d!==undefined?d:c.width,K=e!==undefined?e:c.height,U.viewport(H,I,J,K)},this.setScissor=function(a,b,c,d){U.scissor(a,b,c,d)},this.enableScissorTest=function(a){a?U.enable(U.SCISSOR_TEST):U.disable(U.SCISSOR_TEST)},this.setClearColorHex=function(a,b){j.setHex(a),k=b,U.clearColor(j.r,j.g,j.b,k)},this.setClearColor=function(a,b){j.copy(a),k=b,U.clearColor(j.r,j.g,j.b,k)},this.getClearColor=function(){return j},this.getClearAlpha=function(){return k},this.clear=function(a,b,c){var d=0;if(a===undefined||a)d|=U.COLOR_BUFFER_BIT;if(b===undefined||b)d|=U.DEPTH_BUFFER_BIT;if(c===undefined||c)d|=U.STENCIL_BUFFER_BIT;U.clear(d)},this.clearTarget=function(a,b,c,d){this.setRenderTarget(a),this.clear(b,c,d)},this.addPostPlugin=function(a){a.init(this),this.renderPluginsPost.push(a)},this.addPrePlugin=function(a){a.init(this),this.renderPluginsPre.push(a)},this.deallocateObject=function(b){if(!b.__webglInit)return;b.__webglInit=!1,delete b._modelViewMatrix,delete b._normalMatrix,delete b._normalMatrixArray,delete b._modelViewMatrixArray,delete b._modelMatrixArray;if(b instanceof a.Mesh)for(var c in b.geometry.geometryGroups)mb(b.geometry.geometryGroups[c]);else b instanceof a.Ribbon?lb(b.geometry):b instanceof a.Line?kb(b.geometry):b instanceof a.ParticleSystem&&jb(b.geometry)},this.deallocateTexture=function(a){if(!a.__webglInit)return;a.__webglInit=!1,U.deleteTexture(a.__webglTexture),l.info.memory.textures--},this.deallocateRenderTarget=function(b){if(!b||!b.__webglTexture)return;U.deleteTexture(b.__webglTexture);if(b instanceof a.WebGLRenderTargetCube)for(var c=0;c<6;c++)U.deleteFramebuffer(b.__webglFramebuffer[c]),U.deleteRenderbuffer(b.__webglRenderbuffer[c]);else U.deleteFramebuffer(b.__webglFramebuffer),U.deleteRenderbuffer(b.__webglRenderbuffer)},this.deallocateMaterial=function(a){var b=a.program;if(!b)return;a.program=undefined;var c,d,e,f=!1;for(c=0,d=m.length;c<d;c++){e=m[c];if(e.program===b){e.usedTimes--,e.usedTimes===0&&(f=!0);break}}if(f){var g=[];for(c=0,d=m.length;c<d;c++)e=m[c],e.program!==b&&g.push(e);m=g,U.deleteProgram(b),l.info.memory.programs--}},this.updateShadowMap=function(a,b){o=null,x=-1,B=-1,C=-1,r=-1,q=-1,S=!0,v=-1,w=-1,this.shadowMapPlugin.update(a,b)},this.renderBufferImmediate=function(b,c,d){b.hasPositions&&!b.__webglVertexBuffer&&(b.__webglVertexBuffer=U.createBuffer()),b.hasNormals&&!b.__webglNormalBuffer&&(b.__webglNormalBuffer=U.createBuffer()),b.hasUvs&&!b.__webglUvBuffer&&(b.__webglUvBuffer=U.createBuffer()),b.hasColors&&!b.__webglColorBuffer&&(b.__webglColorBuffer=U.createBuffer()),b.hasPositions&&(U.bindBuffer(U.ARRAY_BUFFER,b.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,b.positionArray,U.DYNAMIC_DRAW),U.enableVertexAttribArray(c.attributes.position),U.vertexAttribPointer(c.attributes.position,3,U.FLOAT,!1,0,0));if(b.hasNormals){U.bindBuffer(U.ARRAY_BUFFER,b.__webglNormalBuffer);if(d.shading===a.FlatShading){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=b.count*3;for(r=0;r<s;r+=9)q=b.normalArray,h=q[r],k=q[r+1],n=q[r+2],i=q[r+3],l=q[r+4],o=q[r+5],j=q[r+6],m=q[r+7],p=q[r+8],e=(h+i+j)/3,f=(k+l+m)/3,g=(n+o+p)/3,q[r]=e,q[r+1]=f,q[r+2]=g,q[r+3]=e,q[r+4]=f,q[r+5]=g,q[r+6]=e,q[r+7]=f,q[r+8]=g}U.bufferData(U.ARRAY_BUFFER,b.normalArray,U.DYNAMIC_DRAW),U.enableVertexAttribArray(c.attributes.normal),U.vertexAttribPointer(c.attributes.normal,3,U.FLOAT,!1,0,0)}b.hasUvs&&d.map&&(U.bindBuffer(U.ARRAY_BUFFER,b.__webglUvBuffer),U.bufferData(U.ARRAY_BUFFER,b.uvArray,U.DYNAMIC_DRAW),U.enableVertexAttribArray(c.attributes.uv),U.vertexAttribPointer(c.attributes.uv,2,U.FLOAT,!1,0,0)),b.hasColors&&d.vertexColors!==a.NoColors&&(U.bindBuffer(U.ARRAY_BUFFER,b.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,b.colorArray,U.DYNAMIC_DRAW),U.enableVertexAttribArray(c.attributes.color),U.vertexAttribPointer(c.attributes.color,3,U.FLOAT,!1,0,0)),U.drawArrays(U.TRIANGLES,0,b.count),b.count=0},this.renderBufferDirect=function(b,c,d,e,f,g){if(e.visible===!1)return;var h,i,j,k,m,n;h=Xb(b,c,d,e,g),i=h.attributes;var o=!1,p=e.wireframe?1:0,q=f.id*16777215+h.id*2+p;q!==r&&(r=q,o=!0);if(g instanceof a.Mesh){var s=f.offsets;s.length>1&&(o=!0);for(var t=0,u=s.length;t<u;++t){var v=s[t].index;if(o){var w=f.attributes.position,x=w.itemSize;U.bindBuffer(U.ARRAY_BUFFER,w.buffer),U.vertexAttribPointer(i.position,x,U.FLOAT,!1,0,v*x*4);var y=f.attributes.normal;if(i.normal>=0&&y){var z=y.itemSize;U.bindBuffer(U.ARRAY_BUFFER,y.buffer),U.vertexAttribPointer(i.normal,z,U.FLOAT,!1,0,v*z*4)}var A=f.attributes.uv;if(i.uv>=0&&A)if(A.buffer){var B=A.itemSize;U.bindBuffer(U.ARRAY_BUFFER,A.buffer),U.vertexAttribPointer(i.uv,B,U.FLOAT,!1,0,v*B*4),U.enableVertexAttribArray(i.uv)}else U.disableVertexAttribArray(i.uv);var C=f.attributes.color;if(i.color>=0&&C){var D=C.itemSize;U.bindBuffer(U.ARRAY_BUFFER,C.buffer),U.vertexAttribPointer(i.color,D,U.FLOAT,!1,0,v*D*4)}var E=f.attributes.tangent;if(i.tangent>=0&&E){var F=E.itemSize;U.bindBuffer(U.ARRAY_BUFFER,E.buffer),U.vertexAttribPointer(i.tangent,F,U.FLOAT,!1,0,v*F*4)}var G=f.attributes.index;U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,G.buffer)}U.drawElements(U.TRIANGLES,s[t].count,U.UNSIGNED_SHORT,s[t].start*2),l.info.render.calls++,l.info.render.vertices+=s[t].count,l.info.render.faces+=s[t].count/3}}else if(g instanceof a.ParticleSystem&&o){var w=f.attributes.position,x=w.itemSize;U.bindBuffer(U.ARRAY_BUFFER,w.buffer),U.vertexAttribPointer(i.position,x,U.FLOAT,!1,0,0);var C=f.attributes.color;if(i.color>=0&&C){var D=C.itemSize;U.bindBuffer(U.ARRAY_BUFFER,C.buffer),U.vertexAttribPointer(i.color,D,U.FLOAT,!1,0,0)}U.drawArrays(U.POINTS,0,w.numItems/3),l.info.render.calls++,l.info.render.points+=w.numItems/3}},this.renderBuffer=function(b,c,d,e,f,g){if(e.visible===!1)return;var h,i,j,k,m,n,o,p;h=Xb(b,c,d,e,g),i=h.attributes;var q=!1,s=e.wireframe?1:0,t=f.id*16777215+h.id*2+s;t!==r&&(r=t,q=!0),!e.morphTargets&&i.position>=0?q&&(U.bindBuffer(U.ARRAY_BUFFER,f.__webglVertexBuffer),U.vertexAttribPointer(i.position,3,U.FLOAT,!1,0,0)):g.morphTargetBase&&Eb(e,f,g);if(q){if(f.__webglCustomAttributesList)for(o=0,p=f.__webglCustomAttributesList.length;o<p;o++)n=f.__webglCustomAttributesList[o],i[n.buffer.belongsToAttribute]>=0&&(U.bindBuffer(U.ARRAY_BUFFER,n.buffer),U.vertexAttribPointer(i[n.buffer.belongsToAttribute],n.size,U.FLOAT,!1,0,0));i.color>=0&&(U.bindBuffer(U.ARRAY_BUFFER,f.__webglColorBuffer),U.vertexAttribPointer(i.color,3,U.FLOAT,!1,0,0)),i.normal>=0&&(U.bindBuffer(U.ARRAY_BUFFER,f.__webglNormalBuffer),U.vertexAttribPointer(i.normal,3,U.FLOAT,!1,0,0)),i.tangent>=0&&(U.bindBuffer(U.ARRAY_BUFFER,f.__webglTangentBuffer),U.vertexAttribPointer(i.tangent,4,U.FLOAT,!1,0,0)),i.uv>=0&&(f.__webglUVBuffer?(U.bindBuffer(U.ARRAY_BUFFER,f.__webglUVBuffer),U.vertexAttribPointer(i.uv,2,U.FLOAT,!1,0,0),U.enableVertexAttribArray(i.uv)):U.disableVertexAttribArray(i.uv)),i.uv2>=0&&(f.__webglUV2Buffer?(U.bindBuffer(U.ARRAY_BUFFER,f.__webglUV2Buffer),U.vertexAttribPointer(i.uv2,2,U.FLOAT,!1,0,0),U.enableVertexAttribArray(i.uv2)):U.disableVertexAttribArray(i.uv2)),e.skinning&&i.skinIndex>=0&&i.skinWeight>=0&&(U.bindBuffer(U.ARRAY_BUFFER,f.__webglSkinIndicesBuffer),U.vertexAttribPointer(i.skinIndex,4,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,f.__webglSkinWeightsBuffer),U.vertexAttribPointer(i.skinWeight,4,U.FLOAT,!1,0,0)),i.lineDistance>=0&&(U.bindBuffer(U.ARRAY_BUFFER,f.__webglLineDistanceBuffer),U.vertexAttribPointer(i.lineDistance,1,U.FLOAT,!1,0,0))}g instanceof a.Mesh?(e.wireframe?(mc(e.wireframeLinewidth),q&&U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),U.drawElements(U.LINES,f.__webglLineCount,U.UNSIGNED_SHORT,0)):(q&&U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),U.drawElements(U.TRIANGLES,f.__webglFaceCount,U.UNSIGNED_SHORT,0)),l.info.render.calls++,l.info.render.vertices+=f.__webglFaceCount,l.info.render.faces+=f.__webglFaceCount/3):g instanceof a.Line?(k=g.type===a.LineStrip?U.LINE_STRIP:U.LINES,mc(e.linewidth),U.drawArrays(k,0,f.__webglLineCount),l.info.render.calls++):g instanceof a.ParticleSystem?(U.drawArrays(U.POINTS,0,f.__webglParticleCount),l.info.render.calls++,l.info.render.points+=f.__webglParticleCount):g instanceof a.Ribbon&&(U.drawArrays(U.TRIANGLE_STRIP,0,f.__webglVertexCount),l.info.render.calls++)},this.render=function(b,c,d,e){if(c instanceof a.Camera==0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var f,g,h,i,j,k=b.__lights,m=b.fog;q=-1,S=!0,this.autoUpdateScene&&b.updateMatrixWorld(),c.parent===undefined&&c.updateMatrixWorld(),c._viewMatrixArray||(c._viewMatrixArray=new Float32Array(16)),c._projectionMatrixArray||(c._projectionMatrixArray=new Float32Array(16)),c.matrixWorldInverse.getInverse(c.matrixWorld),c.matrixWorldInverse.flattenToArray(c._viewMatrixArray),c.projectionMatrix.flattenToArray(c._projectionMatrixArray),O.multiply(c.projectionMatrix,c.matrixWorldInverse),N.setFromMatrix(O),this.autoUpdateObjects&&this.initWebGLObjects(b),Hb(this.renderPluginsPre,b,c),l.info.render.calls=0,l.info.render.vertices=0,l.info.render.faces=0,l.info.render.points=0,this.setRenderTarget(d),(this.autoClear||e)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),j=b.__webglObjects;for(f=0,g=j.length;f<g;f++)h=j[f],i=h.object,h.render=!1,i.visible&&(!(i instanceof a.Mesh||i instanceof a.ParticleSystem)||!i.frustumCulled||N.contains(i))&&(ic(i,c),Lb(h),h.render=!0,this.sortObjects===!0&&(i.renderDepth!==null?h.z=i.renderDepth:(Q.copy(i.matrixWorld.getPosition()),O.multiplyVector3(Q),h.z=Q.z),h.id=i.id));this.sortObjects&&j.sort(Fb),j=b.__webglObjectsImmediate;for(f=0,g=j.length;f<g;f++)h=j[f],i=h.object,i.visible&&(ic(i,c),Kb(h));if(b.overrideMaterial){var n=b.overrideMaterial;this.setBlending(n.blending,n.blendEquation,n.blendSrc,n.blendDst),this.setDepthTest(n.depthTest),this.setDepthWrite(n.depthWrite),nc(n.polygonOffset,n.polygonOffsetFactor,n.polygonOffsetUnits),Ib(b.__webglObjects,!1,"",c,k,m,!0,n),Jb(b.__webglObjectsImmediate,"",c,k,m,!1,n)}else this.setBlending(a.NormalBlending),Ib(b.__webglObjects,!0,"opaque",c,k,m,!1),Jb(b.__webglObjectsImmediate,"opaque",c,k,m,!1),Ib(b.__webglObjects,!1,"transparent",c,k,m,!0),Jb(b.__webglObjectsImmediate,"transparent",c,k,m,!0);Hb(this.renderPluginsPost,b,c),d&&d.generateMipmaps&&d.minFilter!==a.NearestFilter&&d.minFilter!==a.LinearFilter&&Bc(d),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(a,b,c,d,e){var f=Xb(a,b,c,d,e);r=-1,l.setMaterialFaces(d),e.immediateRenderCallback?e.immediateRenderCallback(f,U,N):e.render(function(a){l.renderBufferImmediate(a,f,d)})},this.initWebGLObjects=function(a){a.__webglObjects||(a.__webglObjects=[],a.__webglObjectsImmediate=[],a.__webglSprites=[],a.__webglFlares=[]);while(a.__objectsAdded.length)Nb(a.__objectsAdded[0],a),a.__objectsAdded.splice(0,1);while(a.__objectsRemoved.length)Tb(a.__objectsRemoved[0],a),a.__objectsRemoved.splice(0,1);for(var b=0,c=a.__webglObjects.length;b<c;b++)Qb(a.__webglObjects[b].object)},this.initMaterial=function(b,c,d,e){var f,g,h,i,j,k,l,m,n;b instanceof a.MeshDepthMaterial?n="depth":b instanceof a.MeshNormalMaterial?n="normal":b instanceof a.MeshBasicMaterial?n="basic":b instanceof a.MeshLambertMaterial?n="lambert":b instanceof a.MeshPhongMaterial?n="phong":b instanceof a.LineBasicMaterial?n="basic":b instanceof a.LineDashedMaterial?n="dashed":b instanceof a.ParticleBasicMaterial&&(n="particle_basic"),n&&Wb(b,a.ShaderLib[n]),k=Fc(c),m=Gc(c),l=Ec(e),j={map:!!b.map,envMap:!!b.envMap,lightMap:!!b.lightMap,bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,specularMap:!!b.specularMap,vertexColors:b.vertexColors,fog:d,useFog:b.fog,fogExp:d instanceof a.FogExp2,sizeAttenuation:b.sizeAttenuation,skinning:b.skinning,maxBones:l,useVertexTexture:db&&e&&e.useVertexTexture,boneTextureWidth:e&&e.boneTextureWidth,boneTextureHeight:e&&e.boneTextureHeight,morphTargets:b.morphTargets,morphNormals:b.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:k.directional,maxPointLights:k.point,maxSpotLights:k.spot,maxHemiLights:k.hemi,maxShadows:m,shadowMapEnabled:this.shadowMapEnabled&&e.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:b.alphaTest,metal:b.metal,perPixel:b.perPixel,wrapAround:b.wrapAround,doubleSided:b.side===a.DoubleSide,flipSided:b.side===a.BackSide},b.program=pc(n,b.fragmentShader,b.vertexShader,b.uniforms,b.attributes,b.defines,j);var o=b.program.attributes;o.position>=0&&U.enableVertexAttribArray(o.position),o.color>=0&&U.enableVertexAttribArray(o.color),o.normal>=0&&U.enableVertexAttribArray(o.normal),o.tangent>=0&&U.enableVertexAttribArray(o.tangent),o.lineDistance>=0&&U.enableVertexAttribArray(o.lineDistance),b.skinning&&o.skinIndex>=0&&o.skinWeight>=0&&(U.enableVertexAttribArray(o.skinIndex),U.enableVertexAttribArray(o.skinWeight));if(b.attributes)for(g in b.attributes)o[g]!==undefined&&o[g]>=0&&U.enableVertexAttribArray(o[g]);if(b.morphTargets){b.numSupportedMorphTargets=0;var p,q="morphTarget";for(i=0;i<this.maxMorphTargets;i++)p=q+i,o[p]>=0&&(U.enableVertexAttribArray(o[p]),b.numSupportedMorphTargets++)}if(b.morphNormals){b.numSupportedMorphNormals=0;var p,q="morphNormal";for(i=0;i<this.maxMorphNormals;i++)p=q+i,o[p]>=0&&(U.enableVertexAttribArray(o[p]),b.numSupportedMorphNormals++)}b.uniformsList=[];for(f in b.uniforms)b.uniformsList.push([b.uniforms[f],f])},this.setFaceCulling=function(a,b){a?(!b||b==="ccw"?U.frontFace(U.CCW):U.frontFace(U.CW),a==="back"?U.cullFace(U.BACK):a==="front"?U.cullFace(U.FRONT):U.cullFace(U.FRONT_AND_BACK),U.enable(U.CULL_FACE)):U.disable(U.CULL_FACE)},this.setMaterialFaces=function(b){var c=b.side===a.DoubleSide,d=b.side===a.BackSide;v!==c&&(c?U.disable(U.CULL_FACE):U.enable(U.CULL_FACE),v=c),w!==d&&(d?U.frontFace(U.CW):U.frontFace(U.CCW),w=d)},this.setDepthTest=function(a){B!==a&&(a?U.enable(U.DEPTH_TEST):U.disable(U.DEPTH_TEST),B=a)},this.setDepthWrite=function(a){C!==a&&(U.depthMask(a),C=a)},this.setBlending=function(b,c,d,e){b!==x&&(b===a.NoBlending?U.disable(U.BLEND):b===a.AdditiveBlending?(U.enable(U.BLEND),U.blendEquation(U.FUNC_ADD),U.blendFunc(U.SRC_ALPHA,U.ONE)):b===a.SubtractiveBlending?(U.enable(U.BLEND),U.blendEquation(U.FUNC_ADD),U.blendFunc(U.ZERO,U.ONE_MINUS_SRC_COLOR)):b===a.MultiplyBlending?(U.enable(U.BLEND),U.blendEquation(U.FUNC_ADD),U.blendFunc(U.ZERO,U.SRC_COLOR)):b===a.CustomBlending?U.enable(U.BLEND):(U.enable(U.BLEND),U.blendEquationSeparate(U.FUNC_ADD,U.FUNC_ADD),U.blendFuncSeparate(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA,U.ONE,U.ONE_MINUS_SRC_ALPHA)),x=b);if(b===a.CustomBlending){c!==y&&(U.blendEquation(Dc(c)),y=c);if(d!==z||e!==A)U.blendFunc(Dc(d),Dc(e)),z=d,A=e}else y=null,z=null,A=null},this.setTexture=function(b,c){if(b.needsUpdate){b.__webglInit||(b.__webglInit=!0,b.__webglTexture=U.createTexture(),l.info.memory.textures++),U.activeTexture(U.TEXTURE0+c),U.bindTexture(U.TEXTURE_2D,b.__webglTexture),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,b.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);var d=b.image,e=uc(d.width)&&uc(d.height),f=Dc(b.format),g=Dc(b.type);vc(U.TEXTURE_2D,b,e);if(b instanceof a.CompressedTexture){var h,i=b.mipmaps;for(var j=0,k=i.length;j<k;j++)h=i[j],U.compressedTexImage2D(U.TEXTURE_2D,j,f,h.width,h.height,0,h.data)}else b instanceof a.DataTexture?U.texImage2D(U.TEXTURE_2D,0,f,d.width,d.height,0,f,g,d.data):U.texImage2D(U.TEXTURE_2D,0,f,f,g,b.image);b.generateMipmaps&&e&&U.generateMipmap(U.TEXTURE_2D),b.needsUpdate=!1,b.onUpdate&&b.onUpdate()}else U.activeTexture(U.TEXTURE0+c),U.bindTexture(U.TEXTURE_2D,b.__webglTexture)},this.setRenderTarget=function(b){var c=b instanceof a.WebGLRenderTargetCube;if(b&&!b.__webglFramebuffer){b.depthBuffer===undefined&&(b.depthBuffer=!0),b.stencilBuffer===undefined&&(b.stencilBuffer=!0),b.__webglTexture=U.createTexture();var d=uc(b.width)&&uc(b.height),e=Dc(b.format),f=Dc(b.type);if(c){b.__webglFramebuffer=[],b.__webglRenderbuffer=[],U.bindTexture(U.TEXTURE_CUBE_MAP,b.__webglTexture),vc(U.TEXTURE_CUBE_MAP,b,d);for(var g=0;g<6;g++)b.__webglFramebuffer[g]=U.createFramebuffer(),b.__webglRenderbuffer[g]=U.createRenderbuffer(),U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,e,b.width,b.height,0,e,f,null),zc(b.__webglFramebuffer[g],b,U.TEXTURE_CUBE_MAP_POSITIVE_X+g),Ac(b.__webglRenderbuffer[g],b);d&&U.generateMipmap(U.TEXTURE_CUBE_MAP)}else b.__webglFramebuffer=U.createFramebuffer(),b.__webglRenderbuffer=U.createRenderbuffer(),U.bindTexture(U.TEXTURE_2D,b.__webglTexture),vc(U.TEXTURE_2D,b,d),U.texImage2D(U.TEXTURE_2D,0,e,b.width,b.height,0,e,f,null),zc(b.__webglFramebuffer,b,U.TEXTURE_2D),Ac(b.__webglRenderbuffer,b),d&&U.generateMipmap(U.TEXTURE_2D);c?U.bindTexture(U.TEXTURE_CUBE_MAP,null):U.bindTexture(U.TEXTURE_2D,null),U.bindRenderbuffer(U.RENDERBUFFER,null),U.bindFramebuffer(U.FRAMEBUFFER,null)}var h,i,j,k,l;b?(c?h=b.__webglFramebuffer[b.activeCubeFace]:h=b.__webglFramebuffer,i=b.width,j=b.height,k=0,l=0):(h=null,i=J,j=K,k=H,l=I),h!==p&&(U.bindFramebuffer(U.FRAMEBUFFER,h),U.viewport(k,l,i,j),p=h),L=i,M=j},this.shadowMapPlugin=new a.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new a.SpritePlugin),this.addPostPlugin(new a.LensFlarePlugin)},a.WebGLRenderTarget=function(b,c,d){this.width=b,this.height=c,d=d||{},this.wrapS=d.wrapS!==undefined?d.wrapS:a.ClampToEdgeWrapping,this.wrapT=d.wrapT!==undefined?d.wrapT:a.ClampToEdgeWrapping,this.magFilter=d.magFilter!==undefined?d.magFilter:a.LinearFilter,this.minFilter=d.minFilter!==undefined?d.minFilter:a.LinearMipMapLinearFilter,this.anisotropy=d.anisotropy!==undefined?d.anisotropy:1,this.offset=new a.Vector2(0,0),this.repeat=new a.Vector2(1,1),this.format=d.format!==undefined?d.format:a.RGBAFormat,this.type=d.type!==undefined?d.type:a.UnsignedByteType,this.depthBuffer=d.depthBuffer!==undefined?d.depthBuffer:!0,this.stencilBuffer=d.stencilBuffer!==undefined?d.stencilBuffer:!0,this.generateMipmaps=!0},a.WebGLRenderTarget.prototype.clone=function(){var b=new a.WebGLRenderTarget(this.width,this.height);return b.wrapS=this.wrapS,b.wrapT=this.wrapT,b.magFilter=this.magFilter,b.anisotropy=this.anisotropy,b.minFilter=this.minFilter,b.offset.copy(this.offset),b.repeat.copy(this.repeat),b.format=this.format,b.type=this.type,b.depthBuffer=this.depthBuffer,b.stencilBuffer=this.stencilBuffer,b.generateMipmaps=this.generateMipmaps,b},a.WebGLRenderTargetCube=function(b,c,d){a.WebGLRenderTarget.call(this,b,c,d),this.activeCubeFace=0},a.WebGLRenderTargetCube.prototype=Object.create(a.WebGLRenderTarget.prototype),a.RenderableVertex=function(){this.positionWorld=new a.Vector3,this.positionScreen=new a.Vector4,this.visible=!0},a.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld),this.positionScreen.copy(a.positionScreen)},a.RenderableFace3=function(){this.v1=new a.RenderableVertex,this.v2=new a.RenderableVertex,this.v3=new a.RenderableVertex,this.centroidWorld=new a.Vector3,this.centroidScreen=new a.Vector3,this.normalWorld=new a.Vector3,this.vertexNormalsWorld=[new a.Vector3,new a.Vector3,new a.Vector3],this.vertexNormalsLength=0,this.color=null,this.material=null,this.uvs=[[]],this.z=null},a.RenderableFace4=function(){this.v1=new a.RenderableVertex,this.v2=new a.RenderableVertex,this.v3=new a.RenderableVertex,this.v4=new a.RenderableVertex,this.centroidWorld=new a.Vector3,this.centroidScreen=new a.Vector3,this.normalWorld=new a.Vector3,this.vertexNormalsWorld=[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3],this.vertexNormalsLength=0,this.color=null,this.material=null,this.uvs=[[]],this.z=null},a.RenderableObject=function(){this.object=null,this.z=null},a.RenderableParticle=function(){this.object=null,this.x=null,this.y=null,this.z=null,this.rotation=null,this.scale=new a.Vector2,this.material=null},a.RenderableLine=function(){this.z=null,this.v1=new a.RenderableVertex,this.v2=new a.RenderableVertex,this.material=null},a.ColorUtils={adjustHSV:function(b,c,d,e){var f=a.ColorUtils.__hsv;b.getHSV(f),f.h=a.Math.clamp(f.h+c,0,1),f.s=a.Math.clamp(f.s+d,0,1),f.v=a.Math.clamp(f.v+e,0,1),b.setHSV(f.h,f.s,f.v)}},a.ColorUtils.__hsv={h:0,s:0,v:0},a.GeometryUtils={merge:function(b,c){var d,e,f=b.vertices.length,g=b.faceVertexUvs[0].length,h=c instanceof a.Mesh?c.geometry:c,i=b.vertices,j=h.vertices,k=b.faces,l=h.faces,m=b.faceVertexUvs[0],n=h.faceVertexUvs[0];c instanceof a.Mesh&&(c.matrixAutoUpdate&&c.updateMatrix(),d=c.matrix,e=new a.Matrix4,e.extractRotation(d,c.scale));for(var o=0,p=j.length;o<p;o++){var q=j[o],r=q.clone();d&&d.multiplyVector3(r),i.push(r)}for(o=0,p=l.length;o<p;o++){var s=l[o],t,u,v,w=s.vertexNormals,x=s.vertexColors;s instanceof a.Face3?t=new a.Face3(s.a+f,s.b+f,s.c+f):s instanceof a.Face4&&(t=new a.Face4(s.a+f,s.b+f,s.c+f,s.d+f)),t.normal.copy(s.normal),e&&e.multiplyVector3(t.normal);for(var y=0,z=w.length;y<z;y++)u=w[y].clone(),e&&e.multiplyVector3(u),t.vertexNormals.push(u);t.color.copy(s.color);for(var y=0,z=x.length;y<z;y++)v=x[y],t.vertexColors.push(v.clone());t.materialIndex=s.materialIndex,t.centroid.copy(s.centroid),d&&d.multiplyVector3(t.centroid),k.push(t)}for(o=0,p=n.length;o<p;o++){var A=n[o],B=[];for(var y=0,z=A.length;y<z;y++)B.push(new a.UV(A[y].u,A[y].v));m.push(B)}},removeMaterials:function(a,b){var c={};for(var d=0,e=b.length;d<e;d++)c[b[d]]=!0;var f,g=[];for(var d=0,e=a.faces.length;d<e;d++)f=a.faces[d],f.materialIndex in c||g.push(f);a.faces=g},randomPointInTriangle:function(b,c,d){var e,f,g,h=new a.Vector3,i=a.GeometryUtils.__v1;return e=a.GeometryUtils.random(),f=a.GeometryUtils.random(),e+f>1&&(e=1-e,f=1-f),g=1-e-f,h.copy(b),h.multiplyScalar(e),i.copy(c),i.multiplyScalar(f),h.addSelf(i),i.copy(d),i.multiplyScalar(g),h.addSelf(i),h},randomPointInFace:function(b,c,d){var e,f,g,h;if(b instanceof a.Face3)return e=c.vertices[b.a],f=c.vertices[b.b],g=c.vertices[b.c],a.GeometryUtils.randomPointInTriangle(e,f,g);if(b instanceof a.Face4){e=c.vertices[b.a],f=c.vertices[b.b],g=c.vertices[b.c],h=c.vertices[b.d];var i,j;d?b._area1&&b._area2?(i=b._area1,j=b._area2):(i=a.GeometryUtils.triangleArea(e,f,h),j=a.GeometryUtils.triangleArea(f,g,h),b._area1=i,b._area2=j):(i=a.GeometryUtils.triangleArea(e,f,h),j=a.GeometryUtils.triangleArea(f,g,h));var k=a.GeometryUtils.random()*(i+j);return k<i?a.GeometryUtils.randomPointInTriangle(e,f,h):a.GeometryUtils.randomPointInTriangle(f,g,h)}},randomPointsInGeometry:function(b,c){function o(a){function b(c,d){if(d<c)return c;var e=c+Math.floor((d-c)/2);return j[e]>a?b(c,e-1):j[e]<a?b(e+1,d):e}var c=b(0,j.length-1);return c}var d,e,f=b.faces,g=b.vertices,h=f.length,i=0,j=[],k,l,m,n;for(e=0;e<h;e++)d=f[e],d instanceof a.Face3?(k=g[d.a],l=g[d.b],m=g[d.c],d._area=a.GeometryUtils.triangleArea(k,l,m)):d instanceof a.Face4&&(k=g[d.a],l=g[d.b],m=g[d.c],n=g[d.d],d._area1=a.GeometryUtils.triangleArea(k,l,n),d._area2=a.GeometryUtils.triangleArea(l,m,n),d._area=d._area1+d._area2),i+=d._area,j[e]=i;var p,q,r=[],s={};for(e=0;e<c;e++)p=a.GeometryUtils.random()*i,q=o(p),r[e]=a.GeometryUtils.randomPointInFace(f[q],b,!0),s[q]?s[q]+=1:s[q]=1;return r},triangleArea:function(b,c,d){var e,f,g,h,i=a.GeometryUtils.__v1;return i.sub(b,c),f=i.length(),i.sub(b,d),g=i.length(),i.sub(c,d),h=i.length(),e=.5*(f+g+h),Math.sqrt(e*(e-f)*(e-g)*(e-h))},center:function(b){b.computeBoundingBox();var c=b.boundingBox,d=new a.Vector3;return d.add(c.min,c.max),d.multiplyScalar(-0.5),b.applyMatrix((new a.Matrix4).makeTranslation(d.x,d.y,d.z)),b.computeBoundingBox(),d},normalizeUVs:function(a){var b=a.faceVertexUvs[0];for(var c=0,d=b.length;c<d;c++){var e=b[c];for(var f=0,g=e.length;f<g;f++)e[f].u!==1&&(e[f].u=e[f].u-Math.floor(e[f].u)),e[f].v!==1&&(e[f].v=e[f].v-Math.floor(e[f].v))}},triangulateQuads:function(b){var c,d,e,f,g=[],h=[],i=[];for(c=0,d=b.faceUvs.length;c<d;c++)h[c]=[];for(c=0,d=b.faceVertexUvs.length;c<d;c++)i[c]=[];for(c=0,d=b.faces.length;c<d;c++){var j=b.faces[c];if(j instanceof a.Face4){var k=j.a,l=j.b,m=j.c,n=j.d,o=new a.Face3,p=new a.Face3;o.color.copy(j.color),p.color.copy(j.color),o.materialIndex=j.materialIndex,p.materialIndex=j.materialIndex,o.a=k,o.b=l,o.c=n,p.a=l,p.b=m,p.c=n,j.vertexColors.length===4&&(o.vertexColors[0]=j.vertexColors[0].clone(),o.vertexColors[1]=j.vertexColors[1].clone(),o.vertexColors[2]=j.vertexColors[3].clone(),p.vertexColors[0]=j.vertexColors[1].clone(),p.vertexColors[1]=j.vertexColors[2].clone(),p.vertexColors[2]=j.vertexColors[3].clone()),g.push(o,p);for(e=0,f=b.faceVertexUvs.length;e<f;e++)if(b.faceVertexUvs[e].length){var q=b.faceVertexUvs[e][c],r=q[0],s=q[1],t=q[2],u=q[3],v=[r.clone(),s.clone(),u.clone()],w=[s.clone(),t.clone(),u.clone()];i[e].push(v,w)}for(e=0,f=b.faceUvs.length;e<f;e++)if(b.faceUvs[e].length){var x=b.faceUvs[e][c];h[e].push(x,x)}}else{g.push(j);for(e=0,f=b.faceUvs.length;e<f;e++)h[e].push(b.faceUvs[e][c]);for(e=0,f=b.faceVertexUvs.length;e<f;e++)i[e].push(b.faceVertexUvs[e][c])}}b.faces=g,b.faceUvs=h,b.faceVertexUvs=i,b.computeCentroids(),b.computeFaceNormals(),b.computeVertexNormals(),b.hasTangents&&b.computeTangents()},explode:function(b){var c=[];for(var d=0,e=b.faces.length;d<e;d++){var f=c.length,g=b.faces[d];if(g instanceof a.Face4){var h=g.a,i=g.b,j=g.c,k=g.d,l=b.vertices[h],m=b.vertices[i],n=b.vertices[j],o=b.vertices[k];c.push(l.clone()),c.push(m.clone()),c.push(n.clone()),c.push(o.clone()),g.a=f,g.b=f+1,g.c=f+2,g.d=f+3}else{var h=g.a,i=g.b,j=g.c,l=b.vertices[h],m=b.vertices[i],n=b.vertices[j];c.push(l.clone()),c.push(m.clone()),c.push(n.clone()),g.a=f,g.b=f+1,g.c=f+2}}b.vertices=c,delete b.__tmpVertices},tessellate:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=[],L=[];for(d=0,e=b.faceVertexUvs.length;d<e;d++)L[d]=[];for(d=0,e=b.faces.length;d<e;d++){f=b.faces[d];if(f instanceof a.Face3){g=f.a,h=f.b,i=f.c,k=b.vertices[g],l=b.vertices[h],m=b.vertices[i],o=k.distanceTo(l),p=l.distanceTo(m),q=k.distanceTo(m);if(o>c||p>c||q>c){t=b.vertices.length,F=f.clone(),G=f.clone(),o>=p&&o>=q?(w=k.clone(),w.lerpSelf(l,.5),F.a=g,F.b=t,F.c=i,G.a=t,G.b=h,G.c=i,f.vertexNormals.length===3&&(z=f.vertexNormals[0].clone(),z.lerpSelf(f.vertexNormals[1],.5),F.vertexNormals[1].copy(z),G.vertexNormals[0].copy(z)),f.vertexColors.length===3&&(C=f.vertexColors[0].clone(),C.lerpSelf(f.vertexColors[1],.5),F.vertexColors[1].copy(C),G.vertexColors[0].copy(C)),J=0):p>=o&&p>=q?(w=l.clone(),w.lerpSelf(m,.5),F.a=g,F.b=h,F.c=t,G.a=t,G.b=i,G.c=g,f.vertexNormals.length===3&&(z=f.vertexNormals[1].clone(),z.lerpSelf(f.vertexNormals[2],.5),F.vertexNormals[2].copy(z),G.vertexNormals[0].copy(z),G.vertexNormals[1].copy(f.vertexNormals[2]),G.vertexNormals[2].copy(f.vertexNormals[0])),f.vertexColors.length===3&&(C=f.vertexColors[1].clone(),C.lerpSelf(f.vertexColors[2],.5),F.vertexColors[2].copy(C),G.vertexColors[0].copy(C),G.vertexColors[1].copy(f.vertexColors[2]),G.vertexColors[2].copy(f.vertexColors[0])),J=1):(w=k.clone(),w.lerpSelf(m,.5),F.a=g,F.b=h,F.c=t,G.a=t,G.b=h,G.c=i,f.vertexNormals.length===3&&(z=f.vertexNormals[0].clone(),z.lerpSelf(f.vertexNormals[2],.5),F.vertexNormals[2].copy(z),G.vertexNormals[0].copy(z)),f.vertexColors.length===3&&(C=f.vertexColors[0].clone(),C.lerpSelf(f.vertexColors[2],.5),F.vertexColors[2].copy(C),G.vertexColors[0].copy(C)),J=2),K.push(F,G),b.vertices.push(w);var M,N,O,P,Q,R,S,T,U;for(M=0,N=b.faceVertexUvs.length;M<N;M++)b.faceVertexUvs[M].length&&(O=b.faceVertexUvs[M][d],P=O[0],Q=O[1],R=O[2],J===0?(S=P.clone(),S.lerpSelf(Q,.5),T=[P.clone(),S.clone(),R.clone()],U=[S.clone(),Q.clone(),R.clone()]):J===1?(S=Q.clone(),S.lerpSelf(R,.5),T=[P.clone(),Q.clone(),S.clone()],U=[S.clone(),R.clone(),P.clone()]):(S=P.clone(),S.lerpSelf(R,.5),T=[P.clone(),Q.clone(),S.clone()],U=[S.clone(),Q.clone(),R.clone()]),L[M].push(T,U))}else{K.push(f);for(M=0,N=b.faceVertexUvs.length;M<N;M++)L[M].push(b.faceVertexUvs[M][d])}}else{g=f.a,h=f.b,i=f.c,j=f.d,k=b.vertices[g],l=b.vertices[h],m=b.vertices[i],n=b.vertices[j],o=k.distanceTo(l),p=l.distanceTo(m),r=m.distanceTo(n),s=k.distanceTo(n);if(o>c||p>c||r>c||s>c){u=b.vertices.length,v=b.vertices.length+1,H=f.clone(),I=f.clone(),o>=p&&o>=r&&o>=s||r>=p&&r>=o&&r>=s?(x=k.clone(),x.lerpSelf(l,.5),y=m.clone(),y.lerpSelf(n,.5),H.a=g,H.b=u,H.c=v,H.d=j,I.a=u,I.b=h,I.c=i,I.d=v,f.vertexNormals.length===4&&(A=f.vertexNormals[0].clone(),A.lerpSelf(f.vertexNormals[1],.5),B=f.vertexNormals[2].clone(),B.lerpSelf(f.vertexNormals[3],.5),H.vertexNormals[1].copy(A),H.vertexNormals[2].copy(B),I.vertexNormals[0].copy(A),I.vertexNormals[3].copy(B)),f.vertexColors.length===4&&(D=f.vertexColors[0].clone(),D.lerpSelf(f.vertexColors[1],.5),E=f.vertexColors[2].clone(),E.lerpSelf(f.vertexColors[3],.5),H.vertexColors[1].copy(D),H.vertexColors[2].copy(E),I.vertexColors[0].copy(D),I.vertexColors[3].copy(E)),J=0):(x=l.clone(),x.lerpSelf(m,.5),y=n.clone(),y.lerpSelf(k,.5),H.a=g,H.b=h,H.c=u,H.d=v,I.a=v,I.b=u,I.c=i,I.d=j,f.vertexNormals.length===4&&(A=f.vertexNormals[1].clone(),A.lerpSelf(f.vertexNormals[2],.5),B=f.vertexNormals[3].clone(),B.lerpSelf(f.vertexNormals[0],.5),H.vertexNormals[2].copy(A),H.vertexNormals[3].copy(B),I.vertexNormals[0].copy(B),I.vertexNormals[1].copy(A)),f.vertexColors.length===4&&(D=f.vertexColors[1].clone(),D.lerpSelf(f.vertexColors[2],.5),E=f.vertexColors[3].clone(),E.lerpSelf(f.vertexColors[0],.5),H.vertexColors[2].copy(D),H.vertexColors[3].copy(E),I.vertexColors[0].copy(E),I.vertexColors[1].copy(D)),J=1),K.push(H,I),b.vertices.push(x,y);var M,N,O,P,Q,R,V,W,X,Y,Z;for(M=0,N=b.faceVertexUvs.length;M<N;M++)b.faceVertexUvs[M].length&&(O=b.faceVertexUvs[M][d],P=O[0],Q=O[1],R=O[2],V=O[3],J===0?(W=P.clone(),W.lerpSelf(Q,.5),X=R.clone(),X.lerpSelf(V,.5),Y=[P.clone(),W.clone(),X.clone(),V.clone()],Z=[W.clone(),Q.clone(),R.clone(),X.clone()]):(W=Q.clone(),W.lerpSelf(R,.5),X=V.clone(),X.lerpSelf(P,.5),Y=[P.clone(),Q.clone(),W.clone(),X.clone()],Z=[X.clone(),W.clone(),R.clone(),V.clone()]),L[M].push(Y,Z))}else{K.push(f);for(M=0,N=b.faceVertexUvs.length;M<N;M++)L[M].push(b.faceVertexUvs[M][d])}}}b.faces=K,b.faceVertexUvs=L}},a.GeometryUtils.random=a.Math.random16,a.GeometryUtils.__v1=new a.Vector3,a.ImageUtils={crossOrigin:"anonymous",loadTexture:function(b,c,d,e){var f=new Image,g=new a.Texture(f,c),h=new a.ImageLoader;return h.addEventListener("load",function(a){g.image=a.content,g.needsUpdate=!0,d&&d(g)}),h.addEventListener("error",function(a){e&&e(a.message)}),h.crossOrigin=this.crossOrigin,h.load(b,f),g.sourceFile=b,g},loadCompressedTexture:function(b,c,d,e){var f=new a.CompressedTexture;f.mapping=c;var g=new XMLHttpRequest;return g.onload=function(){var b=g.response,c=a.ImageUtils.parseDDS(b,!0);f.format=c.format,f.mipmaps=c.mipmaps,f.image.width=c.width,f.image.height=c.height,f.generateMipmaps=!1,f.needsUpdate=!0,d&&d(f)},g.onerror=e,g.open("GET",b,!0),g.responseType="arraybuffer",g.send(null),f},loadTextureCube:function(b,c,d,e){var f=[];f.loadCount=0;var g=new a.Texture;g.image=f,c!==undefined&&(g.mapping=c),g.flipY=!1;for(var h=0,i=b.length;h<i;++h){var j=new Image;f[h]=j,j.onload=function(){f.loadCount+=1,f.loadCount===6&&(g.needsUpdate=!0,d&&d())},j.onerror=e,j.crossOrigin=this.crossOrigin,j.src=b[h]}return g},loadCompressedTextureCube:function(b,c,d,e){var f=[];f.loadCount=0;var g=new a.CompressedTexture;g.image=f,c!==undefined&&(g.mapping=c),g.flipY=!1,g.generateMipmaps=!1;var h=function(b,c){return function(){var e=b.response,h=a.ImageUtils.parseDDS(e,!0);c.format=h.format,c.mipmaps=h.mipmaps,c.width=h.width,c.height=h.height,f.loadCount+=1,f.loadCount===6&&(g.format=h.format,g.needsUpdate=!0,d&&d())}};for(var i=0,j=b.length;i<j;++i){var k={};f[i]=k;var l=new XMLHttpRequest;l.onload=h(l,k),l.onerror=e;var m=b[i];l.open("GET",m,!0),l.responseType="arraybuffer",l.send(null)}return g},parseDDS:function(b,c){function E(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function F(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var d={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},e=542327876,f=1,g=2,h=4,i=8,j=4096,k=131072,l=524288,m=8388608,n=8,o=4194304,p=4096,q=512,r=1024,s=2048,t=4096,u=8192,v=16384,w=32768,x=2097152,y=1,z=2,A=4,B=64,C=512,D=131072,G=E("DXT1"),H=E("DXT3"),I=E("DXT5"),J=31,K=0,L=1,M=2,N=3,O=4,P=7,Q=20,R=21,S=new Int32Array(b,0,J);if(S[K]!==e)return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),d;if(!S[Q]&A)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),d;var T,U=S[R];switch(U){case G:T=8,d.format=a.RGB_S3TC_DXT1_Format;break;case H:T=16,d.format=a.RGBA_S3TC_DXT3_Format;break;case I:T=16,d.format=a.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",F(U)),d}d.mipmapCount=1,S[M]&k&&c!==!1&&(d.mipmapCount=Math.max(1,S[P])),d.width=S[O],d.height=S[N];var V=S[L]+4,W=d.width,X=d.height;for(var Y=0;Y<d.mipmapCount;Y++){var Z=Math.max(4,W)/4*Math.max(4,X)/4*T,$=new Uint8Array(b,V,Z),_={data:$,width:W,height:X};d.mipmaps.push(_),V+=Z,W=Math.max(W*.5,1),X=Math.max(X*.5,1)}return d},getNormalMap:function(a,b){var c=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]},d=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]},e=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/b,a[1]/b,a[2]/b]};b|=1;var f=a.width,g=a.height,h=document.createElement("canvas");h.width=f,h.height=g;var i=h.getContext("2d");i.drawImage(a,0,0);var j=i.getImageData(0,0,f,g).data,k=i.createImageData(f,g),l=k.data;for(var m=0;m<f;m++)for(var n=0;n<g;n++){var o=n-1<0?0:n-1,p=n+1>g-1?g-1:n+1,q=m-1<0?0:m-1,r=m+1>f-1?f-1:m+1,s=[],t=[0,0,j[(n*f+m)*4]/255*b];s.push([-1,0,j[(n*f+q)*4]/255*b]),s.push([-1,-1,j[(o*f+q)*4]/255*b]),s.push([0,-1,j[(o*f+m)*4]/255*b]),s.push([1,-1,j[(o*f+r)*4]/255*b]),s.push([1,0,j[(n*f+r)*4]/255*b]),s.push([1,1,j[(p*f+r)*4]/255*b]),s.push([0,1,j[(p*f+m)*4]/255*b]),s.push([-1,1,j[(p*f+q)*4]/255*b]);var u=[],v=s.length;for(var w=0;w<v;w++){var x=s[w],y=s[(w+1)%v];x=d(x,t),y=d(y,t),u.push(e(c(x,y)))}var z=[0,0,0];for(var w=0;w<u.length;w++)z[0]+=u[w][0],z[1]+=u[w][1],z[2]+=u[w][2];z[0]/=u.length,z[1]/=u.length,z[2]/=u.length;var A=(n*f+m)*4;l[A]=(z[0]+1)/2*255|0,l[A+1]=(z[1]+1)/2*255|0,l[A+2]=z[2]*255|0,l[A+3]=255}return i.putImageData(k,0,0),h},generateDataTexture:function(b,c,d){var e=b*c,f=new Uint8Array(3*e),g=Math.floor(d.r*255),h=Math.floor(d.g*255),i=Math.floor(d.b*255);for(var j=0;j<e;j++)f[j*3]=g,f[j*3+1]=h,f[j*3+2]=i;var k=new a.DataTexture(f,b,c,a.RGBFormat);return k.needsUpdate=!0,k}},a.SceneUtils={createMultiMaterialObject:function(b,c){var d=new a.Object3D;for(var e=0,f=c.length;e<f;e++)d.add(new a.Mesh(b,c[e]));return d},detach:function(a,b,c){a.applyMatrix(b.matrixWorld),b.remove(a),c.add(a)},attach:function(b,c,d){var e=new a.Matrix4;e.getInverse(d.matrixWorld),b.applyMatrix(e),c.remove(b),d.add(b)}},a.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:null}},fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0 );","refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n"),vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vReflect = reflect( I, worldNormal );","vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n")},normal:{uniforms:a.UniformsUtils.merge([a.UniformsLib.fog,a.UniformsLib.lights,a.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new a.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new a.Color(16777215)},uSpecularColor:{type:"c",value:new a.Color(1118481)},uAmbientColor:{type:"c",value:new a.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new a.Vector2(0,0)},uRepeat:{type:"v2",value:new a.Vector2(1,1)},wrapRGB:{type:"v3",value:new a.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",a.ShaderChunk.shadowmap_pars_fragment,a.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.linear_to_gamma_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",a.ShaderChunk.skinning_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {",a.ShaderChunk.skinbase_vertex,a.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")}}},a.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(a){var b=a.familyName.toLowerCase(),c=this;c.faces[b]=c.faces[b]||{},c.faces[b][a.cssFontWeight]=c.faces[b][a.cssFontWeight]||{},c.faces[b][a.cssFontWeight][a.cssFontStyle]=a;var d=c.faces[b][a.cssFontWeight][a.cssFontStyle]=a;return a},drawText:function(b){var c=[],d=[],e,f,g=this.getFace(),h=this.size/g.resolution,i=0,j=String(b).split(""),k=j.length,l=[];for(e=0;e<k;e++){var m=new a.Path,n=this.extractGlyphPoints(j[e],g,h,i,m);i+=n.offset,l.push(n.path)}var o=i/2;return{paths:l,offset:o}},extractGlyphPoints:function(b,c,d,e,f){var g=[],h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=c.glyphs[b]||c.glyphs["?"];if(!A)return;if(A.o){k=A._cachedOutline||(A._cachedOutline=A.o.split(" ")),m=k.length,n=d,o=d;for(h=0;h<m;){l=k[h++];switch(l){case"m":p=k[h++]*n+e,q=k[h++]*o,f.moveTo(p,q);break;case"l":p=k[h++]*n+e,q=k[h++]*o,f.lineTo(p,q);break;case"q":r=k[h++]*n+e,s=k[h++]*o,v=k[h++]*n+e,w=k[h++]*o,f.quadraticCurveTo(v,w,r,s),z=g[g.length-1];if(z){t=z.x,u=z.y;for(i=1,j=this.divisions;i<=j;i++)var B=i/j,C=a.Shape.Utils.b2(B,t,v,r),D=a.Shape.Utils.b2(B,u,w,s)}break;case"b":r=k[h++]*n+e,s=k[h++]*o,v=k[h++]*n+e,w=k[h++]*-o,x=k[h++]*n+e,y=k[h++]*-o,f.bezierCurveTo(r,s,v,w,x,y),z=g[g.length-1];if(z){t=z.x,u=z.y;for(i=1,j=this.divisions;i<=j;i++)var B=i/j,C=a.Shape.Utils.b3(B,t,v,x,r),D=a.Shape.Utils.b3(B,u,w,y,s)}}}}return{offset:A.ha*d,path:f}}},a.FontUtils.generateShapes=function(b,c){c=c||{};var d=c.size!==undefined?c.size:100,e=c.curveSegments!==undefined?c.curveSegments:4,f=c.font!==undefined?c.font:"helvetiker",g=c.weight!==undefined?c.weight:"normal",h=c.style!==undefined?c.style:"normal";a.FontUtils.size=d,a.FontUtils.divisions=e,a.FontUtils.face=f,a.FontUtils.weight=g,a.FontUtils.style=h;var i=a.FontUtils.drawText(b),j=i.paths,k=[];for(var l=0,m=j.length;l<m;l++)Array.prototype.push.apply(k,j[l].toShapes());return k},function(a){var b=1e-10,c=function(a,b){var c=a.length;if(c<3)return null;var e=[],g=[],h=[],i,j,k;if(d(a)>0)for(j=0;j<c;j++)g[j]=j;else for(j=0;j<c;j++)g[j]=c-1-j;var l=c,m=2*l;for(j=l-1;l>2;){if(m--<=0)return console.log("Warning, unable to triangulate polygon!"),b?h:e;i=j,l<=i&&(i=0),j=i+1,l<=j&&(j=0),k=j+1,l<=k&&(k=0);if(f(a,i,j,k,l,g)){var n,o,p,q,r;n=g[i],o=g[j],p=g[k],e.push([a[n],a[o],a[p]]),h.push([g[i],g[j],g[k]]);for(q=j,r=j+1;r<l;q++,r++)g[q]=g[r];l--,m=2*l}}return b?h:e},d=function(a){var b=a.length,c=0;for(var d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return c*.5},e=function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return i=e-c,j=f-d,k=a-e,l=b-f,m=c-a,n=d-b,o=g-a,p=h-b,q=g-c,r=h-d,s=g-e,t=h-f,w=i*r-j*q,u=m*p-n*o,v=k*t-l*s,w>=0&&v>=0&&u>=0},f=function(a,c,d,f,g,h){var i,j,k,l,m,n,o,p,q;j=a[h[c]].x,k=a[h[c]].y,l=a[h[d]].x,m=a[h[d]].y,n=a[h[f]].x,o=a[h[f]].y;if(b>(l-j)*(o-k)-(m-k)*(n-j))return!1;for(i=0;i<g;i++){if(i==c||i==d||i==f)continue;p=a[h[i]].x,q=a[h[i]].y;if(e(j,k,l,m,n,o,p,q))return!1}return!0};return a.Triangulate=c,a.Triangulate.area=d,a}(a.FontUtils),self._typeface_js={faces:a.FontUtils.faces,loadFace:a.FontUtils.loadFace},a.Curve=function(){},a.Curve.prototype.getPoint=function(a){return console.log("Warning, getPoint() not implemented!"),null},a.Curve.prototype.getPointAt=function(a){var b=this.getUtoTmapping(a);return this.getPoint(b)},a.Curve.prototype.getPoints=function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPoint(b/a));return c},a.Curve.prototype.getSpacedPoints=function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return c},a.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]},a.Curve.prototype.getLengths=function(a){a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],c,d=this.getPoint(0),e,f=0;b.push(0);for(e=1;e<=a;e++)c=this.getPoint(e/a),f+=c.distanceTo(d),b.push(f),d=c;return this.cacheArcLengths=b,b},a.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},a.Curve.prototype.getUtoTmapping=function(a,b){var c=this.getLengths(),d=0,e=c.length,f;b?f=b:f=a*c[e-1];var g=0,h=e-1,i;while(g<=h){d=Math.floor(g+(h-g)/2),i=c[d]-f;if(i<0){g=d+1;continue}if(i>0){h=d-1;continue}h=d;break}d=h;if(c[d]==f){var j=d/(e-1);return j}var k=c[d],l=c[d+1],m=l-k,n=(f-k)/m,j=(d+n)/(e-1);return j},a.Curve.prototype.getNormalVector=function(b){var c=this.getTangent(b);return new a.Vector2(-c.y,c.x)},a.Curve.prototype.getTangent=function(a){var b=1e-4,c=a-b,d=a+b;c<0&&(c=0),d>1&&(d=1);var e=this.getPoint(c),f=this.getPoint(d),g=f.clone().subSelf(e);return g.normalize()},a.Curve.prototype.getTangentAt=function(a){var b=this.getUtoTmapping(a);return this.getTangent(b)},a.LineCurve=function(a,b){this.v1=a,this.v2=b},a.LineCurve.prototype=Object.create(a.Curve.prototype),a.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().subSelf(this.v1);return b.multiplyScalar(a).addSelf(this.v1),b},a.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)},a.LineCurve.prototype.getTangent=function(a){var b=this.v2.clone().subSelf(this.v1);return b.normalize()},a.QuadraticBezierCurve=function(a,b,c){this.v0=a,this.v1=b,this.v2=c},a.QuadraticBezierCurve.prototype=Object.create(a.Curve.prototype),a.QuadraticBezierCurve.prototype.getPoint=function(b){var c,d;return c=a.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x),d=a.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y),new a.Vector2(c,d)},a.QuadraticBezierCurve.prototype.getTangent=function(b){var c,d;c=a.Curve.Utils.tangentQuadraticBezier(b,this.v0.x,this.v1.x,this.v2.x),d=a.Curve.Utils.tangentQuadraticBezier(b,this.v0.y,this.v1.y,this.v2.y);var e=new a.Vector2(c,d);return e.normalize(),e},a.CubicBezierCurve=function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},a.CubicBezierCurve.prototype=Object.create(a.Curve.prototype),a.CubicBezierCurve.prototype.getPoint=function(b){var c,d;return c=a.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x),d=a.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new a.Vector2(c,d)},a.CubicBezierCurve.prototype.getTangent=function(b){var c,d;c=a.Curve.Utils.tangentCubicBezier(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x),d=a.Curve.Utils.tangentCubicBezier(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var e=new a.Vector2(c,d);return e.normalize(),e},a.SplineCurve=function(a){this.points=a==undefined?[]:a},a.SplineCurve.prototype=Object.create(a.Curve.prototype),a.SplineCurve.prototype.getPoint=function(b){var c=new a.Vector2,d=[],e=this.points,f,g,h;return f=(e.length-1)*b,g=Math.floor(f),h=f-g,d[0]=g==0?g:g-1,d[1]=g,d[2]=g>e.length-2?e.length-1:g+1,d[3]=g>e.length-3?e.length-1:g+2,c.x=a.Curve.Utils.interpolate(e[d[0]].x,e[d[1]].x,e[d[2]].x,e[d[3]].x,h),c.y=a.Curve.Utils.interpolate(e[d[0]].y,e[d[1]].y,e[d[2]].y,e[d[3]].y,h),c},a.EllipseCurve=function(a,b,c,d,e,f,g){this.aX=a,this.aY=b,this.xRadius=c,this.yRadius=d,this.aStartAngle=e,this.aEndAngle=f,this.aClockwise=g},a.EllipseCurve.prototype=Object.create(a.Curve.prototype),a.EllipseCurve.prototype.getPoint=function(b){var c=this.aEndAngle-this.aStartAngle;this.aClockwise||(b=1-b);var d=this.aStartAngle+b*c,e=this.aX+this.xRadius*Math.cos(d),f=this.aY+this.yRadius*Math.sin(d);return new a.Vector2(e,f)},a.ArcCurve=function(b,c,d,e,f,g){a.EllipseCurve.call(this,b,c,d,d,e,f,g)},a.ArcCurve.prototype=Object.create(a.EllipseCurve.prototype),a.Curve.Utils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){var f=6*a*a-6*a,g=3*a*a-4*a+1,h=-6*a*a+6*a,i=3*a*a-2*a;return f+g+h+i},interpolate:function(a,b,c,d,e){var f=(c-a)*.5,g=(d-b)*.5,h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b}},a.Curve.create=function(b,c){return b.prototype=Object.create(a.Curve.prototype),b.prototype.getPoint=c,b},a.LineCurve3=a.Curve.create(function(a,b){this.v1=a,this.v2=b},function(b){var c=new a.Vector3;return c.sub(this.v2,this.v1),c.multiplyScalar(b),c.addSelf(this.v1),c}),a.QuadraticBezierCurve3=a.Curve.create(function(a,b,c){this.v0=a,this.v1=b,this.v2=c},function(b){var c,d,e;return c=a.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x),d=a.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y),e=a.Shape.Utils.b2(b,this.v0.z,this.v1.z,this.v2.z),new a.Vector3(c,d,e)}),a.CubicBezierCurve3=a.Curve.create(function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},function(b){var c,d,e;return c=a.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x),d=a.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=a.Shape.Utils.b3(b,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new a.Vector3(c,d,e)}),a.SplineCurve3=a.Curve.create(function(a){this.points=a==undefined?[]:a},function(b){var c=new a.Vector3,d=[],e=this.points,f,g,h;f=(e.length-1)*b,g=Math.floor(f),h=f-g,d[0]=g==0?g:g-1,d[1]=g,d[2]=g>e.length-2?e.length-1:g+1,d[3]=g>e.length-3?e.length-1:g+2;var i=e[d[0]],j=e[d[1]],k=e[d[2]],l=e[d[3]];return c.x=a.Curve.Utils.interpolate(i.x,j.x,k.x,l.x,h),c.y=a.Curve.Utils.interpolate(i.y,j.y,k.y,l.y,h),c.z=a.Curve.Utils.interpolate(i.z,j.z,k.z,l.z,h),c}),a.ClosedSplineCurve3=a.Curve.create(function(a){this.points=a==undefined?[]:a},function(b){var c=new a.Vector3,d=[],e=this.points,f,g,h;return f=(e.length-0)*b,g=Math.floor(f),h=f-g,g+=g>0?0:(Math.floor(Math.abs(g)/e.length)+1)*e.length,d[0]=(g-1)%e.length,d[1]=g%e.length,d[2]=(g+1)%e.length,d[3]=(g+2)%e.length,c.x=a.Curve.Utils.interpolate(e[d[0]].x,e[d[1]].x,e[d[2]].x,e[d[3]].x,h),c.y=a.Curve.Utils.interpolate(e[d[0]].y,e[d[1]].y,e[d[2]].y,e[d[3]].y,h),c.z=a.Curve.Utils.interpolate(e[d[0]].z,e[d[1]].z,e[d[2]].z,e[d[3]].z,h),c}),a.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},a.CurvePath.prototype=Object.create(a.Curve.prototype),a.CurvePath.prototype.add=function(a){this.curves.push(a)},a.CurvePath.prototype.checkConnection=function(){},a.CurvePath.prototype.closePath=function(){var b=this.curves[0].getPoint(0),c=this.curves[this.curves.length-1].getPoint(1);b.equals(c)||this.curves.push(new a.LineCurve(c,b))},a.CurvePath.prototype.getPoint=function(a){var b=a*this.getLength(),c=this.getCurveLengths(),d=0,e,f;while(d<c.length){if(c[d]>=b){e=c[d]-b,f=this.curves[d];var g=1-e/f.getLength();return f.getPointAt(g)}d++}return null},a.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]},a.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var a=[],b=0,c,d=this.curves.length;for(c=0;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a,a},a.CurvePath.prototype.getBoundingBox=function(){var b=this.getPoints(),c,d,e,f,g,h;c=d=Number.NEGATIVE_INFINITY,f=g=Number.POSITIVE_INFINITY;var i,j,k,l,m=b[0]instanceof a.Vector3;l=m?new a.Vector3:new a.Vector2;for(j=0,k=b.length;j<k;j++)i=b[j],i.x>c?c=i.x:i.x<f&&(f=i.x),i.y>d?d=i.y:i.y<g&&(g=i.y),m&&(i.z>e?e=i.z:i.z<h&&(h=i.z)),l.addSelf(i);var n={minX:f,minY:g,maxX:c,maxY:d,centroid:l.divideScalar(k)};return m&&(n.maxZ=e,n.minZ=h),n},a.CurvePath.prototype.createPointsGeometry=function(a){var b=this.getPoints(a,!0);return this.createGeometry(b)},a.CurvePath.prototype.createSpacedPointsGeometry=function(a){var b=this.getSpacedPoints(a,!0);return this.createGeometry(b)},a.CurvePath.prototype.createGeometry=function(b){var c=new a.Geometry;for(var d=0;d<b.length;d++)c.vertices.push(new a.Vector3(b[d].x,b[d].y,b[d].z||0));return c},a.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)},a.CurvePath.prototype.getTransformedPoints=function(a,b){var c=this.getPoints(a),d,e;b||(b=this.bends);for(d=0,e=b.length;d<e;d++)c=this.getWrapPoints(c,b[d]);return c},a.CurvePath.prototype.getTransformedSpacedPoints=function(a,b){var c=this.getSpacedPoints(a),d,e;b||(b=this.bends);for(d=0,e=b.length;d<e;d++)c=this.getWrapPoints(c,b[d]);return c},a.CurvePath.prototype.getWrapPoints=function(a,b){var c=this.getBoundingBox(),d,e,f,g,h,i;for(d=0,e=a.length;d<e;d++){f=a[d],g=f.x,h=f.y,i=g/c.maxX,i=b.getUtoTmapping(i,g);var j=b.getPoint(i),k=b.getNormalVector(i).multiplyScalar(h);f.x=j.x+k.x,f.y=j.y+k.y}return a},a.Gyroscope=function(){a.Object3D.call(this)},a.Gyroscope.prototype=Object.create(a.Object3D.prototype),a.Gyroscope.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a)this.parent?(this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},a.Gyroscope.prototype.translationWorld=new a.Vector3,a.Gyroscope.prototype.translationObject=new a.Vector3,a.Gyroscope.prototype.rotationWorld=new a.Quaternion,a.Gyroscope.prototype.rotationObject=new a.Quaternion,a.Gyroscope.prototype.scaleWorld=new a.Vector3,a.Gyroscope.prototype.scaleObject=new a.Vector3,a.Path=function(b){a.CurvePath.call(this),this.actions=[],b&&this.fromPoints(b)},a.Path.prototype=Object.create(a.CurvePath.prototype),a.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},a.Path.prototype.fromPoints=function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)},a.Path.prototype.moveTo=function(b,c){var d=Array.prototype.slice.call(arguments);this.actions.push({action:a.PathActions.MOVE_TO,args:d})},a.Path.prototype.lineTo=function(b,c){var d=Array.prototype.slice.call(arguments),e=this.actions[this.actions.length-1].args,f=e[e.length-2],g=e[e.length-1],h=new a.LineCurve(new a.Vector2(f,g),new a.Vector2(b,c));this.curves.push(h),this.actions.push({action:a.PathActions.LINE_TO,args:d})},a.Path.prototype.quadraticCurveTo=function(b,c,d,e){var f=Array.prototype.slice.call(arguments),g=this.actions[this.actions.length-1].args,h=g[g.length-2],i=g[g.length-1],j=new a.QuadraticBezierCurve(new a.Vector2(h,i),new a.Vector2(b,c),new a.Vector2(d,e));this.curves.push(j),this.actions.push({action:a.PathActions.QUADRATIC_CURVE_TO,args:f})},a.Path.prototype.bezierCurveTo=function(b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,j=i[i.length-2],k=i[i.length-1],l=new a.CubicBezierCurve(new a.Vector2(j,k),new a.Vector2(b,c),new a.Vector2(d,e),new a.Vector2(f,g));this.curves.push(l),this.actions.push({action:a.PathActions.BEZIER_CURVE_TO,args:h})},a.Path.prototype.splineThru=function(b){var c=Array.prototype.slice.call(arguments),d=this.actions[this.actions.length-1].args,e=d[d.length-2],f=d[d.length-1],g=[new a.Vector2(e,f)];Array.prototype.push.apply(g,b);var h=new a.SplineCurve(g);this.curves.push(h),this.actions.push({action:a.PathActions.CSPLINE_THRU,args:c})},a.Path.prototype.arc=function(a,b,c,d,e,f){var g=this.actions[this.actions.length-1].args,h=g[g.length-2],i=g[g.length-1];this.absarc(a+h,b+i,c,d,e,f)},a.Path.prototype.absarc=function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},a.Path.prototype.ellipse=function(a,b,c,d,e,f,g){var h=this.actions[this.actions.length-1].args,i=h[h.length-2],j=h[h.length-1];this.absellipse(a+i,b+j,c,d,e,f,g)},a.Path.prototype.absellipse=function(b,c,d,e,f,g,h){var i=Array.prototype.slice.call(arguments),j=new a.EllipseCurve(b,c,d,e,f,g,h);this.curves.push(j);var k=j.getPoint(h?1:0);i.push(k.x),i.push(k.y),this.actions.push({action:a.PathActions.ELLIPSE,args:i})},a.Path.prototype.getSpacedPoints=function(a,b){a||(a=40);var c=[];for(var d=0;d<a;d++)c.push(this.getPoint(d/a));return c},a.Path.prototype.getPoints=function(b,c){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(b,c);b=b||12;var d=[],e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;for(e=0,f=this.actions.length;e<f;e++){g=this.actions[e],h=g.action,i=g.args;switch(h){case a.PathActions.MOVE_TO:d.push(new a.Vector2(i[0],i[1]));break;case a.PathActions.LINE_TO:d.push(new a.Vector2(i[0],i[1]));break;case a.PathActions.QUADRATIC_CURVE_TO:j=i[2],k=i[3],n=i[0],o=i[1],d.length>0?(r=d[d.length-1],p=r.x,q=r.y):(r=this.actions[e-1].args,p=r[r.length-2],q=r[r.length-1]);for(s=1;s<=b;s++)t=s/b,u=a.Shape.Utils.b2(t,p,n,j),v=a.Shape.Utils.b2(t,q,o,k),d.push(new a.Vector2(u,v));break;case a.PathActions.BEZIER_CURVE_TO:j=i[4],k=i[5],n=i[0],o=i[1],l=i[2],m=i[3],d.length>0?(r=d[d.length-1],p=r.x,q=r.y):(r=this.actions[e-1].args,p=r[r.length-2],q=r[r.length-1]);for(s=1;s<=b;s++)t=s/b,u=a.Shape.Utils.b3(t,p,n,l,j),v=a.Shape.Utils.b3(t,q,o,m,k),d.push(new a.Vector2(u,v));break;case a.PathActions.CSPLINE_THRU:r=this.actions[e-1].args;var w=new a.Vector2(r[r.length-2],r[r.length-1]),x=[w],y=b*i[0].length;x=x.concat(i[0]);var z=new a.SplineCurve(x);for(s=1;s<=y;s++)d.push(z.getPointAt(s/y));break;case a.PathActions.ARC:var A=i[0],B=i[1],C=i[2],D=i[3],E=i[4],F=!!i[5],G=E-D,H,I=b*2;for(s=1;s<=I;s++)t=s/I,F||(t=1-t),H=D+t*G,u=A+C*Math.cos(H),v=B+C*Math.sin(H),d.push(new a.Vector2(u,v));break;case a.PathActions.ELLIPSE:var A=i[0],B=i[1],J=i[2],K=i[3],D=i[4],E=i[5],F=!!i[6],G=E-D,H,I=b*2;for(s=1;s<=I;s++)t=s/I,F||(t=1-t),H=D+t*G,u=A+J*Math.cos(H),v=B+K*Math.sin(H),d.push(new a.Vector2(u,v))}}var L=d[d.length-1],M=1e-10;return Math.abs(L.x-d[0].x)<M&&Math.abs(L.y-d[0].y)<M&&d.splice(d.length-1,1),c&&d.push(d[0]),d},a.Path.prototype.toShapes=function(){var b,c,d,e,f,g=[],h=new a.Path;for(b=0,c=this.actions.length;b<c;b++)d=this.actions[b],f=d.args,e=d.action,e==a.PathActions.MOVE_TO&&h.actions.length!=0&&(g.push(h),h=new a.Path),h[e].apply(h,f);h.actions.length!=0&&g.push(h);if(g.length==0)return[];var i,j,k=[],l=!a.Shape.Utils.isClockWise(g[0].getPoints());if(g.length==1)return i=g[0],j=new a.Shape,j.actions=i.actions,j.curves=i.curves,k.push(j),k;if(l){j=new a.Shape;for(b=0,c=g.length;b<c;b++)i=g[b],a.Shape.Utils.isClockWise(i.getPoints())?(j.actions=i.actions,j.curves=i.curves,k.push(j),j=new a.Shape):j.holes.push(i)}else{for(b=0,c=g.length;b<c;b++)i=g[b],a.Shape.Utils.isClockWise(i.getPoints())?(j&&k.push(j),j=new a.Shape,j.actions=i.actions,j.curves=i.curves):j.holes.push(i);k.push(j)}return k},a.Shape=function(){a.Path.apply(this,arguments),this.holes=[]},a.Shape.prototype=Object.create(a.Path.prototype),a.Shape.prototype.extrude=function(b){var c=new a.ExtrudeGeometry(this,b);return c},a.Shape.prototype.makeGeometry=function(b){var c=new a.ShapeGeometry(this,b);return c},a.Shape.prototype.getPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++)d[b]=this.holes[b].getTransformedPoints(a,this.bends);return d},a.Shape.prototype.getSpacedPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++)d[b]=this.holes[b].getTransformedSpacedPoints(a,this.bends);return d},a.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}},a.Shape.prototype.extractPoints=function(a){return this.useSpacedPoints?this.extractAllSpacedPoints(a):this.extractAllPoints(a)},a.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}},a.Shape.Utils={removeHoles:function(b,c){var d=b.concat(),e=d.concat(),f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=[];for(n=0;n<c.length;n++){p=c[n],Array.prototype.push.apply(e,p),q=Number.POSITIVE_INFINITY;for(o=0;o<p.length;o++){t=p[o];var A=[];for(s=0;s<d.length;s++)u=d[s],r=t.distanceToSquared(u),A.push(r),r<q&&(q=r,j=o,k=s)}f=k-1>=0?k-1:d.length-1,h=j-1>=0?j-1:p.length-1;var B=[p[j],d[k],d[f]],C=a.FontUtils.Triangulate.area(B),D=[p[j],p[h],d[k]],E=a.FontUtils.Triangulate.area(D),F=1,G=-1,H=k,I=j;k+=F,j+=G,k<0&&(k+=d.length),k%=d.length,j<0&&(j+=p.length),j%=p.length,f=k-1>=0?k-1:d.length-1,h=j-1>=0?j-1:p.length-1,B=[p[j],d[k],d[f]];var J=a.FontUtils.Triangulate.area(B);D=[p[j],p[h],d[k]];var K=a.FontUtils.Triangulate.area(D);C+E>J+K&&(k=H,j=I,k<0&&(k+=d.length),k%=d.length,j<0&&(j+=p.length),j%=p.length,f=k-1>=0?k-1:d.length-1,h=j-1>=0?j-1:p.length-1),v=d.slice(0,k),w=d.slice(k),x=p.slice(j),y=p.slice(0,j);var L=[p[j],d[k],d[f]],M=[p[j],p[h],d[k]];z.push(L),z.push(M),d=v.concat(x).concat(y).concat(w)}return{shape:d,isolatedPts:z,allpoints:e}},triangulateShape:function(b,c){var d=a.Shape.Utils.removeHoles(b,c),e=d.shape,f=d.allpoints,g=d.isolatedPts,h=a.FontUtils.Triangulate(e,!1),i,j,k,l,m,n,o={},p={};for(i=0,j=f.length;i<j;i++)m=f[i].x+":"+f[i].y,o[m]!==undefined&&console.log("Duplicate point",m),o[m]=i;for(i=0,j=h.length;i<j;i++){l=h[i];for(k=0;k<3;k++)m=l[k].x+":"+l[k].y,n=o[m],n!==undefined&&(l[k]=n)}for(i=0,j=g.length;i<j;i++){l=g[i];for(k=0;k<3;k++)m=l[k].x+":"+l[k].y,n=o[m],n!==undefined&&(l[k]=n)}return h.concat(g)},isClockWise:function(b){return a.FontUtils.Triangulate.area(b)<0},b2p0:function(a,b){var c=1-a;return c*c*b},b2p1:function(a,b){return 2*(1-a)*a*b},b2p2:function(a,b){return a*a*b},b2:function(a,b,c,d){return this.b2p0(a,b)+this.b2p1(a,c)+this.b2p2(a,d)},b3p0:function(a,b){var c=1-a;return c*c*c*b},b3p1:function(a,b){var c=1-a;return 3*c*c*a*b},b3p2:function(a,b){var c=1-a;return 3*c*a*a*b},b3p3:function(a,b){return a*a*a*b},b3:function(a,b,c,d,e){return this.b3p0(a,b)+this.b3p1(a,c)+this.b3p2(a,d)+this.b3p3(a,e)}},a.AnimationHandler=function(){var b=[],c={},d={};d.update=function(a){for(var c=0;c<b.length;c++)b[c].update(a)},d.addToUpdate=function(a){b.indexOf(a)===-1&&b.push(a)},d.removeFromUpdate=function(a){var c=b.indexOf(a);c!==-1&&b.splice(c,1)},d.add=function(a){c[a.name]!==undefined&&console.log("THREE.AnimationHandler.add: Warning! "+a.name+" already exists in library. Overwriting."),c[a.name]=a,f(a)},d.get=function(a){if(typeof a=="string")return c[a]?c[a]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+a),null)},d.parse=function(b){var c=[];if(b instanceof a.SkinnedMesh)for(var d=0;d<b.bones.length;d++)c.push(b.bones[d]);else e(b,c);return c};var e=function(a,b){b.push(a);for(var c=0;c<a.children.length;c++)e(a.children[c],b)},f=function(b){if(b.initialized===!0)return;for(var c=0;c<b.hierarchy.length;c++){for(var d=0;d<b.hierarchy[c].keys.length;d++){b.hierarchy[c].keys[d].time<0&&(b.hierarchy[c].keys[d].time=0);if(b.hierarchy[c].keys[d].rot!==undefined&&!(b.hierarchy[c].keys[d].rot instanceof a.Quaternion)){var e=b.hierarchy[c].keys[d].rot;b.hierarchy[c].keys[d].rot=new a.Quaternion(e[0],e[1],e[2],e[3])}}if(b.hierarchy[c].keys.length&&b.hierarchy[c].keys[0].morphTargets!==undefined){var f={};for(var d=0;d<b.hierarchy[c].keys.length;d++)for(var g=0;g<b.hierarchy[c].keys[d].morphTargets.length;g++){var h=b.hierarchy[c].keys[d].morphTargets[g];f[h]=-1}b.hierarchy[c].usedMorphTargets=f;for(var d=0;d<b.hierarchy[c].keys.length;d++){var i={};for(var h in f){for(var g=0;g<b.hierarchy[c].keys[d].morphTargets.length;g++)if(b.hierarchy[c].keys[d].morphTargets[g]===h){i[h]=b.hierarchy[c].keys[d].morphTargetsInfluences[g];break}g===b.hierarchy[c].keys[d].morphTargets.length&&(i[h]=0)}b.hierarchy[c].keys[d].morphTargetsInfluences=i}}for(var d=1;d<b.hierarchy[c].keys.length;d++)b.hierarchy[c].keys[d].time===b.hierarchy[c].keys[d-1].time&&(b.hierarchy[c].keys.splice(d,1),d--);for(var d=0;d<b.hierarchy[c].keys.length;d++)b.hierarchy[c].keys[d].index=d}var j=parseInt(b.length*b.fps,10);b.JIT={},b.JIT.hierarchy=[];for(var c=0;c<b.hierarchy.length;c++)b.JIT.hierarchy.push(new Array(j));b.initialized=!0};return d.LINEAR=0,d.CATMULLROM=1,d.CATMULLROM_FORWARD=2,d}(),a.Animation=function(b,c,d){this.root=b,this.data=a.AnimationHandler.get(c),this.hierarchy=a.AnimationHandler.parse(b),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=d!==undefined?d:a.AnimationHandler.LINEAR,this.points=[],this.target=new a.Vector3},a.Animation.prototype.play=function(b,c){if(this.isPlaying===!1){this.isPlaying=!0,this.loop=b!==undefined?b:!0,this.currentTime=c!==undefined?c:0;var d,e=this.hierarchy.length,f;for(d=0;d<e;d++){f=this.hierarchy[d],this.interpolationType!==a.AnimationHandler.CATMULLROM_FORWARD&&(f.useQuaternion=!0),f.matrixAutoUpdate=!0,f.animationCache===undefined&&(f.animationCache={},f.animationCache.prevKey={pos:0,rot:0,scl:0},f.animationCache.nextKey={pos:0,rot:0,scl:0},f.animationCache.originalMatrix=f instanceof a.Bone?f.skinMatrix:f.matrix);var g=f.animationCache.prevKey,h=f.animationCache.nextKey;g.pos=this.data.hierarchy[d].keys[0],g.rot=this.data.hierarchy[d].keys[0],g.scl=this.data.hierarchy[d].keys[0],h.pos=this.getNextKeyWith("pos",d,1),h.rot=this.getNextKeyWith("rot",d,1),h.scl=this.getNextKeyWith("scl",d,1)}this.update(0)}this.isPaused=!1,a.AnimationHandler.addToUpdate(this)},a.Animation.prototype.pause=function(){this.isPaused===!0?a.AnimationHandler.addToUpdate(this):a.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},a.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,a.AnimationHandler.removeFromUpdate(this)},a.Animation.prototype.update=function(b){if(this.isPlaying===!1)return;var c=["pos","rot","scl"],d,e,f,g,h,i,j,k,l,m,n=this.data.JIT.hierarchy,o,p,q,r,s;this.currentTime+=b*this.timeScale,p=this.currentTime,o=this.currentTime=this.currentTime%this.data.length,m=parseInt(Math.min(o*this.data.fps,this.data.length*this.data.fps),10);for(var t=0,u=this.hierarchy.length;t<u;t++){k=this.hierarchy[t],l=k.animationCache;for(var v=0;v<3;v++){d=c[v],i=l.prevKey[d],j=l.nextKey[d];if(j.time<=p){if(o<p){if(!this.loop){this.stop();return}i=this.data.hierarchy[t].keys[0],j=this.getNextKeyWith(d,t,1);while(j.time<o)i=j,j=this.getNextKeyWith(d,t,j.index+1)}else do i=j,j=this.getNextKeyWith(d,t,j.index+1);while(j.time<o);l.prevKey[d]=i,l.nextKey[d]=j}k.matrixAutoUpdate=!0,k.matrixWorldNeedsUpdate=!0,e=(o-i.time)/(j.time-i.time),g=i[d],h=j[d];if(e<0||e>1)console.log("THREE.Animation.update: Warning! Scale out of bounds:"+e+" on bone "+t),e=e<0?0:1;if(d==="pos"){f=k.position;if(this.interpolationType===a.AnimationHandler.LINEAR)f.x=g[0]+(h[0]-g[0])*e,f.y=g[1]+(h[1]-g[1])*e,f.z=g[2]+(h[2]-g[2])*e;else if(this.interpolationType===a.AnimationHandler.CATMULLROM||this.interpolationType===a.AnimationHandler.CATMULLROM_FORWARD)this.points[0]=this.getPrevKeyWith("pos",t,i.index-1).pos,this.points[1]=g,this.points[2]=h,this.points[3]=this.getNextKeyWith("pos",t,j.index+1).pos,e=e*.33+.33,q=this.interpolateCatmullRom(this.points,e),f.x=q[0],f.y=q[1],f.z=q[2],this.interpolationType===a.AnimationHandler.CATMULLROM_FORWARD&&(r=this.interpolateCatmullRom(this.points,e*1.01),this.target.set(r[0],r[1],r[2]),this.target.subSelf(f),this.target.y=0,this.target.normalize(),s=Math.atan2(this.target.x,this.target.z),k.rotation.set(0,s,0))}else d==="rot"?a.Quaternion.slerp(g,h,k.quaternion,e):d==="scl"&&(f=k.scale,f.x=g[0]+(h[0]-g[0])*e,f.y=g[1]+(h[1]-g[1])*e,f.z=g[2]+(h[2]-g[2])*e)}}},a.Animation.prototype.interpolateCatmullRom=function(a,b){var c=[],d=[],e,f,g,h,i,j,k,l,m;return e=(a.length-1)*b,f=Math.floor(e),g=e-f,c[0]=f===0?f:f-1,c[1]=f,c[2]=f>a.length-2?f:f+1,c[3]=f>a.length-3?f:f+2,j=a[c[0]],k=a[c[1]],l=a[c[2]],m=a[c[3]],h=g*g,i=g*h,d[0]=this.interpolate(j[0],k[0],l[0],m[0],g,h,i),d[1]=this.interpolate(j[1],k[1],l[1],m[1],g,h,i),d[2]=this.interpolate(j[2],k[2],l[2],m[2],g,h,i),d},a.Animation.prototype.interpolate=function(a,b,c,d,e,f,g){var h=(c-a)*.5,i=(d-b)*.5;return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b},a.Animation.prototype.getNextKeyWith=function(b,c,d){var e=this.data.hierarchy[c].keys;this.interpolationType===a.AnimationHandler.CATMULLROM||this.interpolationType===a.AnimationHandler.CATMULLROM_FORWARD?d=d<e.length-1?d:e.length-1:d%=e.length;for(;d<e.length;d++)if(e[d][b]!==undefined)return e[d];return this.data.hierarchy[c].keys[0]},a.Animation.prototype.getPrevKeyWith=function(b,c,d){var e=this.data.hierarchy[c].keys;this.interpolationType===a.AnimationHandler.CATMULLROM||this.interpolationType===a.AnimationHandler.CATMULLROM_FORWARD?d=d>0?d:0:d=d>=0?d:d+e.length;for(;d>=0;d--)if(e[d][b]!==undefined)return e[d];return this.data.hierarchy[c].keys[e.length-1]},a.KeyFrameAnimation=function(b,c,d){this.root=b,this.data=a.AnimationHandler.get(c),this.hierarchy=a.AnimationHandler.parse(b),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.JITCompile=d!==undefined?d:!0;for(var e=0,f=this.hierarchy.length;e<f;e++){var g=this.data.hierarchy[e].keys,h=this.data.hierarchy[e].sids,i=this.hierarchy[e];if(g.length&&h){for(var j=0;j<h.length;j++){var k=h[j],l=this.getNextKeyWith(k,e,0);l&&l.apply(k)}i.matrixAutoUpdate=!1,this.data.hierarchy[e].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}},a.KeyFrameAnimation.prototype.play=function(b,c){if(!this.isPlaying){this.isPlaying=!0,this.loop=b!==undefined?b:!0,this.currentTime=c!==undefined?c:0,this.startTimeMs=c,this.startTime=1e7,this.endTime=-this.startTime;var d,e=this.hierarchy.length,f,g;for(d=0;d<e;d++){f=this.hierarchy[d],g=this.data.hierarchy[d],f.useQuaternion=!0,g.animationCache===undefined&&(g.animationCache={},g.animationCache.prevKey=null,g.animationCache.nextKey=null,g.animationCache.originalMatrix=f instanceof a.Bone?f.skinMatrix:f.matrix);var h=this.data.hierarchy[d].keys;h.length&&(g.animationCache.prevKey=h[0],g.animationCache.nextKey=h[1],this.startTime=Math.min(h[0].time,this.startTime),this.endTime=Math.max(h[h.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,a.AnimationHandler.addToUpdate(this)},a.KeyFrameAnimation.prototype.pause=function(){this.isPaused?a.AnimationHandler.addToUpdate(this):a.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},a.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,a.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.data.hierarchy.length;b++){var c=this.hierarchy[b],d=this.data.hierarchy[b];if(d.animationCache!==undefined){var e=d.animationCache.originalMatrix;c instanceof a.Bone?(e.copy(c.skinMatrix),c.skinMatrix=e):(e.copy(c.matrix),c.matrix=e),delete d.animationCache}}},a.KeyFrameAnimation.prototype.update=function(b){if(!this.isPlaying)return;var c,d,e,f,g,h=this.data.JIT.hierarchy,i,j,k;this.currentTime+=b*this.timeScale,j=this.currentTime,i=this.currentTime=this.currentTime%this.data.length,i<this.startTimeMs&&(i=this.currentTime=this.startTimeMs+i),g=parseInt(Math.min(i*this.data.fps,this.data.length*this.data.fps),10),k=i<j;if(k&&!this.loop){for(var l=0,m=this.hierarchy.length;l<m;l++){var n=this.data.hierarchy[l].keys,o=this.data.hierarchy[l].sids,p=n.length-1,q=this.hierarchy[l];if(n.length){for(var r=0;r<o.length;r++){var s=o[r],t=this.getPrevKeyWith(s,l,p);t&&t.apply(s)}this.data.hierarchy[l].node.updateMatrix(),q.matrixWorldNeedsUpdate=!0}}this.stop();return}if(i<this.startTime)return;for(var l=0,m=this.hierarchy.length;l<m;l++){e=this.hierarchy[l],f=this.data.hierarchy[l];var n=f.keys,u=f.animationCache;if(this.JITCompile&&h[l][g]!==undefined)e instanceof a.Bone?(e.skinMatrix=h[l][g],e.matrixWorldNeedsUpdate=!1):(e.matrix=h[l][g],e.matrixWorldNeedsUpdate=!0);else if(n.length){this.JITCompile&&u&&(e instanceof a.Bone?e.skinMatrix=u.originalMatrix:e.matrix=u.originalMatrix),c=u.prevKey,d=u.nextKey;if(c&&d){if(d.time<=j){if(k&&this.loop){c=n[0],d=n[1];while(d.time<i)c=d,d=n[c.index+1]}else if(!k){var v=n.length-1;while(d.time<i&&d.index!==v)c=d,d=n[c.index+1]}u.prevKey=c,u.nextKey=d}d.time>=i?c.interpolate(d,i):c.interpolate(d,d.time)}this.data.hierarchy[l].node.updateMatrix(),e.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&h[0][g]===undefined){this.hierarchy[0].updateMatrixWorld(!0);for(var l=0;l<this.hierarchy.length;l++)this.hierarchy[l]instanceof a.Bone?h[l][g]=this.hierarchy[l].skinMatrix.clone():h[l][g]=this.hierarchy[l].matrix.clone()}},a.KeyFrameAnimation.prototype.getNextKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;c%=d.length;for(;c<d.length;c++)if(d[c].hasTarget(a))return d[c];return d[0]},a.KeyFrameAnimation.prototype.getPrevKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;c=c>=0?c:c+d.length;for(;c>=0;c--)if(d[c].hasTarget(a))return d[c];return d[d.length-1]},a.CubeCamera=function(b,c,d){a.Object3D.call(this);var e=90,f=1,g=new a.PerspectiveCamera(e,f,b,c);g.up.set(0,-1,0),g.lookAt(new a.Vector3(1,0,0)),this.add(g);var h=new a.PerspectiveCamera(e,f,b,c);h.up.set(0,-1,0),h.lookAt(new a.Vector3(-1,0,0)),this.add(h);var i=new a.PerspectiveCamera(e,f,b,c);i.up.set(0,0,1),i.lookAt(new a.Vector3(0,1,0)),this.add(i);var j=new a.PerspectiveCamera(e,f,b,c);j.up.set(0,0,-1),j.lookAt(new a.Vector3(0,-1,0)),this.add(j);var k=new a.PerspectiveCamera(e,f,b,c);k.up.set(0,-1,0),k.lookAt(new a.Vector3(0,0,1)),this.add(k);var l=new a.PerspectiveCamera(e,f,b,c);l.up.set(0,-1,0),l.lookAt(new a.Vector3(0,0,-1)),this.add(l),this.renderTarget=new a.WebGLRenderTargetCube(d,d,{format:a.RGBFormat,magFilter:a.LinearFilter,minFilter:a.LinearFilter}),this.updateCubeMap=function(a,b){var c=this.renderTarget,d=c.generateMipmaps;c.generateMipmaps=!1,c.activeCubeFace=0,a.render(b,g,c),c.activeCubeFace=1,a.render(b,h,c),c.activeCubeFace=2,a.render(b,i,c),c.activeCubeFace=3,a.render(b,j,c),c.activeCubeFace=4,a.render(b,k,c),c.generateMipmaps=d,c.activeCubeFace=5,a.render(b,l,c)}},a.CubeCamera.prototype=Object.create(a.Object3D.prototype),a.CombinedCamera=function(b,c,d,e,f,g,h){a.Camera.call(this),this.fov=d,this.left=-b/2,this.right=b/2,this.top=c/2,this.bottom=-c/2,this.cameraO=new a.OrthographicCamera(b/-2,b/2,c/2,c/-2,g,h),this.cameraP=new a.PerspectiveCamera(d,b/c,e,f),this.zoom=1,this.toPerspective();var i=b/c},a.CombinedCamera.prototype=Object.create(a.Camera.prototype),a.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},a.CombinedCamera.prototype.toOrthographic=function(){var a=this.fov,b=this.cameraP.aspect,c=this.cameraP.near,d=this.cameraP.far,e=(c+d)/2,f=Math.tan(a/2)*e,g=2*f,h=g*b,i=h/2;f/=this.zoom,i/=this.zoom,this.cameraO.left=-i,this.cameraO.right=i,this.cameraO.top=f,this.cameraO.bottom=-f,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},a.CombinedCamera.prototype.setSize=function(a,b){this.cameraP.aspect=a/b,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2},a.CombinedCamera.prototype.setFov=function(a){this.fov=a,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},a.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},a.CombinedCamera.prototype.setLens=function(a,b){b===undefined&&(b=24);var c=2*Math.atan(b/(a*2))*(180/Math.PI);return this.setFov(c),c},a.CombinedCamera.prototype.setZoom=function(a){this.zoom=a,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},a.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},a.AsteriskGeometry=function(b,c){a.Geometry.call(this);var d=b,e=c,f=.707*d,g=.707*e,h=[[d,0,0],[e,0,0],[-d,0,0],[-e,0,0],[0,d,0],[0,e,0],[0,-d,0],[0,-e,0],[0,0,d],[0,0,e],[0,0,-d],[0,0,-e],[f,f,0],[g,g,0],[-f,-f,0],[-g,-g,0],[f,-f,0],[g,-g,0],[-f,f,0],[-g,g,0],[f,0,f],[g,0,g],[-f,0,-f],[-g,0,-g],[f,0,-f],[g,0,-g],[-f,0,f],[-g,0,g],[0,f,f],[0,g,g],[0,-f,-f],[0,-g,-g],[0,f,-f],[0,g,-g],[0,-f,f],[0,-g,g]];for(var i=0,j=h.length;i<j;i++){var k=h[i][0],l=h[i][1],m=h[i][2];this.vertices.push(new a.Vector3(k,l,m))}},a.AsteriskGeometry.prototype=Object.create(a.Geometry.prototype),a.CircleGeometry=function(b,c,d,e){a.Geometry.call(this),b=b||50,d=d!==undefined?d:0,e=e!==undefined?e:Math.PI*2,c=c!==undefined?Math.max(3,c):8;var f,g=[],h=new a.Vector3,i=new a.UV(.5,.5);this.vertices.push(h),g.push(i);for(f=0;f<=c;f++){var j=new a.Vector3;j.x=b*Math.cos(d+f/c*e),j.y=b*Math.sin(d+f/c*e),this.vertices.push(j),g.push(new a.UV((j.x/b+1)/2,-(j.y/b+1)/2+1))}var k=new a.Vector3(0,0,-1);for(f=1;f<=c;f++){var l=f,m=f+1,n=0;this.faces.push(new a.Face3(l,m,n,[k,k,k])),this.faceVertexUvs[0].push([g[f],g[f+1],i])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:b}},a.CircleGeometry.prototype=Object.create(a.Geometry.prototype),a.CubeGeometry=function(b,c,d,e,f,g){function l(b,c,d,e,f,g,i,j){var k,l,m,n=h.widthSegments,o=h.heightSegments,p=f/2,q=g/2,r=h.vertices.length;if(b==="x"&&c==="y"||b==="y"&&c==="x")k="z";else if(b==="x"&&c==="z"||b==="z"&&c==="x")k="y",o=h.depthSegments;else if(b==="z"&&c==="y"||b==="y"&&c==="z")k="x",n=h.depthSegments;var s=n+1,t=o+1,u=f/n,v=g/o,w=new a.Vector3;w[k]=i>0?1:-1;for(m=0;m<t;m++)for(l=0;l<s;l++){var x=new a.Vector3;x[b]=(l*u-p)*d,x[c]=(m*v-q)*e,x[k]=i,h.vertices.push(x)}for(m=0;m<o;m++)for(l=0;l<n;l++){var y=l+s*m,z=l+s*(m+1),A=l+1+s*(m+1),B=l+1+s*m,C=new a.Face4(y+r,z+r,A+r,B+r);C.normal.copy(w),C.vertexNormals.push(w.clone(),w.clone(),w.clone(),w.clone()),C.materialIndex=j,h.faces.push(C),h.faceVertexUvs[0].push([new a.UV(l/n,1-m/o),new a.UV(l/n,1-(m+1)/o),new a.UV((l+1)/n,1-(m+1)/o),new a.UV((l+1)/n,1-m/o)])}}a.Geometry.call(this);var h=this;this.width=b,this.height=c,this.depth=d,this.widthSegments=e||1,this.heightSegments=f||1,this.depthSegments=g||1;var i=this.width/2,j=this.height/2,k=this.depth/2;l("z","y",-1,-1,this.depth,this.height,i,0),l("z","y",1,-1,this.depth,this.height,-i,1),l("x","z",1,1,this.width,this.depth,j,2),l("x","z",1,-1,this.width,this.depth,-j,3),l("x","y",1,-1,this.width,this.height,k,4),l("x","y",-1,-1,this.width,this.height,-k,5),this.computeCentroids(),this.mergeVertices()},a.CubeGeometry.prototype=Object.create(a.Geometry.prototype),a.CylinderGeometry=function(b,c,d,e,f,g){a.Geometry.call(this),b=b!==undefined?b:20,c=c!==undefined?c:20,d=d!==undefined?d:100;var h=d/2,i=e||8,j=f||1,k,l,m=[],n=[];for(l=0;l<=j;l++){var o=[],p=[],q=l/j,r=q*(c-b)+b;for(k=0;k<=i;k++){var s=k/i,t=new a.Vector3;t.x=r*Math.sin(s*Math.PI*2),t.y=-q*d+h,t.z=r*Math.cos(s*Math.PI*2),this.vertices.push(t),o.push(this.vertices.length-1),p.push(new a.UV(s,1-q))}m.push(o),n.push(p)}var u=(c-b)/d,v,w;for(k=0;k<i;k++){b!==0?(v=this.vertices[m[0][k]].clone(),w=this.vertices[m[0][k+1]].clone()):(v=this.vertices[m[1][k]].clone(),w=this.vertices[m[1][k+1]].clone()),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*u).normalize(),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*u).normalize();for(l=0;l<j;l++){var x=m[l][k],y=m[l+1][k],z=m[l+1][k+1],A=m[l][k+1],B=v.clone(),C=v.clone(),D=w.clone(),E=w.clone(),F=n[l][k].clone(),G=n[l+1][k].clone(),H=n[l+1][k+1].clone(),I=n[l][k+1].clone();this.faces.push(new a.Face4(x,y,z,A,[B,C,D,E])),this.faceVertexUvs[0].push([F,G,H,I])}}if(!g&&b>0){this.vertices.push(new a.Vector3(0,h,0));for(k=0;k<i;k++){var x=m[0][k],y=m[0][k+1],z=this.vertices.length-1,B=new a.Vector3(0,1,0),C=new a.Vector3(0,1,0),D=new a.Vector3(0,1,0),F=n[0][k].clone(),G=n[0][k+1].clone(),H=new a.UV(G.u,0);this.faces.push(new a.Face3(x,y,z,[B,C,D])),this.faceVertexUvs[0].push([F,G,H])}}if(!g&&c>0){this.vertices.push(new a.Vector3(0,-h,0));for(k=0;k<i;k++){var x=m[l][k+1],y=m[l][k],z=this.vertices.length-1,B=new a.Vector3(0,-1,0),C=new a.Vector3(0,-1,0),D=new a.Vector3(0,-1,0),F=n[l][k+1].clone(),G=n[l][k].clone(),H=new a.UV(G.u,1);this.faces.push(new a.Face3(x,y,z,[B,C,D])),this.faceVertexUvs[0].push([F,G,H])}}this.computeCentroids(),this.computeFaceNormals()},a.CylinderGeometry.prototype=Object.create(a.Geometry.prototype),a.ExtrudeGeometry=function(b,c){if(typeof b=="undefined"){b=[];return}a.Geometry.call(this),b=b instanceof Array?b:[b],this.shapebb=b[b.length-1].getBoundingBox(),this.addShapeList(b,c),this.computeCentroids(),this.computeFaceNormals()},a.ExtrudeGeometry.prototype=Object.create(a.Geometry.prototype),a.ExtrudeGeometry.prototype.addShapeList=function(a,b){var c=a.length;for(var d=0;d<c;d++){var e=a[d];this.addShape(e,b)}},a.ExtrudeGeometry.prototype.addShape=function(b,c){function H(a,b,c){return b||console.log("die"),b.clone().multiplyScalar(c).addSelf(a)}function T(a,b,c){return V(a,b,c)}function U(b,c,d){var e=Math.atan2(c.y-b.y,c.x-b.x),f=Math.atan2(d.y-b.y,d.x-b.x);e>f&&(f+=Math.PI*2);var g=(e+f)/2,h=-Math.cos(g),i=-Math.sin(g),j=new a.Vector2(h,i);return j}function V(b,c,d){var e=a.ExtrudeGeometry.__v1,f=a.ExtrudeGeometry.__v2,g=a.ExtrudeGeometry.__v3,h=a.ExtrudeGeometry.__v4,i=a.ExtrudeGeometry.__v5,j=a.ExtrudeGeometry.__v6,k,l,m,n,o,p;return e.set(b.x-c.x,b.y-c.y),f.set(b.x-d.x,b.y-d.y),k=e.normalize(),l=f.normalize(),g.set(-k.y,k.x),h.set(l.y,-l.x),i.copy(b).addSelf(g),j.copy(b).addSelf(h),i.equals(j)?h.clone():(i.copy(c).addSelf(g),j.copy(d).addSelf(h),m=k.dot(h),n=j.subSelf(i).dot(h),m===0&&(console.log("Either infinite or no solutions!"),n===0?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),o=n/m,o<0?U(b,c,d):(p=k.multiplyScalar(o).addSelf(i),p.subSelf(b).clone()))}function gb(){if(h){var a=0,b=N*a;for(X=0;X<P;X++)O=F[X],kb(O[2]+b,O[1]+b,O[0]+b,!0);a=j+g*2,b=N*a;for(X=0;X<P;X++)O=F[X],kb(O[0]+b,O[1]+b,O[2]+b,!1)}else{for(X=0;X<P;X++)O=F[X],kb(O[2],O[1],O[0],!0);for(X=0;X<P;X++)O=F[X],kb(O[0]+N*j,O[1]+N*j,O[2]+N*j,!1)}}function hb(){var a=0;ib(G,a),a+=G.length;for(w=0,x=D.length;w<x;w++)v=D[w],ib(v,a),a+=v.length}function ib(a,b){var c,d;X=a.length;while(--X>=0){c=X,d=X-1,d<0&&(d=a.length-1);var e=0,f=j+g*2;for(e=0;e<f;e++){var h=N*e,i=N*(e+1),k=b+c+h,l=b+d+h,m=b+d+i,n=b+c+i;lb(k,l,m,n,a,e,f,c,d)}}}function jb(b,c,d){y.vertices.push(new a.Vector3(b,c,d))}function kb(d,e,f,g){d+=A,e+=A,f+=A,y.faces.push(new a.Face3(d,e,f,null,null,n));var h=g?p.generateBottomUV(y,b,c,d,e,f):p.generateTopUV(y,b,c,d,e,f);y.faceVertexUvs[0].push(h)}function lb(d,e,f,g,h,i,j,k,l){d+=A,e+=A,f+=A,g+=A,y.faces.push(new a.Face4(d,e,f,g,null,null,o));var m=p.generateSideWallUV(y,b,h,c,d,e,f,g,i,j,k,l);y.faceVertexUvs[0].push(m)}var d=c.amount!==undefined?c.amount:100,e=c.bevelThickness!==undefined?c.bevelThickness:6,f=c.bevelSize!==undefined?c.bevelSize:e-2,g=c.bevelSegments!==undefined?c.bevelSegments:3,h=c.bevelEnabled!==undefined?c.bevelEnabled:!0,i=c.curveSegments!==undefined?c.curveSegments:12,j=c.steps!==undefined?c.steps:1,k=c.extrudePath,l,m=!1,n=c.material,o=c.extrudeMaterial,p=c.UVGenerator!==undefined?c.UVGenerator:a.ExtrudeGeometry.WorldUVGenerator,q=this.shapebb,r,s,t,u;k&&(l=k.getSpacedPoints(j),m=!0,h=!1,r=c.frames!==undefined?c.frames:new a.TubeGeometry.FrenetFrames(k,j,!1),s=new a.Vector3,t=new a.Vector3,u=new a.Vector3),h||(g=0,e=0,f=0);var v,w,x,y=this,z=[],A=this.vertices.length,B=b.extractPoints(),C=B.shape,D=B.holes,E=!a.Shape.Utils.isClockWise(C);if(E){C=C.reverse();for(w=0,x=D.length;w<x;w++)v=D[w],a.Shape.Utils.isClockWise(v)&&(D[w]=v.reverse());E=!1}var F=a.Shape.Utils.triangulateShape(C,D),G=C;for(w=0,x=D.length;w<x;w++)v=D[w],C=C.concat(v);var I,J,K,L,M,N=C.length,O,P=F.length,Q,R=G.length,S=180/Math.PI,W=[];for(var X=0,Y=G.length,Z=Y-1,$=X+1;X<Y;X++,Z++,$++){Z===Y&&(Z=0),$===Y&&($=0);var _=G[X],ab=G[Z],bb=G[$];W[X]=T(G[X],G[Z],G[$])}var cb=[],db,eb=W.concat();for(w=0,x=D.length;w<x;w++){v=D[w],db=[];for(X=0,Y=v.length,Z=Y-1,$=X+1;X<Y;X++,Z++,$++)Z===Y&&(Z=0),$===Y&&($=0),db[X]=T(v[X],v[Z],v[$]);cb.push(db),eb=eb.concat(db)}for(I=0;I<g;I++){K=I/g,L=e*(1-K),J=f*Math.sin(K*Math.PI/2);for(X=0,Y=G.length;X<Y;X++)M=H(G[X],W[X],J),jb(M.x,M.y,-L);for(w=0,x=D.length;w<x;w++){v=D[w],db=cb[w];for(X=0,Y=v.length;X<Y;X++)M=H(v[X],db[X],J),jb(M.x,M.y,-L)}}J=f;for(X=0;X<N;X++)M=h?H(C[X],eb[X],J):C[X],m?(t.copy(r.normals[0]).multiplyScalar(M.x),s.copy(r.binormals[0]).multiplyScalar(M.y),u.copy(l[0]).addSelf(t).addSelf(s),jb(u.x,u.y,u.z)):jb(M.x,M.y,0);var fb;for(fb=1;fb<=j;fb++)for(X=0;X<N;X++)M=h?H(C[X],eb[X],J):C[X],m?(t.copy(r.normals[fb]).multiplyScalar(M.x),s.copy(r.binormals[fb]).multiplyScalar(M.y),u.copy(l[fb]).addSelf(t).addSelf(s),jb(u.x,u.y,u.z)):jb(M.x,M.y,d/j*fb);for(I=g-1;I>=0;I--){K=I/g,L=e*(1-K),J=f*Math.sin(K*Math.PI/2);for(X=0,Y=G.length;X<Y;X++)M=H(G[X],W[X],J),jb(M.x,M.y,d+L);for(w=0,x=D.length;w<x;w++){v=D[w],db=cb[w];for(X=0,Y=v.length;X<Y;X++)M=H(v[X],db[X],J),m?jb(M.x,M.y+l[j-1].y,l[j-1].x+L):jb(M.x,M.y,d+L)}}gb(),hb()},a.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(b,c,d,e,f,g){var h=b.vertices[e].x,i=b.vertices[e].y,j=b.vertices[f].x,k=b.vertices[f].y,l=b.vertices[g].x,m=b.vertices[g].y;return[new a.UV(h,i),new a.UV(j,k),new a.UV(l,m)]},generateBottomUV:function(a,b,c,d,e,f){return this.generateTopUV(a,b,c,d,e,f)},generateSideWallUV:function(b,c,d,e,f,g,h,i,j,k,l,m){var n=b.vertices[f].x,o=b.vertices[f].y,p=b.vertices[f].z,q=b.vertices[g].x,r=b.vertices[g].y,s=b.vertices[g].z,t=b.vertices[h].x,u=b.vertices[h].y,v=b.vertices[h].z,w=b.vertices[i].x,x=b.vertices[i].y,y=b.vertices[i].z;return Math.abs(o-r)<.01?[new a.UV(n,1-p),new a.UV(q,1-s),new a.UV(t,1-v),new a.UV(w,1-y)]:[new a.UV(o,1-p),new a.UV(r,1-s),new a.UV(u,1-v),new a.UV(x,1-y)]}},a.ExtrudeGeometry.__v1=new a.Vector2,a.ExtrudeGeometry.__v2=new a.Vector2,a.ExtrudeGeometry.__v3=new a.Vector2,a.ExtrudeGeometry.__v4=new a.Vector2,a.ExtrudeGeometry.__v5=new a.Vector2,a.ExtrudeGeometry.__v6=new a.Vector2,a.ShapeGeometry=function(b,c){a.Geometry.call(this),b instanceof Array==0&&(b=[b]),this.shapebb=b[b.length-1].getBoundingBox(),this.addShapeList(b,c),this.computeCentroids(),this.computeFaceNormals()},a.ShapeGeometry.prototype=Object.create(a.Geometry.prototype),a.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++)this.addShape(a[c],b);return this},a.ShapeGeometry.prototype.addShape=function(b,c){c===undefined&&(c={});var d=c.material,e=c.UVGenerator===undefined?a.ExtrudeGeometry.WorldUVGenerator:c.UVGenerator,f=this.shapebb,g,h,i,j,k=this.vertices.length,l=b.extractPoints(),m=l.shape,n=l.holes,o=!a.Shape.Utils.isClockWise(m);if(o){m=m.reverse();for(g=0,h=n.length;g<h;g++)i=n[g],a.Shape.Utils.isClockWise(i)&&(n[g]=i.reverse());o=!1}var p=a.Shape.Utils.triangulateShape(m,n),q=m;for(g=0,h=n.length;g<h;g++)i=n[g],m=m.concat(i);var r,s=m.length,t,u=p.length,v,w=q.length;for(g=0;g<s;g++)r=m[g],this.vertices.push(new a.Vector3(r.x,r.y,0));for(g=0;g<u;g++){t=p[g];var x=t[0]+k,y=t[1]+k,z=t[2]+k;this.faces.push(new a.Face3(x,y,z,null,null,d)),this.faceVertexUvs[0].push(e.generateBottomUV(this,b,c,x,y,z))}},a.LatheGeometry=function(b,c,d){a.Geometry.call(this);var e=c||12,f=d||2*Math.PI,g=[],h=(new a.Matrix4).makeRotationZ(f/e);for(var i=0;i<b.length;i++)g[i]=b[i].clone(),this.vertices.push(g[i]);var j,k=e+1;for(j=0;j<k;j++)for(var i=0;i<g.length;i++)g[i]=h.multiplyVector3(g[i].clone()),this.vertices.push(g[i]);for(j=0;j<e;j++)for(var l=0,m=b.length;l<m-1;l++){var n=j*m+l,o=(j+1)%k*m+l,p=(j+1)%k*m+(l+1)%m,q=j*m+(l+1)%m;this.faces.push(new a.Face4(n,o,p,q)),this.faceVertexUvs[0].push([new a.UV(1-j/e,l/m),new a.UV(1-(j+1)/e,l/m),new a.UV(1-(j+1)/e,(l+1)/m),new a.UV(1-j/e,(l+1)/m)])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.LatheGeometry.prototype=Object.create(a.Geometry.prototype),a.PlaneGeometry=function(b,c,d,e){a.Geometry.call(this),this.width=b,this.height=c,this.widthSegments=d||1,this.heightSegments=e||1;var f,g,h=b/2,i=c/2,j=this.widthSegments,k=this.heightSegments,l=j+1,m=k+1,n=this.width/j,o=this.height/k,p=new a.Vector3(0,0,1);for(g=0;g<m;g++)for(f=0;f<l;f++){var q=f*n-h,r=g*o-i;this.vertices.push(new a.Vector3(q,-r,0))}for(g=0;g<k;g++)for(f=0;f<j;f++){var s=f+l*g,t=f+l*(g+1),u=f+1+l*(g+1),v=f+1+l*g,w=new a.Face4(s,t,u,v);w.normal.copy(p),w.vertexNormals.push(p.clone(),p.clone(),p.clone(),p.clone()),this.faces.push(w),this.faceVertexUvs[0].push([new a.UV(f/j,1-g/k),new a.UV(f/j,1-(g+1)/k),new a.UV((f+1)/j,1-(g+1)/k),new a.UV((f+1)/j,1-g/k)])}this.computeCentroids()},a.PlaneGeometry.prototype=Object.create(a.Geometry.prototype),a.SphereGeometry=function(b,c,d,e,f,g,h){a.Geometry.call(this),this.radius=b||50,this.widthSegments=Math.max(3,Math.floor(c)||8),this.heightSegments=Math.max(2,Math.floor(d)||6),e=e!==undefined?e:0,f=f!==undefined?f:Math.PI*2,g=g!==undefined?g:0,h=h!==undefined?h:Math.PI;var i,j,k=[],l=[];for(j=0;j<=this.heightSegments;j++){var m=[],n=[];for(i=0;i<=this.widthSegments;i++){var o=i/this.widthSegments,p=j/this.heightSegments,q=new a.Vector3;q.x=-this.radius*Math.cos(e+o*f)*Math.sin(g+p*h),q.y=this.radius*Math.cos(g+p*h),q.z=this.radius*Math.sin(e+o*f)*Math.sin(g+p*h),this.vertices.push(q),m.push(this.vertices.length-1),n.push(new a.UV(o,1-p))}k.push(m),l.push(n)}for(j=0;j<this.heightSegments;j++)for(i=0;i<this.widthSegments;i++){var r=k[j][i+1],s=k[j][i],t=k[j+1][i],u=k[j+1][i+1],v=this.vertices[r].clone().normalize(),w=this.vertices[s].clone().normalize(),x=this.vertices[t].clone().normalize(),y=this.vertices[u].clone().normalize(),z=l[j][i+1].clone(),A=l[j][i].clone(),B=l[j+1][i].clone(),C=l[j+1][i+1].clone();Math.abs(this.vertices[r].y)===this.radius?(this.faces.push(new a.Face3(r,t,u,[v,x,y])),this.faceVertexUvs[0].push([z,B,C])):Math.abs(this.vertices[t].y)===this.radius?(this.faces.push(new a.Face3(r,s,t,[v,w,x])),this.faceVertexUvs[0].push([z,A,B])):(this.faces.push(new a.Face4(r,s,t,u,[v,w,x,y])),this.faceVertexUvs[0].push([z,A,B,C]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:this.radius}},a.SphereGeometry.prototype=Object.create(a.Geometry.prototype),a.TextGeometry=function(b,c){var d=a.FontUtils.generateShapes(b,c);c.amount=c.height!==undefined?c.height:50,c.bevelThickness===undefined&&(c.bevelThickness=10),c.bevelSize===undefined&&(c.bevelSize=8),c.bevelEnabled===undefined&&(c.bevelEnabled=!1),a.ExtrudeGeometry.call(this,d,c)},a.TextGeometry.prototype=Object.create(a.ExtrudeGeometry.prototype),a.TorusGeometry=function(b,c,d,e,f){a.Geometry.call(this);var g=this;this.radius=b||100,this.tube=c||40,this.radialSegments=d||8,this.tubularSegments=e||6,this.arc=f||Math.PI*2;var h=new a.Vector3,i=[],j=[];for(var k=0;k<=this.radialSegments;k++)for(var l=0;l<=this.tubularSegments;l++){var m=l/this.tubularSegments*this.arc,n=k/this.radialSegments*Math.PI*2;h.x=this.radius*Math.cos(m),h.y=this.radius*Math.sin(m);var o=new a.Vector3;o.x=(this.radius+this.tube*Math.cos(n))*Math.cos(m),o.y=(this.radius+this.tube*Math.cos(n))*Math.sin(m),o.z=this.tube*Math.sin(n),this.vertices.push(o),i.push(new a.UV(l/this.tubularSegments,k/this.radialSegments)),j.push(o.clone().subSelf(h).normalize())}for(var k=1;k<=this.radialSegments;k++)for(var l=1;l<=this.tubularSegments;l++){var p=(this.tubularSegments+1)*k+l-1,q=(this.tubularSegments+1)*(k-1)+l-1,r=(this.tubularSegments+1)*(k-1)+l,s=(this.tubularSegments+1)*k+l,t=new a.Face4(p,q,r,s,[j[p],j[q],j[r],j[s]]);t.normal.addSelf(j[p]),t.normal.addSelf(j[q]),t.normal.addSelf(j[r]),t.normal.addSelf(j[s]),t.normal.normalize(),this.faces.push(t),this.faceVertexUvs[0].push([i[p].clone(),i[q].clone(),i[r].clone(),i[s].clone()])}this.computeCentroids()},a.TorusGeometry.prototype=Object.create(a.Geometry.prototype),a.TorusKnotGeometry=function(b,c,d,e,f,g,h){function E(b,c,d){return i.vertices.push(new a.Vector3(b,c,d))-1}function F(b,c,d,e,f,g){var h=Math.cos(b),i=Math.cos(c),j=Math.sin(b),k=d/e*b,l=Math.cos(k),m=f*(2+l)*.5*h,n=f*(2+l)*j*.5,o=g*f*Math.sin(k)*.5;return new a.Vector3(m,n,o)}a.Geometry.call(this);var i=this;this.radius=b||200,this.tube=c||40,this.radialSegments=d||64,this.tubularSegments=e||8,this.p=f||2,this.q=g||3,this.heightScale=h||1,this.grid=new Array(this.radialSegments);var j=new a.Vector3,k=new a.Vector3,l=new a.Vector3;for(var m=0;m<this.radialSegments;++m){this.grid[m]=new Array(this.tubularSegments);for(var n=0;n<this.tubularSegments;++n){var o=m/this.radialSegments*2*this.p*Math.PI,p=n/this.tubularSegments*2*Math.PI,q=F(o,p,this.q,this.p,this.radius,this.heightScale),r=F(o+.01,p,this.q,this.p,this.radius,this.heightScale),s,t;j.sub(r,q),k.add(r,q),l.cross(j,k),k.cross(l,j),l.normalize(),k.normalize(),s=-this.tube*Math.cos(p),t=this.tube*Math.sin(p),q.x+=s*k.x+t*l.x,q.y+=s*k.y+t*l.y,q.z+=s*k.z+t*l.z,this.grid[m][n]=E(q.x,q.y,q.z)}}for(var m=0;m<this.radialSegments;++m)for(var n=0;n<this.tubularSegments;++n){var u=(m+1)%this.radialSegments,v=(n+1)%this.tubularSegments,w=this.grid[m][n],x=this.grid[u][n],y=this.grid[u][v],z=this.grid[m][v],A=new a.UV(m/this.radialSegments,n/this.tubularSegments),B=new a.UV((m+1)/this.radialSegments,n/this.tubularSegments),C=new a.UV((m+1)/this.radialSegments,(n+1)/this.tubularSegments),D=new a.UV(m/this.radialSegments,(n+1)/this.tubularSegments);this.faces.push(new a.Face4(w,x,y,z)),this.faceVertexUvs[0].push([A,B,C,D])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.TorusKnotGeometry.prototype=Object.create(a.Geometry.prototype),a.TubeGeometry=function(b,c,d,e,f,g){function O(b,c,d){return h.vertices.push(new a.Vector3(b,c,d))-1}a.Geometry.call(this),this.path=b,this.segments=c||64,this.radius=d||1,this.radiusSegments=e||8,this.closed=f||!1,g&&(this.debug=new a.Object3D),this.grid=[];var h=this,i,j,k,l=this.segments+1,m,n,o,p,q,r,s,t,u,v,w,x=new a.Vector3,y,z,A,B,C,D,E,F,G,H,I,J,K=new a.TubeGeometry.FrenetFrames(b,c,f),L=K.tangents,M=K.normals,N=K.binormals;this.tangents=L,this.normals=M,this.binormals=N;for(y=0;y<l;y++){this.grid[y]=[],s=y/(l-1),w=b.getPointAt(s),i=L[y],j=M[y],k=N[y],this.debug&&(this.debug.add(new a.ArrowHelper(i,w,d,255)),this.debug.add(new a.ArrowHelper(j,w,d,16711680)),this.debug.add(new a.ArrowHelper(k,w,d,65280)));for(z=0;z<this.radiusSegments;z++)t=z/this.radiusSegments*2*Math.PI,u=-this.radius*Math.cos(t),v=this.radius*Math.sin(t),x.copy(w),x.x+=u*j.x+v*k.x,x.y+=u*j.y+v*k.y,x.z+=u*j.z+v*k.z,this.grid[y][z]=O(x.x,x.y,x.z)}for(y=0;y<this.segments;y++)for(z=0;z<this.radiusSegments;z++)A=f?(y+1)%this.segments:y+1,B=(z+1)%this.radiusSegments,C=this.grid[y][z],D=this.grid[A][z],E=this.grid[A][B],F=this.grid[y][B],G=new a.UV(y/this.segments,z/this.radiusSegments),H=new a.UV((y+1)/this.segments,z/this.radiusSegments),I=new a.UV((y+1)/this.segments,(z+1)/this.radiusSegments),J=new a.UV(y/this.segments,(z+1)/this.radiusSegments),this.faces.push(new a.Face4(C,D,E,F)),this.faceVertexUvs[0].push([G,H,I,J]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.TubeGeometry.prototype=Object.create(a.Geometry.prototype),a.TubeGeometry.FrenetFrames=function(b,c,d){function w(b){i[0]=new a.Vector3,j[0]=new a.Vector3,b===undefined&&(b=new a.Vector3(0,0,1)),i[0].cross(b,h[0]).normalize(),j[0].cross(h[0],i[0]).normalize()}function x(){var c=b.getTangentAt(o);i[0]=(new a.Vector3).sub(c,h[0]).normalize(),j[0]=(new a.Vector3).cross(h[0],i[0]),i[0].cross(j[0],h[0]).normalize(),j[0].cross(h[0],i[0]).normalize()}function y(){i[0]=new a.Vector3,j[0]=new a.Vector3,p=Number.MAX_VALUE,q=Math.abs(h[0].x),r=Math.abs(h[0].y),s=Math.abs(h[0].z),q<=p&&(p=q,f.set(1,0,0)),r<=p&&(p=r,f.set(0,1,0)),s<=p&&f.set(0,0,1),k.cross(h[0],f).normalize(),i[0].cross(h[0],k),j[0].cross(h[0],i[0])}var e=new a.Vector3,f=new a.Vector3,g=new a.Vector3,h=[],i=[],j=[],k=new a.Vector3,l=new a.Matrix4,m=c+1,n,o=1e-4,p,q,r,s,t,u,v;this.tangents=h,this.normals=i,this.binormals=j;for(t=0;t<m;t++)u=t/(m-1),h[t]=b.getTangentAt(u),h[t].normalize();y();for(t=1;t<m;t++)i[t]=i[t-1].clone(),j[t]=j[t-1].clone(),k.cross(h[t-1],h[t]),k.length()>o&&(k.normalize(),n=Math.acos(h[t-1].dot(h[t])),l.makeRotationAxis(k,n).multiplyVector3(i[t])),j[t].cross(h[t],i[t]);if(d){n=Math.acos(i[0].dot(i[m-1])),n/=m-1,h[0].dot(k.cross(i[0],i[m-1]))>0&&(n=-n);for(t=1;t<m;t++)l.makeRotationAxis(h[t],n*t).multiplyVector3(i[t]),j[t].cross(h[t],i[t])}},a.PolyhedronGeometry=function(b,c,d,e){function k(b){var c=b.normalize().clone();c.index=f.vertices.push(c)-1;var d=n(b)/2/Math.PI+.5,e=o(b)/Math.PI+.5;return c.uv=new a.UV(d,1-e),c}function l(b,c,d,e){if(e<1){var g=new a.Face3(b.index,c.index,d.index,[b.clone(),c.clone(),d.clone()]);g.centroid.addSelf(b).addSelf(c).addSelf(d).divideScalar(3),g.normal=g.centroid.clone().normalize(),f.faces.push(g);var h=n(g.centroid);f.faceVertexUvs[0].push([p(b.uv,b,h),p(c.uv,c,h),p(d.uv,d,h)])}else e-=1,l(b,m(b,c),m(b,d),e),l(m(b,c),c,m(c,d),e),l(m(b,d),m(c,d),d,e),l(m(b,c),m(c,d),m(b,d),e)}function m(b,c){i[b.index]||(i[b.index]=[]),i[c.index]||(i[c.index]=[]);var d=i[b.index][c.index];return d===undefined&&(i[b.index][c.index]=i[c.index][b.index]=d=k((new a.Vector3).add(b,c).divideScalar(2))),d}function n(a){return Math.atan2(a.z,-a.x)}function o(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}function p(b,c,d){return d<0&&b.u===1&&(b=new a.UV(b.u-1,b.v)),c.x===0&&c.z===0&&(b=new a.UV(d/2/Math.PI+.5,b.v)),b}a.Geometry.call(this),d=d||1,e=e||0;var f=this;for(var g=0,h=b.length;g<h;g++)k(new a.Vector3(b[g][0],b[g][1],b[g][2]));var i=[],j=this.vertices;for(var g=0,h=c.length;g<h;g++)l(j[c[g][0]],j[c[g][1]],j[c[g][2]],e);this.mergeVertices();for(var g=0,h=this.vertices.length;g<h;g++)this.vertices[g].multiplyScalar(d);this.computeCentroids(),this.boundingSphere={radius:d}},a.PolyhedronGeometry.prototype=Object.create(a.Geometry.prototype),a.IcosahedronGeometry=function(b,c){var d=(1+Math.sqrt(5))/2,e=[[-1,d,0],[1,d,0],[-1,-d,0],[1,-d,0],[0,-1,d],[0,1,d],[0,-1,-d],[0,1,-d],[d,0,-1],[d,0,1],[-d,0,-1],[-d,0,1]],f=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];a.PolyhedronGeometry.call(this,e,f,b,c)},a.IcosahedronGeometry.prototype=Object.create(a.Geometry.prototype),a.OctahedronGeometry=function(b,c){var d=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],e=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];a.PolyhedronGeometry.call(this,d,e,b,c)},a.OctahedronGeometry.prototype=Object.create(a.Geometry.prototype),a.TetrahedronGeometry=function(b,c){var d=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],e=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];a.PolyhedronGeometry.call(this,d,e,b,c)},a.TetrahedronGeometry.prototype=Object.create(a.Geometry.prototype),a.ParametricGeometry=function(b,c,d,e){a.Geometry.call(this);var f=this.vertices,g=this.faces,h=this.faceVertexUvs[0];e=e===undefined?!1:e;var i,j,k,l,m,n,o=d+1,p=c+1;for(i=0;i<=d;i++){n=i/d;for(k=0;k<=c;k++)m=k/c,l=b(m,n),f.push(l)}var q,r,s,t,u,v,w,x;for(i=0;i<d;i++)for(k=0;k<c;k++)q=i*p+k,r=i*p+k+1,s=(i+1)*p+k,t=(i+1)*p+k+1,u=new a.UV(k/c,i/d),v=new a.UV((k+1)/c,i/d),w=new a.UV(k/c,(i+1)/d),x=new a.UV((k+1)/c,(i+1)/d),e?(g.push(new a.Face3(q,r,s)),g.push(new a.Face3(r,t,s)),h.push([u,v,w]),h.push([v,x,w])):(g.push(new a.Face4(q,r,t,s)),h.push([u,v,x,w]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.ParametricGeometry.prototype=Object.create(a.Geometry.prototype),a.ConvexGeometry=function(b){function e(a){var d=b[a].clone(),e=d.length();d.x+=e*i(),d.y+=e*i(),d.z+=e*i();var g=[];for(var j=0;j<c.length;){var k=c[j];if(f(k,d)){for(var l=0;l<3;l++){var m=[k[l],k[(l+1)%3]],n=!0;for(var o=0;o<g.length;o++)if(h(g[o],m)){g[o]=g[g.length-1],g.pop(),n=!1;break}n&&g.push(m)}c[j]=c[c.length-1],c.pop()}else j++}for(var o=0;o<g.length;o++)c.push([g[o][0],g[o][1],a])}function f(a,c){var d=b[a[0]],e=b[a[1]],f=b[a[2]],h=g(d,e,f),i=h.dot(d);return h.dot(c)>=i}function g(b,c,d){var e=new a.Vector3,f=new a.Vector3;return e.sub(d,c),f.sub(b,c),e.crossSelf(f),e.normalize(),e}function h(a,b){return a[0]===b[1]&&a[1]===b[0]}function i(){return(Math.random()-.5)*2*1e-6}function j(b){var c=b.length();return new a.UV(b.x/c,b.y/c)}a.Geometry.call(this);var c=[[0,1,2],[0,2,1]];for(var d=3;d<b.length;d++)e(d);var k=0,l=new Array(b.length);for(var d=0;d<c.length;d++){var m=c[d];for(var n=0;n<3;n++)l[m[n]]===undefined&&(l[m[n]]=k++,this.vertices.push(b[m[n]])),m[n]=l[m[n]]}for(var d=0;d<c.length;d++)this.faces.push(new a.Face3(c[d][0],c[d][1],c[d][2]));for(var d=0;d<this.faces.length;d++){var m=this.faces[d];this.faceVertexUvs[0].push([j(this.vertices[m.a]),j(this.vertices[m.b]),j(this.vertices[m.c])])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.ConvexGeometry.prototype=Object.create(a.Geometry.prototype),a.AxisHelper=function(b){var c=new a.Geometry;c.vertices.push(new a.Vector3,new a.Vector3(b||1,0,0),new a.Vector3,new a.Vector3(0,b||1,0),new a.Vector3,new a.Vector3(0,0,b||1)),c.colors.push(new a.Color(16711680),new a.Color(16755200),new a.Color(65280),new a.Color(11206400),new a.Color(255),new a.Color(43775));var d=new a.LineBasicMaterial({vertexColors:a.VertexColors});a.Line.call(this,c,d,a.LinePieces)},a.AxisHelper.prototype=Object.create(a.Line.prototype),a.ArrowHelper=function(b,c,d,e){a.Object3D.call(this),e===undefined&&(e=16776960),d===undefined&&(d=20);var f=new a.Geometry;f.vertices.push(new a.Vector3(0,0,0)),f.vertices.push(new a.Vector3(0,1,0)),this.line=new a.Line(f,new a.LineBasicMaterial({color:e})),this.add(this.line);var g=new a.CylinderGeometry(0,.05,.25,5,1);this.cone=new a.Mesh(g,new a.MeshBasicMaterial({color:e})),this.cone.position.set(0,1,0),this.add(this.cone),c instanceof a.Vector3&&(this.position=c),this.setDirection(b),this.setLength(d)},a.ArrowHelper.prototype=Object.create(a.Object3D.prototype),a.ArrowHelper.prototype.setDirection=function(b){var c=(new a.Vector3(0,1,0)).crossSelf(b),d=Math.acos((new a.Vector3(0,1,0)).dot(b.clone().normalize()));this.matrix=(new a.Matrix4).makeRotationAxis(c.normalize(),d),this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)},a.ArrowHelper.prototype.setLength=function(a){this.scale.set(a,a,a)},a.ArrowHelper.prototype.setColor=function(a){this.line.material.color.setHex(a),this.cone.material.color.setHex(a)},a.CameraHelper=function(b){function i(a,b,c){j(a,c),j(b,c)}function j(b,d){c.geometry.vertices.push(new a.Vector3),c.geometry.colors.push(new a.Color(d)),c.pointMap[b]===undefined&&(c.pointMap[b]=[]),c.pointMap[b].push(c.geometry.vertices.length-1)}a.Line.call(this);var c=this;this.geometry=new a.Geometry,this.material=new a.LineBasicMaterial({color:16777215,vertexColors:a.FaceColors}),this.type=a.LinePieces,this.matrixWorld=b.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap={};var d=16755200,e=16711680,f=43775,g=16777215,h=3355443;i("n1","n2",d),i("n2","n4",d),i("n4","n3",d),i("n3","n1",d),i("f1","f2",d),i("f2","f4",d),i("f4","f3",d),i("f3","f1",d),i("n1","f1",d),i("n2","f2",d),i("n3","f3",d),i("n4","f4",d),i("p","n1",e),i("p","n2",e),i("p","n3",e),i("p","n4",e),i("u1","u2",f),i("u2","u3",f),i("u3","u1",f),i("c","t",g),i("p","c",h),i("cn1","cn2",h),i("cn3","cn4",h),i("cf1","cf2",h),i("cf3","cf4",h),this.camera=b,this.update(b)},a.CameraHelper.prototype=Object.create(a.Line.prototype),a.CameraHelper.prototype.update=function(){function e(c,d,e,f){a.CameraHelper.__v.set(d,e,f),a.CameraHelper.__projector.unprojectVector(a.CameraHelper.__v,a.CameraHelper.__c);var g=b.pointMap[c];if(g!==undefined)for(var h=0,i=g.length;h<i;h++)b.geometry.vertices[g[h]].copy(a.CameraHelper.__v)}var b=this,c=1,d=1;a.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-c,-d,-1),e("n2",c,-d,-1),e("n3",-c,d,-1),e("n4",c,d,-1),e("f1",-c,-d,1),e("f2",c,-d,1),e("f3",-c,d,1),e("f4",c,d,1),e("u1",c*.7,d*1.1,-1),e("u2",-c*.7,d*1.1,-1),e("u3",0,d*2,-1),e("cf1",-c,0,1),e("cf2",c,0,1),e("cf3",0,-d,1),e("cf4",0,d,1),e("cn1",-c,0,-1),e("cn2",c,0,-1),e("cn3",0,-d,-1),e("cn4",0,d,-1),this.geometry.verticesNeedUpdate=!0},a.CameraHelper.__projector=new a.Projector,a.CameraHelper.__v=new a.Vector3,a.CameraHelper.__c=new a.Camera,a.DirectionalLightHelper=function(b,c,d){a.Object3D.call(this),this.light=b,this.position=b.position,this.direction=new a.Vector3,this.direction.sub(b.target.position,b.position),this.color=b.color.clone();var e=a.Math.clamp(b.intensity,0,1);this.color.r*=e,this.color.g*=e,this.color.b*=e;var f=this.color.getHex(),g=new a.SphereGeometry(c,16,8),h=new a.AsteriskGeometry(c*1.25,c*2.25),i=new a.MeshBasicMaterial({color:f,fog:!1}),j=new a.LineBasicMaterial({color:f,fog:!1});this.lightArrow=new a.ArrowHelper(this.direction,null,d,f),this.lightSphere=new a.Mesh(g,i),this.lightArrow.cone.material.fog=!1,this.lightArrow.line.material.fog=!1,this.lightRays=new a.Line(h,j,a.LinePieces),this.add(this.lightArrow),this.add(this.lightSphere),this.add(this.lightRays),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=b,this.lightSphere.properties.gizmoRoot=this,this.targetSphere=null;if(b.target.properties.targetInverse){var k=new a.SphereGeometry(c,8,4),l=new a.MeshBasicMaterial({color:f,wireframe:!0,fog:!1});this.targetSphere=new a.Mesh(k,l),this.targetSphere.position=b.target.position,this.targetSphere.properties.isGizmo=!0,this.targetSphere.properties.gizmoSubject=b.target,this.targetSphere.properties.gizmoRoot=this.targetSphere;var m=new a.LineDashedMaterial({color:f,dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),n=new a.Geometry;n.vertices.push(this.position.clone()),n.vertices.push(this.targetSphere.position.clone()),n.computeLineDistances(),this.targetLine=new a.Line(n,m),this.targetLine.properties.isGizmo=!0}this.properties.isGizmo=!0},a.DirectionalLightHelper.prototype=Object.create(a.Object3D.prototype),a.DirectionalLightHelper.prototype.update=function(){this.direction.sub(this.light.target.position,this.light.position),this.lightArrow.setDirection(this.direction),this.color.copy(this.light.color);var b=a.Math.clamp(this.light.intensity,0,1);this.color.r*=b,this.color.g*=b,this.color.b*=b,this.lightArrow.setColor(this.color.getHex()),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),this.targetSphere.material.color.copy(this.color),this.targetLine.material.color.copy(this.color),this.targetLine.geometry.vertices[0].copy(this.light.position),this.targetLine.geometry.vertices[1].copy(this.light.target.position),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0},a.HemisphereLightHelper=function(b,c,d,e){a.Object3D.call(this),this.light=b,this.position=b.position;var f=a.Math.clamp(b.intensity,0,1);this.color=b.color.clone(),this.color.r*=f,this.color.g*=f,this.color.b*=f;var g=this.color.getHex();this.groundColor=b.groundColor.clone(),this.groundColor.r*=f,this.groundColor.g*=f,this.groundColor.b*=f;var h=this.groundColor.getHex(),i=new a.SphereGeometry(c,16,8,0,Math.PI*2,0,Math.PI*.5),j=new a.SphereGeometry(c,16,8,0,Math.PI*2,Math.PI*.5,Math.PI),k=new a.MeshBasicMaterial({color:g,fog:!1}),l=new a.MeshBasicMaterial({color:h,fog:!1});for(var m=0,n=i.faces.length;m<n;m++)i.faces[m].materialIndex=0;for(var m=0,n=j.faces.length;m<n;m++)j.faces[m].materialIndex=1;a.GeometryUtils.merge(i,j),this.lightSphere=new a.Mesh(i,new a.MeshFaceMaterial([k,l])),this.lightArrow=new a.ArrowHelper(new a.Vector3(0,1,0),new a.Vector3(0,(c+d)*1.1,0),d,g),this.lightArrow.rotation.x=Math.PI,this.lightArrowGround=new a.ArrowHelper(new a.Vector3(0,1,0),new a.Vector3(0,(c+d)*-1.1,0),d,h);var o=new a.Object3D;o.rotation.x=-Math.PI*.5,o.add(this.lightSphere),o.add(this.lightArrow),o.add(this.lightArrowGround),this.add(o),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=b,this.lightSphere.properties.gizmoRoot=this,this.properties.isGizmo=!0,this.target=new a.Vector3,this.lookAt(this.target)},a.HemisphereLightHelper.prototype=Object.create(a.Object3D.prototype),a.HemisphereLightHelper.prototype.update=function(){var b=a.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.groundColor.copy(this.light.groundColor),this.color.r*=b,this.color.g*=b,this.color.b*=b,this.groundColor.r*=b,this.groundColor.g*=b,this.groundColor.b*=b,this.lightSphere.material.materials[0].color.copy(this.color),this.lightSphere.material.materials[1].color.copy(this.groundColor),this.lightArrow.setColor(this.color.getHex()),this.lightArrowGround.setColor(this.groundColor.getHex()),this.lookAt(this.target)},a.PointLightHelper=function(b,c){a.Object3D.call(this),this.light=b,this.position=b.position,this.color=b.color.clone();var d=a.Math.clamp(b.intensity,0,1);this.color.r*=d,this.color.g*=d,this.color.b*=d;var e=this.color.getHex(),f=new a.SphereGeometry(c,16,8),g=new a.AsteriskGeometry(c*1.25,c*2.25),h=new a.IcosahedronGeometry(1,2),i=new a.MeshBasicMaterial({color:e,fog:!1}),j=new a.LineBasicMaterial({color:e,fog:!1}),k=new a.MeshBasicMaterial({color:e,fog:!1,wireframe:!0,opacity:.1,transparent:!0});this.lightSphere=new a.Mesh(f,i),this.lightRays=new a.Line(g,j,a.LinePieces),this.lightDistance=new a.Mesh(h,k);var l=b.distance;l===0?this.lightDistance.visible=!1:this.lightDistance.scale.set(l,l,l),this.add(this.lightSphere),this.add(this.lightRays),this.add(this.lightDistance),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=b,this.lightSphere.properties.gizmoRoot=this,this.properties.isGizmo=!0},a.PointLightHelper.prototype=Object.create(a.Object3D.prototype),a.PointLightHelper.prototype.update=function(){this.color.copy(this.light.color);var b=a.Math.clamp(this.light.intensity,0,1);this.color.r*=b,this.color.g*=b,this.color.b*=b,this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),this.lightDistance.material.color.copy(this.color);var c=this.light.distance;c===0?this.lightDistance.visible=!1:(this.lightDistance.visible=!0,this.lightDistance.scale.set(c,c,c))},a.SpotLightHelper=function(b,c,d){a.Object3D.call(this),this.light=b,this.position=b.position,this.direction=new a.Vector3,this.direction.sub(b.target.position,b.position),this.color=b.color.clone();var e=a.Math.clamp(b.intensity,0,1);this.color.r*=e,this.color.g*=e,this.color.b*=e;var f=this.color.getHex(),g=new a.SphereGeometry(c,16,8),h=new a.AsteriskGeometry(c*1.25,c*2.25),i=new a.CylinderGeometry(1e-4,1,1,8,1,!0),j=new a.Matrix4;j.rotateX(-Math.PI/2),j.translate(new a.Vector3(0,-0.5,0)),i.applyMatrix(j);var k=new a.MeshBasicMaterial({color:f,fog:!1}),l=new a.LineBasicMaterial({color:f,fog:!1}),m=new a.MeshBasicMaterial({color:f,fog:!1,wireframe:!0,opacity:.3,transparent:!0});this.lightArrow=new a.ArrowHelper(this.direction,null,d,f),this.lightSphere=new a.Mesh(g,k),this.lightCone=new a.Mesh(i,m);var n=b.distance?b.distance:1e4,o=n*Math.tan(b.angle*.5)*2;this.lightCone.scale.set(o,o,n),this.lightArrow.cone.material.fog=!1,this.lightArrow.line.material.fog=!1,this.lightRays=new a.Line(h,l,a.LinePieces),this.gyroscope=new a.Gyroscope,this.gyroscope.add(this.lightArrow),this.gyroscope.add(this.lightSphere),this.gyroscope.add(this.lightRays),this.add(this.gyroscope),this.add(this.lightCone),this.lookAt(b.target.position),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=b,this.lightSphere.properties.gizmoRoot=this,this.targetSphere=null;if(b.target.properties.targetInverse){var p=new a.SphereGeometry(c,8,4),q=new a.MeshBasicMaterial({color:f,wireframe:!0,fog:!1});this.targetSphere=new a.Mesh(p,q),this.targetSphere.position=b.target.position,this.targetSphere.properties.isGizmo=!0,this.targetSphere.properties.gizmoSubject=b.target,this.targetSphere.properties.gizmoRoot=this.targetSphere;var r=new a.LineDashedMaterial({color:f,dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),s=new a.Geometry;s.vertices.push(this.position.clone()),s.vertices.push(this.targetSphere.position.clone()),s.computeLineDistances(),this.targetLine=new a.Line(s,r),this.targetLine.properties.isGizmo=!0}this.properties.isGizmo=!0},a.SpotLightHelper.prototype=Object.create(a.Object3D.prototype),a.SpotLightHelper.prototype.update=function(){this.direction.sub(this.light.target.position,this.light.position),this.lightArrow.setDirection(this.direction),this.lookAt(this.light.target.position);var b=this.light.distance?this.light.distance:1e4,c=b*Math.tan(this.light.angle*.5)*2;this.lightCone.scale.set(c,c,b),this.color.copy(this.light.color);var d=a.Math.clamp(this.light.intensity,0,1);this.color.r*=d,this.color.g*=d,this.color.b*=d,this.lightArrow.setColor(this.color.getHex()),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),this.lightCone.material.color.copy(this.color),this.targetSphere.material.color.copy(this.color),this.targetLine.material.color.copy(this.color),this.targetLine.geometry.vertices[0].copy(this.light.position),this.targetLine.geometry.vertices[1].copy(this.light.target.position),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0},a.SubdivisionModifier=function(a){this.subdivisions=a===undefined?1:a,this.useOldVertexColors=!1,this.supportUVs=!0,this.debug=!1},a.SubdivisionModifier.prototype.modify=function(a){var b=this.subdivisions;while(b-->0)this.smooth(a)},a.GeometryUtils.orderedKey=function(a,b){return Math.min(a,b)+"_"+Math.max(a,b)},a.GeometryUtils.computeEdgeFaces=function(b){function p(a,b){n[a]===undefined&&(n[a]=[]),n[a].push(b)}var c,d,e,f,g,h,i,j,k,l,m,n={},o=a.GeometryUtils.orderedKey;for(c=0,d=b.faces.length;c<d;c++)i=b.faces[c],i instanceof a.Face3?(m=o(i.a,i.b),p(m,c),m=o(i.b,i.c),p(m,c),m=o(i.c,i.a),p(m,c)):i instanceof a.Face4&&(m=o(i.a,i.b),p(m,c),m=o(i.b,i.c),p(m,c),m=o(i.c,i.d),p(m,c),m=o(i.d,i.a),p(m,c));return n},a.SubdivisionModifier.prototype.smooth=function(b){function f(b,d,e){c.push(new a.Vector3(b,d,e))}function j(){g.debug&&console&&console.assert&&console.assert.apply(console,arguments)}function k(){g.debug&&console.log.apply(console,arguments)}function l(){console&&console.log.apply(console,arguments)}function m(b,c,f,h,i,j,l){var m=new a.Face4(b,c,f,h,null,i.color,i.materialIndex);if(g.useOldVertexColors){m.vertexColors=[];var n,o,p;for(var q=0;q<4;q++){p=j[q],n=new a.Color,n.setRGB(0,0,0);for(var r=0,s=0;r<p.length;r++)o=i.vertexColors[p[r]-1],n.r+=o.r,n.g+=o.g,n.b+=o.b;n.r/=p.length,n.g/=p.length,n.b/=p.length,m.vertexColors[q]=n}}d.push(m);if(g.supportUVs){var t=[x(b,""),x(c,l),x(f,l),x(h,l)];t[0]?t[1]?t[2]?t[3]?e.push(t):k("d :( ",h+":"+l):k("c :( ",f+":"+l):k("b :( ",c+":"+l):k("a :( ",b+":"+l)}}function w(){console.log("facePoints",r,"edgePoints",s),console.log("edgeFaceMap",K,"vertexEdgeMap",T)}function x(a,b){var c,d,e=a+":"+b,f=v[e];return f?f:(a>=p&&a<p+o.length?k("face pt"):k("edge pt"),l("warning, UV not found for",e),null)}function y(a,b,c){var d=a+":"+b;d in v?l("dup vertexNo",a,"oldFaceNo",b,"value",c,"key",d,v[d]):v[d]=c}function V(a,b){T[a]===undefined&&(T[a]=[]),T[a].push(b)}function W(a,b,c){U[a]===undefined&&(U[a]={}),U[a][b]=c}var c=[],d=[],e=[],g=this,h=a.GeometryUtils.orderedKey,i=a.GeometryUtils.computeEdgeFaces,n=b.vertices,o=b.faces,p=n.length,q=n.concat(),r=[],s={},t={},u=[],v={},z,A,B,C,D,E=b.faceVertexUvs[0],F="abcd",G;k("originalFaces, uvs, originalVerticesLength",o.length,E.length,p);if(g.supportUVs)for(z=0,A=E.length;z<A;z++)for(B=0,C=E[z].length;B<C;B++)G=o[z][F.charAt(B)],y(G,z,E[z][B]);E.length==0&&(g.supportUVs=!1);var H=0;for(var I in v)H++;H||(g.supportUVs=!1,k("no uvs"));var J;for(z=0,A=o.length;z<A;z++){D=o[z],r.push(D.centroid),q.push(D.centroid);if(!g.supportUVs)continue;J=new a.UV,D instanceof a.Face3?(J.u=x(D.a,z).u+x(D.b,z).u+x(D.c,z).u,J.v=x(D.a,z).v+x(D.b,z).v+x(D.c,z).v,J.u/=3,J.v/=3):D instanceof a.Face4&&(J.u=x(D.a,z).u+x(D.b,z).u+x(D.c,z).u+x(D.d,z).u,J.v=x(D.a,z).v+x(D.b,z).v+x(D.c,z).v+x(D.d,z).v,J.u/=4,J.v/=4),y(p+z,"",J)}var K=i(b),L,M,N,O,P=0,Q,R,S,T={},U={};for(z in K){L=K[z],Q=z.split("_"),R=Q[0],S=Q[1],V(R,[R,S]),V(S,[R,S]);for(B=0,C=L.length;B<C;B++)D=L[B],W(R,D,z),W(S,D,z);L.length<2&&(t[z]=!0,u[R]=!0,u[S]=!0)}for(z in K){L=K[z],M=L[0],N=L[1],Q=z.split("_"),R=Q[0],S=Q[1],O=new a.Vector3,j(L.length>0,"an edge without faces?!"),L.length==1?(O.addSelf(n[R]),O.addSelf(n[S]),O.multiplyScalar(.5),u[q.length]=!0):(O.addSelf(r[M]),O.addSelf(r[N]),O.addSelf(n[R]),O.addSelf(n[S]),O.multiplyScalar(.25)),s[z]=p+o.length+P,q.push(O),P++;if(!g.supportUVs)continue;J=new a.UV,J.u=x(R,M).u+x(S,M).u,J.v=x(R,M).v+x(S,M).v,J.u/=2,J.v/=2,y(s[z],M,J),L.length>=2&&(j(L.length==2,"did we plan for more than 2 edges?"),J=new a.UV,J.u=x(R,N).u+x(S,N).u,J.v=x(R,N).v+x(S,N).v,J.u/=2,J.v/=2,y(s[z],N,J))}k("-- Step 2 done");var X,Y,Z,$,_,ab,bb,cb=["123","12","2","23"],db=["123","23","3","31"],eb=["123","31","1","12"],fb=["1234","12","2","23"],gb=["1234","23","3","34"],hb=["1234","34","4","41"],ib=["1234","41","1","12"];for(z=0,A=r.length;z<A;z++)X=r[z],D=o[z],Y=p+z,D instanceof a.Face3?(Z=h(D.a,D.b),$=h(D.b,D.c),bb=h(D.c,D.a),m(Y,s[Z],D.b,s[$],D,cb,z),m(Y,s[$],D.c,s[bb],D,db,z),m(Y,s[bb],D.a,s[Z],D,eb,z)):D instanceof a.Face4?(Z=h(D.a,D.b),$=h(D.b,D.c),_=h(D.c,D.d),ab=h(D.d,D.a),m(Y,s[Z],D.b,s[$],D,fb,z),m(Y,s[$],D.c,s[_],D,gb,z),m(Y,s[_],D.d,s[ab],D,hb,z),m(Y,s[ab],D.a,s[Z],D,ib,z)):k("face should be a face!",D);c=q;var jb=new a.Vector3,kb=new a.Vector3,lb;for(z=0,A=n.length;z<A;z++){if(T[z]===undefined)continue;jb.set(0,0,0),kb.set(0,0,0);var mb=new a.Vector3(0,0,0),nb=0;for(B in U[z])jb.addSelf(r[B]),nb++;var ob=0;lb=T[z].length;var pb=nb!=lb;for(B=0;B<lb;B++)t[h(T[z][B][0],T[z][B][1])]&&ob++;jb.divideScalar(nb);var qb=0;if(pb){var rb;for(B=0;B<lb;B++){L=T[z][B],rb=K[h(L[0],L[1])].length==1;if(rb){var sb=n[L[0]].clone().addSelf(n[L[1]]).divideScalar(2);kb.addSelf(sb),qb++}}kb.divideScalar(4),j(qb==2,"should have only 2 boundary edges")}else{for(B=0;B<lb;B++){L=T[z][B];var sb=n[L[0]].clone().addSelf(n[L[1]]).divideScalar(2);kb.addSelf(sb)}kb.divideScalar(lb)}mb.addSelf(n[z]),pb?(mb.divideScalar(2),mb.addSelf(kb)):(mb.multiplyScalar(lb-3),mb.addSelf(jb),mb.addSelf(kb.multiplyScalar(2)),mb.divideScalar(lb)),c[z]=mb}var tb=b;tb.vertices=c,tb.faces=d,tb.faceVertexUvs[0]=e,delete tb.__tmpVertices,tb.computeCentroids(),tb.computeFaceNormals(),tb.computeVertexNormals()},a.ImmediateRenderObject=function(){a.Object3D.call(this),this.render=function(a){}},a.ImmediateRenderObject.prototype=Object.create(a.Object3D.prototype),a.LensFlare=function(b,c,d,e,f){a.Object3D.call(this),this.lensFlares=[],this.positionScreen=new a.Vector3,this.customUpdateCallback=undefined,b!==undefined&&this.add(b,c,d,e,f)},a.LensFlare.prototype=Object.create(a.Object3D.prototype),a.LensFlare.prototype.add=function(b,c,d,e,f,g){c===undefined&&(c=-1),d===undefined&&(d=0),g===undefined&&(g=1),f===undefined&&(f=new a.Color(16777215)),e===undefined&&(e=a.NormalBlending),d=Math.min(d,Math.max(0,d)),this.lensFlares.push({texture:b,size:c,distance:d,x:0,y:0,z:0,scale:1,rotation:1,opacity:g,color:f,blending:e})},a.LensFlare.prototype.updateLensFlares=function(){var a,b=this.lensFlares.length,c,d=-this.positionScreen.x*2,e=-this.positionScreen.y*2;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=(c.wantedRotation-c.rotation)*.25},a.MorphBlendMesh=function(b,c){a.Mesh.call(this,b,c),this.animationsMap={},this.animationsList=[];var d=this.geometry.morphTargets.length,e="__default",f=0,g=d-1,h=d/1;this.createAnimation(e,f,g,h),this.setAnimationWeight(e,1)},a.MorphBlendMesh.prototype=Object.create(a.Mesh.prototype),a.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){var e={startFrame:b,endFrame:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=e,this.animationsList.push(e)},a.MorphBlendMesh.prototype.autoCreateAnimations=function(a){var b=/([a-z]+)(\d+)/,c,d={},e=this.geometry;for(var f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f],i=h.name.match(b);if(i&&i.length>1){var j=i[1],k=i[2];d[j]||(d[j]={start:Infinity,end:-Infinity});var l=d[j];f<l.start&&(l.start=f),f>l.end&&(l.end=f),c||(c=j)}}for(var j in d){var l=d[j];this.createAnimation(j,l.start,l.end,a)}this.firstAnimation=c},a.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){var b=this.animationsMap[a];b&&(b.direction=1,b.directionBackwards=!1)},a.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){var b=this.animationsMap[a];b&&(b.direction=-1,b.directionBackwards=!0)},a.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)},a.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)},a.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)},a.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)},a.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0,c=this.animationsMap[a];return c&&(b=c.time),b},a.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1,c=this.animationsMap[a];return c&&(b=c.duration),b},a.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("animation["+a+"] undefined")},a.MorphBlendMesh.prototype.stopAnimation=function(a){var b=this.animationsMap[a];b&&(b.active=!1)},a.MorphBlendMesh.prototype.update=function(b){for(var c=0,d=this.animationsList.length;c<d;c++){var e=this.animationsList[c];if(!e.active)continue;var f=e.duration/e.length;e.time+=e.direction*b;if(e.mirroredLoop){if(e.time>e.duration||e.time<0)e.direction*=-1,e.time>e.duration&&(e.time=e.duration,e.directionBackwards=!0),e.time<0&&(e.time=0,e.directionBackwards=!1)}else e.time=e.time%e.duration,e.time<0&&(e.time+=e.duration);var g=e.startFrame+a.Math.clamp(Math.floor(e.time/f),0,e.length-1),h=e.weight;g!==e.currentFrame&&(this.morphTargetInfluences[e.lastFrame]=0,this.morphTargetInfluences[e.currentFrame]=1*h,this.morphTargetInfluences[g]=0,e.lastFrame=e.currentFrame,e.currentFrame=g);var i=e.time%f/f;e.directionBackwards&&(i=1-i),this.morphTargetInfluences[e.currentFrame]=i*h,this.morphTargetInfluences[e.lastFrame]=(1-i)*h}},a.LensFlarePlugin=function(){function e(a){var c=b.createProgram(),d=b.createShader(b.FRAGMENT_SHADER),e=b.createShader(b.VERTEX_SHADER);return b.shaderSource(d,a.fragmentShader),b.shaderSource(e,a.vertexShader),b.compileShader(d),b.compileShader(e),b.attachShader(c,d),b.attachShader(c,e),b.linkProgram(c),c}var b,c,d={};this.init=function(f){b=f.context,c=f,d.vertices=new Float32Array(16),d.faces=new Uint16Array(6);var g=0;d.vertices[g++]=-1,d.vertices[g++]=-1,d.vertices[g++]=0,d.vertices[g++]=0,d.vertices[g++]=1,d.vertices[g++]=-1,d.vertices[g++]=1,d.vertices[g++]=0,d.vertices[g++]=1,d.vertices[g++]=1,d.vertices[g++]=1,d.vertices[g++]=1,d.vertices[g++]=-1,d.vertices[g++]=1,d.vertices[g++]=0,d.vertices[g++]=1,g=0,d.faces[g++]=0,d.faces[g++]=1,d.faces[g++]=2,d.faces[g++]=0,d.faces[g++]=2,d.faces[g++]=3,d.vertexBuffer=b.createBuffer(),d.elementBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,d.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,d.vertices,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d.elementBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.faces,b.STATIC_DRAW),d.tempTexture=b.createTexture(),d.occlusionTexture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,d.tempTexture),b.texImage2D(b.TEXTURE_2D,0,b.RGB,16,16,0,b.RGB,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.bindTexture(b.TEXTURE_2D,d.occlusionTexture),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,16,16,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(d.hasVertexTexture=!1,d.program=e(a.ShaderFlares.lensFlare)):(d.hasVertexTexture=!0,d.program=e(a.ShaderFlares.lensFlareVertexTexture)),d.attributes={},d.uniforms={},d.attributes.vertex=b.getAttribLocation(d.program,"position"),d.attributes.uv=b.getAttribLocation(d.program,"uv"),d.uniforms.renderType=b.getUniformLocation(d.program,"renderType"),d.uniforms.map=b.getUniformLocation(d.program,"map"),d.uniforms.occlusionMap=b.getUniformLocation(d.program,"occlusionMap"),d.uniforms.opacity=b.getUniformLocation(d.program,"opacity"),d.uniforms.color=b.getUniformLocation(d.program,"color"),d.uniforms.scale=b.getUniformLocation(d.program,"scale"),d.uniforms.rotation=b.getUniformLocation(d.program,"rotation"),d.uniforms.screenPosition=b.getUniformLocation(d.program,"screenPosition"),d.attributesEnabled=!1},this.render=function(e,f,g,h){var i=e.__webglFlares,j=i.length;if(!j)return;var k=new a.Vector3,l=h/g,m=g*.5,n=h*.5,o=16/h,p=new a.Vector2(o*l,o),q=new a.Vector3(1,1,0),r=new a.Vector2(1,1),s=d.uniforms,t=d.attributes;b.useProgram(d.program),d.attributesEnabled||(b.enableVertexAttribArray(d.attributes.vertex),b.enableVertexAttribArray(d.attributes.uv),d.attributesEnabled=!0),b.uniform1i(s.occlusionMap,0),b.uniform1i(s.map,1),b.bindBuffer(b.ARRAY_BUFFER,d.vertexBuffer),b.vertexAttribPointer(t.vertex,2,b.FLOAT,!1,16,0),b.vertexAttribPointer(t.uv,2,b.FLOAT,!1,16,8),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d.elementBuffer),b.disable(b.CULL_FACE),b.depthMask(!1);var u,v,w,x,y;for(u=0;u<j;u++){o=16/h,p.set(o*l,o),x=i[u],k.set(x.matrixWorld.elements[12],x.matrixWorld.elements[13],x.matrixWorld.elements[14]),f.matrixWorldInverse.multiplyVector3(k),f.projectionMatrix.multiplyVector3(k),q.copy(k),r.x=q.x*m+m,r.y=q.y*n+n;if(d.hasVertexTexture||r.x>0&&r.x<g&&r.y>0&&r.y<h){b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,d.tempTexture),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGB,r.x-8,r.y-8,16,16,0),b.uniform1i(s.renderType,0),b.uniform2f(s.scale,p.x,p.y),b.uniform3f(s.screenPosition,q.x,q.y,q.z),b.disable(b.BLEND),b.enable(b.DEPTH_TEST),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,d.occlusionTexture),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,r.x-8,r.y-8,16,16,0),b.uniform1i(s.renderType,1),b.disable(b.DEPTH_TEST),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,d.tempTexture),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0),x.positionScreen.copy(q),x.customUpdateCallback?x.customUpdateCallback(x):x.updateLensFlares(),b.uniform1i(s.renderType,2),b.enable(b.BLEND);for(v=0,w=x.lensFlares.length;v<w;v++)y=x.lensFlares[v],y.opacity>.001&&y.scale>.001&&(q.x=y.x,q.y=y.y,q.z=y.z,o=y.size*y.scale/h,p.x=o*l,p.y=o,b.uniform3f(s.screenPosition,q.x,q.y,q.z),b.uniform2f(s.scale,p.x,p.y),b.uniform1f(s.rotation,y.rotation),b.uniform1f(s.opacity,y.opacity),b.uniform3f(s.color,y.color.r,y.color.g,y.color.b),c.setBlending(y.blending,y.blendEquation,y.blendSrc,y.blendDst),c.setTexture(y.texture,1),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0))}}b.enable(b.CULL_FACE),b.enable(b.DEPTH_TEST),b.depthMask(!0)}},a.ShadowMapPlugin=function(){function l(b,c){var d=new a.DirectionalLight;d.isVirtual=!0,d.onlyShadow=!0,d.castShadow=!0,d.shadowCameraNear=b.shadowCameraNear,d.shadowCameraFar=b.shadowCameraFar,d.shadowCameraLeft=b.shadowCameraLeft,d.shadowCameraRight=b.shadowCameraRight,d.shadowCameraBottom=b.shadowCameraBottom,d.shadowCameraTop=b.shadowCameraTop,d.shadowCameraVisible=b.shadowCameraVisible,d.shadowDarkness=b.shadowDarkness,d.shadowBias=b.shadowCascadeBias[c],d.shadowMapWidth=b.shadowCascadeWidth[c],d.shadowMapHeight=b.shadowCascadeHeight[c],d.pointsWorld=[],d.pointsFrustum=[];var e=d.pointsWorld,f=d.pointsFrustum;for(var g=0;g<8;g++)e[g]=new a.Vector3,f[g]=new a.Vector3;var h=b.shadowCascadeNearZ[c],i=b.shadowCascadeFarZ[c];return f[0].set(-1,-1,h),f[1].set(1,-1,h),f[2].set(-1,1,h),f[3].set(1,1,h),f[4].set(-1,-1,i),f[5].set(1,-1,i),f[6].set(-1,1,i),f[7].set(1,1,i),d}function m(a,b){var c=a.shadowCascadeArray[b];c.position.copy(a.position),c.target.position.copy(a.target.position),c.lookAt(c.target),c.shadowCameraVisible=a.shadowCameraVisible,c.shadowDarkness=a.shadowDarkness,c.shadowBias=a.shadowCascadeBias[b];var d=a.shadowCascadeNearZ[b],e=a.shadowCascadeFarZ[b],f=c.pointsFrustum;f[0].z=d,f[1].z=d,f[2].z=d,f[3].z=d,f[4].z=e,f[5].z=e,f[6].z=e,f[7].z=e}function n(b,c){var d=c.shadowCamera,e=c.pointsFrustum,f=c.pointsWorld;j.set(Infinity,Infinity,Infinity),k.set(-Infinity,-Infinity,-Infinity);for(var g=0;g<8;g++){var h=f[g];h.copy(e[g]),a.ShadowMapPlugin.__projector.unprojectVector(h,b),d.matrixWorldInverse.multiplyVector3(h),h.x<j.x&&(j.x=h.x),h.x>k.x&&(k.x=h.x),h.y<j.y&&(j.y=h.y),h.y>k.y&&(k.y=h.y),h.z<j.z&&(j.z=h.z),h.z>k.z&&(k.z=h.z)}d.left=j.x,d.right=k.x,d.top=k.y,d.bottom=j.y,d.updateProjectionMatrix()}function o(b){return b.material instanceof a.MeshFaceMaterial?b.material.materials[0]:b.material}var b,c,d,e,f,g,h=new a.Frustum,i=new a.Matrix4,j=new a.Vector3,k=new a.Vector3;this.init=function(h){b=h.context,c=h;var i=a.ShaderLib.depthRGBA,j=a.UniformsUtils.clone(i.uniforms);d=new a.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j}),e=new a.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j,morphTargets:!0}),f=new a.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j,skinning:!0}),g=new a.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j,morphTargets:!0,skinning:!0}),d._shadowPass=!0,e._shadowPass=!0,f._shadowPass=!0,g._shadowPass=!0},this.render=function(a,b){if(!c.shadowMapEnabled||!c.shadowMapAutoUpdate)return;this.update(a,b)},this.update=function(j,k){var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=[],F=0,G=null;b.clearColor(1,1,1,1),b.disable(b.BLEND),b.enable(b.CULL_FACE),b.frontFace(b.CCW),c.shadowMapCullFrontFaces?b.cullFace(b.FRONT):b.cullFace(b.BACK),c.setDepthTest(!0);for(p=0,q=j.__lights.length;p<q;p++){C=j.__lights[p];if(!C.castShadow)continue;if(C instanceof a.DirectionalLight&&C.shadowCascade)for(t=0;t<C.shadowCascadeCount;t++){var H;if(!C.shadowCascadeArray[t]){H=l(C,t),H.originalCamera=k;var I=new a.Gyroscope;I.position=C.shadowCascadeOffset,I.add(H),I.add(H.target),k.add(I),C.shadowCascadeArray[t]=H,console.log("Created virtualLight",H)}else H=C.shadowCascadeArray[t];m(C,t),E[F]=H,F++}else E[F]=C,F++}for(p=0,q=E.length;p<q;p++){C=E[p];if(!C.shadowMap){var J={minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat};C.shadowMap=new a.WebGLRenderTarget(C.shadowMapWidth,C.shadowMapHeight,J),C.shadowMapSize=new a.Vector2(C.shadowMapWidth,C.shadowMapHeight),C.shadowMatrix=new a.Matrix4}if(!C.shadowCamera){if(C instanceof a.SpotLight)C.shadowCamera=new a.PerspectiveCamera(C.shadowCameraFov,C.shadowMapWidth/C.shadowMapHeight,C.shadowCameraNear,C.shadowCameraFar);else{if(!(C instanceof a.DirectionalLight)){console.error("Unsupported light type for shadow");continue}C.shadowCamera=new a.OrthographicCamera(C.shadowCameraLeft,C.shadowCameraRight,C.shadowCameraTop,C.shadowCameraBottom,C.shadowCameraNear,C.shadowCameraFar)}j.add(C.shadowCamera),c.autoUpdateScene&&j.updateMatrixWorld()}C.shadowCameraVisible&&!C.cameraHelper&&(C.cameraHelper=new a.CameraHelper(C.shadowCamera),C.shadowCamera.add(C.cameraHelper)),C.isVirtual&&H.originalCamera==k&&n(k,C),u=C.shadowMap,v=C.shadowMatrix,w=C.shadowCamera,w.position.copy(C.matrixWorld.getPosition()),w.lookAt(C.target.matrixWorld.getPosition()),w.updateMatrixWorld(),w.matrixWorldInverse.getInverse(w.matrixWorld),C.cameraHelper&&(C.cameraHelper.visible=C.shadowCameraVisible),C.shadowCameraVisible&&C.cameraHelper.update(),v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiplySelf(w.projectionMatrix),v.multiplySelf(w.matrixWorldInverse),w._viewMatrixArray||(w._viewMatrixArray=new Float32Array(16)),w._projectionMatrixArray||(w._projectionMatrixArray=new Float32Array(16)),w.matrixWorldInverse.flattenToArray(w._viewMatrixArray),w.projectionMatrix.flattenToArray(w._projectionMatrixArray),i.multiply(w.projectionMatrix,w.matrixWorldInverse),h.setFromMatrix(i),c.setRenderTarget(u),c.clear(),D=j.__webglObjects;for(r=0,s=D.length;r<s;r++)A=D[r],B=A.object,A.render=!1,B.visible&&B.castShadow&&(!(B instanceof a.Mesh||B instanceof a.ParticleSystem)||!B.frustumCulled||h.contains(B))&&(B._modelViewMatrix.multiply(w.matrixWorldInverse,B.matrixWorld),A.render=!0);var K,L,M;for(r=0,s=D.length;r<s;r++)A=D[r],A.render&&(B=A.object,y=A.buffer,K=o(B),L=B.geometry.morphTargets.length>0&&K.morphTargets,M=B instanceof a.SkinnedMesh&&K.skinning,B.customDepthMaterial?z=B.customDepthMaterial:M?z=L?g:f:L?z=e:z=d,y instanceof a.BufferGeometry?c.renderBufferDirect(w,j.__lights,G,z,y,B):c.renderBuffer(w,j.__lights,G,z,y,B));D=j.__webglObjectsImmediate;for(r=0,s=D.length;r<s;r++)A=D[r],B=A.object,B.visible&&B.castShadow&&(B._modelViewMatrix.multiply(w.matrixWorldInverse,B.matrixWorld),c.renderImmediateObject(w,j.__lights,G,d,B))}var N=c.getClearColor(),O=c.getClearAlpha();b.clearColor(N.r,N.g,N.b,O),b.enable(b.BLEND),c.shadowMapCullFrontFaces&&b.cullFace(b.BACK)}},a.ShadowMapPlugin.__projector=new a.Projector,a.SpritePlugin=function(){function e(a){var c=b.createProgram(),d=b.createShader(b.FRAGMENT_SHADER),e=b.createShader(b.VERTEX_SHADER);return b.shaderSource(d,a.fragmentShader),b.shaderSource(e,a.vertexShader),b.compileShader(d),b.compileShader(e),b.attachShader(c,d),b.attachShader(c,e),b.linkProgram(c),c}function f(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}var b,c,d={};this.init=function(f){b=f.context,c=f,d.vertices=new Float32Array(16),d.faces=new Uint16Array(6);var g=0;d.vertices[g++]=-1,d.vertices[g++]=-1,d.vertices[g++]=0,d.vertices[g++]=0,d.vertices[g++]=1,d.vertices[g++]=-1,d.vertices[g++]=1,d.vertices[g++]=0,d.vertices[g++]=1,d.vertices[g++]=1,d.vertices[g++]=1,d.vertices[g++]=1,d.vertices[g++]=-1,d.vertices[g++]=1,d.vertices[g++]=0,d.vertices[g++]=1,g=0,d.faces[g++]=0,d.faces[g++]=1,d.faces[g++]=2,d.faces[g++]=0,d.faces[g++]=2,d.faces[g++]=3,d.vertexBuffer=b.createBuffer(),d.elementBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,d.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,d.vertices,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d.elementBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.faces,b.STATIC_DRAW),d.program=e(a.ShaderSprite.sprite),d.attributes={},d.uniforms={},d.attributes.position=b.getAttribLocation(d.program,"position"),d.attributes.uv=b.getAttribLocation(d.program,"uv"),d.uniforms.uvOffset=b.getUniformLocation(d.program,"uvOffset"),d.uniforms.uvScale=b.getUniformLocation(d.program,"uvScale"),d.uniforms.rotation=b.getUniformLocation(d.program,"rotation"),d.uniforms.scale=b.getUniformLocation(d.program,"scale"),d.uniforms.alignment=b.getUniformLocation(d.program,"alignment"),d.uniforms.color=b.getUniformLocation(d.program,"color"),d.uniforms.map=b.getUniformLocation(d.program,"map"),d.uniforms.opacity=b.getUniformLocation(d.program,"opacity"),d.uniforms.useScreenCoordinates=b.getUniformLocation(d.program,"useScreenCoordinates"),d.uniforms.affectedByDistance=b.getUniformLocation(d.program,"affectedByDistance"),d.uniforms.screenPosition=b.getUniformLocation(d.program,"screenPosition"),d.uniforms.modelViewMatrix=b.getUniformLocation(d.program,"modelViewMatrix"),d.uniforms.projectionMatrix=b.getUniformLocation(d.program,"projectionMatrix"),d.uniforms.fogType=b.getUniformLocation(d.program,"fogType"),d.uniforms.fogDensity=b.getUniformLocation(d.program,"fogDensity"),d.uniforms.fogNear=b.getUniformLocation(d.program,"fogNear"),d.uniforms.fogFar=b.getUniformLocation(d.program,"fogFar"),d.uniforms.fogColor=b.getUniformLocation(d.program,"fogColor"),d.attributesEnabled=!1},this.render=function(e,g,h,i){var j=e.__webglSprites,k=j.length;if(!k)return;var l=d.attributes,m=d.uniforms,n=i/h,o=h*.5,p=i*.5,q=!0;b.useProgram(d.program),d.attributesEnabled||(b.enableVertexAttribArray(l.position),b.enableVertexAttribArray(l.uv),d.attributesEnabled=!0),b.disable(b.CULL_FACE),b.enable(b.BLEND),b.depthMask(!0),b.bindBuffer(b.ARRAY_BUFFER,d.vertexBuffer),b.vertexAttribPointer(l.position,2,b.FLOAT,!1,16,0),b.vertexAttribPointer(l.uv,2,b.FLOAT,!1,16,8),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d.elementBuffer),b.uniformMatrix4fv(m.projectionMatrix,!1,g._projectionMatrixArray),b.activeTexture(b.TEXTURE0),b.uniform1i(m.map,0);var r=0,s=0,t=e.fog;t?(b.uniform3f(m.fogColor,t.color.r,t.color.g,t.color.b),t instanceof a.Fog?(b.uniform1f(m.fogNear,t.near),b.uniform1f(m.fogFar,t.far),b.uniform1i(m.fogType,1),r=1,s=1):t instanceof a.FogExp2&&(b.uniform1f(m.fogDensity,t.density),b.uniform1i(m.fogType,2),r=2,s=2)):(b.uniform1i(m.fogType,0),r=0,s=0);var u,v,w,x,y,z=[];for(u=0;u<k;u++){v=j[u];if(!v.visible||v.opacity===0)continue;v.useScreenCoordinates?v.z=-v.position.z:(v._modelViewMatrix.multiply(g.matrixWorldInverse,v.matrixWorld),v.z=-v._modelViewMatrix.elements[14])}j.sort(f);for(u=0;u<k;u++){v=j[u];if(!v.visible||v.opacity===0)continue;v.map&&v.map.image&&v.map.image.width&&(v.useScreenCoordinates?(b.uniform1i(m.useScreenCoordinates,1),b.uniform3f(m.screenPosition,(v.position.x-o)/o,(p-v.position.y)/p,Math.max(0,Math.min(1,v.position.z)))):(b.uniform1i(m.useScreenCoordinates,0),b.uniform1i(m.affectedByDistance,v.affectedByDistance?1:0),b.uniformMatrix4fv(m.modelViewMatrix,!1,v._modelViewMatrix.elements)),e.fog&&v.fog?y=s:y=0,r!==y&&(b.uniform1i(m.fogType,y),r=y),x=1/(v.scaleByViewport?i:1),z[0]=x*n*v.scale.x,z[1]=x*v.scale.y,b.uniform2f(m.uvScale,v.uvScale.x,v.uvScale.y),b.uniform2f(m.uvOffset,v.uvOffset.x,v.uvOffset.y),b.uniform2f(m.alignment,v.alignment.x,v.alignment.y),b.uniform1f(m.opacity,v.opacity),b.uniform3f(m.color,v.color.r,v.color.g,v.color.b),b.uniform1f(m.rotation,v.rotation),b.uniform2fv(m.scale,z),v.mergeWith3D&&!q?(b.enable(b.DEPTH_TEST),q=!0):!v.mergeWith3D&&q&&(b.disable(b.DEPTH_TEST),q=!1),c.setBlending(v.blending,v.blendEquation,v.blendSrc,v.blendDst),c.setTexture(v.map,0),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0))}b.enable(b.CULL_FACE),b.enable(b.DEPTH_TEST),b.depthMask(!0)}},a.DepthPassPlugin=function(){function j(b){return b.material instanceof a.MeshFaceMaterial?b.material.materials[0]:b.material}this.enabled=!1,this.renderTarget=null;var b,c,d,e,f,g,h=new a.Frustum,i=new a.Matrix4;this.init=function(h){b=h.context,c=h;var i=a.ShaderLib.depthRGBA,j=a.UniformsUtils.clone(i.uniforms);d=new a.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j}),e=new a.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j,morphTargets:!0}),f=new a.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j,skinning:!0}),g=new a.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j,morphTargets:!0,skinning:!0}),d._shadowPass=!0,e._shadowPass=!0,f._shadowPass=!0,g._shadowPass=!0},this.render=function(a,b){if(!this.enabled)return;this.update(a,b)},this.update=function(k,l){var m,n,o,p,q,r,s,t,u,v,w,x,y=null;b.clearColor(1,1,1,1),b.disable(b.BLEND),c.setDepthTest(!0),c.autoUpdateScene&&k.updateMatrixWorld(),l._viewMatrixArray||(l._viewMatrixArray=new Float32Array(16)),l._projectionMatrixArray||(l._projectionMatrixArray=new Float32Array(16)),l.matrixWorldInverse.getInverse(l.matrixWorld),l.matrixWorldInverse.flattenToArray(l._viewMatrixArray),l.projectionMatrix.flattenToArray(l._projectionMatrixArray),i.multiply(l.projectionMatrix,l.matrixWorldInverse),h.setFromMatrix(i),c.setRenderTarget(this.renderTarget),c.clear(),x=k.__webglObjects;for(o=0,p=x.length;o<p;o++)u=x[o],v=u.object,u.render=!1,v.visible&&(!(v instanceof a.Mesh||v instanceof a.ParticleSystem)||!v.frustumCulled||h.contains(v))&&(v._modelViewMatrix.multiply(l.matrixWorldInverse,v.matrixWorld),u.render=!0);var z,A,B;for(o=0,p=x.length;o<p;o++){u=x[o];if(u.render){v=u.object,s=u.buffer;if(v instanceof a.ParticleSystem&&!v.customDepthMaterial)continue;z=j(v),z&&c.setMaterialFaces(v.material),A=v.geometry.morphTargets.length>0&&z.morphTargets,B=v instanceof a.SkinnedMesh&&z.skinning,v.customDepthMaterial?t=v.customDepthMaterial:B?t=A?g:f:A?t=e:t=d,s instanceof a.BufferGeometry?c.renderBufferDirect(l,k.__lights,y,t,s,v):c.renderBuffer(l,k.__lights,y,t,s,v)}}x=k.__webglObjectsImmediate;for(o=0,p=x.length;o<p;o++)u=x[o],v=u.object,v.visible&&(v._modelViewMatrix.multiply(l.matrixWorldInverse,v.matrixWorld),c.renderImmediateObject(l,k.__lights,y,d,v));var C=c.getClearColor(),D=c.getClearAlpha();b.clearColor(C.r,C.g,C.b,D),b.enable(b.BLEND)}},a.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform int renderType;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility = (       visibility.r / 9.0 ) *","( 1.0 - visibility.g / 9.0 ) *","(       visibility.b / 9.0 ) *","( 1.0 - visibility.a / 9.0 );","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform sampler2D map;","uniform float opacity;","uniform int renderType;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform int renderType;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform int renderType;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},a.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int affectedByDistance;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["precision mediump float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},define("Three",function(a){return function(){return a.THREE}}(this)),a.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},define("CopyShader",function(){}),a.ConvolutionShader={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{type:"t",value:null},uImageIncrement:{type:"v2",value:new a.Vector2(.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(a){function b(a,b){return Math.exp(-(a*a)/(2*b*b))}var c,d,e,f,g=25,h=2*Math.ceil(a*3)+1;h>g&&(h=g),f=(h-1)*.5,d=new Array(h),e=0;for(c=0;c<h;++c)d[c]=b(c-f,a),e+=d[c];for(c=0;c<h;++c)d[c]/=e;return d}},define("ConvolutionShader",function(){}),a.VignetteShader={uniforms:{tDiffuse:{type:"t",value:null},offset:{type:"f",value:1},darkness:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},define("VignetteShader",function(){}),a.FilmShader={uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0},nIntensity:{type:"f",value:.5},sIntensity:{type:"f",value:.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float x = vUv.x * vUv.y * time *  1000.0;","x = mod( x, 13.0 ) * mod( x, 123.0 );","float dx = mod( x, 0.01 );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},define("FilmShader",function(){}),a.TrackballControls=function(b,c){function q(a){if(!d.enabled)return;window.removeEventListener("keydown",q),h=g;if(g!==e.NONE)return;a.keyCode===d.keys[e.ROTATE]&&!d.noRotate?g=e.ROTATE:a.keyCode===d.keys[e.ZOOM]&&!d.noZoom?g=e.ZOOM:a.keyCode===d.keys[e.PAN]&&!d.noPan&&(g=e.PAN)}function r(a){if(!d.enabled)return;g=h,window.addEventListener("keydown",q,!1)}function s(a){if(!d.enabled)return;a.preventDefault(),a.stopPropagation(),g===e.NONE&&(g=a.button),g===e.ROTATE&&!d.noRotate?j=k=d.getMouseProjectionOnBall(a.clientX,a.clientY):g===e.ZOOM&&!d.noZoom?l=m=d.getMouseOnScreen(a.clientX,a.clientY):g===e.PAN&&!d.noPan&&(n=o=d.getMouseOnScreen(a.clientX,a.clientY)),document.addEventListener("mousemove",t,!1),document.addEventListener("mouseup",u,!1)}function t(a){if(!d.enabled)return;g===e.ROTATE&&!d.noRotate?k=d.getMouseProjectionOnBall(a.clientX,a.clientY):g===e.ZOOM&&!d.noZoom?m=d.getMouseOnScreen(a.clientX,a.clientY):g===e.PAN&&!d.noPan&&(o=d.getMouseOnScreen(a.clientX,a.clientY))}function u(a){if(!d.enabled)return;a.preventDefault(),a.stopPropagation(),g=e.NONE,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",u)}function v(a){if(!d.enabled)return;a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),l.y+=1/b*.05}function w(a){if(!d.enabled)return;a.preventDefault();switch(a.touches.length){case 1:j=k=d.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY);break;case 2:l=m=d.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY);break;case 3:n=o=d.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY)}}function x(a){if(!d.enabled)return;a.preventDefault();switch(a.touches.length){case 1:k=d.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY);break;case 2:m=d.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY);break;case 3:o=d.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY)}}a.EventTarget.call(this);var d=this,e={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};this.object=b,this.domElement=c!==undefined?c:document,this.enabled=!0,this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=Infinity,this.keys=[65,83,68],this.target=new a.Vector3;var f=new a.Vector3,g=e.NONE,h=e.NONE,i=new a.Vector3,j=new a.Vector3,k=new a.Vector3,l=new a.Vector2,m=new a.Vector2,n=new a.Vector2,o=new a.Vector2,p={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth,this.screen.height=window.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleEvent=function(a){typeof this[a.type]=="function"&&this[a.type](a)},this.getMouseOnScreen=function(b,c){return new a.Vector2((b-d.screen.offsetLeft)/d.radius*.5,(c-d.screen.offsetTop)/d.radius*.5)},this.getMouseProjectionOnBall=function(b,c){var e=new a.Vector3((b-d.screen.width*.5-d.screen.offsetLeft)/d.radius,(d.screen.height*.5+d.screen.offsetTop-c)/d.radius,0),f=e.length();f>1?e.normalize():e.z=Math.sqrt(1-f*f),i.copy(d.object.position).subSelf(d.target);var g=d.object.up.clone().setLength(e.y);return g.addSelf(d.object.up.clone().crossSelf(i).setLength(e.x)),g.addSelf(i.setLength(e.z)),g},this.rotateCamera=function(){var b=Math.acos(j.dot(k)/j.length()/k.length());if(b){var c=(new a.Vector3).cross(j,k).normalize(),e=new a.Quaternion;b*=d.rotateSpeed,e.setFromAxisAngle(c,-b),e.multiplyVector3(i),e.multiplyVector3(d.object.up),e.multiplyVector3(k),d.staticMoving?j.copy(k):(e.setFromAxisAngle(c,b*(d.dynamicDampingFactor-1)),e.multiplyVector3(j))}},this.zoomCamera=function(){var a=1+(m.y-l.y)*d.zoomSpeed;a!==1&&a>0&&(i.multiplyScalar(a),d.staticMoving?l.copy(m):l.y+=(m.y-l.y)*this.dynamicDampingFactor)},this.panCamera=function(){var a=o.clone().subSelf(n);if(a.lengthSq()){a.multiplyScalar(i.length()*d.panSpeed);var b=i.clone().crossSelf(d.object.up).setLength(a.x);b.addSelf(d.object.up.clone().setLength(a.y)),d.object.position.addSelf(b),d.target.addSelf(b),d.staticMoving?n=o:n.addSelf(a.sub(o,n).multiplyScalar(d.dynamicDampingFactor))}},this.checkDistances=function(){if(!d.noZoom||!d.noPan)d.object.position.lengthSq()>d.maxDistance*d.maxDistance&&d.object.position.setLength(d.maxDistance),i.lengthSq()<d.minDistance*d.minDistance&&d.object.position.add(d.target,i.setLength(d.minDistance))},this.update=function(){i.copy(d.object.position).subSelf(d.target),d.noRotate||d.rotateCamera(),d.noZoom||d.zoomCamera(),d.noPan||d.panCamera(),d.object.position.add(d.target,i),d.checkDistances(),d.object.lookAt(d.target),f.distanceToSquared(d.object.position)>0&&(d.dispatchEvent(p),f.copy(d.object.position))},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",s,!1),this.domElement.addEventListener("mousewheel",v,!1),this.domElement.addEventListener("DOMMouseScroll",v,!1),this.domElement.addEventListener("touchstart",w,!1),this.domElement.addEventListener("touchend",w,!1),this.domElement.addEventListener("touchmove",x,!1),window.addEventListener("keydown",q,!1),window.addEventListener("keyup",r,!1),this.handleResize()},define("TrackballControls",function(){}),a.EffectComposer=function(b,c){this.renderer=b,this.renderTarget1=c;if(this.renderTarget1===undefined){var d=window.innerWidth||1,e=window.innerHeight||1;this.renderTargetParameters={minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBFormat,stencilBuffer:!1},this.renderTarget1=new a.WebGLRenderTarget(d,e,this.renderTargetParameters)}this.renderTarget2=this.renderTarget1.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],a.CopyShader===undefined&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new a.ShaderPass(a.CopyShader)},a.EffectComposer.prototype={swapBuffers:function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=a},addPass:function(a){this.passes.push(a)},render:function(b){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var c=!1,d,e,f=this.passes.length;for(e=0;e<f;e++){d=this.passes[e];if(!d.enabled)continue;d.render(this.renderer,this.writeBuffer,this.readBuffer,b,c);if(d.needsSwap){if(c){var g=this.renderer.context;g.stencilFunc(g.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,b),g.stencilFunc(g.EQUAL,1,4294967295)}this.swapBuffers()}d instanceof a.MaskPass?c=!0:d instanceof a.ClearMaskPass&&(c=!1)}},reset:function(b){this.renderTarget1=b,this.renderTarget1===undefined&&(this.renderTarget1=new a.WebGLRenderTarget(window.innerWidth,window.innerHeight,this.renderTargetParameters)),this.renderTarget2=this.renderTarget1.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}},a.EffectComposer.camera=new a.OrthographicCamera(-1,1,1,-1,0,1),a.EffectComposer.quad=new a.Mesh(new a.PlaneGeometry(2,2),null),a.EffectComposer.scene=new a.Scene,a.EffectComposer.scene.add(a.EffectComposer.quad),define("EffectComposer",function(){}),a.RenderPass=function(b,c,d,e,f){this.scene=b,this.camera=c,this.overrideMaterial=d,this.clearColor=e,this.clearAlpha=f!==undefined?f:1,this.oldClearColor=new a.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},a.RenderPass.prototype={render:function(a,b,c,d){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(a.getClearColor()),this.oldClearAlpha=a.getClearAlpha(),a.setClearColor(this.clearColor,this.clearAlpha)),a.render(this.scene,this.camera,c,this.clear),this.clearColor&&a.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}},define("RenderPass",function(){}),a.BloomPass=function(b,c,d,e){b=b!==undefined?b:1,c=c!==undefined?c:25,d=d!==undefined?d:4,e=e!==undefined?e:256;var f={minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBFormat};this.renderTargetX=new a.WebGLRenderTarget(e,e,f),this.renderTargetY=new a.WebGLRenderTarget(e,e,f),a.CopyShader===undefined&&console.error("THREE.BloomPass relies on THREE.CopyShader");var g=a.CopyShader;this.copyUniforms=a.UniformsUtils.clone(g.uniforms),this.copyUniforms.opacity.value=b,this.materialCopy=new a.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,blending:a.AdditiveBlending,transparent:!0}),a.ConvolutionShader===undefined&&console.error("THREE.BloomPass relies on THREE.ConvolutionShader");var h=a.ConvolutionShader;this.convolutionUniforms=a.UniformsUtils.clone(h.uniforms),this.convolutionUniforms.uImageIncrement.value=a.BloomPass.blurx,this.convolutionUniforms.cKernel.value=a.ConvolutionShader.buildKernel(d),this.materialConvolution=new a.ShaderMaterial({uniforms:this.convolutionUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{KERNEL_SIZE_FLOAT:c.toFixed(1),KERNEL_SIZE_INT:c.toFixed(0)}}),this.enabled=!0,this.needsSwap=!1,this.clear=!1},a.BloomPass.prototype={render:function(b,c,d,e,f){f&&b.context.disable(b.context.STENCIL_TEST),a.EffectComposer.quad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=d,this.convolutionUniforms.uImageIncrement.value=a.BloomPass.blurX,b.render(a.EffectComposer.scene,a.EffectComposer.camera,this.renderTargetX,!0),this.convolutionUniforms.tDiffuse.value=this.renderTargetX,this.convolutionUniforms.uImageIncrement.value=a.BloomPass.blurY,b.render(a.EffectComposer.scene,a.EffectComposer.camera,this.renderTargetY,!0),a.EffectComposer.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY,f&&b.context.enable(b.context.STENCIL_TEST),b.render(a.EffectComposer.scene,a.EffectComposer.camera,d,this.clear)}},a.BloomPass.blurX=new a.Vector2(.001953125,0),a.BloomPass.blurY=new a.Vector2(0,.001953125),define("BloomPass",function(){}),a.FilmPass=function(b,c,d,e){a.FilmShader===undefined&&console.error("THREE.FilmPass relies on THREE.FilmShader");var f=a.FilmShader;this.uniforms=a.UniformsUtils.clone(f.uniforms),this.material=new a.ShaderMaterial({uniforms:this.uniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}),e!==undefined&&(this.uniforms.grayscale.value=e),b!==undefined&&(this.uniforms.nIntensity.value=b),c!==undefined&&(this.uniforms.sIntensity.value=c),d!==undefined&&(this.uniforms.sCount.value=d),this.enabled=!0,this.renderToScreen=!1,this.needsSwap=!0},a.FilmPass.prototype={render:function(b,c,d,e){this.uniforms.tDiffuse.value=d,this.uniforms.time.value+=e,a.EffectComposer.quad.material=this.material,this.renderToScreen?b.render(a.EffectComposer.scene,a.EffectComposer.camera):b.render(a.EffectComposer.scene,a.EffectComposer.camera,c,!1)}},define("FilmPass",function(){}),a.TexturePass=function(b,c){a.CopyShader===undefined&&console.error("THREE.TexturePass relies on THREE.CopyShader");var d=a.CopyShader;this.uniforms=a.UniformsUtils.clone(d.uniforms),this.uniforms.opacity.value=c!==undefined?c:1,this.uniforms.tDiffuse.value=b,this.material=new a.ShaderMaterial({uniforms:this.uniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader}),this.enabled=!0,this.needsSwap=!1},a.TexturePass.prototype={render:function(b,c,d,e){a.EffectComposer.quad.material=this.material,b.render(a.EffectComposer.scene,a.EffectComposer.camera,d)}},define("TexturePass",function(){}),a.ShaderPass=function(b,c){this.textureID=c!==undefined?c:"tDiffuse",this.uniforms=a.UniformsUtils.clone(b.uniforms),this.material=new a.ShaderMaterial({uniforms:this.uniforms,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1},a.ShaderPass.prototype={render:function(b,c,d,e){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=d),a.EffectComposer.quad.material=this.material,this.renderToScreen?b.render(a.EffectComposer.scene,a.EffectComposer.camera):b.render(a.EffectComposer.scene,a.EffectComposer.camera,c,this.clear)}},define("ShaderPass",function(){}),a.MaskPass=function(a,b){this.scene=a,this.camera=b,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},a.MaskPass.prototype={render:function(a,b,c,d){var e=a.context;e.colorMask(!1,!1,!1,!1),e.depthMask(!1);var f,g;this.inverse?(f=0,g=1):(f=1,g=0),e.enable(e.STENCIL_TEST),e.stencilOp(e.REPLACE,e.REPLACE,e.REPLACE),e.stencilFunc(e.ALWAYS,f,4294967295),e.clearStencil(g),a.render(this.scene,this.camera,c,this.clear),a.render(this.scene,this.camera,b,this.clear),e.colorMask(!0,!0,!0,!0),e.depthMask(!0),e.stencilFunc(e.EQUAL,1,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}},a.ClearMaskPass=function(){this.enabled=!0},a.ClearMaskPass.prototype={render:function(a,b,c,d){var e=a.context;e.disable(e.STENCIL_TEST)}},define("MaskPass",function(){}),function(){var b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("objects/Stars",["vendor/namespace","Three"],function(){var b;return namespace("ThreePlanet.objects",{Stars:b=function(b){function d(){var b,c,e,f,g,h,i,j,k,l,m,n;d.__super__.constructor.apply(this,arguments),h=new a.Geometry,c=7500,e=200,i=[],i.push(new a.ParticleBasicMaterial({color:5592405,size:2,sizeAttenuation:!1})),i.push(new a.ParticleBasicMaterial({color:5592405,size:1,sizeAttenuation:!1})),i.push(new a.ParticleBasicMaterial({color:3355443,size:2,sizeAttenuation:!1})),i.push(new a.ParticleBasicMaterial({color:3815994,size:1,sizeAttenuation:!1})),i.push(new a.ParticleBasicMaterial({color:1710618,size:2,sizeAttenuation:!1})),i.push(new a.ParticleBasicMaterial({color:1710618,size:1,sizeAttenuation:!1}));for(b=k=0,m=c-1;0<=m?k<=m:k>=m;b=0<=m?++k:--k)j=new a.Vector3,j.x=Math.random()*2-1,j.y=Math.random()*2-1,j.z=Math.random()*2-1,j.multiplyScalar(e),h.vertices.push(j);for(b=l=10,n=99;10<=n?l<=n:l>=n;b=10<=n?++l:--l)g=new a.ParticleSystem(h,i[b%6]),g.rotation.x=Math.random()*6,g.rotation.y=Math.random()*6,g.rotation.z=Math.random()*6,f=b*10,g.scale.set(f,f,f),g.matrixAutoUpdate=!1,g.updateMatrix(),this.add(g)}return c(d,b),d}(a.Object3D)})})}.call(this),define("text",["module"],function(a){var b,c,d=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],e=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,f=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,g=typeof location!="undefined"&&location.href,h=g&&location.protocol&&location.protocol.replace(/\:/,""),i=g&&location.hostname,j=g&&(location.port||undefined),k=[],l=a.config&&a.config()||{};b={version:"2.0.3",strip:function(a){if(a){a=a.replace(e,"");var b=a.match(f);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:l.createXhr||function(){var a,b,c;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(b=0;b<3;b+=1){c=d[b];try{a=new ActiveXObject(c)}catch(e){}if(a){d=[c];break}}return a},parseName:function(a){var b=!1,c=a.indexOf("."),d=a.substring(0,c),e=a.substring(c+1,a.length);return c=e.indexOf("!"),c!==-1&&(b=e.substring(c+1,e.length),b=b==="strip",e=e.substring(0,c)),{moduleName:d,ext:e,strip:b}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,c,d,e){var f,g,h,i=b.xdRegExp.exec(a);return i?(f=i[2],g=i[3],g=g.split(":"),h=g[1],g=g[0],(!f||f===c)&&(!g||g.toLowerCase()===d.toLowerCase())&&(!h&&!g||h===e)):!0},finishLoad:function(a,c,d,e){d=c?b.strip(d):d,l.isBuild&&(k[a]=d),e(d)},load:function(a,c,d,e){if(e.isBuild&&!e.inlineText){d();return}l.isBuild=e.isBuild;var f=b.parseName(a),k=f.moduleName+"."+f.ext,m=c.toUrl(k),n=l.useXhr||b.useXhr;!g||n(m,h,i,j)?b.get(m,function(c){b.finishLoad(a,f.strip,c,d)},function(a){d.error&&d.error(a)}):c([k],function(a){b.finishLoad(f.moduleName+"."+f.ext,f.strip,a,d)})},write:function(a,c,d,e){if(k.hasOwnProperty(c)){var f=b.jsEscape(k[c]);d.asModule(a+"!"+c,"define(function () { return '"+f+"';});\n")}},writeFile:function(a,c,d,e,f){var g=b.parseName(c),h=g.moduleName+"."+g.ext,i=d.toUrl(g.moduleName+"."+g.ext)+".js";b.load(h,d,function(c){var d=function(a){return e(i,a)};d.asModule=function(a,b){return e.asModule(a,i,b)},b.write(a,h,d,f)},f)}};if(l.env==="node"||!l.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)c=require.nodeRequire("fs"),b.get=function(a,b){var d=c.readFileSync(a,"utf8");d.indexOf("ï»¿")===0&&(d=d.substring(1)),b(d)};else if(l.env==="xhr"||!l.env&&b.createXhr())b.get=function(a,c,d){var e=b.createXhr();e.open("GET",a,!0),l.onXhr&&l.onXhr(e,a),e.onreadystatechange=function(b){var f,g;e.readyState===4&&(f=e.status,f>399&&f<600?(g=new Error(a+" HTTP status: "+f),g.xhr=e,d(g)):c(e.responseText))},e.send(null)};else if(l.env==="rhino"||!l.env&&typeof Packages!="undefined"&&typeof java!="undefined")b.get=function(a,b){var c,d,e="utf-8",f=new java.io.File(a),g=java.lang.System.getProperty("line.separator"),h=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(f),e)),i="";try{c=new java.lang.StringBuffer,d=h.readLine(),d&&d.length()&&d.charAt(0)===65279&&(d=d.substring(1)),c.append(d);while((d=h.readLine())!==null)c.append(g),c.append(d);i=String(c.toString())}finally{h.close()}b(i)};return b}),define("text!shaders/SkyFromSpace.vert",[],function(){return"// Atmospheric scattering shader\n//\n// Author: Sean O'Neil\n//\n// Copyright (c) 2004 Sean O'Neil\n//\n// Based on the blender example\n\nuniform vec3 v3CameraPos;       // The camera's current position\nuniform vec3 v3LightPos;        // The Light Position\nuniform vec3 v3InvWavelength;   // 1 / pow(wavelength, 4) for the red, green, and blue channels\n//uniform float fCameraHeight;    // The camera's current height\nuniform float fCameraHeight2;   // fCameraHeight^2\nuniform float fOuterRadius;     // The outer (atmosphere) radius\nuniform float fOuterRadius2;    // fOuterRadius^2\nuniform float fInnerRadius;     // The inner (planetary) radius\n//uniform float fInnerRadius2;    // fInnerRadius^2\nuniform float fKrESun;          // Kr * ESun\nuniform float fKmESun;          // Km * ESun\nuniform float fKr4PI;           // Kr * 4 * PI\nuniform float fKm4PI;           // Km * 4 * PI\nuniform float fScale;           // 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;      // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n// assign as constant since \"Loop index cannot be compared with non-constant expression\"\nconst int nSamples = 2;\nuniform float fSamples;\n\n\nvarying vec3 v3Direction;\nvarying float depth;\nvarying vec4 primary_color;\nvarying vec4 secondary_color;\n\n\nmat4 g_WorldViewProjectionMatrix = projectionMatrix * modelViewMatrix;\nmat4 g_WorldMatrix = modelMatrix;\n\nfloat fInvScaleDepth = (1.0 / fScaleDepth);\n\nfloat scale(float fCos)\n{\n   float x = 1.0 - fCos;\n   return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void)\n{\n  vec4 inPosition = vec4(position, 1.0);\n\n  // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n  vec3 v3Pos = vec3(g_WorldMatrix * inPosition);\n  vec3 v3Ray = v3Pos - v3CameraPos;\n  float fFar = length(v3Ray);\n  v3Ray /= fFar;\n\n  // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n  float B = 2.0 * dot(v3CameraPos, v3Ray);\n  float C = fCameraHeight2 - fOuterRadius2;\n  float fDet = max(0.0, B*B - 4.0 * C);\n  float fNear = 0.5 * (-B - sqrt(fDet));\n\n  // Calculate the ray's starting position, then calculate its scattering offset\n  vec3 v3Start = v3CameraPos + v3Ray * fNear;\n  fFar -= fNear;\n  float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n  float fStartDepth = exp(-1.0 / fScaleDepth);\n  float fStartOffset = fStartDepth*scale(fStartAngle);\n  depth = clamp(fStartOffset,0.0,1.0);\n\n  // Initialize the scattering loop variables\n  float fSampleLength = fFar / fSamples;\n  float fScaledLength = fSampleLength * fScale;\n  vec3 v3SampleRay = v3Ray * fSampleLength;\n  vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n  // Now loop through the sample rays\n  vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n  vec3 v3Attenuate = vec3(0.0, 0.0, 0.0);\n  for(int i=0; i<nSamples; i++)\n  {\n    float fHeight = length(v3SamplePoint);\n    float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n    float fLightAngle = dot(v3LightPos, v3SamplePoint) / fHeight;\n    float fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\n    float fScatter = (fStartOffset + fDepth*(scale(fLightAngle) - scale(fCameraAngle)));\n    vec3 v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n    v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n    v3SamplePoint += v3SampleRay;\n  }\n  secondary_color = vec4(v3FrontColor * fKmESun, 1.0);\n  primary_color = vec4(v3FrontColor * (v3InvWavelength * fKrESun), 1.0);\n  gl_Position = g_WorldViewProjectionMatrix * inPosition;\n  v3Direction = v3CameraPos - v3Pos;\n}\n"}),define("text!shaders/SkyFromSpace.frag",[],function(){return"// Atmospheric scattering shader\n//\n// Author: Sean O'Neil\n//\n// Copyright (c) 2004 Sean O'Neil\n//\n// Based on the blender example\n\nuniform vec3 v3LightPos;\nuniform float fg;\nuniform float fg2;\nuniform float fExposure;\n\nvarying vec3 v3Direction;\nvarying float depth;\n\nvarying vec4 primary_color;\nvarying vec4 secondary_color;\n\nvoid main (void)\n{\n  float fCos = dot(v3LightPos, v3Direction) / length(v3Direction);\n  float fRayleighPhase = 0.75 * (1.0 + (fCos*fCos));\n  float fMiePhase = 1.5 * ((1.0 - fg2) / (2.0 + fg2)) * (1.0 + fCos*fCos) / pow(1.0 + fg2 - 2.0*fg*fCos, 1.5);\n\n  float sun = 2.0*((1.0 - 0.2) / (2.0 + 0.2)) * (1.0 + fCos*fCos) / pow(1.0 + 0.2 - 2.0*(-0.2)*fCos, 1.0);\n\n  vec4 f4Ambient = (sun * depth )*vec4(0.05, 0.05, 0.1,1.0);\n\n  vec4 f4Color = (fRayleighPhase * primary_color + fMiePhase * secondary_color)+f4Ambient;\n  vec4 HDR = 1.0 - exp(f4Color * -fExposure);\n  float nightmult = clamp(max(HDR.x, max(HDR.y, HDR.z))*1.5,0.0,1.0);\n\n  //gl_FragColor = vec4(ambient);\n  gl_FragColor = HDR;\n  gl_FragColor.a = nightmult;\n}\n\n"}),define("text!shaders/SkyFromAtmosphere.vert",[],function(){return"// Atmospheric scattering shader\n//\n// Author: Sean O'Neil\n//\n// Copyright (c) 2004 Sean O'Neil\n//\n// Based on the blender example\n\nuniform vec3 v3CameraPos;	// The camera's current position\nuniform vec3 v3LightPos;	// The direction vector to the light source\nuniform vec3 v3InvWavelength;	// 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform float fCameraHeight;	// The camera's current height\nuniform float fCameraHeight2;	// fCameraHeight^2\nuniform float fOuterRadius;	// The outer (atmosphere) radius\nuniform float fOuterRadius2;	// fOuterRadius^2\nuniform float fInnerRadius;	// The inner (planetary) radius\n//uniform float fInnerRadius2;	// fInnerRadius^2\nuniform float fKrESun;		// Kr * ESun\nuniform float fKmESun;		// Km * ESun\nuniform float fKr4PI;		// Kr * 4 * PI\nuniform float fKm4PI;		// Km * 4 * PI\nuniform float fScale;		// 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;	// The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n//uniform int nSamples;\nuniform float fSamples;\n\nmat4 g_WorldViewProjectionMatrix = projectionMatrix * modelViewMatrix;\nmat4 g_WorldMatrix = modelMatrix;\n\n// assign as constant since \"Loop index cannot be compared with non-constant expression\"\nconst int nSamples = 2;\n\nvarying vec3 v3Direction;\nvarying float depth;\n\nvarying vec4 primary_color;\nvarying vec4 secondary_color;\n\nfloat scale(float fCos)\n{\n	float x = 1.0 - fCos;\n	return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void)\n{\n  vec4 inPosition = vec4(position, 1.0);\n  gl_Position = g_WorldViewProjectionMatrix * inPosition;\n\n  // Get the ray from the camera to the vertex, and its length (which is the far point of the ray passing through the atmosphere)\n  vec3 v3Pos = vec3(g_WorldMatrix * inPosition);\n  vec3 v3Ray = v3Pos - v3CameraPos;\n  float fFar = length(v3Ray);\n  v3Ray /= fFar;\n\n  // Calculate the ray's starting position, then calculate its scattering offset\n  vec3 v3Start = v3CameraPos;\n  float fHeight = length(v3Start);\n  float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\n  float fStartAngle = dot(v3Ray, v3Start) / fHeight;\n  float fStartOffset = fDepth*scale(fStartAngle);\n\n  float fStartDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\n  depth = clamp(fStartDepth*scale(fStartAngle),0.0,1.0);\n\n  // Initialize the scattering loop variables\n  float fSampleLength = fFar / fSamples;\n  float fScaledLength = fSampleLength * fScale;\n  vec3 v3SampleRay = v3Ray * fSampleLength;\n  vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n  // Now loop through the sample rays\n  vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n  vec3 v3Attenuate = vec3(0.0, 0.0, 0.0);\n  for(int i=0; i<nSamples; i++)\n  {\n    float fHeight = length(v3SamplePoint);\n    float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n    float fLightAngle = dot(v3LightPos, v3SamplePoint) / fHeight;\n    float fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\n    float fScatter = (fStartOffset + fDepth*(scale(fLightAngle) - scale(fCameraAngle)));\n    vec3 v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n    v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n    v3SamplePoint += v3SampleRay;\n  }\n\n  secondary_color = vec4(v3FrontColor * fKmESun, 1.0);\n  primary_color = vec4(v3FrontColor * (v3InvWavelength * fKrESun), 1.0);\n\n  v3Direction = v3CameraPos - v3Pos;\n}\n"}),define("text!shaders/SkyFromAtmosphere.frag",[],function(){return"// Atmospheric scattering shader\n//\n// Author: Sean O'Neil\n//\n// Copyright (c) 2004 Sean O'Neil\n//\n// Based on the blender example\n\nuniform vec3 v3LightPos;\nuniform float fg;\nuniform float fg2;\nuniform float fExposure;\nuniform float fCameraHeight, fOuterRadius, fScaleDepth;\n\nvarying vec3 v3Direction;\nvarying float depth;\n\nvarying vec4 primary_color;\nvarying vec4 secondary_color;\n\nvoid main (void)\n{\n  float fCos = dot(v3LightPos, v3Direction) / length(v3Direction);\n  float fRayleighPhase = 0.75 * (1.0 + (fCos*fCos));\n  float fMiePhase = 1.5 * ((1.0 - fg2) / (2.0 + fg2)) * (1.0 + fCos*fCos) / pow(1.0 + fg2 - 2.0*fg*fCos, 1.5);\n\n  float sun = 2.0*((1.0 - 0.2) / (2.0 + 0.2)) * (1.0 + fCos*fCos) / pow(1.0 + 0.2 - 2.0*(-0.2)*fCos, 1.0);\n\n  vec4 f4Ambient = (sun * depth + (fOuterRadius - fCameraHeight))*vec4(0.05, 0.05, 0.1,1.0);\n\n  vec4 f4Color = (fRayleighPhase * primary_color + fMiePhase * secondary_color)+f4Ambient;\n  vec4 HDR = 1.0 - exp(f4Color * -fExposure);\n  float nightmult = clamp(max(HDR.x, max(HDR.y, HDR.z))*1.5,0.0,1.0);\n\n  //gl_FragColor = vec4(f4Ambient);\n  gl_FragColor = HDR;\n  gl_FragColor.a = nightmult+(fOuterRadius - fCameraHeight);\n  //gl_FragColor.a = nightmult;\n}\n"}),define("text!shaders/GroundFromSpace.vert",[],function(){return"// Atmospheric scattering shader\n//\n// Author: Sean O'Neil\n//\n// Copyright (c) 2004 Sean O'Neil\n//\n// Based on the blender example\n\nuniform vec3 v3LightPos;            // world space (or direction)\nuniform vec3 v3CameraPos;           // The camera's current position (world space)\nuniform vec3 v3InvWavelength;       // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform float fCameraHeight2;       // fCameraHeight^2\nuniform float fOuterRadius;         // The outer (atmosphere) radius\nuniform float fOuterRadius2;        // fOuterRadius^2\nuniform float fInnerRadius;         // The inner (planetary) radius\nuniform float fKr4PI;               // Kr * 4 * PI\nuniform float fKm4PI;               // Km * 4 * PI\nuniform float fKrESun;              // Kr * ESun\nuniform float fKmESun;              // Km * ESun\nuniform float fScale;               // 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;          // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n//uniform int nSamples;\nconst int nSamples = 2;\nuniform float fSamples;\n\nvarying vec2 texCoord;\nvarying vec4 primary_color;\nvarying vec4 secondary_color;\n\n\nfloat fInvScaleDepth = (1.0 / fScaleDepth);\n/*\nhttps://github.com/mrdoob/three.js/issues/1188\nhttp://jmonkeyengine.org/groups/graphics/forum/topic/help-learning-shaders/#post-180570\n\nmodel to world: g_WorldMatrix => modelMatrix\nmodel to view space: g_WorldViewMatrix => modelViewMatrix\nworld to view space: g_ViewMatrix => viewMatrix\nprojection: projectionMatrix\n */\n\nmat4 g_WorldViewProjectionMatrix = projectionMatrix * modelViewMatrix;\nmat4 g_WorldMatrix = modelMatrix;\n\n\n// Returns the near intersection point of a line and a sphere\nfloat getNearIntersection(vec3 v3Pos, vec3 v3Ray, float fDistance2, float fRadius2)\n{\n  float B = 2.0 * dot(v3Pos, v3Ray);\n  float C = fDistance2 - fRadius2;\n  float fDet = max(0.0, B*B - 4.0 * C);\n  return 0.5 * (-B - sqrt(fDet));\n}\n\nfloat scale(float fCos)\n{\n  float x = 1.0 - fCos;\n  return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void)\n{\n  vec4 inPosition = vec4(position, 1.0);\n  gl_Position = g_WorldViewProjectionMatrix * inPosition;\n\n  // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n  vec3 v3Pos = vec3(g_WorldMatrix * inPosition);\n  //vec3 v3Pos = position.xyz;\n  vec3 v3Ray = v3Pos - v3CameraPos;\n  float fFar = length(v3Ray);\n  v3Ray /= fFar;\n\n  // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n  float B = 2.0 * dot(v3CameraPos, v3Ray);\n  float C = fCameraHeight2 - fOuterRadius2;\n  float fDet = max(0.0, B*B - 4.0 * C);\n  float fNear = 0.5 * (-B - sqrt(fDet));\n\n  // Calculate the ray's starting position, then calculate its scattering offset\n  vec3 v3Start = v3CameraPos + v3Ray * fNear;\n  fFar -= fNear;\n  float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\n  float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\n  float fLightAngle = dot(v3LightPos, v3Pos) / length(v3Pos);\n  float fCameraScale = scale(fCameraAngle);\n  float fLightScale = scale(fLightAngle);\n  float fCameraOffset = fDepth*fCameraScale;\n  float fTemp = (fLightScale + fCameraScale);\n\n  // Initialize the scattering loop variables\n  float fSampleLength = fFar / fSamples;\n  float fScaledLength = fSampleLength * fScale;\n  vec3 v3SampleRay = v3Ray * fSampleLength;\n  vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n  // Now loop through the sample rays\n  vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n  vec3 v3Attenuate;\n  for(int i=0; i<nSamples; i++)\n  {\n    float fHeight = length(v3SamplePoint);\n    float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n    float fScatter = fDepth*fTemp - fCameraOffset;\n    v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n    v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n    v3SamplePoint += v3SampleRay;\n  }\n\n  primary_color = vec4(v3FrontColor * (v3InvWavelength * fKrESun + fKmESun), 1.0);\n  // Calculate the attenuation factor for the ground\n  secondary_color = vec4(v3Attenuate, 1.0);\n  texCoord  = uv;\n}\n\n\n"}),define("text!shaders/GroundFromSpace.frag",[],function(){return"// Atmospheric scattering shader\n//\n// Author: Sean O'Neil\n//\n// Copyright (c) 2004 Sean O'Neil\n//\n// Based on the blender example\n\nuniform float fExposure;\n\nuniform sampler2D tGround;\nuniform sampler2D tClouds;\nuniform sampler2D tNight;\n\nvarying vec2 texCoord;\nvarying vec4 primary_color;\nvarying vec4 secondary_color;\n\nvoid main (void)\n{\n  vec4 v4Diffuse = texture2D(tGround, texCoord);\n  vec4 colorNight = texture2D(tNight, texCoord);\n\n  vec4 f4Color = primary_color + v4Diffuse * secondary_color + (colorNight*(1.0- secondary_color))*0.2;\n\n  gl_FragColor = 1.0 - exp(f4Color * -fExposure);\n}\n"}),define("text!shaders/GroundFromAtmosphere.vert",[],function(){return"// Atmospheric scattering shader\n//\n// Author: Sean O'Neil\n//\n// Copyright (c) 2004 Sean O'Neil\n//\n// Based on the blender example\n\nuniform vec3 v3CameraPos;   // The camera's current position\nuniform vec3 v3LightPos;    // The direction vector to the light source\nuniform vec3 v3InvWavelength;     // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform float fCameraHeight;  // The camera's current height\nuniform float fCameraHeight2; // fCameraHeight^2\nuniform float fOuterRadius;   // The outer (atmosphere) radius\nuniform float fOuterRadius2;  // fOuterRadius^2\nuniform float fInnerRadius;   // The inner (planetary) radius\n//uniform float fInnerRadius2;  // fInnerRadius^2\nuniform float fKrESun;      // Kr * ESun\nuniform float fKmESun;      // Km * ESun\nuniform float fKr4PI;     // Kr * 4 * PI\nuniform float fKm4PI;     // Km * 4 * PI\nuniform float fScale;     // 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;    // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n\nconst int nSamples = 2;\nuniform float fSamples;\n\n\nvarying vec2 texCoord;\nvarying vec3 v3Direction;\nvarying vec4 primary_color;\nvarying vec4 secondary_color;\n\nmat4 g_WorldViewProjectionMatrix = projectionMatrix * modelViewMatrix;\nmat4 g_WorldMatrix = modelMatrix;\n\nfloat scale(float fCos)\n{\n  float x = 1.0 - fCos;\n  return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void)\n{\n  vec4 inPosition = vec4(position, 1.0);\n\n  // Get the ray from the camera to the vertex, and its length (which is the far point of the ray passing through the atmosphere)\n  vec3 v3Pos = vec3(g_WorldMatrix * inPosition);\n  vec3 v3Ray = v3Pos - v3CameraPos;\n  float fFar = length(v3Ray);\n  v3Ray /= fFar;\n\n  // Calculate the ray's starting position, then calculate its scattering offset\n  vec3 v3Start = v3CameraPos;\n  float fDepth = exp((fInnerRadius - fCameraHeight) / fScaleDepth);\n  float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\n  float fLightAngle = dot(v3LightPos, v3Pos) / length(v3Pos);\n  float fCameraScale = scale(fCameraAngle);\n  float fLightScale = scale(fLightAngle);\n  float fCameraOffset = fDepth*fCameraScale;\n  float fTemp = (fLightScale + fCameraScale);\n\n  // Initialize the scattering loop variables\n  float fSampleLength = fFar / fSamples;\n  float fScaledLength = fSampleLength * fScale;\n  vec3 v3SampleRay = v3Ray * fSampleLength;\n  vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n  // Now loop through the sample rays\n  vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n  vec3 v3Attenuate= vec3(0.0, 0.0, 0.0);\n  for(int i=0; i<nSamples; i++)\n  {\n    float fHeight = length(v3SamplePoint);\n    float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n    float fScatter = fDepth*fTemp - fCameraOffset;\n    v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n    v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n    v3SamplePoint += v3SampleRay;\n  }\n\n  primary_color = vec4(v3FrontColor * (v3InvWavelength * fKrESun + fKmESun), 1.0);\n\n  // Calculate the attenuation factor for the ground\n  secondary_color = vec4(v3Attenuate, 1.0);\n\n  gl_Position = g_WorldViewProjectionMatrix * inPosition;\n  texCoord = uv;\n}\n"}),define("text!shaders/GroundFromAtmosphere.frag",[],function(){return"// Atmospheric scattering shader\n//\n// Author: Sean O'Neil\n//\n// Copyright (c) 2004 Sean O'Neil\n//\n// Based on the blender example\n\nuniform sampler2D tGround;\nuniform sampler2D tNight;\n\nuniform float fExposure;\n\nvarying vec2 texCoord;\nvarying vec4 primary_color;\nvarying vec4 secondary_color;\n\nvoid main (void)\n{\n  //gl_FragColor = gl_Color + 0.25 * gl_SecondaryColor;\n  vec4 f4Color = primary_color + texture2D(tGround, texCoord) * secondary_color + (texture2D(tNight, texCoord)*(1.0- secondary_color))*0.2;\n\n  gl_FragColor = 1.0 - exp(f4Color * -fExposure);\n}\n"}),function(){var b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};define("objects/Planet",["Three","jquery","text!shaders/SkyFromSpace.vert","text!shaders/SkyFromSpace.frag","text!shaders/SkyFromAtmosphere.vert","text!shaders/SkyFromAtmosphere.frag","text!shaders/GroundFromSpace.vert","text!shaders/GroundFromSpace.frag","text!shaders/GroundFromAtmosphere.vert","text!shaders/GroundFromAtmosphere.frag","jquery","vendor/namespace"],function(c,e,f,g,h,i,j,k,l,m){var n,o;return namespace("ThreePlanet.objects",{settings:{postprocessing:!0,backgroundColor:0},PlanetShaderUtil:o=function(){function c(c,d){this.innerRadius=c,this.position=d,this.updateCalculations=b(this.updateCalculations,this),this.nSamples=2,this.Kr=.0025,this.Km=.0015,this.ESun=15,this.exposure=2,this.wavelength=new a.Vector3,this.wavelengthColor=[165,145,121],this.G=-0.99,this.invWavelength4=new a.Vector3,this.scaleDepth=.25,this.outerRadius=this.innerRadius*1.025,this.updateCalculations()}return c.prototype.updateCalculations=function(){return this.scale=1/(this.outerRadius-this.innerRadius),this.scaleOverScaleDepth=this.scale/this.scaleDepth,this.KrESun=this.Kr*this.ESun,this.KmESun=this.Km*this.ESun,this.Kr4PI=this.Kr*4*Math.PI,this.Km4PI=this.Km*4*Math.PI,this.wavelength.x=this.wavelengthColor[0]/255,this.wavelength.y=this.wavelengthColor[1]/255,this.wavelength.z=this.wavelengthColor[2]/255,this.invWavelength4.x=1/Math.pow(this.wavelength.x,4),this.invWavelength4.y=1/Math.pow(this.wavelength.y,4),this.invWavelength4.z=1/Math.pow(this.wavelength.z,4)},c}(),Planet:n=function(c){function e(c,d,f,g){var h;this.radius=c,this.pos=d,this.sun=f,this.camera=g,this.createShaderGroundFromAtmosphere=b(this.createShaderGroundFromAtmosphere,this),this.createShaderGroundFromSpace=b(this.createShaderGroundFromSpace,this),this.createShaderSkyFromSpace=b(this.createShaderSkyFromSpace,this),this.createShaderSkyFromAtmosphere=b(this.createShaderSkyFromAtmosphere,this),this.createBaseUniforms=b(this.createBaseUniforms,this),this.updateCommonUniforms=b(this.updateCommonUniforms,this),this.update=b(this.update,this),this.createClouds=b(this.createClouds,this),e.__super__.constructor.apply(this,arguments),this.planetUtil=new ThreePlanet.objects.PlanetShaderUtil(this.radius,this.pos),h=128,this.sphere=new a.SphereGeometry(1,h*2,h),this.sphere.computeTangents(),this.sphere2=new a.SphereGeometry(1,h*2,h),this.createBaseUniforms(),this.createShaderSkyFromSpace(),this.createShaderGroundFromSpace(),this.createShaderSkyFromAtmosphere(),this.createShaderGroundFromAtmosphere(),this.mSkyFromSpace.blending=a.AdditiveAlphaBlending,this.mSkyFromAtmosphere.blending=a.AdditiveAlphaBlending,this.atmosphere=new a.Mesh(this.sphere2,this.mSkyFromSpace),this.atmosphere.scale.set(this.planetUtil.outerRadius,this.planetUtil.outerRadius,this.planetUtil.outerRadius),this.add(this.atmosphere),this.ground=new a.Mesh(this.sphere,this.mGroundFromSpace),this.ground.scale.set(this.planetUtil.innerRadius,this.planetUtil.innerRadius,this.planetUtil.innerRadius),this.add(this.ground);return}return d(e,c),e.prototype.createClouds=function(){var b,c,d,e,f;return d=42,f=new a.SphereGeometry(1,d*2,d),c=a.ImageUtils.loadTexture("textures/earth_clouds_1024.png"),e=new a.MeshLambertMaterial({color:16777215,map:c,transparent:!0,depthWrite:!1}),this.meshClouds=new a.Mesh(f,e),b=this.planetUtil.outerRadius-2,this.meshClouds.scale.set(b,b,b),this.meshClouds.doubleSided=!1,this.add(this.meshClouds)},e.prototype.update=function(b,c){var d,e,f;return this.atmosphere.scale.set(this.planetUtil.outerRadius,this.planetUtil.outerRadius,this.planetUtil.outerRadius),this.ground.scale.set(this.planetUtil.innerRadius,this.planetUtil.innerRadius,this.planetUtil.innerRadius),this.planetUtil.updateCalculations(),this.cameraDistance=this.pos.distanceTo(this.camera.position),this.cameraDistance2=this.cameraDistance*this.cameraDistance,d=this.pos.distanceTo(this.sun.position),this.lightpos=this.sun.position.clone().divideScalar(d),e=(new a.Vector3).sub(this.camera.position,this.position),f=this.planetUtil.innerRadius,this.cameraDistance<f+1&&(this.camera.position=e.normalize().multiplyScalar(f+1)),this.meshClouds&&(this.meshClouds.rotation.y=b*.002),this.cameraDistance>this.planetUtil.outerRadius?(this.atmosphere.material=this.mSkyFromSpace,this.ground.material=this.mGroundFromSpace):(this.atmosphere.material=this.mSkyFromAtmosphere,this.ground.material=this.mGroundFromAtmosphere),this.updateCommonUniforms(this.mSkyFromSpace),this.updateCommonUniforms(this.mSkyFromAtmosphere),this.updateCommonUniforms(this.mGroundFromSpace),this.updateCommonUniforms(this.mGroundFromAtmosphere)},e.prototype.updateCommonUniforms=function(a){return a.uniforms.v3LightPos.value=this.lightpos,a.uniforms.v3CameraPos.value=this.camera.position,a.uniforms.fCameraHeight.value=this.cameraDistance,a.uniforms.fCameraHeight2.value=this.cameraDistance2,a.uniforms.fExposure.value=this.planetUtil.exposure,a.uniforms.fKrESun.value=this.planetUtil.KrESun,a.uniforms.fKmESun.value=this.planetUtil.KmESun,a.uniforms.v3InvWavelength.value=this.planetUtil.invWavelength4,a.uniforms.fKr4PI.value=this.planetUtil.Kr4PI,a.uniforms.fKm4PI.value=this.planetUtil.Km4PI,a.uniforms.fScale.value=this.planetUtil.scale,a.uniforms.fScaleDepth.value=this.planetUtil.scaleDepth,a.uniforms.fScaleOverScaleDepth.value=this.planetUtil.scaleOverScaleDepth,a.uniforms.fOuterRadius.value=this.planetUtil.outerRadius,a.uniforms.fInnerRadius.value=this.planetUtil.innerRadius,a.uniforms.fOuterRadius2.value=this.planetUtil.outerRadius*this.planetUtil.outerRadius,a.uniforms.fg.value=this.planetUtil.G,a.uniforms.fg2.value=this.planetUtil.G*this.planetUtil.G},e.prototype.createBaseUniforms=function(){return this.baseUniforms={v3CameraPos:{type:"v3",value:this.camera.position},fCameraHeight:{type:"f",value:206},fCameraHeight2:{type:"f",value:32e3},v3LightPos:{type:"v3",value:this.sun.position.clone().normalize()},fg:{type:"f",value:this.planetUtil.G},fg2:{type:"f",value:this.planetUtil.G*this.planetUtil.G},fExposure:{type:"f",value:this.planetUtil.exposure},fScaleDepth:{type:"f",value:this.planetUtil.scaleDepth},fScaleOverScaleDepth:{type:"f",value:this.planetUtil.scaleOverScaleDepth},fSamples:{type:"f",value:this.planetUtil.nSamples},v3InvWavelength:{type:"v3",value:this.planetUtil.invWavelength4},fKrESun:{type:"f",value:this.planetUtil.KrESun},fKmESun:{type:"f",value:this.planetUtil.KmESun},fOuterRadius:{type:"f",value:this.planetUtil.outerRadius},fInnerRadius:{type:"f",value:this.planetUtil.innerRadius},fOuterRadius2:{type:"f",value:this.planetUtil.outerRadius*this.planetUtil.outerRadius},fKr4PI:{type:"f",value:this.planetUtil.Kr4PI},fKm4PI:{type:"f",value:this.planetUtil.Km4PI},fScale:{type:"f",value:this.planetUtil.scale}}},e.prototype.createShaderSkyFromAtmosphere=function(){var b;return b=a.UniformsUtils.clone(this.baseUniforms),this.mSkyFromAtmosphere=new a.ShaderMaterial({uniforms:b,vertexShader:h,fragmentShader:i,side:a.BackSide,shading:a.SmoothShading,depthWrite:!1,transparent:!0})},e.prototype.createShaderSkyFromSpace=function(){var b;return b=a.UniformsUtils.clone(this.baseUniforms),this.mSkyFromSpace=new a.ShaderMaterial({uniforms:b,vertexShader:f,fragmentShader:g,side:a.BackSide,shading:a.SmoothShading,depthWrite:!1,transparent:!0})},e.prototype.createShaderGroundFromSpace=function(){var b,c,d,e,f;return d=a.ImageUtils.loadTexture("textures/earth_atmos_2048.jpg"),c=a.ImageUtils.loadTexture("textures/earthnight.jpg"),b=a.ImageUtils.loadTexture("textures/earthbump.png"),e=a.UniformsUtils.clone(this.baseUniforms),f={tGround:{type:"t",value:d},tNight:{type:"t",value:c},tBump:{type:"t",value:b}},$.extend(e,f),this.mGroundFromSpace=new a.ShaderMaterial({uniforms:e,vertexShader:j,fragmentShader:k,shading:a.SmoothShading})},e.prototype.createShaderGroundFromAtmosphere=function(){var b,c,d,e;return c=a.ImageUtils.loadTexture("textures/earth_atmos_2048.jpg"),b=a.ImageUtils.loadTexture("textures/earthnight.jpg"),d=a.UniformsUtils.clone(this.baseUniforms),e={tGround:{type:"t",value:c},tNight:{type:"t",value:b}},$.extend(d,e),this.mGroundFromAtmosphere=new a.ShaderMaterial({uniforms:d,vertexShader:l,fragmentShader:m,shading:a.SmoothShading})},e}(a.Object3D)})})}.call(this);var b=b||{};b.gui=b.gui||{},b.utils=b.utils||{},b.controllers=b.controllers||{},b.dom=b.dom||{},b.color=b.color||{},b.utils.css=function(){return{load:function(a,b){var b=b||document,c=b.createElement("link");c.type="text/css",c.rel="stylesheet",c.href=a,b.getElementsByTagName("head")[0].appendChild(c)},inject:function(a,b){var b=b||document,c=document.createElement("style");c.type="text/css",c.innerHTML=a,b.getElementsByTagName("head")[0].appendChild(c)}}}(),b.utils.common=function(){var a=Array.prototype.forEach,b=Array.prototype.slice;return{BREAK:{},extend:function(a){return this.each(b.call(arguments,1),function(b){for(var d in b)this.isUndefined(b[d])||(a[d]=b[d])},this),a},defaults:function(a){return this.each(b.call(arguments,1),function(b){for(var d in b)this.isUndefined(a[d])&&(a[d]=b[d])},this),a},compose:function(){var a=b.call(arguments);return function(){for(var d=b.call(arguments),e=a.length-1;e>=0;e--)d=[a[e].apply(this,d)];return d[0]}},each:function(b,c,d){if(a&&b.forEach===a)b.forEach(c,d);else if(b.length===b.length+0){for(var f=0,g=b.length;f<g;f++)if(f in b&&c.call(d,b[f],f)===this.BREAK)break}else for(f in b)if(c.call(d,b[f],f)===this.BREAK)break},defer:function(a){setTimeout(a,0)},toArray:function(a){return a.toArray?a.toArray():b.call(a)},isUndefined:function(a){return a===void 0},isNull:function(a){return a===null},isNaN:function(a){return a!==a},isArray:Array.isArray||function(a){return a.constructor===Array},isObject:function(a){return a===Object(a)},isNumber:function(a){return a===a+0},isString:function(a){return a===a+""},isBoolean:function(a){return a===!1||a===!0},isFunction:function(a){return Object.prototype.toString.call(a)==="[object Function]"}}}(),b.controllers.Controller=function(a){var b=function(a,b){this.initialValue=a[b],this.domElement=document.createElement("div"),this.object=a,this.property=b,this.__onFinishChange=this.__onChange=void 0};return a.extend(b.prototype,{onChange:function(a){return this.__onChange=a,this},onFinishChange:function(a){return this.__onFinishChange=a,this},setValue:function(a){return this.object[this.property]=a,this.__onChange&&this.__onChange.call(this,a),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),b}(b.utils.common),b.dom.dom=function(a){function b(b){return b==="0"||a.isUndefined(b)?0:(b=b.match(d),a.isNull(b)?0:parseFloat(b[1]))}var c={};a.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(b,d){a.each(b,function(a){c[a]=d})});var d=/(\d+(\.\d+)?)px/,e={makeSelectable:function(a,b){a!==void 0&&a.style!==void 0&&(a.onselectstart=b?function(){return!1}:function(){},a.style.MozUserSelect=b?"auto":"none",a.style.KhtmlUserSelect=b?"auto":"none",a.unselectable=b?"on":"off")},makeFullscreen:function(b,c,d){a.isUndefined(c)&&(c=!0),a.isUndefined(d)&&(d=!0),b.style.position="absolute",c&&(b.style.left=0,b.style.right=0),d&&(b.style.top=0,b.style.bottom=0)},fakeEvent:function(b,d,e,f){var e=e||{},g=c[d];if(!g)throw Error("Event type "+d+" not supported.");var h=document.createEvent(g);switch(g){case"MouseEvents":h.initMouseEvent(d,e.bubbles||!1,e.cancelable||!0,window,e.clickCount||1,0,0,e.x||e.clientX||0,e.y||e.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":g=h.initKeyboardEvent||h.initKeyEvent,a.defaults(e,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),g(d,e.bubbles||!1,e.cancelable,window,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.keyCode,e.charCode);break;default:h.initEvent(d,e.bubbles||!1,e.cancelable||!0)}a.defaults(h,f),b.dispatchEvent(h)},bind:function(a,b,c,d){return a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent&&a.attachEvent("on"+b,c),e},unbind:function(a,b,c,d){return a.removeEventListener?a.removeEventListener(b,c,d||!1):a.detachEvent&&a.detachEvent("on"+b,c),e},addClass:function(a,b){if(a.className===void 0)a.className=b;else if(a.className!==b){var c=a.className.split(/ +/);c.indexOf(b)==-1&&(c.push(b),a.className=c.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return e},removeClass:function(a,b){if(b){if(a.className!==void 0)if(a.className===b)a.removeAttribute("class");else{var c=a.className.split(/ +/),d=c.indexOf(b);d!=-1&&(c.splice(d,1),a.className=c.join(" "))}}else a.className=void 0;return e},hasClass:function(a,b){return RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)").test(a.className)||!1},getWidth:function(a){return a=getComputedStyle(a),b(a["border-left-width"])+b(a["border-right-width"])+b(a["padding-left"])+b(a["padding-right"])+b(a.width)},getHeight:function(a){return a=getComputedStyle(a),b(a["border-top-width"])+b(a["border-bottom-width"])+b(a["padding-top"])+b(a["padding-bottom"])+b(a.height)},getOffset:function(a){var b={left:0,top:0};if(a.offsetParent)do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent);return b},isActive:function(a){return a===document.activeElement&&(a.type||a.href)}};return e}(b.utils.common),b.controllers.OptionController=function(a,b,c){var d=function(a,e,f){d.superclass.call(this,a,e);var g=this;this.__select=document.createElement("select");if(c.isArray(f)){var h={};c.each(f,function(a){h[a]=a}),f=h}c.each(f,function(a,b){var c=document.createElement("option");c.innerHTML=b,c.setAttribute("value",a),g.__select.appendChild(c)}),this.updateDisplay(),b.bind(this.__select,"change",function(){g.setValue(this.options[this.selectedIndex].value)}),this.domElement.appendChild(this.__select)};return d.superclass=a,c.extend(d.prototype,a.prototype,{setValue:function(a){return a=d.superclass.prototype.setValue.call(this,a),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),a},updateDisplay:function(){return this.__select.value=this.getValue(),d.superclass.prototype.updateDisplay.call(this)}}),d}(b.controllers.Controller,b.dom.dom,b.utils.common),b.controllers.NumberController=function(a,b){var c=function(a,d,e){c.superclass.call(this,a,d),e=e||{},this.__min=e.min,this.__max=e.max,this.__step=e.step,a=this.__impliedStep=b.isUndefined(this.__step)?this.initialValue==0?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step,a=a.toString(),this.__precision=a.indexOf(".")>-1?a.length-a.indexOf(".")-1:0};return c.superclass=a,b.extend(c.prototype,a.prototype,{setValue:function(a){return this.__min!==void 0&&a<this.__min?a=this.__min:this.__max!==void 0&&a>this.__max&&(a=this.__max),this.__step!==void 0&&a%this.__step!=0&&(a=Math.round(a/this.__step)*this.__step),c.superclass.prototype.setValue.call(this,a)},min:function(a){return this.__min=a,this},max:function(a){return this.__max=a,this},step:function(a){return this.__step=a,this}}),c}(b.controllers.Controller,b.utils.common),b.controllers.NumberControllerBox=function(a,b,c){var d=function(a,e,f){function g(){var a=parseFloat(j.__input.value);c.isNaN(a)||j.setValue(a)}function h(a){var b=k-a.clientY;j.setValue(j.getValue()+b*j.__impliedStep),k=a.clientY}function i(){b.unbind(window,"mousemove",h),b.unbind(window,"mouseup",i)}this.__truncationSuspended=!1,d.superclass.call(this,a,e,f);var j=this,k;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),b.bind(this.__input,"change",g),b.bind(this.__input,"blur",function(){g(),j.__onFinishChange&&j.__onFinishChange.call(j,j.getValue())}),b.bind(this.__input,"mousedown",function(a){b.bind(window,"mousemove",h),b.bind(window,"mouseup",i),k=a.clientY}),b.bind(this.__input,"keydown",function(a){a.keyCode===13&&(j.__truncationSuspended=!0,this.blur(),j.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return d.superclass=a,c.extend(d.prototype,a.prototype,{updateDisplay:function(){var a=this.__input,b;if(this.__truncationSuspended)b=this.getValue();else{b=this.getValue();var c=Math.pow(10,this.__precision);b=Math.round(b*c)/c}return a.value=b,d.superclass.prototype.updateDisplay.call(this)}}),d}(b.controllers.NumberController,b.dom.dom,b.utils.common),b.controllers.NumberControllerSlider=function(a,b,c,d,e){var f=function(a,c,d,e,g){function h(a){a.preventDefault();var c=b.getOffset(j.__background),d=b.getWidth(j.__background);return j.setValue(j.__min+(j.__max-j.__min)*((a.clientX-c.left)/(c.left+d-c.left))),!1}function i(){b.unbind(window,"mousemove",h),b.unbind(window,"mouseup",i),j.__onFinishChange&&j.__onFinishChange.call(j,j.getValue())}f.superclass.call(this,a,c,{min:d,max:e,step:g});var j=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),b.bind(this.__background,"mousedown",function(a){b.bind(window,"mousemove",h),b.bind(window,"mouseup",i),h(a)}),b.addClass(this.__background,"slider"),b.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return f.superclass=a,f.useDefaultStyles=function(){c.inject(e)},d.extend(f.prototype,a.prototype,{updateDisplay:function(){return this.__foreground.style.width=(this.getValue()-this.__min)/(this.__max-this.__min)*100+"%",f.superclass.prototype.updateDisplay.call(this)}}),f}(b.controllers.NumberController,b.dom.dom,b.utils.css,b.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),b.controllers.FunctionController=function(a,b,c){var d=function(a,c,e){d.superclass.call(this,a,c);var f=this;this.__button=document.createElement("div"),this.__button.innerHTML=e===void 0?"Fire":e,b.bind(this.__button,"click",function(a){return a.preventDefault(),f.fire(),!1}),b.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return d.superclass=a,c.extend(d.prototype,a.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),d}(b.controllers.Controller,b.dom.dom,b.utils.common),b.controllers.BooleanController=function(a,b,c){var d=function(a,c){d.superclass.call(this,a,c);var e=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),b.bind(this.__checkbox,"change",function(){e.setValue(!e.__prev)},!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return d.superclass=a,c.extend(d.prototype,a.prototype,{setValue:function(a){return a=d.superclass.prototype.setValue.call(this,a),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),a},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,d.superclass.prototype.updateDisplay.call(this)}}),d}(b.controllers.Controller,b.dom.dom,b.utils.common),b.color.toString=function(a){return function(b){if(b.a==1||a.isUndefined(b.a)){for(b=b.hex.toString(16);b.length<6;)b="0"+b;return"#"+b}return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}(b.utils.common),b.color.interpret=function(a,b){var c,d,e=[{litmus:b.isString,conversions:{THREE_CHAR_HEX:{read:function(a){return a=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i),a===null?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString())}},write:a},SIX_CHAR_HEX:{read:function(a){return a=a.match(/^#([A-F0-9]{6})$/i),a===null?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString())}},write:a},CSS_RGB:{read:function(a){return a=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/),a===null?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:a},CSS_RGBA:{read:function(a){return a=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/),a===null?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:a}}},{litmus:b.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:b.isArray,conversions:{RGB_ARRAY:{read:function(a){return a.length!=3?!1:{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return a.length!=4?!1:{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:b.isObject,conversions:{RGBA_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)&&b.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)&&b.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v}}}}}];return function(){d=!1;var a=arguments.length>1?b.toArray(arguments):arguments[0];return b.each(e,function(e){if(e.litmus(a))return b.each(e.conversions,function(e,f){c=e.read(a);if(d===!1&&c!==!1)return d=c,c.conversionName=f,c.conversion=e,b.BREAK}),b.BREAK}),d}}(b.color.toString,b.utils.common),b.GUI=b.gui.GUI=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a,b,c,f){if(b[c]===void 0)throw Error("Object "+b+' has no property "'+c+'"');f.color?b=new k(b,c):(b=[b,c].concat(f.factoryArgs),b=d.apply(a,b)),f.before instanceof e&&(f.before=f.before.__li),s(a,b),n.addClass(b.domElement,"c"),c=document.createElement("span"),n.addClass(c,"property-name"),c.innerHTML=b.property;var g=document.createElement("div");return g.appendChild(c),g.appendChild(b.domElement),f=q(a,g,f.before),n.addClass(f,I.CLASS_CONTROLLER_ROW),n.addClass(f,typeof b.getValue()),r(a,f,b),a.__controllers.push(b),b}function q(a,b,c){var d=document.createElement("li");return b&&d.appendChild(b),c?a.__ul.insertBefore(d,params.before):a.__ul.appendChild(d),a.onResize(),d}function r(a,b,c){c.__li=b,c.__gui=a,o.extend(c,{options:function(b){if(arguments.length>1)return c.remove(),p(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[o.toArray(arguments)]});if(o.isArray(b)||o.isObject(b))return c.remove(),p(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[b]})},name:function(a){return c.__li.firstElementChild.firstElementChild.innerHTML=a,c},listen:function(){return c.__gui.listen(c),c},remove:function(){return c.__gui.remove(c),c}});if(c instanceof i){var d=new h(c.object,c.property,{min:c.__min,max:c.__max,step:c.__step});o.each(["updateDisplay","onChange","onFinishChange"],function(a){var b=c[a],e=d[a];c[a]=d[a]=function(){var a=Array.prototype.slice.call(arguments);return b.apply(c,a),e.apply(d,a)}}),n.addClass(b,"has-slider"),c.domElement.insertBefore(d.domElement,c.domElement.firstElementChild)}else if(c instanceof h){var e=function(b){return o.isNumber(c.__min)&&o.isNumber(c.__max)?(c.remove(),p(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[c.__min,c.__max,c.__step]})):b};c.min=o.compose(e,c.min),c.max=o.compose(e,c.max)}else c instanceof f?(n.bind(b,"click",function(){n.fakeEvent(c.__checkbox,"click")}),n.bind(c.__checkbox,"click",function(a){a.stopPropagation()})):c instanceof g?(n.bind(b,"click",function(){n.fakeEvent(c.__button,"click")}),n.bind(b,"mouseover",function(){n.addClass(c.__button,"hover")}),n.bind(b,"mouseout",function(){n.removeClass(c.__button,"hover")})):c instanceof k&&(n.addClass(b,"color"),c.updateDisplay=o.compose(function(a){return b.style.borderLeftColor=c.__color.toString(),a},c.updateDisplay),c.updateDisplay());c.setValue=o.compose(function(b){return a.getRoot().__preset_select&&c.isModified()&&y(a.getRoot(),!0),b},c.setValue)}function s(a,b){var c=a.getRoot(),d=c.__rememberedObjects.indexOf(b.object);if(d!=-1){var e=c.__rememberedObjectIndecesToControllers[d];e===void 0&&(e={},c.__rememberedObjectIndecesToControllers[d]=e),e[b.property]=b;if(c.load&&c.load.remembered){c=c.load.remembered;if(c[a.preset])c=c[a.preset];else{if(!c[A])return;c=c[A]}c[d]&&c[d][b.property]!==void 0&&(d=c[d][b.property],b.initialValue=d,b.setValue(d))}}}function t(a){var b=a.__save_row=document.createElement("li");n.addClass(a.domElement,"has-save"),a.__ul.insertBefore(b,a.__ul.firstChild),n.addClass(b,"save-row");var c=document.createElement("span");c.innerHTML="&nbsp;",n.addClass(c,"button gears");var d=document.createElement("span");d.innerHTML="Save",n.addClass(d,"button"),n.addClass(d,"save");var e=document.createElement("span");e.innerHTML="New",n.addClass(e,"button"),n.addClass(e,"save-as");var f=document.createElement("span");f.innerHTML="Revert",n.addClass(f,"button"),n.addClass(f,"revert");var g=a.__preset_select=document.createElement("select");a.load&&a.load.remembered?o.each(a.load.remembered,function(b,c){x(a,c,c==a.preset)}):x(a,A,!1),n.bind(g,"change",function(){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].innerHTML=a.__preset_select[b].value;a.preset=this.value}),b.appendChild(g),b.appendChild(c),b.appendChild(d),b.appendChild(e),b.appendChild(f);if(B){var b=document.getElementById("dg-save-locally"),h=document.getElementById("dg-local-explain");b.style.display="block",b=document.getElementById("dg-local-storage"),localStorage.getItem(document.location.href+".isLocal")==="true"&&b.setAttribute("checked","checked");var i=function(){h.style.display=a.useLocalStorage?"block":"none"};i(),n.bind(b,"change",function(){a.useLocalStorage=!a.useLocalStorage,i()})}var j=document.getElementById("dg-new-constructor");n.bind(j,"keydown",function(a){a.metaKey&&(a.which===67||a.keyCode==67)&&D.hide()}),n.bind(c,"click",function(){j.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2),D.show(),j.focus(),j.select()}),n.bind(d,"click",function(){a.save()}),n.bind(e,"click",function(){var b=prompt("Enter a new preset name.");b&&a.saveAs(b)}),n.bind(f,"click",function(){a.revert()})}function u(a){function b(b){return b.preventDefault(),e=b.clientX,n.addClass(a.__closeButton,I.CLASS_DRAG),n.bind(window,"mousemove",c),n.bind(window,"mouseup",d),!1}function c(b){return b.preventDefault(),a.width+=e-b.clientX,a.onResize(),e=b.clientX,!1}function d(){n.removeClass(a.__closeButton,I.CLASS_DRAG),n.unbind(window,"mousemove",c),n.unbind(window,"mouseup",d)}a.__resize_handle=document.createElement("div"),o.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var e;n.bind(a.__resize_handle,"mousedown",b),n.bind(a.__closeButton,"mousedown",b),a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function v(a,b){a.domElement.style.width=b+"px",a.__save_row&&a.autoPlace&&(a.__save_row.style.width=b+"px"),a.__closeButton&&(a.__closeButton.style.width=b+"px")}function w(a,b){var c={};return o.each(a.__rememberedObjects,function(d,e){var f={};o.each(a.__rememberedObjectIndecesToControllers[e],function(a,c){f[c]=b?a.initialValue:a.getValue()}),c[e]=f}),c}function x(a,b,c){var d=document.createElement("option");d.innerHTML=b,d.value=b,a.__preset_select.appendChild(d),c&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function y(a,b){var c=a.__preset_select[a.__preset_select.selectedIndex];c.innerHTML=b?c.value+"*":c.value}function z(a){a.length!=0&&l(function(){z(a)}),o.each(a,function(a){a.updateDisplay()})}a.inject(c);var A="Default",B;try{B="localStorage"in window&&window.localStorage!==null}catch(C){B=!1}var D,E=!0,F,G=!1,H=[],I=function(a){function b(){localStorage.setItem(document.location.href+".gui",JSON.stringify(d.getSaveObject()))}function c(){var a=d.getRoot();a.width+=1,o.defer(function(){a.width-=1})}var d=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),n.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=a||{},a=o.defaults(a,{autoPlace:!0,width:I.DEFAULT_WIDTH}),a=o.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),o.isUndefined(a.load)?a.load={preset:A}:a.preset&&(a.load.preset=a.preset),o.isUndefined(a.parent)&&a.hideable&&H.push(this),a.resizable=o.isUndefined(a.parent)&&a.resizable,a.autoPlace&&o.isUndefined(a.scrollable)&&(a.scrollable=!0);var e=B&&localStorage.getItem(document.location.href+".isLocal")==="true";Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return d.parent?d.getRoot().preset:a.load.preset},set:function(b){d.parent?d.getRoot().preset=b:a.load.preset=b;for(b=0;b<this.__preset_select.length;b++)this.__preset_select[b].value==this.preset&&(this.__preset_select.selectedIndex=b);d.revert()}},width:{get:function(){return a.width},set:function(b){a.width=b,v(d,b)}},name:{get:function(){return a.name},set:function(b){a.name=b,g&&(g.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(b){a.closed=b,a.closed?n.addClass(d.__ul,I.CLASS_CLOSED):n.removeClass(d.__ul,I.CLASS_CLOSED),this.onResize(),d.__closeButton&&(d.__closeButton.innerHTML=b?I.TEXT_OPEN:I.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return e},set:function(a){B&&((e=a)?n.bind(window,"unload",b):n.unbind(window,"unload",b),localStorage.setItem(document.location.href+".isLocal",a))}}});if(o.isUndefined(a.parent)){a.closed=!1,n.addClass(this.domElement,I.CLASS_MAIN),n.makeSelectable(this.domElement,!1);if(B&&e){d.useLocalStorage=!0;var f=localStorage.getItem(document.location.href+".gui");f&&(a.load=JSON.parse(f))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=I.TEXT_CLOSED,n.addClass(this.__closeButton,I.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),n.bind(this.__closeButton,"click",function(){d.closed=!d.closed})}else{a.closed===void 0&&(a.closed=!0);var g=document.createTextNode(a.name);n.addClass(g,"controller-name"),f=q(d,g),n.addClass(this.__ul,I.CLASS_CLOSED),n.addClass(f,"title"),n.bind(f,"click",function(a){return a.preventDefault(),d.closed=!d.closed,!1}),a.closed||(this.closed=!1)}a.autoPlace&&(o.isUndefined(a.parent)&&(E&&(F=document.createElement("div"),n.addClass(F,"dg"),n.addClass(F,I.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(F),E=!1),F.appendChild(this.domElement),n.addClass(this.domElement,I.CLASS_AUTO_PLACE)),this.parent||v(d,a.width)),n.bind(window,"resize",function(){d.onResize()}),n.bind(this.__ul,"webkitTransitionEnd",function(){d.onResize()}),n.bind(this.__ul,"transitionend",function(){d.onResize()}),n.bind(this.__ul,"oTransitionEnd",function(){d.onResize()}),this.onResize(),a.resizable&&u(this),d.getRoot(),a.parent||c()};return I.toggleHide=function(){G=!G,o.each(H,function(a){a.domElement.style.zIndex=G?-999:999,a.domElement.style.opacity=G?0:1})},I.CLASS_AUTO_PLACE="a",I.CLASS_AUTO_PLACE_CONTAINER="ac",I.CLASS_MAIN="main",I.CLASS_CONTROLLER_ROW="cr",I.CLASS_TOO_TALL="taller-than-window",I.CLASS_CLOSED="closed",I.CLASS_CLOSE_BUTTON="close-button",I.CLASS_DRAG="drag",I.DEFAULT_WIDTH=245,I.TEXT_CLOSED="Close Controls",I.TEXT_OPEN="Open Controls",n.bind(window,"keydown",function(a){document.activeElement.type!=="text"&&(a.which===72||a.keyCode==72)&&I.toggleHide()},!1),o.extend(I.prototype,{add:function(a,b){return p(this,a,b,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(a,b){return p(this,a,b,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li),this.__controllers.slice(this.__controllers.indexOf(a),1);var b=this;o.defer(function(){b.onResize()})},destroy:function(){this.autoPlace&&F.removeChild(this.domElement)},addFolder:function(a){if(this.__folders[a]!==void 0)throw Error('You already have a folder in this GUI by the name "'+a+'"');var b={name:a,parent:this};return b.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[a]&&(b.closed=this.load.folders[a].closed,b.load=this.load.folders[a]),b=new I(b),this.__folders[a]=b,a=q(this,b.domElement),n.addClass(a,"folder"),b},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var b=n.getOffset(a.__ul).top,c=0;o.each(a.__ul.childNodes,function(b){a.autoPlace&&b===a.__save_row||(c+=n.getHeight(b))}),window.innerHeight-b-20<c?(n.addClass(a.domElement,I.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-b-20+"px"):(n.removeClass(a.domElement,I.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&o.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"}),a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){o.isUndefined(D)&&(D=new m,D.domElement.innerHTML=b);if(this.parent)throw Error("You can only call remember on a top level GUI.");var a=this;o.each(Array.prototype.slice.call(arguments),function(b){a.__rememberedObjects.length==0&&t(a),a.__rememberedObjects.indexOf(b)==-1&&a.__rememberedObjects.push(b)}),this.autoPlace&&v(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;return a.closed=this.closed,this.__rememberedObjects.length>0&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=w(this)),a.folders={},o.each(this.__folders,function(b,c){a.folders[c]=b.getSaveObject()}),a},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=w(this),y(this,!1)},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered[A]=w(this,!0)),this.load.remembered[a]=w(this),this.preset=a,x(this,a,!0)},revert:function(a){o.each(this.__controllers,function(b){this.getRoot().load.remembered?s(a||this.getRoot(),b):b.setValue(b.initialValue)},this),o.each(this.__folders,function(a){a.revert(a)}),a||y(this.getRoot(),!1)},listen:function(a){var b=this.__listening.length==0;this.__listening.push(a),b&&z(this.__listening)}}),I}(b.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",b.controllers.factory=function(a,b,c,d,e,f,g){return function(h,i,j,k){var l=h[i];if(g.isArray(j)||g.isObject(j))return new a(h,i,j);if(g.isNumber(l))return g.isNumber(j)&&g.isNumber(k)?new c(h,i,j,k):new b(h,i,{min:j,max:k});if(g.isString(l))return new d(h,i);if(g.isFunction(l))return new e(h,i,"");if(g.isBoolean(l))return new f(h,i)}}(b.controllers.OptionController,b.controllers.NumberControllerBox,b.controllers.NumberControllerSlider,b.controllers.StringController=function(a,b,c){var d=function(a,c){function e(){f.setValue(f.__input.value)}d.superclass.call(this,a,c);var f=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),b.bind(this.__input,"keyup",e),b.bind(this.__input,"change",e),b.bind(this.__input,"blur",function(){f.__onFinishChange&&f.__onFinishChange.call(f,f.getValue())}),b.bind(this.__input,"keydown",function(a){a.keyCode===13&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return d.superclass=a,c.extend(d.prototype,a.prototype,{updateDisplay:function(){return b.isActive(this.__input)||(this.__input.value=this.getValue()),d.superclass.prototype.updateDisplay.call(this)}}),d}(b.controllers.Controller,b.dom.dom,b.utils.common),b.controllers.FunctionController,b.controllers.BooleanController,b.utils.common),b.controllers.Controller,b.controllers.BooleanController,b.controllers.FunctionController,b.controllers.NumberControllerBox,b.controllers.NumberControllerSlider,b.controllers.OptionController,b.controllers.ColorController=function(a,b,c,d,e){function f(a,b,c,d){a.style.background="",e.each(i,function(e){a.style.cssText+="background: "+e+"linear-gradient("+b+", "+c+" 0%, "+d+" 100%); "})}function g(a){a.style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var h=function(a,i){function j(a){o(a),b.bind(window,"mousemove",o),b.bind(window,"mouseup",k)}function k(){b.unbind(window,"mousemove",o),b.unbind(window,"mouseup",k)}function l(){var a=d(this.value);a!==!1?(q.__color.__state=a,q.setValue(q.__color.toOriginal())):this.value=q.__color.toString()}function m(){b.unbind(window,"mousemove",p),b.unbind(window,"mouseup",m)}function o(a){a.preventDefault();var c=b.getWidth(q.__saturation_field),d=b.getOffset(q.__saturation_field),e=(a.clientX-d.left+document.body.scrollLeft)/c,a=1-(a.clientY-d.top+document.body.scrollTop)/c;return a>1?a=1:a<0&&(a=0),e>1?e=1:e<0&&(e=0),q.__color.v=a,q.__color.s=e,q.setValue(q.__color.toOriginal()),!1}function p(a){a.preventDefault();var c=b.getHeight(q.__hue_field),d=b.getOffset(q.__hue_field),a=1-(a.clientY-d.top+document.body.scrollTop)/c;return a>1?a=1:a<0&&(a=0),q.__color.h=a*360,q.setValue(q.__color.toOriginal()),!1}h.superclass.call(this,a,i),this.__color=new c(this.getValue()),this.__temp=new c(0);var q=this;this.domElement=document.createElement("div"),b.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",b.bind(this.__input,"keydown",function(a){a.keyCode===13&&l.call(this)}),b.bind(this.__input,"blur",l),b.bind(this.__selector,"mousedown",function(){b.addClass(this,"drag").bind(window,"mouseup",function(){b.removeClass(q.__selector,"drag")})});var r=document.createElement("div");e.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),e.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),e.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),e.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),e.extend(r.style,{width:"100%",height:"100%",background:"none"}),f(r,"top","rgba(0,0,0,0)","#000"),e.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),g(this.__hue_field),e.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),b.bind(this.__saturation_field,"mousedown",j),b.bind(this.__field_knob,"mousedown",j),b.bind(this.__hue_field,"mousedown",function(a){p(a),b.bind(window,"mousemove",p),b.bind(window,"mouseup",m)}),this.__saturation_field.appendChild(r),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};h.superclass=a,e.extend(h.prototype,a.prototype,{updateDisplay:function(){var a=d(this.getValue());if(a!==!1){var b=!1;e.each(c.COMPONENTS,function(c){if(!e.isUndefined(a[c])&&!e.isUndefined(this.__color.__state[c])&&a[c]!==this.__color.__state[c])return b=!0,{}},this),b&&e.extend(this.__color.__state,a)}e.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var g=this.__color.v<.5||this.__color.s>.5?255:0,h=255-g;e.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+g+","+g+","+g+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,f(this.__saturation_field,"left","#fff",this.__temp.toString()),e.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+g+","+g+","+g+")",textShadow:this.__input_textShadow+"rgba("+h+","+h+","+h+",.7)"})}});var i=["-moz-","-o-","-webkit-","-ms-",""];return h}(b.controllers.Controller,b.dom.dom,b.color.Color=function(a,b,c,d){function e(a,b,c){Object.defineProperty(a,b,{get:function(){return this.__state.space==="RGB"?this.__state[b]:(g(this,b,c),this.__state[b])},set:function(a){this.__state.space!=="RGB"&&(g(this,b,c),this.__state.space="RGB"),this.__state[b]=a}})}function f(a,b){Object.defineProperty(a,b,{get:function(){return this.__state.space==="HSV"?this.__state[b]:(h(this),this.__state[b])},set:function(a){this.__state.space!=="HSV"&&(h(this),this.__state.space="HSV"),this.__state[b]=a}})}function g(a,c,e){if(a.__state.space==="HEX")a.__state[c]=b.component_from_hex(a.__state.hex,e);else{if(a.__state.space!=="HSV")throw"Corrupted color state";d.extend(a.__state,b.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v))}}function h(a){var c=b.rgb_to_hsv(a.r,a.g,a.b);d.extend(a.__state,{s:c.s,v:c.v}),d.isNaN(c.h)?d.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=c.h}var i=function(){this.__state=a.apply(this,arguments);if(this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return i.COMPONENTS="r,g,b,h,s,v,hex,a".split(","),d.extend(i.prototype,{toString:function(){return c(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),e(i.prototype,"r",2),e(i.prototype,"g",1),e(i.prototype,"b",0),f(i.prototype,"h"),f(i.prototype,"s"),f(i.prototype,"v"),Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}}),Object.defineProperty(i.prototype,"hex",{get:function(){return!this.__state.space!=="HEX"&&(this.__state.hex=b.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(a){this.__state.space="HEX",this.__state.hex=a}}),i}(b.color.interpret,b.color.math=function(){var a;return{hsv_to_rgb:function(a,b,c){var d=a/60-Math.floor(a/60),e=c*(1-b),f=c*(1-d*b),b=c*(1-(1-d)*b),a=[[c,b,e],[f,c,e],[e,c,b],[e,f,c],[b,e,c],[c,e,f]][Math.floor(a/60)%6];return{r:a[0]*255,g:a[1]*255,b:a[2]*255}},rgb_to_hsv:function(a,b,c){var d=Math.min(a,b,c),e=Math.max(a,b,c),d=e-d;return e==0?{h:NaN,s:0,v:0}:(a=a==e?(b-c)/d:b==e?2+(c-a)/d:4+(a-b)/d,a/=6,a<0&&(a+=1),{h:a*360,s:d/e,v:e/255})},rgb_to_hex:function(a,b,c){return a=this.hex_with_component(0,2,a),a=this.hex_with_component(a,1,b),a=this.hex_with_component(a,0,c)},component_from_hex:function(a,b){return a>>b*8&255},hex_with_component:function(b,c,d){return d<<(a=c*8)|b&~(255<<a)}}}(),b.color.toString,b.utils.common),b.color.interpret,b.utils.common),b.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),b.dom.CenteredDiv=function(a,b){var c=function(){this.backgroundElement=document.createElement("div"),b.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),a.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),b.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var c=this;a.bind(this.backgroundElement,"click",function(){c.hide()})};return c.prototype.show=function(){var a=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),b.defer(function(){a.backgroundElement.style.opacity=1,a.domElement.style.opacity=1,a.domElement.style.webkitTransform="scale(1)"})},c.prototype.hide=function(){var b=this,c=function(){b.domElement.style.display="none",b.backgroundElement.style.display="none",a.unbind(b.domElement,"webkitTransitionEnd",c),a.unbind(b.domElement,"transitionend",c),a.unbind(b.domElement,"oTransitionEnd",c)};a.bind(this.domElement,"webkitTransitionEnd",c),a.bind(this.domElement,"transitionend",c),a.bind(this.domElement,"oTransitionEnd",c),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},c.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-a.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-a.getHeight(this.domElement)/2+"px"},c}(b.dom.dom,b.utils.common),b.dom.dom,b.utils.common),define("vendor/dat.gui.min",function(){}),function(){var c=function(a,b){return function(){return a.apply(b,arguments)}};define("app",["jquery","vendor/namespace","Three","CopyShader","ConvolutionShader","VignetteShader","FilmShader","TrackballControls","EffectComposer","RenderPass","BloomPass","FilmPass","TexturePass","ShaderPass","MaskPass","CopyShader","objects/Stars","objects/Planet","vendor/dat.gui.min"],function(){var d;return namespace("ThreePlanet",{App:d=function(){function d(){this.onResize=c(this.onResize,this),this.render=c(this.render,this),this.animate=c(this.animate,this),this.createLensFlare=c(this.createLensFlare,this),this.initRenderer=c(this.initRenderer,this),this.createLights=c(this.createLights,this),this.createCamera=c(this.createCamera,this),this.updateWorld=c(this.updateWorld,this),this.createWorld=c(this.createWorld,this);var d,e,f,g,h=this;this.clock=new a.Clock,this.scene=new a.Scene,this.PLANET_POSITION=new a.Vector3(.001,.001,.001),this.PLANET_RADIUS=200,this.lightPosition=new a.Vector3(0,0,-this.PLANET_RADIUS*10),this.LIGHT_DIRECTION=this.PLANET_POSITION.clone().subSelf(this.lightPosition).normalize(),this.renderer=new a.WebGLRenderer({clearColor:0,alpha:!0,clearAlpha:1,antialias:!0}),this.bloom=.6,this.grain=.25,this.scanlines=.025,this.vignette=1.5,this.vignetteOffset=1,this.createCamera(),this.createLights(),this.initRenderer(),this.createWorld(),this.createLensFlare(),$(window).bind("resize",function(a){return h.onResize()}),this.animate(),f=new b.GUI({width:300,hide:!0}),this.camera="space",f.add(this,"camera",["space","atmosphere"]).onChange(function(a){return h.currentCamera=function(){switch(a){case"atmosphere":return this.camera2;default:return this.camera1}}.call(h)}),e=f.addFolder("Basic"),e.add(this.planet.planetUtil,"exposure",1,4),e.add(this.planet.planetUtil,"innerRadius"),e.add(this.planet.planetUtil,"outerRadius"),d=f.addFolder("Advanced"),d.addColor(this.planet.planetUtil,"wavelengthColor"),d.add(this.planet.planetUtil,"scaleDepth",0,2),d.add(this.planet.planetUtil,"Kr",0,.01),d.add(this.planet.planetUtil,"Km",0,.1),g=f.addFolder("Post-processing"),g.add(this,"bloom",0,2),g.add(this,"grain",0,2),g.add(this,"scanlines",0,1),g.add(this,"vignette",0,2),g.add(this,"vignetteOffset",0,2)}return d.prototype.createWorld=function(){var b,c,d,e,f,g;return this.stars=new ThreePlanet.objects.Stars,this.scene.add(this.stars),this.planet=new ThreePlanet.objects.Planet(this.PLANET_RADIUS,this.PLANET_POSITION,this.directionalLight,this.currentCamera),this.scene.add(this.planet),d="textures/nightCompressed/",g=[d+"px.jpg",d+"nx.jpg",d+"py.jpg",d+"ny.jpg",d+"pz.jpg",d+"nz.jpg"],f=a.ImageUtils.loadTextureCube(g),e=a.ShaderUtils.lib.cube,e.uniforms.tCube.value=f,b=new a.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:e.uniforms,side:a.BackSide}),c=new a.Mesh(new a.CubeGeometry(1e4,1e4,1e4),b),this.scene.add(c)},d.prototype.updateWorld=function(a,b){return this.lightPosition.z=Math.cos(a*.05)*this.PLANET_RADIUS*10,this.lightPosition.x=Math.sin(a*.05)*this.PLANET_RADIUS*10,this.lightPosition.y=Math.sin(a*.05)*-this.PLANET_RADIUS*.5,this.scene.updateMatrixWorld(),this.planet.update(a,b)},d.prototype.createCamera=function(){return this.camera1=new a.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,1e4),this.scene.add(this.camera1),this.controls=new a.TrackballControls(this.camera1,this.renderer.domElement),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.4,this.controls.panSpeed=.2,this.controls.noZoom=!1,this.controls.noPan=!1,this.controls.staticMoving=!1,this.controls.dynamicDampingFactor=.1,this.controls.keys=[65,83,68],this.camera1.position.set(this.PLANET_POSITION.x+this.PLANET_RADIUS*2,this.PLANET_POSITION.y,this.PLANET_POSITION.z+this.PLANET_RADIUS*2),this.camera1.position.x=-600,this.camera1.position.z=0,this.camera1.lookAt(this.PLANET_POSITION),this.camera2=new a.PerspectiveCamera(80,window.innerWidth/window.innerHeight,.1,1e4),this.scene.add(this.camera2),this.camera2.position=new a.Vector3(-67.54433193947916,134.44195702074728,-134.0052727111125),this.camera2.rotation=new a.Vector3(.2,-0.9,1.01),this.currentCamera=this.camera1},d.prototype.createLights=function(){return this.directionalLight=new a.DirectionalLight(16777215,1.15),this.directionalLight.position=this.lightPosition,this.scene.add(this.directionalLight)},d.prototype.initRenderer=function(){var b;return $("body").append("<div id='container'></div>"),this.container=$("#container")[0],this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.autoClear=!1,this.container.appendChild(this.renderer.domElement),this.renderModel=new a.RenderPass(this.scene,this.currentCamera),this.effectBloom=new a.BloomPass(this.bloom),this.effectFilm=new a.FilmPass(this.grain,this.scanlines,648,!1),this.effectVignette=new a.ShaderPass(a.VignetteShader),this.effectVignette.uniforms.darkness.value=this.vignette,console.log(this.effectBloom),console.log(this.effectFilm.uniforms),console.log(this.effectVignette.uniforms),b={minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.ARGBFormat,stencilBuffer:!1},this.renderTarget=new a.WebGLRenderTarget(window.innerWidth,window.innerHeight,b),this.composer=new a.EffectComposer(this.renderer,this.renderTarget),this.composer.addPass(this.renderModel),this.composer.addPass(this.effectBloom),this.composer.addPass(this.effectFilm),this.composer.addPass(this.effectVignette),this.effectVignette.renderToScreen=!0},d.prototype.createLensFlare=function(){var b,c,d,e;return c=a.ImageUtils.loadTexture("textures/lensflare0.jpg"),d=a.ImageUtils.loadTexture("textures/lensflare2.jpg"),e=a.ImageUtils.loadTexture("textures/lensflare3.jpg"),b=new a.Color(16777215),this.lensFlare=new a.LensFlare(c,700,0,a.AdditiveBlending,b),this.lensFlare.add(d,512,0,a.AdditiveBlending),this.lensFlare.add(d,512,0,a.AdditiveBlending),this.lensFlare.add(d,512,0,a.AdditiveBlending),this.lensFlare.add(e,60,.6,a.AdditiveBlending),this.lensFlare.add(e,70,.7,a.AdditiveBlending),this.lensFlare.add(e,120,.9,a.AdditiveBlending),this.lensFlare.add(e,70,1,a.AdditiveBlending),this.lensFlare.position=this.lightPosition,this.lensFlare.customUpdateCallback=this.updateLensFlare,this.scene.add(this.lensFlare)},d.prototype.animate=function(){var a,b;return a=this.clock.getDelta(),b=this.clock.getElapsedTime()*10,this.bloom=.6,this.grain=.25,this.scanlines=.025,this.vignette=1.5,this.vignetteOffset=1,console.log(this.effectBloom),this.effectFilm.uniforms.nIntensity.value=this,this.effectVignette.uniforms.darkness.value=this.vignette,this.effectVignette.uniforms.offset.value=this.vignetteOffset,requestAnimationFrame(this.animate),this.controls&&this.controls.update(),this.updateWorld(b,a),this.render(b,a)},d.prototype.render=function(a,b){return this.renderer.clear(),this.composer?(this.renderModel.camera=this.currentCamera,this.planet.camera=this.currentCamera,this.composer.render(b)):this.renderer.render(this.scene,this.currentCamera)},d.prototype.onResize=function(){var a,b;b=window.innerWidth,a=window.innerHeight,this.camera1.aspect=b/a,this.camera2.aspect=this.camera1.aspect,this.camera1.updateProjectionMatrix(),this.camera2.updateProjectionMatrix(),this.controls&&(this.controls.screen.width=b,this.controls.screen.height=a),this.renderer.setSize(window.innerWidth,window.innerHeight);if(this.composer)return this.composer.reset()},d}()})})}.call(this),require.config({shim:{Three:{exports:"THREE"},CopyShader:["Three"],ConvolutionShader:["Three"],VignetteShader:["Three"],FilmShader:["Three"],TrackballControls:["Three"],EffectComposer:["Three"],RenderPass:["Three"],BloomPass:["Three"],FilmPass:["Three"],TexturePass:["Three"],ShaderPass:["Three"],MaskPass:["Three"]},paths:{jquery:"vendor/jquery.min",Three:"vendor/threejs/build/Three",CopyShader:"vendor/threejs/examples/js/shaders/CopyShader",ConvolutionShader:"vendor/threejs/examples/js/shaders/ConvolutionShader",VignetteShader:"vendor/threejs/examples/js/shaders/VignetteShader",FilmShader:"vendor/threejs/examples/js/shaders/FilmShader",TrackballControls:"vendor/threejs/examples/js/controls/TrackballControls",EffectComposer:"vendor/threejs/examples/js/postprocessing/EffectComposer",RenderPass:"vendor/threejs/examples/js/postprocessing/RenderPass",BloomPass:"vendor/threejs/examples/js/postprocessing/BloomPass",FilmPass:"vendor/threejs/examples/js/postprocessing/FilmPass",TexturePass:"vendor/threejs/examples/js/postprocessing/TexturePass",ShaderPass:"vendor/threejs/examples/js/postprocessing/ShaderPass",MaskPass:"vendor/threejs/examples/js/postprocessing/MaskPass"}}),require(["app"],function(){new ThreePlanet.App}),define("main",function(){})}();